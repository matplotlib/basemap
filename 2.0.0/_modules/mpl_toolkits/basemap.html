<!doctype html>
<html class="no-js" lang="en" data-content_root="../../">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><link rel="index" title="Index" href="../../genindex.html" /><link rel="search" title="Search" href="../../search.html" />

    <!-- Generated with Sphinx 7.4.7 and Furo 2024.08.06 -->
        <title>mpl_toolkits.basemap - basemap 2.0.0 documentation</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=8f2a1f02" />
    <link rel="stylesheet" type="text/css" href="../../_static/styles/furo.css?v=354aac6f" />
    <link rel="stylesheet" type="text/css" href="../../_static/plot_directive.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/styles/furo-extensions.css?v=302659d7" />
    
    


<style>
  body {
    --color-code-background: #f8f8f8;
  --color-code-foreground: black;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
      }
    }
  }
</style></head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-with-moon" viewBox="0 0 24 24">
    <title>Auto light/dark, in light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path style="opacity: 50%" d="M 5.411 14.504 C 5.471 14.504 5.532 14.504 5.591 14.504 C 3.639 16.319 4.383 19.569 6.931 20.352 C 7.693 20.586 8.512 20.551 9.25 20.252 C 8.023 23.207 4.056 23.725 2.11 21.184 C 0.166 18.642 1.702 14.949 4.874 14.536 C 5.051 14.512 5.231 14.5 5.411 14.5 L 5.411 14.504 Z"/>
      <line x1="14.5" y1="3.25" x2="14.5" y2="1.25"/>
      <line x1="14.5" y1="15.85" x2="14.5" y2="17.85"/>
      <line x1="10.044" y1="5.094" x2="8.63" y2="3.68"/>
      <line x1="19" y1="14.05" x2="20.414" y2="15.464"/>
      <line x1="8.2" y1="9.55" x2="6.2" y2="9.55"/>
      <line x1="20.8" y1="9.55" x2="22.8" y2="9.55"/>
      <line x1="10.044" y1="14.006" x2="8.63" y2="15.42"/>
      <line x1="19" y1="5.05" x2="20.414" y2="3.636"/>
      <circle cx="14.5" cy="9.55" r="3.6"/>
    </svg>
  </symbol>
  <symbol id="svg-moon-with-sun" viewBox="0 0 24 24">
    <title>Auto light/dark, in dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path d="M 8.282 7.007 C 8.385 7.007 8.494 7.007 8.595 7.007 C 5.18 10.184 6.481 15.869 10.942 17.24 C 12.275 17.648 13.706 17.589 15 17.066 C 12.851 22.236 5.91 23.143 2.505 18.696 C -0.897 14.249 1.791 7.786 7.342 7.063 C 7.652 7.021 7.965 7 8.282 7 L 8.282 7.007 Z"/>
      <line style="opacity: 50%" x1="18" y1="3.705" x2="18" y2="2.5"/>
      <line style="opacity: 50%" x1="18" y1="11.295" x2="18" y2="12.5"/>
      <line style="opacity: 50%" x1="15.316" y1="4.816" x2="14.464" y2="3.964"/>
      <line style="opacity: 50%" x1="20.711" y1="10.212" x2="21.563" y2="11.063"/>
      <line style="opacity: 50%" x1="14.205" y1="7.5" x2="13.001" y2="7.5"/>
      <line style="opacity: 50%" x1="21.795" y1="7.5" x2="23" y2="7.5"/>
      <line style="opacity: 50%" x1="15.316" y1="10.184" x2="14.464" y2="11.036"/>
      <line style="opacity: 50%" x1="20.711" y1="4.789" x2="21.563" y2="3.937"/>
      <circle style="opacity: 50%" cx="18" cy="7.5" r="2.169"/>
    </svg>
  </symbol>
  <symbol id="svg-pencil" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-pencil-code">
      <path d="M4 20h4l10.5 -10.5a2.828 2.828 0 1 0 -4 -4l-10.5 10.5v4" />
      <path d="M13.5 6.5l4 4" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
  <symbol id="svg-eye" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-eye-code">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M10 12a2 2 0 1 0 4 0a2 2 0 0 0 -4 0" />
      <path
        d="M11.11 17.958c-3.209 -.307 -5.91 -2.293 -8.11 -5.958c2.4 -4 5.4 -6 9 -6c3.6 0 6.6 2 9 6c-.21 .352 -.427 .688 -.647 1.008" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
  <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
  <div class="visually-hidden">Hide table of contents sidebar</div>
</label>

<a class="skip-to-content muted-link" href="#furo-main-content">Skip to content</a>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <div class="visually-hidden">Toggle site navigation sidebar</div>
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="../../index.html"><div class="brand">basemap 2.0.0 documentation</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle">
          <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
          <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
          <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon no-toc" for="__toc">
        <div class="visually-hidden">Toggle table of contents sidebar</div>
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand" href="../../index.html">
  
  
  <span class="sidebar-brand-text">basemap 2.0.0 documentation</span>
  
</a><form class="sidebar-search-container" method="get" action="../../search.html" role="search">
  <input class="sidebar-search" placeholder="Search" name="q" aria-label="Search">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <ul>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../users/index.html">Basemap User’s Guide</a><input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" role="switch" type="checkbox"/><label for="toctree-checkbox-1"><div class="visually-hidden">Toggle navigation of Basemap User’s Guide</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../users/introduction.html">Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../users/installation.html">Installation</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../users/mapsetup.html">Setting up the map</a><input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" role="switch" type="checkbox"/><label for="toctree-checkbox-2"><div class="visually-hidden">Toggle navigation of Setting up the map</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../users/aeqd.html">Azimuthal Equidistant Projection</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../users/gnomon.html">Gnomonic Projection</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../users/ortho.html">Orthographic Projection</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../users/geos.html">Geostationary Projection</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../users/nsper.html">Near-Sided Perspective Projection</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../users/moll.html">Mollweide Projection</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../users/hammer.html">Hammer Projection</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../users/robin.html">Robinson Projection</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../users/eck4.html">Eckert IV Projection</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../users/kav7.html">Kavrayskiy VII Projection</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../users/mbtfpq.html">McBryde-Thomas Flat Polar Quartic</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../users/sinu.html">Sinusoidal Projection</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../users/cyl.html">Equidistant Cylindrical Projection</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../users/cass.html">Cassini Projection</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../users/merc.html">Mercator Projection</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../users/tmerc.html">Transverse Mercator Projection</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../users/omerc.html">Oblique Mercator Projection</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../users/poly.html">Polyconic Projection</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../users/mill.html">Miller Cylindrical Projection</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../users/gall.html">Gall Stereographic Projection</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../users/cea.html">Cylindrical Equal-Area Projection</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../users/lcc.html">Lambert Conformal Projection</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../users/laea.html">Lambert Azimuthal Equal Area Projection</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../users/stere.html">Stereographic Projection</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../users/eqdc.html">Equidistant Conic Projection</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../users/aea.html">Albers Equal Area Projection</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../users/pstere.html">Polar Stereographic Projection</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../users/plaea.html">Polar Lambert Azimuthal Projection</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../users/paeqd.html">Polar Azimuthal Equidistant Projection</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../users/vandg.html">van der Grinten Projection</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../users/geography.html">Drawing a Map Background</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../users/graticule.html">Drawing and Labelling Parallels and Meridians</a><input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" role="switch" type="checkbox"/><label for="toctree-checkbox-3"><div class="visually-hidden">Toggle navigation of Drawing and Labelling Parallels and Meridians</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul class="simple">
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../users/mapcoords.html">Converting to and from map projection coordinates</a><input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" role="switch" type="checkbox"/><label for="toctree-checkbox-4"><div class="visually-hidden">Toggle navigation of Converting to and from map projection coordinates</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul class="simple">
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../users/examples.html">Plotting data on a map (Example Gallery)</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../api/index.html">Basemap API</a><input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" role="switch" type="checkbox"/><label for="toctree-checkbox-5"><div class="visually-hidden">Toggle navigation of Basemap API</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../api/basemap_api.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">mpl_toolkits.basemap</span></code></a></li>
</ul>
</li>
</ul>

</div>
</div>

      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container">
          <div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle">
              <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
              <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
              <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon no-toc" for="__toc">
            <div class="visually-hidden">Toggle table of contents sidebar</div>
            <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
          </label>
        </div>
        <article role="main" id="furo-main-content">
          <h1>Source code for mpl_toolkits.basemap</h1><div class="highlight"><pre>
<span></span><span class="kn">from</span><span class="w"> </span><span class="nn">__future__</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span><span class="n">absolute_import</span><span class="p">,</span> <span class="n">division</span><span class="p">,</span> <span class="n">print_function</span><span class="p">)</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Module for plotting data on maps with matplotlib.</span>

<span class="sd">Contains the :class:`Basemap` class (which does most of the</span>
<span class="sd">heavy lifting), and the following functions:</span>

<span class="sd">:func:`interp`:  bilinear interpolation between rectilinear grids.</span>

<span class="sd">:func:`maskoceans`:  mask &#39;wet&#39; points of an input array.</span>

<span class="sd">:func:`shiftgrid`:  shifts global lat/lon grids east or west.</span>

<span class="sd">:func:`addcyclic`: Add cyclic (wraparound) point in longitude.</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">sys</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">math</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">warnings</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">functools</span>
<span class="k">try</span><span class="p">:</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">urllib2</span><span class="w"> </span><span class="kn">import</span> <span class="n">urlopen</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">urllib</span><span class="w"> </span><span class="kn">import</span> <span class="n">urlretrieve</span>
<span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">urllib.request</span><span class="w"> </span><span class="kn">import</span> <span class="n">urlopen</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">urllib.request</span><span class="w"> </span><span class="kn">import</span> <span class="n">urlretrieve</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy.ma</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">ma</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">mpl</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">matplotlib.artist</span><span class="w"> </span><span class="kn">import</span> <span class="n">Artist</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">matplotlib.collections</span><span class="w"> </span><span class="kn">import</span> <span class="n">LineCollection</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">matplotlib.collections</span><span class="w"> </span><span class="kn">import</span> <span class="n">PolyCollection</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">matplotlib.image</span><span class="w"> </span><span class="kn">import</span> <span class="n">imread</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">matplotlib.lines</span><span class="w"> </span><span class="kn">import</span> <span class="n">Line2D</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">matplotlib.patches</span><span class="w"> </span><span class="kn">import</span> <span class="n">Circle</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">matplotlib.patches</span><span class="w"> </span><span class="kn">import</span> <span class="n">Ellipse</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">matplotlib.patches</span><span class="w"> </span><span class="kn">import</span> <span class="n">FancyArrowPatch</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">matplotlib.patches</span><span class="w"> </span><span class="kn">import</span> <span class="n">Polygon</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">matplotlib.transforms</span><span class="w"> </span><span class="kn">import</span> <span class="n">Bbox</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">mpl_toolkits.axes_grid1</span><span class="w"> </span><span class="kn">import</span> <span class="n">make_axes_locatable</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">pyproj</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">_geoslib</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">.</span> <span class="n">proj</span> <span class="kn">import</span><span class="w"> </span><span class="nn">Proj</span>


<span class="n">__version__</span> <span class="o">=</span> <span class="s2">&quot;2.0.0&quot;</span>

<span class="c1"># basemap data files now installed in lib/matplotlib/toolkits/basemap/data</span>
<span class="c1"># check to see if environment variable BASEMAPDATA set to a directory,</span>
<span class="c1"># and if so look for the data there.</span>
<span class="k">if</span> <span class="s1">&#39;BASEMAPDATA&#39;</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">:</span>
    <span class="n">basemap_datadir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;BASEMAPDATA&#39;</span><span class="p">]</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">basemap_datadir</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s1">&#39;Path in environment BASEMAPDATA not a directory&#39;</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">mpl_toolkits</span><span class="w"> </span><span class="kn">import</span> <span class="n">basemap_data</span>
    <span class="n">basemap_datadir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">basemap_data</span><span class="o">.</span><span class="n">__path__</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>

<span class="c1"># module variable that sets the default value for the &#39;latlon&#39; kwarg.</span>
<span class="c1"># can be set to True by user so plotting functions can take lons,lats</span>
<span class="c1"># in degrees by default, instead of x,y (map projection coords in meters).</span>
<span class="n">latlon_default</span> <span class="o">=</span> <span class="kc">False</span>

<span class="c1"># supported map projections.</span>
<span class="n">_projnames</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;cyl&#39;</span>      <span class="p">:</span> <span class="s1">&#39;Cylindrical Equidistant&#39;</span><span class="p">,</span>
             <span class="s1">&#39;merc&#39;</span>     <span class="p">:</span> <span class="s1">&#39;Mercator&#39;</span><span class="p">,</span>
             <span class="s1">&#39;tmerc&#39;</span>    <span class="p">:</span> <span class="s1">&#39;Transverse Mercator&#39;</span><span class="p">,</span>
             <span class="s1">&#39;omerc&#39;</span>    <span class="p">:</span> <span class="s1">&#39;Oblique Mercator&#39;</span><span class="p">,</span>
             <span class="s1">&#39;mill&#39;</span>     <span class="p">:</span> <span class="s1">&#39;Miller Cylindrical&#39;</span><span class="p">,</span>
             <span class="s1">&#39;gall&#39;</span>     <span class="p">:</span> <span class="s1">&#39;Gall Stereographic Cylindrical&#39;</span><span class="p">,</span>
             <span class="s1">&#39;cea&#39;</span>      <span class="p">:</span> <span class="s1">&#39;Cylindrical Equal Area&#39;</span><span class="p">,</span>
             <span class="s1">&#39;lcc&#39;</span>      <span class="p">:</span> <span class="s1">&#39;Lambert Conformal&#39;</span><span class="p">,</span>
             <span class="s1">&#39;laea&#39;</span>     <span class="p">:</span> <span class="s1">&#39;Lambert Azimuthal Equal Area&#39;</span><span class="p">,</span>
             <span class="s1">&#39;nplaea&#39;</span>   <span class="p">:</span> <span class="s1">&#39;North-Polar Lambert Azimuthal&#39;</span><span class="p">,</span>
             <span class="s1">&#39;splaea&#39;</span>   <span class="p">:</span> <span class="s1">&#39;South-Polar Lambert Azimuthal&#39;</span><span class="p">,</span>
             <span class="s1">&#39;eqdc&#39;</span>     <span class="p">:</span> <span class="s1">&#39;Equidistant Conic&#39;</span><span class="p">,</span>
             <span class="s1">&#39;aeqd&#39;</span>     <span class="p">:</span> <span class="s1">&#39;Azimuthal Equidistant&#39;</span><span class="p">,</span>
             <span class="s1">&#39;npaeqd&#39;</span>   <span class="p">:</span> <span class="s1">&#39;North-Polar Azimuthal Equidistant&#39;</span><span class="p">,</span>
             <span class="s1">&#39;spaeqd&#39;</span>   <span class="p">:</span> <span class="s1">&#39;South-Polar Azimuthal Equidistant&#39;</span><span class="p">,</span>
             <span class="s1">&#39;aea&#39;</span>      <span class="p">:</span> <span class="s1">&#39;Albers Equal Area&#39;</span><span class="p">,</span>
             <span class="s1">&#39;stere&#39;</span>    <span class="p">:</span> <span class="s1">&#39;Stereographic&#39;</span><span class="p">,</span>
             <span class="s1">&#39;npstere&#39;</span>  <span class="p">:</span> <span class="s1">&#39;North-Polar Stereographic&#39;</span><span class="p">,</span>
             <span class="s1">&#39;spstere&#39;</span>  <span class="p">:</span> <span class="s1">&#39;South-Polar Stereographic&#39;</span><span class="p">,</span>
             <span class="s1">&#39;cass&#39;</span>     <span class="p">:</span> <span class="s1">&#39;Cassini-Soldner&#39;</span><span class="p">,</span>
             <span class="s1">&#39;poly&#39;</span>     <span class="p">:</span> <span class="s1">&#39;Polyconic&#39;</span><span class="p">,</span>
             <span class="s1">&#39;ortho&#39;</span>    <span class="p">:</span> <span class="s1">&#39;Orthographic&#39;</span><span class="p">,</span>
             <span class="s1">&#39;geos&#39;</span>     <span class="p">:</span> <span class="s1">&#39;Geostationary&#39;</span><span class="p">,</span>
             <span class="s1">&#39;nsper&#39;</span>    <span class="p">:</span> <span class="s1">&#39;Near-Sided Perspective&#39;</span><span class="p">,</span>
             <span class="s1">&#39;sinu&#39;</span>     <span class="p">:</span> <span class="s1">&#39;Sinusoidal&#39;</span><span class="p">,</span>
             <span class="s1">&#39;moll&#39;</span>     <span class="p">:</span> <span class="s1">&#39;Mollweide&#39;</span><span class="p">,</span>
             <span class="s1">&#39;hammer&#39;</span>   <span class="p">:</span> <span class="s1">&#39;Hammer&#39;</span><span class="p">,</span>
             <span class="s1">&#39;robin&#39;</span>    <span class="p">:</span> <span class="s1">&#39;Robinson&#39;</span><span class="p">,</span>
             <span class="s1">&#39;kav7&#39;</span>     <span class="p">:</span> <span class="s1">&#39;Kavrayskiy VII&#39;</span><span class="p">,</span>
             <span class="s1">&#39;eck4&#39;</span>     <span class="p">:</span> <span class="s1">&#39;Eckert IV&#39;</span><span class="p">,</span>
             <span class="s1">&#39;vandg&#39;</span>    <span class="p">:</span> <span class="s1">&#39;van der Grinten&#39;</span><span class="p">,</span>
             <span class="s1">&#39;mbtfpq&#39;</span>   <span class="p">:</span> <span class="s1">&#39;McBryde-Thomas Flat-Polar Quartic&#39;</span><span class="p">,</span>
             <span class="s1">&#39;gnom&#39;</span>     <span class="p">:</span> <span class="s1">&#39;Gnomonic&#39;</span><span class="p">,</span>
             <span class="s1">&#39;rotpole&#39;</span>  <span class="p">:</span> <span class="s1">&#39;Rotated Pole&#39;</span><span class="p">,</span>
             <span class="p">}</span>
<span class="n">supported_projections</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">_items</span> <span class="ow">in</span> <span class="n">_projnames</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="n">supported_projections</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot; </span><span class="si">%-17s%-40s</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">_items</span><span class="p">))</span>
<span class="n">supported_projections</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">supported_projections</span><span class="p">)</span>

<span class="n">_cylproj</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;cyl&#39;</span><span class="p">,</span><span class="s1">&#39;merc&#39;</span><span class="p">,</span><span class="s1">&#39;mill&#39;</span><span class="p">,</span><span class="s1">&#39;gall&#39;</span><span class="p">,</span><span class="s1">&#39;cea&#39;</span><span class="p">]</span>
<span class="n">_pseudocyl</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;moll&#39;</span><span class="p">,</span><span class="s1">&#39;robin&#39;</span><span class="p">,</span><span class="s1">&#39;eck4&#39;</span><span class="p">,</span><span class="s1">&#39;kav7&#39;</span><span class="p">,</span><span class="s1">&#39;sinu&#39;</span><span class="p">,</span><span class="s1">&#39;mbtfpq&#39;</span><span class="p">,</span><span class="s1">&#39;vandg&#39;</span><span class="p">,</span><span class="s1">&#39;hammer&#39;</span><span class="p">]</span>
<span class="n">_dg2rad</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="mf">1.</span><span class="p">)</span>
<span class="n">_rad2dg</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">degrees</span><span class="p">(</span><span class="mf">1.</span><span class="p">)</span>

<span class="c1"># projection specific parameters.</span>
<span class="n">projection_params</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;cyl&#39;</span>      <span class="p">:</span> <span class="s1">&#39;corners only (no width/height)&#39;</span><span class="p">,</span>
             <span class="s1">&#39;merc&#39;</span>     <span class="p">:</span> <span class="s1">&#39;corners plus lat_ts (no width/height)&#39;</span><span class="p">,</span>
             <span class="s1">&#39;tmerc&#39;</span>    <span class="p">:</span> <span class="s1">&#39;lon_0,lat_0,k_0&#39;</span><span class="p">,</span>
             <span class="s1">&#39;omerc&#39;</span>    <span class="p">:</span> <span class="s1">&#39;lon_0,lat_0,lat_1,lat_2,lon_1,lon_2,no_rot,k_0&#39;</span><span class="p">,</span>
             <span class="s1">&#39;mill&#39;</span>     <span class="p">:</span> <span class="s1">&#39;corners only (no width/height)&#39;</span><span class="p">,</span>
             <span class="s1">&#39;gall&#39;</span>     <span class="p">:</span> <span class="s1">&#39;corners only (no width/height)&#39;</span><span class="p">,</span>
             <span class="s1">&#39;cea&#39;</span>      <span class="p">:</span> <span class="s1">&#39;corners only plus lat_ts (no width/height)&#39;</span><span class="p">,</span>
             <span class="s1">&#39;lcc&#39;</span>      <span class="p">:</span> <span class="s1">&#39;lon_0,lat_0,lat_1,lat_2,k_0&#39;</span><span class="p">,</span>
             <span class="s1">&#39;laea&#39;</span>     <span class="p">:</span> <span class="s1">&#39;lon_0,lat_0&#39;</span><span class="p">,</span>
             <span class="s1">&#39;nplaea&#39;</span>   <span class="p">:</span> <span class="s1">&#39;bounding_lat,lon_0,lat_0,no corners or width/height&#39;</span><span class="p">,</span>
             <span class="s1">&#39;splaea&#39;</span>   <span class="p">:</span> <span class="s1">&#39;bounding_lat,lon_0,lat_0,no corners or width/height&#39;</span><span class="p">,</span>
             <span class="s1">&#39;eqdc&#39;</span>     <span class="p">:</span> <span class="s1">&#39;lon_0,lat_0,lat_1,lat_2&#39;</span><span class="p">,</span>
             <span class="s1">&#39;aeqd&#39;</span>     <span class="p">:</span> <span class="s1">&#39;lon_0,lat_0&#39;</span><span class="p">,</span>
             <span class="s1">&#39;npaeqd&#39;</span>   <span class="p">:</span> <span class="s1">&#39;bounding_lat,lon_0,lat_0,no corners or width/height&#39;</span><span class="p">,</span>
             <span class="s1">&#39;spaeqd&#39;</span>   <span class="p">:</span> <span class="s1">&#39;bounding_lat,lon_0,lat_0,no corners or width/height&#39;</span><span class="p">,</span>
             <span class="s1">&#39;aea&#39;</span>      <span class="p">:</span> <span class="s1">&#39;lon_0,lat_0,lat_1&#39;</span><span class="p">,</span>
             <span class="s1">&#39;stere&#39;</span>    <span class="p">:</span> <span class="s1">&#39;lon_0,lat_0,lat_ts,k_0&#39;</span><span class="p">,</span>
             <span class="s1">&#39;npstere&#39;</span>  <span class="p">:</span> <span class="s1">&#39;bounding_lat,lon_0,lat_0,no corners or width/height&#39;</span><span class="p">,</span>
             <span class="s1">&#39;spstere&#39;</span>  <span class="p">:</span> <span class="s1">&#39;bounding_lat,lon_0,lat_0,no corners or width/height&#39;</span><span class="p">,</span>
             <span class="s1">&#39;cass&#39;</span>     <span class="p">:</span> <span class="s1">&#39;lon_0,lat_0&#39;</span><span class="p">,</span>
             <span class="s1">&#39;poly&#39;</span>     <span class="p">:</span> <span class="s1">&#39;lon_0,lat_0&#39;</span><span class="p">,</span>
             <span class="s1">&#39;ortho&#39;</span>    <span class="p">:</span> <span class="s1">&#39;lon_0,lat_0,llcrnrx,llcrnry,urcrnrx,urcrnry,no width/height&#39;</span><span class="p">,</span>
             <span class="s1">&#39;geos&#39;</span>     <span class="p">:</span> <span class="s1">&#39;lon_0,satellite_height,llcrnrx,llcrnry,urcrnrx,urcrnry,no width/height&#39;</span><span class="p">,</span>
             <span class="s1">&#39;nsper&#39;</span>    <span class="p">:</span> <span class="s1">&#39;lon_0,satellite_height,llcrnrx,llcrnry,urcrnrx,urcrnry,no width/height&#39;</span><span class="p">,</span>
             <span class="s1">&#39;sinu&#39;</span>     <span class="p">:</span> <span class="s1">&#39;lon_0,lat_0,no corners or width/height&#39;</span><span class="p">,</span>
             <span class="s1">&#39;moll&#39;</span>     <span class="p">:</span> <span class="s1">&#39;lon_0,lat_0,no corners or width/height&#39;</span><span class="p">,</span>
             <span class="s1">&#39;hammer&#39;</span>   <span class="p">:</span> <span class="s1">&#39;lon_0,lat_0,no corners or width/height&#39;</span><span class="p">,</span>
             <span class="s1">&#39;robin&#39;</span>    <span class="p">:</span> <span class="s1">&#39;lon_0,lat_0,no corners or width/height&#39;</span><span class="p">,</span>
             <span class="s1">&#39;eck4&#39;</span>    <span class="p">:</span> <span class="s1">&#39;lon_0,lat_0,no corners or width/height&#39;</span><span class="p">,</span>
             <span class="s1">&#39;kav7&#39;</span>    <span class="p">:</span> <span class="s1">&#39;lon_0,lat_0,no corners or width/height&#39;</span><span class="p">,</span>
             <span class="s1">&#39;vandg&#39;</span>    <span class="p">:</span> <span class="s1">&#39;lon_0,lat_0,no corners or width/height&#39;</span><span class="p">,</span>
             <span class="s1">&#39;mbtfpq&#39;</span>   <span class="p">:</span> <span class="s1">&#39;lon_0,lat_0,no corners or width/height&#39;</span><span class="p">,</span>
             <span class="s1">&#39;gnom&#39;</span>     <span class="p">:</span> <span class="s1">&#39;lon_0,lat_0&#39;</span><span class="p">,</span>
             <span class="s1">&#39;rotpole&#39;</span>  <span class="p">:</span> <span class="s1">&#39;lon_0,o_lat_p,o_lon_p,corner lat/lon or corner x,y (no width/height)&#39;</span>
             <span class="p">}</span>

<span class="c1"># create dictionary that maps epsg codes to Basemap kwargs.</span>
<span class="n">epsgf</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">basemap_datadir</span><span class="p">,</span> <span class="s1">&#39;epsg&#39;</span><span class="p">))</span>
<span class="n">epsg_dict</span><span class="o">=</span><span class="p">{}</span>
<span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">epsgf</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;#&quot;</span><span class="p">):</span>
        <span class="k">continue</span>
    <span class="n">l</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
    <span class="n">code</span> <span class="o">=</span> <span class="n">l</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s2">&quot;&lt;&gt;&quot;</span><span class="p">)</span>
    <span class="n">parms</span> <span class="o">=</span> <span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">l</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">_kw_args</span><span class="o">=</span><span class="p">{}</span>
    <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">l</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">k</span><span class="p">,</span><span class="n">v</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;=&#39;</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="n">k</span> <span class="o">=</span> <span class="n">k</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s2">&quot;+&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">k</span><span class="o">==</span><span class="s1">&#39;proj&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">v</span> <span class="o">==</span> <span class="s1">&#39;longlat&#39;</span><span class="p">:</span> <span class="n">v</span> <span class="o">=</span> <span class="s1">&#39;cyl&#39;</span>
            <span class="k">if</span> <span class="n">v</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">_projnames</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="n">k</span><span class="o">=</span><span class="s1">&#39;projection&#39;</span>
        <span class="k">if</span> <span class="n">k</span><span class="o">==</span><span class="s1">&#39;k&#39;</span><span class="p">:</span>
            <span class="n">k</span><span class="o">=</span><span class="s1">&#39;k_0&#39;</span>
        <span class="k">if</span> <span class="n">k</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;projection&#39;</span><span class="p">,</span><span class="s1">&#39;lat_1&#39;</span><span class="p">,</span><span class="s1">&#39;lat_2&#39;</span><span class="p">,</span><span class="s1">&#39;lon_0&#39;</span><span class="p">,</span><span class="s1">&#39;lat_0&#39;</span><span class="p">,</span>\
                 <span class="s1">&#39;a&#39;</span><span class="p">,</span><span class="s1">&#39;b&#39;</span><span class="p">,</span><span class="s1">&#39;k_0&#39;</span><span class="p">,</span><span class="s1">&#39;lat_ts&#39;</span><span class="p">,</span><span class="s1">&#39;ellps&#39;</span><span class="p">,</span><span class="s1">&#39;datum&#39;</span><span class="p">]:</span>
            <span class="k">if</span> <span class="n">k</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;projection&#39;</span><span class="p">,</span><span class="s1">&#39;ellps&#39;</span><span class="p">,</span><span class="s1">&#39;datum&#39;</span><span class="p">]:</span>
                <span class="n">v</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
            <span class="n">_kw_args</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">=</span><span class="n">v</span>
    <span class="k">if</span> <span class="s1">&#39;projection&#39;</span> <span class="ow">in</span> <span class="n">_kw_args</span><span class="p">:</span>
        <span class="k">if</span> <span class="s1">&#39;a&#39;</span> <span class="ow">in</span> <span class="n">_kw_args</span><span class="p">:</span>
            <span class="k">if</span> <span class="s1">&#39;b&#39;</span> <span class="ow">in</span> <span class="n">_kw_args</span><span class="p">:</span>
                <span class="n">_kw_args</span><span class="p">[</span><span class="s1">&#39;rsphere&#39;</span><span class="p">]</span><span class="o">=</span><span class="p">(</span><span class="n">_kw_args</span><span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">],</span><span class="n">_kw_args</span><span class="p">[</span><span class="s1">&#39;b&#39;</span><span class="p">])</span>
                <span class="k">del</span> <span class="n">_kw_args</span><span class="p">[</span><span class="s1">&#39;b&#39;</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">_kw_args</span><span class="p">[</span><span class="s1">&#39;rsphere&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">_kw_args</span><span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">]</span>
            <span class="k">del</span> <span class="n">_kw_args</span><span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="s1">&#39;datum&#39;</span> <span class="ow">in</span> <span class="n">_kw_args</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">_kw_args</span><span class="p">[</span><span class="s1">&#39;datum&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;NAD83&#39;</span><span class="p">:</span>
                <span class="n">_kw_args</span><span class="p">[</span><span class="s1">&#39;ellps&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;GRS80&#39;</span>
            <span class="k">elif</span> <span class="n">_kw_args</span><span class="p">[</span><span class="s1">&#39;datum&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;NAD27&#39;</span><span class="p">:</span>
                <span class="n">_kw_args</span><span class="p">[</span><span class="s1">&#39;ellps&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;clrk66&#39;</span>
            <span class="k">elif</span> <span class="n">_kw_args</span><span class="p">[</span><span class="s1">&#39;datum&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;WGS84&#39;</span><span class="p">:</span>
                <span class="n">_kw_args</span><span class="p">[</span><span class="s1">&#39;ellps&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;WGS84&#39;</span>
            <span class="k">del</span> <span class="n">_kw_args</span><span class="p">[</span><span class="s1">&#39;datum&#39;</span><span class="p">]</span>
        <span class="c1"># supported epsg projections.</span>
        <span class="c1"># omerc not supported yet, since we can&#39;t handle</span>
        <span class="c1"># alpha,gamma and lonc keywords.</span>
        <span class="k">if</span> <span class="n">_kw_args</span><span class="p">[</span><span class="s1">&#39;projection&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;omerc&#39;</span><span class="p">:</span>
            <span class="n">epsg_dict</span><span class="p">[</span><span class="n">code</span><span class="p">]</span><span class="o">=</span><span class="n">_kw_args</span>
<span class="n">epsgf</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

<span class="c1"># The __init__ docstring is pulled out here because it is so long;</span>
<span class="c1"># Having it in the usual place makes it hard to get from the</span>
<span class="c1"># __init__ argument list to the code that uses the arguments.</span>
<span class="n">_Basemap_init_doc</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>

<span class="s2"> Sets up a basemap with specified map projection.</span>
<span class="s2"> and creates the coastline data structures in map projection</span>
<span class="s2"> coordinates.</span>

<span class="s2"> Calling a Basemap class instance with the arguments lon, lat will</span>
<span class="s2"> convert lon/lat (in degrees) to x/y map projection coordinates</span>
<span class="s2"> (in meters). The inverse transformation is done if the optional keyword</span>
<span class="s2"> ``inverse`` is set to True.</span>

<span class="s2"> The desired projection is set with the projection keyword. Default is ``cyl``.</span>
<span class="s2"> Supported values for the projection keyword are:</span>

<span class="s2"> ==============   ====================================================</span>
<span class="s2"> Value            Description</span>
<span class="s2"> ==============   ====================================================</span>
<span class="si">%(supported_projections)s</span>
<span class="s2"> ==============   ====================================================</span>

<span class="s2"> For most map projections, the map projection region can either be</span>
<span class="s2"> specified by setting these keywords:</span>

<span class="s2"> .. tabularcolumns:: |l|L|</span>

<span class="s2"> ==============   ====================================================</span>
<span class="s2"> Keyword          Description</span>
<span class="s2"> ==============   ====================================================</span>
<span class="s2"> llcrnrlon        longitude of lower left hand corner of the desired map</span>
<span class="s2">                  domain (degrees).</span>
<span class="s2"> llcrnrlat        latitude of lower left hand corner of the desired map</span>
<span class="s2">                  domain (degrees).</span>
<span class="s2"> urcrnrlon        longitude of upper right hand corner of the desired map</span>
<span class="s2">                  domain (degrees).</span>
<span class="s2"> urcrnrlat        latitude of upper right hand corner of the desired map</span>
<span class="s2">                  domain (degrees).</span>
<span class="s2"> ==============   ====================================================</span>

<span class="s2"> or these</span>

<span class="s2"> .. tabularcolumns:: |l|L|</span>

<span class="s2"> ==============   ====================================================</span>
<span class="s2"> Keyword          Description</span>
<span class="s2"> ==============   ====================================================</span>
<span class="s2"> width            width of desired map domain in projection coordinates</span>
<span class="s2">                  (meters).</span>
<span class="s2"> height           height of desired map domain in projection coordinates</span>
<span class="s2">                  (meters).</span>
<span class="s2"> lon_0            center of desired map domain (in degrees).</span>
<span class="s2"> lat_0            center of desired map domain (in degrees).</span>
<span class="s2"> ==============   ====================================================</span>

<span class="s2"> For ``sinu``, ``moll``, ``hammer``, ``npstere``, ``spstere``, ``nplaea``, ``splaea``,</span>
<span class="s2"> ``npaeqd``, ``spaeqd``, ``robin``, ``eck4``, ``kav7``, or ``mbtfpq``, the values of</span>
<span class="s2"> llcrnrlon, llcrnrlat, urcrnrlon, urcrnrlat, width and height are ignored</span>
<span class="s2"> (because either they are computed internally, or entire globe is</span>
<span class="s2"> always plotted).</span>

<span class="s2"> For the cylindrical projections (``cyl``, ``merc``, ``mill``, ``cea``  and ``gall``),</span>
<span class="s2"> the default is to use</span>
<span class="s2"> llcrnrlon=-180,llcrnrlat=-90, urcrnrlon=180 and urcrnrlat=90). For all other</span>
<span class="s2"> projections except ``ortho``, ``geos`` and ``nsper``, either the lat/lon values of the</span>
<span class="s2"> corners or width and height must be specified by the user.</span>

<span class="s2"> For ``ortho``, ``geos`` and ``nsper``, the lat/lon values of the corners may be specified,</span>
<span class="s2"> or the x/y values of the corners (llcrnrx,llcrnry,urcrnrx,urcrnry) in the</span>
<span class="s2"> coordinate system of the global projection (with x=0,y=0 at the center</span>
<span class="s2"> of the global projection).  If the corners are not specified,</span>
<span class="s2"> the entire globe is plotted.</span>

<span class="s2"> For ``rotpole``, the lat/lon values of the corners on the unrotated sphere</span>
<span class="s2"> may be provided as llcrnrlon,llcrnrlat,urcrnrlon,urcrnrlat, or the lat/lon</span>
<span class="s2"> values of the corners on the rotated sphere can be given as</span>
<span class="s2"> llcrnrx,llcrnry,urcrnrx,urcrnry.</span>

<span class="s2"> Other keyword arguments:</span>

<span class="s2"> .. tabularcolumns:: |l|L|</span>

<span class="s2"> ==============   ====================================================</span>
<span class="s2"> Keyword          Description</span>
<span class="s2"> ==============   ====================================================</span>
<span class="s2"> resolution       resolution of boundary database to use. Can be ``c``</span>
<span class="s2">                  (crude), ``l`` (low), ``i`` (intermediate), ``h``</span>
<span class="s2">                  (high), ``f`` (full) or None.</span>
<span class="s2">                  If None, no boundary data will be read in (and</span>
<span class="s2">                  class methods such as drawcoastlines will raise an</span>
<span class="s2">                  if invoked).</span>
<span class="s2">                  Resolution drops off by roughly 80</span><span class="si">%%</span><span class="s2"> between datasets.</span>
<span class="s2">                  Higher res datasets are much slower to draw.</span>
<span class="s2">                  Default ``c``. Coastline data is from the GSHHS</span>
<span class="s2">                  (http://www.soest.hawaii.edu/wessel/gshhs/gshhs.html).</span>
<span class="s2">                  State, country and river datasets from the Generic</span>
<span class="s2">                  Mapping Tools (http://gmt.soest.hawaii.edu).</span>
<span class="s2"> area_thresh      coastline or lake with an area smaller than</span>
<span class="s2">                  area_thresh in km^2 will not be plotted.</span>
<span class="s2">                  Default 10000,1000,100,10,1 for resolution</span>
<span class="s2">                  ``c``, ``l``, ``i``, ``h``, ``f``.</span>
<span class="s2"> rsphere          radius of the sphere used to define map projection</span>
<span class="s2">                  (default 6370997 meters, close to the arithmetic mean</span>
<span class="s2">                  radius of the earth). If given as a sequence, the</span>
<span class="s2">                  first two elements are interpreted as the radii</span>
<span class="s2">                  of the major and minor axes of an ellipsoid.</span>
<span class="s2">                  Note: sometimes an ellipsoid is specified by the</span>
<span class="s2">                  major axis and an inverse flattening parameter (if).</span>
<span class="s2">                  The minor axis (b) can be computed from the major</span>
<span class="s2">                  axis (a) and the inverse flattening parameter using</span>
<span class="s2">                  the formula if = a/(a-b).</span>
<span class="s2"> ellps            string describing ellipsoid (&#39;GRS80&#39; or &#39;WGS84&#39;,</span>
<span class="s2">                  for example). If both rsphere and ellps are given,</span>
<span class="s2">                  rsphere is ignored. Default None. See pyproj.pj_ellps</span>
<span class="s2">                  for allowed values.</span>
<span class="s2"> suppress_ticks   suppress automatic drawing of axis ticks and labels</span>
<span class="s2">                  in map projection coordinates.  Default True,</span>
<span class="s2">                  so parallels and meridians can be labelled instead.</span>
<span class="s2">                  If parallel or meridian labelling is requested</span>
<span class="s2">                  (using drawparallels and drawmeridians methods),</span>
<span class="s2">                  automatic tick labelling will be supressed even if</span>
<span class="s2">                  suppress_ticks=False.  suppress_ticks=False</span>
<span class="s2">                  is useful if you want to use your own custom tick</span>
<span class="s2">                  formatter, or  if you want to let matplotlib label</span>
<span class="s2">                  the axes in meters using map projection</span>
<span class="s2">                  coordinates.</span>
<span class="s2"> fix_aspect       fix aspect ratio of plot to match aspect ratio</span>
<span class="s2">                  of map projection region (default True).</span>
<span class="s2"> anchor           determines how map is placed in axes rectangle</span>
<span class="s2">                  (passed to axes.set_aspect). Default is ``C``,</span>
<span class="s2">                  which means map is centered.</span>
<span class="s2">                  Allowed values are</span>
<span class="s2">                  ``C``, ``SW``, ``S``, ``SE``, ``E``, ``NE``,</span>
<span class="s2">                  ``N``, ``NW``, and ``W``.</span>
<span class="s2"> celestial        use astronomical conventions for longitude (i.e.</span>
<span class="s2">                  negative longitudes to the east of 0). Default False.</span>
<span class="s2">                  Implies resolution=None.</span>
<span class="s2"> ax               set default axes instance</span>
<span class="s2">                  (default None - matplotlib.pyplot.gca() may be used</span>
<span class="s2">                  to get the current axes instance).</span>
<span class="s2">                  If you do not want matplotlib.pyplot to be imported,</span>
<span class="s2">                  you can either set this to a pre-defined axes</span>
<span class="s2">                  instance, or use the ``ax`` keyword in each Basemap</span>
<span class="s2">                  method call that does drawing. In the first case,</span>
<span class="s2">                  all Basemap method calls will draw to the same axes</span>
<span class="s2">                  instance.  In the second case, you can draw to</span>
<span class="s2">                  different axes with the same Basemap instance.</span>
<span class="s2">                  You can also use the ``ax`` keyword in individual</span>
<span class="s2">                  method calls to selectively override the default</span>
<span class="s2">                  axes instance.</span>
<span class="s2"> ==============   ====================================================</span>

<span class="s2"> The following keywords are map projection parameters which all default to</span>
<span class="s2"> None.  Not all parameters are used by all projections, some are ignored.</span>
<span class="s2"> The module variable ``projection_params`` is a dictionary which</span>
<span class="s2"> lists which parameters apply to which projections.</span>

<span class="s2"> .. tabularcolumns:: |l|L|</span>

<span class="s2"> ================ ====================================================</span>
<span class="s2"> Keyword          Description</span>
<span class="s2"> ================ ====================================================</span>
<span class="s2"> lat_ts           latitude of true scale. Optional for stereographic,</span>
<span class="s2">                  cylindrical equal area and mercator projections.</span>
<span class="s2">                  default is lat_0 for stereographic projection.</span>
<span class="s2">                  default is 0 for mercator and cylindrical equal area</span>
<span class="s2">                  projections.</span>
<span class="s2"> lat_1            first standard parallel for lambert conformal,</span>
<span class="s2">                  albers equal area and equidistant conic.</span>
<span class="s2">                  Latitude of one of the two points on the projection</span>
<span class="s2">                  centerline for oblique mercator. If lat_1 is not given, but</span>
<span class="s2">                  lat_0 is, lat_1 is set to lat_0 for lambert</span>
<span class="s2">                  conformal, albers equal area and equidistant conic.</span>
<span class="s2"> lat_2            second standard parallel for lambert conformal,</span>
<span class="s2">                  albers equal area and equidistant conic.</span>
<span class="s2">                  Latitude of one of the two points on the projection</span>
<span class="s2">                  centerline for oblique mercator. If lat_2 is not</span>
<span class="s2">                  given it is set to lat_1 for lambert conformal,</span>
<span class="s2">                  albers equal area and equidistant conic.</span>
<span class="s2"> lon_1            Longitude of one of the two points on the projection</span>
<span class="s2">                  centerline for oblique mercator.</span>
<span class="s2"> lon_2            Longitude of one of the two points on the projection</span>
<span class="s2">                  centerline for oblique mercator.</span>
<span class="s2"> k_0              Scale factor at natural origin (used</span>
<span class="s2">                  by &#39;tmerc&#39;, &#39;omerc&#39;, &#39;stere&#39; and &#39;lcc&#39;).</span>
<span class="s2"> no_rot           only used by oblique mercator.</span>
<span class="s2">                  If set to True, the map projection coordinates will</span>
<span class="s2">                  not be rotated to true North.  Default is False</span>
<span class="s2">                  (projection coordinates are automatically rotated).</span>
<span class="s2"> lat_0            central latitude (y-axis origin) - used by all</span>
<span class="s2">                  projections.</span>
<span class="s2"> lon_0            central meridian (x-axis origin) - used by all</span>
<span class="s2">                  projections.</span>
<span class="s2"> o_lat_p          latitude of rotated pole (only used by &#39;rotpole&#39;)</span>
<span class="s2"> o_lon_p          longitude of rotated pole (only used by &#39;rotpole&#39;)</span>
<span class="s2"> boundinglat      bounding latitude for pole-centered projections</span>
<span class="s2">                  (npstere,spstere,nplaea,splaea,npaeqd,spaeqd).</span>
<span class="s2">                  These projections are square regions centered</span>
<span class="s2">                  on the north or south pole.</span>
<span class="s2">                  The longitude lon_0 is at 6-o&#39;clock, and the</span>
<span class="s2">                  latitude circle boundinglat is tangent to the edge</span>
<span class="s2">                  of the map at lon_0.</span>
<span class="s2"> round            cut off pole-centered projection at boundinglat</span>
<span class="s2">                  (so plot is a circle instead of a square). Only</span>
<span class="s2">                  relevant for npstere,spstere,nplaea,splaea,npaeqd</span>
<span class="s2">                  or spaeqd projections. Default False.</span>
<span class="s2"> satellite_height height of satellite (in m) above equator -</span>
<span class="s2">                  only relevant for geostationary</span>
<span class="s2">                  and near-sided perspective (``geos`` or ``nsper``)</span>
<span class="s2">                  projections. Default 35,786 km.</span>
<span class="s2"> ================ ====================================================</span>

<span class="s2"> Useful instance variables:</span>

<span class="s2"> .. tabularcolumns:: |l|L|</span>

<span class="s2"> ================ ====================================================</span>
<span class="s2"> Variable Name    Description</span>
<span class="s2"> ================ ====================================================</span>
<span class="s2"> projection       map projection. Print the module variable</span>
<span class="s2">                  ``supported_projections`` to see a list of allowed</span>
<span class="s2">                  values.</span>
<span class="s2"> epsg             EPSG code defining projection (see</span>
<span class="s2">                  http://spatialreference.org for a list of</span>
<span class="s2">                  EPSG codes and their definitions).</span>
<span class="s2"> aspect           map aspect ratio</span>
<span class="s2">                  (size of y dimension / size of x dimension).</span>
<span class="s2"> llcrnrlon        longitude of lower left hand corner of the</span>
<span class="s2">                  selected map domain.</span>
<span class="s2"> llcrnrlat        latitude of lower left hand corner of the</span>
<span class="s2">                  selected map domain.</span>
<span class="s2"> urcrnrlon        longitude of upper right hand corner of the</span>
<span class="s2">                  selected map domain.</span>
<span class="s2"> urcrnrlat        latitude of upper right hand corner of the</span>
<span class="s2">                  selected map domain.</span>
<span class="s2"> llcrnrx          x value of lower left hand corner of the</span>
<span class="s2">                  selected map domain in map projection coordinates.</span>
<span class="s2"> llcrnry          y value of lower left hand corner of the</span>
<span class="s2">                  selected map domain in map projection coordinates.</span>
<span class="s2"> urcrnrx          x value of upper right hand corner of the</span>
<span class="s2">                  selected map domain in map projection coordinates.</span>
<span class="s2"> urcrnry          y value of upper right hand corner of the</span>
<span class="s2">                  selected map domain in map projection coordinates.</span>
<span class="s2"> rmajor           equatorial radius of ellipsoid used (in meters).</span>
<span class="s2"> rminor           polar radius of ellipsoid used (in meters).</span>
<span class="s2"> resolution       resolution of boundary dataset being used (``c``</span>
<span class="s2">                  for crude, ``l`` for low, etc.).</span>
<span class="s2">                  If None, no boundary dataset is associated with the</span>
<span class="s2">                  Basemap instance.</span>
<span class="s2"> proj4string      the string describing the map projection that is</span>
<span class="s2">                  used by PROJ.4.</span>
<span class="s2"> ================ ====================================================</span>

<span class="s2"> **Converting from Geographic (lon/lat) to Map Projection (x/y) Coordinates**</span>

<span class="s2"> Calling a Basemap class instance with the arguments lon, lat will</span>
<span class="s2"> convert lon/lat (in degrees) to x/y map projection</span>
<span class="s2"> coordinates (in meters).  If optional keyword ``inverse`` is</span>
<span class="s2"> True (default is False), the inverse transformation from x/y</span>
<span class="s2"> to lon/lat is performed.</span>

<span class="s2"> For cylindrical equidistant projection (``cyl``), this</span>
<span class="s2"> does nothing (i.e. x,y == lon,lat).</span>

<span class="s2"> For non-cylindrical projections, the inverse transformation</span>
<span class="s2"> always returns longitudes between -180 and 180 degrees. For</span>
<span class="s2"> cylindrical projections (self.projection == ``cyl``, ``mill``,</span>
<span class="s2"> ``cea``, ``gall`` or ``merc``)</span>
<span class="s2"> the inverse transformation will return longitudes between</span>
<span class="s2"> self.llcrnrlon and self.llcrnrlat.</span>

<span class="s2"> Input arguments lon, lat can be either scalar floats, sequences</span>
<span class="s2"> or numpy arrays.</span>

<span class="s2"> **Example Usage:**</span>

<span class="s2"> &gt;&gt;&gt; from mpl_toolkits.basemap import Basemap</span>
<span class="s2"> &gt;&gt;&gt; import numpy as np</span>
<span class="s2"> &gt;&gt;&gt; import matplotlib.pyplot as plt</span>
<span class="s2"> &gt;&gt;&gt; # read in topo data (on a regular lat/lon grid)</span>
<span class="s2"> &gt;&gt;&gt; etopo = np.loadtxt(&#39;etopo20data.gz&#39;)</span>
<span class="s2"> &gt;&gt;&gt; lons  = np.loadtxt(&#39;etopo20lons.gz&#39;)</span>
<span class="s2"> &gt;&gt;&gt; lats  = np.loadtxt(&#39;etopo20lats.gz&#39;)</span>
<span class="s2"> &gt;&gt;&gt; # create Basemap instance for Robinson projection.</span>
<span class="s2"> &gt;&gt;&gt; m = Basemap(projection=&#39;robin&#39;,lon_0=0.5*(lons[0]+lons[-1]))</span>
<span class="s2"> &gt;&gt;&gt; # compute map projection coordinates for lat/lon grid.</span>
<span class="s2"> &gt;&gt;&gt; x, y = m(*np.meshgrid(lons,lats))</span>
<span class="s2"> &gt;&gt;&gt; # make filled contour plot.</span>
<span class="s2"> &gt;&gt;&gt; cs = m.contourf(x,y,etopo,30,cmap=plt.cm.jet)</span>
<span class="s2"> &gt;&gt;&gt; m.drawcoastlines() # draw coastlines</span>
<span class="s2"> &gt;&gt;&gt; m.drawmapboundary() # draw a line around the map region</span>
<span class="s2"> &gt;&gt;&gt; m.drawparallels(np.arange(-90.,120.,30.),labels=[1,0,0,0]) # draw parallels</span>
<span class="s2"> &gt;&gt;&gt; m.drawmeridians(np.arange(0.,420.,60.),labels=[0,0,0,1]) # draw meridians</span>
<span class="s2"> &gt;&gt;&gt; plt.title(&#39;Robinson Projection&#39;) # add a title</span>
<span class="s2"> &gt;&gt;&gt; plt.show()</span>

<span class="s2"> [this example (simpletest.py) plus many others can be found in the</span>
<span class="s2"> examples directory of source distribution.  The &quot;OO&quot; version of this</span>
<span class="s2"> example (which does not use matplotlib.pyplot) is called &quot;simpletest_oo.py&quot;.]</span>
<span class="s2">&quot;&quot;&quot;</span> <span class="o">%</span> <span class="nb">locals</span><span class="p">()</span>

<span class="c1"># unsupported projection error message.</span>
<span class="n">_unsupported_projection</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;&#39;</span><span class="si">%s</span><span class="s2">&#39; is an unsupported projection.</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">]</span>
<span class="n">_unsupported_projection</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;The supported projections are:</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="n">_unsupported_projection</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">supported_projections</span><span class="p">)</span>
<span class="n">_unsupported_projection</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">_unsupported_projection</span><span class="p">)</span>

<span class="k">def</span><span class="w"> </span><span class="nf">_validated_ll</span><span class="p">(</span><span class="n">param</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">minval</span><span class="p">,</span> <span class="n">maxval</span><span class="p">):</span>
    <span class="n">item</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">param</span><span class="p">)</span>
    <span class="n">param</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">param</span> <span class="k">if</span> <span class="n">item</span><span class="o">.</span><span class="n">shape</span> <span class="k">else</span> <span class="n">item</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">param</span> <span class="o">&gt;</span> <span class="n">maxval</span> <span class="ow">or</span> <span class="n">param</span> <span class="o">&lt;</span> <span class="n">minval</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1"> must be between </span><span class="si">%f</span><span class="s1"> and </span><span class="si">%f</span><span class="s1"> degrees&#39;</span> <span class="o">%</span>
                                           <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">minval</span><span class="p">,</span> <span class="n">maxval</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">param</span>


<span class="k">def</span><span class="w"> </span><span class="nf">_validated_or_none</span><span class="p">(</span><span class="n">param</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">minval</span><span class="p">,</span> <span class="n">maxval</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">param</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">None</span>
    <span class="k">return</span> <span class="n">_validated_ll</span><span class="p">(</span><span class="n">param</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">minval</span><span class="p">,</span> <span class="n">maxval</span><span class="p">)</span>


<span class="k">def</span><span class="w"> </span><span class="nf">_insert_validated</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">param</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">minval</span><span class="p">,</span> <span class="n">maxval</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">param</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">d</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">_validated_ll</span><span class="p">(</span><span class="n">param</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">minval</span><span class="p">,</span> <span class="n">maxval</span><span class="p">)</span>

<span class="k">def</span><span class="w"> </span><span class="nf">_transform</span><span class="p">(</span><span class="n">plotfunc</span><span class="p">):</span>
    <span class="c1"># shift data and longitudes to map projection region, then compute</span>
    <span class="c1"># transformation to map projection coordinates.</span>
    <span class="nd">@functools</span><span class="o">.</span><span class="n">wraps</span><span class="p">(</span><span class="n">plotfunc</span><span class="p">)</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">with_transform</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">data</span><span class="p">,</span><span class="o">*</span><span class="n">args</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="c1"># input coordinates are latitude/longitude, not map projection coords.</span>
        <span class="k">if</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;latlon&#39;</span><span class="p">,</span> <span class="n">latlon_default</span><span class="p">):</span>
            <span class="c1"># shift data to map projection region for</span>
            <span class="c1"># cylindrical and pseudo-cylindrical projections.</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">projection</span> <span class="ow">in</span> <span class="n">_cylproj</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">projection</span> <span class="ow">in</span> <span class="n">_pseudocyl</span><span class="p">:</span>
                <span class="n">x</span><span class="p">,</span> <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">shiftdata</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span>
                                         <span class="n">fix_wrap_around</span><span class="o">=</span><span class="n">plotfunc</span><span class="o">.</span><span class="vm">__name__</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;scatter&quot;</span><span class="p">])</span>
            <span class="c1"># convert lat/lon coords to map projection coords.</span>
            <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">plotfunc</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">data</span><span class="p">,</span><span class="o">*</span><span class="n">args</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">with_transform</span>

<span class="k">def</span><span class="w"> </span><span class="nf">_transform1d</span><span class="p">(</span><span class="n">plotfunc</span><span class="p">):</span>
    <span class="c1"># shift data and longitudes to map projection region, then compute</span>
    <span class="c1"># transformation to map projection coordinates.</span>
    <span class="nd">@functools</span><span class="o">.</span><span class="n">wraps</span><span class="p">(</span><span class="n">plotfunc</span><span class="p">)</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">with_transform</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="o">*</span><span class="n">args</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="c1"># input coordinates are latitude/longitude, not map projection coords.</span>
        <span class="k">if</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;latlon&#39;</span><span class="p">,</span> <span class="n">latlon_default</span><span class="p">):</span>
            <span class="c1"># shift data to map projection region for</span>
            <span class="c1"># cylindrical and pseudo-cylindrical projections.</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">projection</span> <span class="ow">in</span> <span class="n">_cylproj</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">projection</span> <span class="ow">in</span> <span class="n">_pseudocyl</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">x</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">shiftdata</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">fix_wrap_around</span><span class="o">=</span><span class="n">plotfunc</span><span class="o">.</span><span class="vm">__name__</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;scatter&quot;</span><span class="p">])</span>
                <span class="k">elif</span> <span class="n">x</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">x</span> <span class="o">&gt;</span> <span class="mi">180</span><span class="p">:</span>
                        <span class="n">x</span> <span class="o">=</span> <span class="n">x</span> <span class="o">-</span> <span class="mf">360.</span>
            <span class="c1"># convert lat/lon coords to map projection coords.</span>
            <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">plotfunc</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="o">*</span><span class="n">args</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">with_transform</span>

<span class="k">def</span><span class="w"> </span><span class="nf">_transformuv</span><span class="p">(</span><span class="n">plotfunc</span><span class="p">):</span>
    <span class="c1"># shift data and longitudes to map projection region, then compute</span>
    <span class="c1"># transformation to map projection coordinates. Works when call</span>
    <span class="c1"># signature has two data arrays instead of one.</span>
    <span class="nd">@functools</span><span class="o">.</span><span class="n">wraps</span><span class="p">(</span><span class="n">plotfunc</span><span class="p">)</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">with_transform</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">u</span><span class="p">,</span><span class="n">v</span><span class="p">,</span><span class="o">*</span><span class="n">args</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="c1"># input coordinates are latitude/longitude, not map projection coords.</span>
        <span class="k">if</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;latlon&#39;</span><span class="p">,</span> <span class="n">latlon_default</span><span class="p">):</span>
            <span class="c1"># shift data to map projection region for</span>
            <span class="c1"># cylindrical and pseudo-cylindrical projections.</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">projection</span> <span class="ow">in</span> <span class="n">_cylproj</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">projection</span> <span class="ow">in</span> <span class="n">_pseudocyl</span><span class="p">:</span>
                <span class="n">x1</span><span class="p">,</span> <span class="n">u</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">shiftdata</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">u</span><span class="p">)</span>
                <span class="n">x</span><span class="p">,</span> <span class="n">v</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">shiftdata</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span>
            <span class="c1"># convert lat/lon coords to map projection coords.</span>
            <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">plotfunc</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">u</span><span class="p">,</span><span class="n">v</span><span class="p">,</span><span class="o">*</span><span class="n">args</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">with_transform</span>

<div class="viewcode-block" id="Basemap">
<a class="viewcode-back" href="../../api/basemap_api.html#mpl_toolkits.basemap.Basemap">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Basemap</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>

<div class="viewcode-block" id="Basemap.__init__">
<a class="viewcode-back" href="../../api/basemap_api.html#mpl_toolkits.basemap.Basemap.__init__">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">llcrnrlon</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">llcrnrlat</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                       <span class="n">urcrnrlon</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">urcrnrlat</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                       <span class="n">llcrnrx</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">llcrnry</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                       <span class="n">urcrnrx</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">urcrnry</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                       <span class="n">width</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                       <span class="n">projection</span><span class="o">=</span><span class="s1">&#39;cyl&#39;</span><span class="p">,</span> <span class="n">resolution</span><span class="o">=</span><span class="s1">&#39;c&#39;</span><span class="p">,</span>
                       <span class="n">area_thresh</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">rsphere</span><span class="o">=</span><span class="mf">6370997.0</span><span class="p">,</span>
                       <span class="n">ellps</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">lat_ts</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                       <span class="n">lat_1</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">lat_2</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                       <span class="n">lat_0</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">lon_0</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                       <span class="n">lon_1</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">lon_2</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                       <span class="n">o_lon_p</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">o_lat_p</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                       <span class="n">k_0</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                       <span class="n">no_rot</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                       <span class="n">suppress_ticks</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                       <span class="n">satellite_height</span><span class="o">=</span><span class="mi">35786000</span><span class="p">,</span>
                       <span class="n">boundinglat</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                       <span class="n">fix_aspect</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                       <span class="n">anchor</span><span class="o">=</span><span class="s1">&#39;C&#39;</span><span class="p">,</span>
                       <span class="n">celestial</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                       <span class="nb">round</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                       <span class="n">epsg</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                       <span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="c1"># docstring is added after __init__ method definition</span>

        <span class="c1"># set epsg code if given, set to 4326 for projection=&#39;cyl&#39;:</span>
        <span class="k">if</span> <span class="n">epsg</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">epsg</span> <span class="o">=</span> <span class="n">epsg</span>
        <span class="k">elif</span> <span class="n">projection</span> <span class="o">==</span> <span class="s1">&#39;cyl&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">epsg</span> <span class="o">=</span> <span class="mi">4326</span>
        <span class="c1"># replace kwarg values with those implied by epsg code,</span>
        <span class="c1"># if given.</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="s1">&#39;epsg&#39;</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">epsg</span><span class="p">)</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">epsg_dict</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1"> is not a supported EPSG code&#39;</span> <span class="o">%</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">epsg</span><span class="p">)</span>
            <span class="n">epsg_params</span> <span class="o">=</span> <span class="n">epsg_dict</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">epsg</span><span class="p">)]</span>
            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">epsg_params</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">k</span> <span class="o">==</span> <span class="s1">&#39;projection&#39;</span><span class="p">:</span>
                    <span class="n">projection</span> <span class="o">=</span> <span class="n">epsg_params</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
                <span class="k">elif</span> <span class="n">k</span> <span class="o">==</span> <span class="s1">&#39;rsphere&#39;</span><span class="p">:</span>
                    <span class="n">rsphere</span> <span class="o">=</span> <span class="n">epsg_params</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
                <span class="k">elif</span> <span class="n">k</span> <span class="o">==</span> <span class="s1">&#39;ellps&#39;</span><span class="p">:</span>
                    <span class="n">ellps</span> <span class="o">=</span> <span class="n">epsg_params</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
                <span class="k">elif</span> <span class="n">k</span> <span class="o">==</span> <span class="s1">&#39;lat_1&#39;</span><span class="p">:</span>
                    <span class="n">lat_1</span> <span class="o">=</span> <span class="n">epsg_params</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
                <span class="k">elif</span> <span class="n">k</span> <span class="o">==</span> <span class="s1">&#39;lat_2&#39;</span><span class="p">:</span>
                    <span class="n">lat_2</span> <span class="o">=</span> <span class="n">epsg_params</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
                <span class="k">elif</span> <span class="n">k</span> <span class="o">==</span> <span class="s1">&#39;lon_0&#39;</span><span class="p">:</span>
                    <span class="n">lon_0</span> <span class="o">=</span> <span class="n">epsg_params</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
                <span class="k">elif</span> <span class="n">k</span> <span class="o">==</span> <span class="s1">&#39;lat_0&#39;</span><span class="p">:</span>
                    <span class="n">lat_0</span> <span class="o">=</span> <span class="n">epsg_params</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
                <span class="k">elif</span> <span class="n">k</span> <span class="o">==</span> <span class="s1">&#39;lat_ts&#39;</span><span class="p">:</span>
                    <span class="n">lat_ts</span> <span class="o">=</span> <span class="n">epsg_params</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
                <span class="k">elif</span> <span class="n">k</span> <span class="o">==</span> <span class="s1">&#39;k_0&#39;</span><span class="p">:</span>
                    <span class="n">k_0</span> <span class="o">=</span> <span class="n">epsg_params</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>

        <span class="c1"># fix aspect to ratio to match aspect ratio of map projection</span>
        <span class="c1"># region</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fix_aspect</span> <span class="o">=</span> <span class="n">fix_aspect</span>
        <span class="c1"># where to put plot in figure (default is &#39;C&#39; or center)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">anchor</span> <span class="o">=</span> <span class="n">anchor</span>
        <span class="c1"># geographic or celestial coords?</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">celestial</span> <span class="o">=</span> <span class="n">celestial</span>
        <span class="c1"># map projection.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">projection</span> <span class="o">=</span> <span class="n">projection</span>
        <span class="c1"># bounding lat (for pole-centered plots)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">boundinglat</span> <span class="o">=</span> <span class="n">boundinglat</span>
        <span class="c1"># is a round pole-centered plot desired?</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">round</span> <span class="o">=</span> <span class="nb">round</span>
        <span class="c1"># full disk projection?</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_fulldisk</span> <span class="o">=</span> <span class="kc">False</span> <span class="c1"># default value</span>

        <span class="c1"># set up projection parameter dict.</span>
        <span class="n">projparams</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">projparams</span><span class="p">[</span><span class="s1">&#39;proj&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">projection</span>
        <span class="c1"># if ellps keyword specified, it over-rides rsphere.</span>
        <span class="k">if</span> <span class="n">ellps</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">elldict</span> <span class="o">=</span> <span class="n">pyproj</span><span class="o">.</span><span class="n">pj_ellps</span><span class="p">[</span><span class="n">ellps</span><span class="p">]</span>
            <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s1">&#39;illegal ellps definition, allowed values are </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span>
                <span class="n">pyproj</span><span class="o">.</span><span class="n">pj_ellps</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
            <span class="n">projparams</span><span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">elldict</span><span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">]</span>
            <span class="k">if</span> <span class="s1">&#39;b&#39;</span> <span class="ow">in</span> <span class="n">elldict</span><span class="p">:</span>
                <span class="n">projparams</span><span class="p">[</span><span class="s1">&#39;b&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">elldict</span><span class="p">[</span><span class="s1">&#39;b&#39;</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">projparams</span><span class="p">[</span><span class="s1">&#39;b&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">projparams</span><span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="mf">1.0</span><span class="o">-</span><span class="p">(</span><span class="mf">1.0</span><span class="o">/</span><span class="n">elldict</span><span class="p">[</span><span class="s1">&#39;rf&#39;</span><span class="p">]))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">rsphere</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">rsphere</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
                    <span class="n">projparams</span><span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">rsphere</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="n">projparams</span><span class="p">[</span><span class="s1">&#39;b&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">rsphere</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">projparams</span><span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">rsphere</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                    <span class="n">projparams</span><span class="p">[</span><span class="s1">&#39;b&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">rsphere</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">projection</span> <span class="o">==</span> <span class="s1">&#39;tmerc&#39;</span><span class="p">:</span>
                <span class="c1"># use bR_a instead of R because of obscure bug</span>
                <span class="c1"># in proj4 for tmerc projection.</span>
                    <span class="n">projparams</span><span class="p">[</span><span class="s1">&#39;bR_a&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">rsphere</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">projparams</span><span class="p">[</span><span class="s1">&#39;R&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">rsphere</span>
        <span class="c1"># set units to meters.</span>
        <span class="n">projparams</span><span class="p">[</span><span class="s1">&#39;units&#39;</span><span class="p">]</span><span class="o">=</span><span class="s1">&#39;m&#39;</span>
        <span class="c1"># check for sane values of lon_0, lat_0, lat_ts, lat_1, lat_2</span>
        <span class="n">lat_0</span> <span class="o">=</span> <span class="n">_validated_or_none</span><span class="p">(</span><span class="n">lat_0</span><span class="p">,</span> <span class="s1">&#39;lat_0&#39;</span><span class="p">,</span> <span class="o">-</span><span class="mi">90</span><span class="p">,</span> <span class="mi">90</span><span class="p">)</span>
        <span class="n">lat_1</span> <span class="o">=</span> <span class="n">_validated_or_none</span><span class="p">(</span><span class="n">lat_1</span><span class="p">,</span> <span class="s1">&#39;lat_1&#39;</span><span class="p">,</span> <span class="o">-</span><span class="mi">90</span><span class="p">,</span> <span class="mi">90</span><span class="p">)</span>
        <span class="n">lat_2</span> <span class="o">=</span> <span class="n">_validated_or_none</span><span class="p">(</span><span class="n">lat_2</span><span class="p">,</span> <span class="s1">&#39;lat_2&#39;</span><span class="p">,</span> <span class="o">-</span><span class="mi">90</span><span class="p">,</span> <span class="mi">90</span><span class="p">)</span>
        <span class="n">lat_ts</span> <span class="o">=</span> <span class="n">_validated_or_none</span><span class="p">(</span><span class="n">lat_ts</span><span class="p">,</span> <span class="s1">&#39;lat_ts&#39;</span><span class="p">,</span> <span class="o">-</span><span class="mi">90</span><span class="p">,</span> <span class="mi">90</span><span class="p">)</span>
        <span class="n">lon_0</span> <span class="o">=</span> <span class="n">_validated_or_none</span><span class="p">(</span><span class="n">lon_0</span><span class="p">,</span> <span class="s1">&#39;lon_0&#39;</span><span class="p">,</span> <span class="o">-</span><span class="mi">360</span><span class="p">,</span> <span class="mi">720</span><span class="p">)</span>
        <span class="n">lon_1</span> <span class="o">=</span> <span class="n">_validated_or_none</span><span class="p">(</span><span class="n">lon_1</span><span class="p">,</span> <span class="s1">&#39;lon_1&#39;</span><span class="p">,</span> <span class="o">-</span><span class="mi">360</span><span class="p">,</span> <span class="mi">720</span><span class="p">)</span>
        <span class="n">lon_2</span> <span class="o">=</span> <span class="n">_validated_or_none</span><span class="p">(</span><span class="n">lon_2</span><span class="p">,</span> <span class="s1">&#39;lon_2&#39;</span><span class="p">,</span> <span class="o">-</span><span class="mi">360</span><span class="p">,</span> <span class="mi">720</span><span class="p">)</span>
        <span class="n">llcrnrlon</span> <span class="o">=</span> <span class="n">_validated_or_none</span><span class="p">(</span><span class="n">llcrnrlon</span><span class="p">,</span> <span class="s1">&#39;llcrnrlon&#39;</span><span class="p">,</span> <span class="o">-</span><span class="mi">360</span><span class="p">,</span> <span class="mi">720</span><span class="p">)</span>
        <span class="n">urcrnrlon</span> <span class="o">=</span> <span class="n">_validated_or_none</span><span class="p">(</span><span class="n">urcrnrlon</span><span class="p">,</span> <span class="s1">&#39;urcrnrlon&#39;</span><span class="p">,</span> <span class="o">-</span><span class="mi">360</span><span class="p">,</span> <span class="mi">720</span><span class="p">)</span>
        <span class="n">llcrnrlat</span> <span class="o">=</span> <span class="n">_validated_or_none</span><span class="p">(</span><span class="n">llcrnrlat</span><span class="p">,</span> <span class="s1">&#39;llcrnrlat&#39;</span><span class="p">,</span> <span class="o">-</span><span class="mi">90</span><span class="p">,</span> <span class="mi">90</span><span class="p">)</span>
        <span class="n">urcrnrlat</span> <span class="o">=</span> <span class="n">_validated_or_none</span><span class="p">(</span><span class="n">urcrnrlat</span><span class="p">,</span> <span class="s1">&#39;urcrnrlat&#39;</span><span class="p">,</span> <span class="o">-</span><span class="mi">90</span><span class="p">,</span> <span class="mi">90</span><span class="p">)</span>

        <span class="n">_insert_validated</span><span class="p">(</span><span class="n">projparams</span><span class="p">,</span> <span class="n">lat_0</span><span class="p">,</span> <span class="s1">&#39;lat_0&#39;</span><span class="p">,</span> <span class="o">-</span><span class="mi">90</span><span class="p">,</span> <span class="mi">90</span><span class="p">)</span>
        <span class="n">_insert_validated</span><span class="p">(</span><span class="n">projparams</span><span class="p">,</span> <span class="n">lat_1</span><span class="p">,</span> <span class="s1">&#39;lat_1&#39;</span><span class="p">,</span> <span class="o">-</span><span class="mi">90</span><span class="p">,</span> <span class="mi">90</span><span class="p">)</span>
        <span class="n">_insert_validated</span><span class="p">(</span><span class="n">projparams</span><span class="p">,</span> <span class="n">lat_2</span><span class="p">,</span> <span class="s1">&#39;lat_2&#39;</span><span class="p">,</span> <span class="o">-</span><span class="mi">90</span><span class="p">,</span> <span class="mi">90</span><span class="p">)</span>
        <span class="n">_insert_validated</span><span class="p">(</span><span class="n">projparams</span><span class="p">,</span> <span class="n">lat_ts</span><span class="p">,</span> <span class="s1">&#39;lat_ts&#39;</span><span class="p">,</span> <span class="o">-</span><span class="mi">90</span><span class="p">,</span> <span class="mi">90</span><span class="p">)</span>
        <span class="n">_insert_validated</span><span class="p">(</span><span class="n">projparams</span><span class="p">,</span> <span class="n">lon_0</span><span class="p">,</span> <span class="s1">&#39;lon_0&#39;</span><span class="p">,</span> <span class="o">-</span><span class="mi">360</span><span class="p">,</span> <span class="mi">720</span><span class="p">)</span>
        <span class="n">_insert_validated</span><span class="p">(</span><span class="n">projparams</span><span class="p">,</span> <span class="n">lon_1</span><span class="p">,</span> <span class="s1">&#39;lon_1&#39;</span><span class="p">,</span> <span class="o">-</span><span class="mi">360</span><span class="p">,</span> <span class="mi">720</span><span class="p">)</span>
        <span class="n">_insert_validated</span><span class="p">(</span><span class="n">projparams</span><span class="p">,</span> <span class="n">lon_2</span><span class="p">,</span> <span class="s1">&#39;lon_2&#39;</span><span class="p">,</span> <span class="o">-</span><span class="mi">360</span><span class="p">,</span> <span class="mi">720</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">projection</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;geos&#39;</span><span class="p">,</span><span class="s1">&#39;nsper&#39;</span><span class="p">]:</span>
            <span class="n">projparams</span><span class="p">[</span><span class="s1">&#39;h&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">satellite_height</span>
        <span class="c1"># check for sane values of projection corners.</span>
        <span class="n">using_corners</span> <span class="o">=</span> <span class="p">(</span><span class="kc">None</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="n">llcrnrlon</span><span class="p">,</span><span class="n">llcrnrlat</span><span class="p">,</span><span class="n">urcrnrlon</span><span class="p">,</span><span class="n">urcrnrlat</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">using_corners</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">llcrnrlon</span> <span class="o">=</span> <span class="n">_validated_ll</span><span class="p">(</span><span class="n">llcrnrlon</span><span class="p">,</span> <span class="s1">&#39;llcrnrlon&#39;</span><span class="p">,</span> <span class="o">-</span><span class="mi">360</span><span class="p">,</span> <span class="mi">720</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">urcrnrlon</span> <span class="o">=</span> <span class="n">_validated_ll</span><span class="p">(</span><span class="n">urcrnrlon</span><span class="p">,</span> <span class="s1">&#39;urcrnrlon&#39;</span><span class="p">,</span> <span class="o">-</span><span class="mi">360</span><span class="p">,</span> <span class="mi">720</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">llcrnrlat</span> <span class="o">=</span> <span class="n">_validated_ll</span><span class="p">(</span><span class="n">llcrnrlat</span><span class="p">,</span> <span class="s1">&#39;llcrnrlat&#39;</span><span class="p">,</span> <span class="o">-</span><span class="mi">90</span><span class="p">,</span> <span class="mi">90</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">urcrnrlat</span> <span class="o">=</span> <span class="n">_validated_ll</span><span class="p">(</span><span class="n">urcrnrlat</span><span class="p">,</span> <span class="s1">&#39;urcrnrlat&#39;</span><span class="p">,</span> <span class="o">-</span><span class="mi">90</span><span class="p">,</span> <span class="mi">90</span><span class="p">)</span>

        <span class="c1"># for each of the supported projections,</span>
        <span class="c1"># compute lat/lon of domain corners</span>
        <span class="c1"># and set values in projparams dict as needed.</span>

        <span class="k">if</span> <span class="n">projection</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;lcc&#39;</span><span class="p">,</span> <span class="s1">&#39;eqdc&#39;</span><span class="p">,</span> <span class="s1">&#39;aea&#39;</span><span class="p">]:</span>
            <span class="k">if</span> <span class="n">projection</span> <span class="o">==</span> <span class="s1">&#39;lcc&#39;</span> <span class="ow">and</span> <span class="n">k_0</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">projparams</span><span class="p">[</span><span class="s1">&#39;k_0&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">k_0</span>
            <span class="c1"># if lat_0 is given, but not lat_1,</span>
            <span class="c1"># set lat_1=lat_0</span>
            <span class="k">if</span> <span class="n">lat_1</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">lat_0</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">lat_1</span> <span class="o">=</span> <span class="n">lat_0</span>
                <span class="n">projparams</span><span class="p">[</span><span class="s1">&#39;lat_1&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">lat_1</span>
            <span class="k">if</span> <span class="n">lat_1</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">lon_0</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;must specify lat_1 or lat_0 and lon_0 for </span><span class="si">%s</span><span class="s1"> basemap (lat_2 is optional)&#39;</span> <span class="o">%</span> <span class="n">_projnames</span><span class="p">[</span><span class="n">projection</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">lat_2</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">projparams</span><span class="p">[</span><span class="s1">&#39;lat_2&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">lat_1</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">using_corners</span><span class="p">:</span>
                <span class="n">using_cornersxy</span> <span class="o">=</span> <span class="p">(</span><span class="kc">None</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="n">llcrnrx</span><span class="p">,</span><span class="n">llcrnry</span><span class="p">,</span><span class="n">urcrnrx</span><span class="p">,</span><span class="n">urcrnry</span><span class="p">])</span>
                <span class="k">if</span> <span class="n">using_cornersxy</span><span class="p">:</span>
                    <span class="n">llcrnrlon</span><span class="p">,</span><span class="n">llcrnrlat</span><span class="p">,</span><span class="n">urcrnrlon</span><span class="p">,</span><span class="n">urcrnrlat</span> <span class="o">=</span> <span class="n">_choosecornersllur</span><span class="p">(</span><span class="n">llcrnrx</span><span class="p">,</span><span class="n">llcrnry</span><span class="p">,</span><span class="n">urcrnrx</span><span class="p">,</span><span class="n">urcrnry</span><span class="p">,</span><span class="o">**</span><span class="n">projparams</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">llcrnrlon</span> <span class="o">=</span> <span class="n">llcrnrlon</span><span class="p">;</span> <span class="bp">self</span><span class="o">.</span><span class="n">llcrnrlat</span> <span class="o">=</span> <span class="n">llcrnrlat</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">urcrnrlon</span> <span class="o">=</span> <span class="n">urcrnrlon</span><span class="p">;</span> <span class="bp">self</span><span class="o">.</span><span class="n">urcrnrlat</span> <span class="o">=</span> <span class="n">urcrnrlat</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">width</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">height</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;must either specify lat/lon values of corners (llcrnrlon,llcrnrlat,urcrnrlon,urcrnrlat) in degrees or width and height in meters&#39;</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">lon_0</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">lat_0</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;must specify lon_0 and lat_0 when using width, height to specify projection region&#39;</span><span class="p">)</span>
                    <span class="n">llcrnrlon</span><span class="p">,</span><span class="n">llcrnrlat</span><span class="p">,</span><span class="n">urcrnrlon</span><span class="p">,</span><span class="n">urcrnrlat</span> <span class="o">=</span> <span class="n">_choosecorners</span><span class="p">(</span><span class="n">width</span><span class="p">,</span><span class="n">height</span><span class="p">,</span><span class="o">**</span><span class="n">projparams</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">llcrnrlon</span> <span class="o">=</span> <span class="n">llcrnrlon</span><span class="p">;</span> <span class="bp">self</span><span class="o">.</span><span class="n">llcrnrlat</span> <span class="o">=</span> <span class="n">llcrnrlat</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">urcrnrlon</span> <span class="o">=</span> <span class="n">urcrnrlon</span><span class="p">;</span> <span class="bp">self</span><span class="o">.</span><span class="n">urcrnrlat</span> <span class="o">=</span> <span class="n">urcrnrlat</span>
        <span class="k">elif</span> <span class="n">projection</span> <span class="o">==</span> <span class="s1">&#39;stere&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">k_0</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">projparams</span><span class="p">[</span><span class="s1">&#39;k_0&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">k_0</span>
            <span class="k">if</span> <span class="n">lat_0</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">lon_0</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;must specify lat_0 and lon_0 for Stereographic basemap (lat_ts is optional)&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">using_corners</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">width</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">height</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;must either specify lat/lon values of corners (llcrnrlon,llcrnrlat,urcrnrlon,urcrnrlat) in degrees or width and height in meters&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">lon_0</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">lat_0</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;must specify lon_0 and lat_0 when using width, height to specify projection region&#39;</span><span class="p">)</span>
                <span class="n">llcrnrlon</span><span class="p">,</span><span class="n">llcrnrlat</span><span class="p">,</span><span class="n">urcrnrlon</span><span class="p">,</span><span class="n">urcrnrlat</span> <span class="o">=</span> <span class="n">_choosecorners</span><span class="p">(</span><span class="n">width</span><span class="p">,</span><span class="n">height</span><span class="p">,</span><span class="o">**</span><span class="n">projparams</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">llcrnrlon</span> <span class="o">=</span> <span class="n">llcrnrlon</span><span class="p">;</span> <span class="bp">self</span><span class="o">.</span><span class="n">llcrnrlat</span> <span class="o">=</span> <span class="n">llcrnrlat</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">urcrnrlon</span> <span class="o">=</span> <span class="n">urcrnrlon</span><span class="p">;</span> <span class="bp">self</span><span class="o">.</span><span class="n">urcrnrlat</span> <span class="o">=</span> <span class="n">urcrnrlat</span>
        <span class="k">elif</span> <span class="n">projection</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;spstere&#39;</span><span class="p">,</span> <span class="s1">&#39;npstere&#39;</span><span class="p">,</span>
                            <span class="s1">&#39;splaea&#39;</span><span class="p">,</span> <span class="s1">&#39;nplaea&#39;</span><span class="p">,</span>
                            <span class="s1">&#39;spaeqd&#39;</span><span class="p">,</span> <span class="s1">&#39;npaeqd&#39;</span><span class="p">]:</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">projection</span> <span class="o">==</span> <span class="s1">&#39;splaea&#39;</span> <span class="ow">and</span> <span class="n">boundinglat</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="ow">or</span>\
               <span class="p">(</span><span class="n">projection</span> <span class="o">==</span> <span class="s1">&#39;nplaea&#39;</span> <span class="ow">and</span> <span class="n">boundinglat</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;boundinglat cannot extend into opposite hemisphere&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">boundinglat</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">lon_0</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;must specify boundinglat and lon_0 for </span><span class="si">%s</span><span class="s1"> basemap&#39;</span> <span class="o">%</span> <span class="n">_projnames</span><span class="p">[</span><span class="n">projection</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">projection</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;s&#39;</span><span class="p">:</span>
                <span class="n">sgn</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">sgn</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="n">rootproj</span> <span class="o">=</span> <span class="n">projection</span><span class="p">[</span><span class="mi">2</span><span class="p">:]</span>
            <span class="n">projparams</span><span class="p">[</span><span class="s1">&#39;proj&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">rootproj</span>
            <span class="k">if</span> <span class="n">rootproj</span> <span class="o">==</span> <span class="s1">&#39;stere&#39;</span><span class="p">:</span>
                <span class="n">projparams</span><span class="p">[</span><span class="s1">&#39;lat_ts&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sgn</span> <span class="o">*</span> <span class="mf">90.</span>
            <span class="n">projparams</span><span class="p">[</span><span class="s1">&#39;lat_0&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sgn</span> <span class="o">*</span> <span class="mf">90.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">llcrnrlon</span> <span class="o">=</span> <span class="n">lon_0</span> <span class="o">-</span> <span class="n">sgn</span><span class="o">*</span><span class="mf">45.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">urcrnrlon</span> <span class="o">=</span> <span class="n">lon_0</span> <span class="o">+</span> <span class="n">sgn</span><span class="o">*</span><span class="mf">135.</span>
            <span class="n">proj</span> <span class="o">=</span> <span class="n">pyproj</span><span class="o">.</span><span class="n">Proj</span><span class="p">(</span><span class="n">projparams</span><span class="p">)</span>
            <span class="n">x</span><span class="p">,</span><span class="n">y</span> <span class="o">=</span> <span class="n">proj</span><span class="p">(</span><span class="n">lon_0</span><span class="p">,</span><span class="n">boundinglat</span><span class="p">)</span>
            <span class="n">lon</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">llcrnrlat</span> <span class="o">=</span> <span class="n">proj</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mf">2.</span><span class="p">)</span><span class="o">*</span><span class="n">y</span><span class="p">,</span><span class="mf">0.</span><span class="p">,</span><span class="n">inverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">urcrnrlat</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">llcrnrlat</span>
            <span class="k">if</span> <span class="n">width</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">height</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;warning: width and height keywords ignored for </span><span class="si">%s</span><span class="s1"> projection&#39;</span> <span class="o">%</span> <span class="n">_projnames</span><span class="p">[</span><span class="n">projection</span><span class="p">])</span>
        <span class="k">elif</span> <span class="n">projection</span> <span class="o">==</span> <span class="s1">&#39;laea&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">lat_0</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">lon_0</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;must specify lat_0 and lon_0 for Lambert Azimuthal basemap&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">using_corners</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">width</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">height</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;must either specify lat/lon values of corners (llcrnrlon,llcrnrlat,urcrnrlon,urcrnrlat) in degrees or width and height in meters&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">lon_0</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">lat_0</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;must specify lon_0 and lat_0 when using width, height to specify projection region&#39;</span><span class="p">)</span>
                <span class="n">llcrnrlon</span><span class="p">,</span><span class="n">llcrnrlat</span><span class="p">,</span><span class="n">urcrnrlon</span><span class="p">,</span><span class="n">urcrnrlat</span> <span class="o">=</span> <span class="n">_choosecorners</span><span class="p">(</span><span class="n">width</span><span class="p">,</span><span class="n">height</span><span class="p">,</span><span class="o">**</span><span class="n">projparams</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">llcrnrlon</span> <span class="o">=</span> <span class="n">llcrnrlon</span><span class="p">;</span> <span class="bp">self</span><span class="o">.</span><span class="n">llcrnrlat</span> <span class="o">=</span> <span class="n">llcrnrlat</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">urcrnrlon</span> <span class="o">=</span> <span class="n">urcrnrlon</span><span class="p">;</span> <span class="bp">self</span><span class="o">.</span><span class="n">urcrnrlat</span> <span class="o">=</span> <span class="n">urcrnrlat</span>
        <span class="k">elif</span> <span class="n">projection</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;tmerc&#39;</span><span class="p">,</span><span class="s1">&#39;gnom&#39;</span><span class="p">,</span><span class="s1">&#39;cass&#39;</span><span class="p">,</span><span class="s1">&#39;poly&#39;</span><span class="p">]</span> <span class="p">:</span>
            <span class="k">if</span> <span class="n">projection</span> <span class="o">==</span> <span class="s1">&#39;tmerc&#39;</span> <span class="ow">and</span> <span class="n">k_0</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">projparams</span><span class="p">[</span><span class="s1">&#39;k_0&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">k_0</span>
            <span class="k">if</span> <span class="n">projection</span> <span class="o">==</span> <span class="s1">&#39;gnom&#39;</span> <span class="ow">and</span> <span class="s1">&#39;R&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">projparams</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;gnomonic projection only works for perfect spheres - not ellipsoids&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">lat_0</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">lon_0</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;must specify lat_0 and lon_0 for Transverse Mercator, Gnomonic, Cassini-Soldnerr and Polyconic basemap&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">using_corners</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">width</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">height</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;must either specify lat/lon values of corners (llcrnrlon,llcrnrlat,urcrnrlon,urcrnrlat) in degrees or width and height in meters&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">lon_0</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">lat_0</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;must specify lon_0 and lat_0 when using width, height to specify projection region&#39;</span><span class="p">)</span>
                <span class="n">llcrnrlon</span><span class="p">,</span><span class="n">llcrnrlat</span><span class="p">,</span><span class="n">urcrnrlon</span><span class="p">,</span><span class="n">urcrnrlat</span> <span class="o">=</span> <span class="n">_choosecorners</span><span class="p">(</span><span class="n">width</span><span class="p">,</span><span class="n">height</span><span class="p">,</span><span class="o">**</span><span class="n">projparams</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">llcrnrlon</span> <span class="o">=</span> <span class="n">llcrnrlon</span><span class="p">;</span> <span class="bp">self</span><span class="o">.</span><span class="n">llcrnrlat</span> <span class="o">=</span> <span class="n">llcrnrlat</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">urcrnrlon</span> <span class="o">=</span> <span class="n">urcrnrlon</span><span class="p">;</span> <span class="bp">self</span><span class="o">.</span><span class="n">urcrnrlat</span> <span class="o">=</span> <span class="n">urcrnrlat</span>
        <span class="k">elif</span> <span class="n">projection</span> <span class="o">==</span> <span class="s1">&#39;ortho&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="s1">&#39;R&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">projparams</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;orthographic projection only works for perfect spheres - not ellipsoids&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">lat_0</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">lon_0</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;must specify lat_0 and lon_0 for Orthographic basemap&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">lat_0</span> <span class="o">==</span> <span class="mi">90</span> <span class="ow">or</span> <span class="n">lat_0</span> <span class="o">==</span> <span class="o">-</span><span class="mi">90</span><span class="p">)</span> <span class="ow">and</span>\
               <span class="kc">None</span> <span class="ow">in</span> <span class="p">[</span><span class="n">llcrnrx</span><span class="p">,</span><span class="n">llcrnry</span><span class="p">,</span><span class="n">urcrnrx</span><span class="p">,</span><span class="n">urcrnry</span><span class="p">]:</span>
                <span class="c1"># for ortho plot centered on pole, set boundinglat to equator.</span>
                <span class="c1"># (so meridian labels can be drawn in this special case).</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">boundinglat</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">round</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">if</span> <span class="n">width</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">height</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;warning: width and height keywords ignored for </span><span class="si">%s</span><span class="s1"> projection&#39;</span> <span class="o">%</span> <span class="n">_projnames</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">projection</span><span class="p">])</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">using_corners</span><span class="p">:</span>
                <span class="n">llcrnrlon</span> <span class="o">=</span> <span class="o">-</span><span class="mf">180.</span>
                <span class="n">llcrnrlat</span> <span class="o">=</span> <span class="o">-</span><span class="mf">90.</span>
                <span class="n">urcrnrlon</span> <span class="o">=</span> <span class="mi">180</span>
                <span class="n">urcrnrlat</span> <span class="o">=</span> <span class="mf">90.</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_fulldisk</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_fulldisk</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">llcrnrlon</span> <span class="o">=</span> <span class="n">llcrnrlon</span><span class="p">;</span> <span class="bp">self</span><span class="o">.</span><span class="n">llcrnrlat</span> <span class="o">=</span> <span class="n">llcrnrlat</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">urcrnrlon</span> <span class="o">=</span> <span class="n">urcrnrlon</span><span class="p">;</span> <span class="bp">self</span><span class="o">.</span><span class="n">urcrnrlat</span> <span class="o">=</span> <span class="n">urcrnrlat</span>
            <span class="c1"># FIXME: won&#39;t work for points exactly on equator??</span>
            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">lat_0</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">1.e-2</span><span class="p">:</span> <span class="n">lat_0</span> <span class="o">=</span> <span class="mf">1.e-2</span>
            <span class="n">projparams</span><span class="p">[</span><span class="s1">&#39;lat_0&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">lat_0</span>
        <span class="k">elif</span> <span class="n">projection</span> <span class="o">==</span> <span class="s1">&#39;geos&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">lat_0</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">lat_0</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;lat_0 must be zero for Geostationary basemap&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">lon_0</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;must specify lon_0 for Geostationary basemap&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">width</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">height</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;warning: width and height keywords ignored for </span><span class="si">%s</span><span class="s1"> projection&#39;</span> <span class="o">%</span> <span class="n">_projnames</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">projection</span><span class="p">])</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">using_corners</span><span class="p">:</span>
                <span class="n">llcrnrlon</span> <span class="o">=</span> <span class="o">-</span><span class="mf">180.</span>
                <span class="n">llcrnrlat</span> <span class="o">=</span> <span class="o">-</span><span class="mf">90.</span>
                <span class="n">urcrnrlon</span> <span class="o">=</span> <span class="mi">180</span>
                <span class="n">urcrnrlat</span> <span class="o">=</span> <span class="mf">90.</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_fulldisk</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_fulldisk</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">llcrnrlon</span> <span class="o">=</span> <span class="n">llcrnrlon</span><span class="p">;</span> <span class="bp">self</span><span class="o">.</span><span class="n">llcrnrlat</span> <span class="o">=</span> <span class="n">llcrnrlat</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">urcrnrlon</span> <span class="o">=</span> <span class="n">urcrnrlon</span><span class="p">;</span> <span class="bp">self</span><span class="o">.</span><span class="n">urcrnrlat</span> <span class="o">=</span> <span class="n">urcrnrlat</span>
        <span class="k">elif</span> <span class="n">projection</span> <span class="o">==</span> <span class="s1">&#39;nsper&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="s1">&#39;R&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">projparams</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;near-sided perspective projection only works for perfect spheres - not ellipsoids&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">lat_0</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">lon_0</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;must specify lon_0 and lat_0 for near-sided perspective Basemap&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">width</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">height</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;warning: width and height keywords ignored for </span><span class="si">%s</span><span class="s1"> projection&#39;</span> <span class="o">%</span> <span class="n">_projnames</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">projection</span><span class="p">])</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">using_corners</span><span class="p">:</span>
                <span class="n">llcrnrlon</span> <span class="o">=</span> <span class="o">-</span><span class="mf">180.</span>
                <span class="n">llcrnrlat</span> <span class="o">=</span> <span class="o">-</span><span class="mf">90.</span>
                <span class="n">urcrnrlon</span> <span class="o">=</span> <span class="mi">180</span>
                <span class="n">urcrnrlat</span> <span class="o">=</span> <span class="mf">90.</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_fulldisk</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_fulldisk</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">llcrnrlon</span> <span class="o">=</span> <span class="n">llcrnrlon</span><span class="p">;</span> <span class="bp">self</span><span class="o">.</span><span class="n">llcrnrlat</span> <span class="o">=</span> <span class="n">llcrnrlat</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">urcrnrlon</span> <span class="o">=</span> <span class="n">urcrnrlon</span><span class="p">;</span> <span class="bp">self</span><span class="o">.</span><span class="n">urcrnrlat</span> <span class="o">=</span> <span class="n">urcrnrlat</span>
        <span class="k">elif</span> <span class="n">projection</span> <span class="ow">in</span> <span class="n">_pseudocyl</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">lon_0</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;must specify lon_0 for </span><span class="si">%s</span><span class="s1"> projection&#39;</span> <span class="o">%</span> <span class="n">_projnames</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">projection</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">width</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">height</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;warning: width and height keywords ignored for </span><span class="si">%s</span><span class="s1"> projection&#39;</span> <span class="o">%</span> <span class="n">_projnames</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">projection</span><span class="p">])</span>
            <span class="n">llcrnrlon</span> <span class="o">=</span> <span class="n">lon_0</span><span class="o">-</span><span class="mf">180.</span>
            <span class="n">llcrnrlat</span> <span class="o">=</span> <span class="o">-</span><span class="mf">90.</span>
            <span class="n">urcrnrlon</span> <span class="o">=</span> <span class="n">lon_0</span><span class="o">+</span><span class="mi">180</span>
            <span class="n">urcrnrlat</span> <span class="o">=</span> <span class="mf">90.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">llcrnrlon</span> <span class="o">=</span> <span class="n">llcrnrlon</span><span class="p">;</span> <span class="bp">self</span><span class="o">.</span><span class="n">llcrnrlat</span> <span class="o">=</span> <span class="n">llcrnrlat</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">urcrnrlon</span> <span class="o">=</span> <span class="n">urcrnrlon</span><span class="p">;</span> <span class="bp">self</span><span class="o">.</span><span class="n">urcrnrlat</span> <span class="o">=</span> <span class="n">urcrnrlat</span>
        <span class="k">elif</span> <span class="n">projection</span> <span class="o">==</span> <span class="s1">&#39;omerc&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">k_0</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">projparams</span><span class="p">[</span><span class="s1">&#39;k_0&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">k_0</span>
            <span class="k">if</span> <span class="n">lat_1</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">lon_1</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">lat_2</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">lon_2</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;must specify lat_1,lon_1 and lat_2,lon_2 for Oblique Mercator basemap&#39;</span><span class="p">)</span>
            <span class="n">projparams</span><span class="p">[</span><span class="s1">&#39;lat_1&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">lat_1</span>
            <span class="n">projparams</span><span class="p">[</span><span class="s1">&#39;lon_1&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">lon_1</span>
            <span class="n">projparams</span><span class="p">[</span><span class="s1">&#39;lat_2&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">lat_2</span>
            <span class="n">projparams</span><span class="p">[</span><span class="s1">&#39;lon_2&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">lon_2</span>
            <span class="n">projparams</span><span class="p">[</span><span class="s1">&#39;lat_0&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">lat_0</span>
            <span class="k">if</span> <span class="n">no_rot</span><span class="p">:</span>
                <span class="n">projparams</span><span class="p">[</span><span class="s1">&#39;no_rot&#39;</span><span class="p">]</span><span class="o">=</span><span class="s1">&#39;&#39;</span>
            <span class="c1">#if not using_corners:</span>
            <span class="c1">#    raise ValueError, &#39;cannot specify map region with width and height keywords for this projection, please specify lat/lon values of corners&#39;</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">using_corners</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">width</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">height</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;must either specify lat/lon values of corners (llcrnrlon,llcrnrlat,urcrnrlon,urcrnrlat) in degrees or width and height in meters&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">lon_0</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">lat_0</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;must specify lon_0 and lat_0 when using width, height to specify projection region&#39;</span><span class="p">)</span>
                <span class="n">llcrnrlon</span><span class="p">,</span><span class="n">llcrnrlat</span><span class="p">,</span><span class="n">urcrnrlon</span><span class="p">,</span><span class="n">urcrnrlat</span> <span class="o">=</span> <span class="n">_choosecorners</span><span class="p">(</span><span class="n">width</span><span class="p">,</span><span class="n">height</span><span class="p">,</span><span class="o">**</span><span class="n">projparams</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">llcrnrlon</span> <span class="o">=</span> <span class="n">llcrnrlon</span><span class="p">;</span> <span class="bp">self</span><span class="o">.</span><span class="n">llcrnrlat</span> <span class="o">=</span> <span class="n">llcrnrlat</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">urcrnrlon</span> <span class="o">=</span> <span class="n">urcrnrlon</span><span class="p">;</span> <span class="bp">self</span><span class="o">.</span><span class="n">urcrnrlat</span> <span class="o">=</span> <span class="n">urcrnrlat</span>
        <span class="k">elif</span> <span class="n">projection</span> <span class="o">==</span> <span class="s1">&#39;aeqd&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">lat_0</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">lon_0</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;must specify lat_0 and lon_0 for Azimuthal Equidistant basemap&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">using_corners</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">width</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">height</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_fulldisk</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="n">llcrnrlon</span> <span class="o">=</span> <span class="o">-</span><span class="mf">180.</span>
                    <span class="n">llcrnrlat</span> <span class="o">=</span> <span class="o">-</span><span class="mf">90.</span>
                    <span class="n">urcrnrlon</span> <span class="o">=</span> <span class="mi">180</span>
                    <span class="n">urcrnrlat</span> <span class="o">=</span> <span class="mf">90.</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_fulldisk</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="k">if</span> <span class="n">lon_0</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">lat_0</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;must specify lon_0 and lat_0 when using width, height to specify projection region&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fulldisk</span><span class="p">:</span>
                    <span class="n">llcrnrlon</span><span class="p">,</span><span class="n">llcrnrlat</span><span class="p">,</span><span class="n">urcrnrlon</span><span class="p">,</span><span class="n">urcrnrlat</span> <span class="o">=</span> <span class="n">_choosecorners</span><span class="p">(</span><span class="n">width</span><span class="p">,</span><span class="n">height</span><span class="p">,</span><span class="o">**</span><span class="n">projparams</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">llcrnrlon</span> <span class="o">=</span> <span class="n">llcrnrlon</span><span class="p">;</span> <span class="bp">self</span><span class="o">.</span><span class="n">llcrnrlat</span> <span class="o">=</span> <span class="n">llcrnrlat</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">urcrnrlon</span> <span class="o">=</span> <span class="n">urcrnrlon</span><span class="p">;</span> <span class="bp">self</span><span class="o">.</span><span class="n">urcrnrlat</span> <span class="o">=</span> <span class="n">urcrnrlat</span>
        <span class="k">elif</span> <span class="n">projection</span> <span class="ow">in</span> <span class="n">_cylproj</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">projection</span> <span class="o">==</span> <span class="s1">&#39;merc&#39;</span> <span class="ow">or</span> <span class="n">projection</span> <span class="o">==</span> <span class="s1">&#39;cea&#39;</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">lat_ts</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">lat_ts</span> <span class="o">=</span> <span class="mf">0.</span>
                    <span class="n">projparams</span><span class="p">[</span><span class="s1">&#39;lat_ts&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">lat_ts</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">using_corners</span><span class="p">:</span>
                <span class="n">llcrnrlat</span> <span class="o">=</span> <span class="o">-</span><span class="mf">90.</span>
                <span class="n">urcrnrlat</span> <span class="o">=</span> <span class="mf">90.</span>
                <span class="k">if</span> <span class="n">lon_0</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">llcrnrlon</span> <span class="o">=</span> <span class="n">lon_0</span><span class="o">-</span><span class="mf">180.</span>
                    <span class="n">urcrnrlon</span> <span class="o">=</span> <span class="n">lon_0</span><span class="o">+</span><span class="mf">180.</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">llcrnrlon</span> <span class="o">=</span> <span class="o">-</span><span class="mf">180.</span>
                    <span class="n">urcrnrlon</span> <span class="o">=</span> <span class="mi">180</span>
                <span class="k">if</span> <span class="n">projection</span> <span class="o">==</span> <span class="s1">&#39;merc&#39;</span><span class="p">:</span>
                    <span class="c1"># clip plot region to be within -89.99S to 89.99N</span>
                    <span class="c1"># (mercator is singular at poles)</span>
                    <span class="k">if</span> <span class="n">llcrnrlat</span> <span class="o">&lt;</span> <span class="o">-</span><span class="mf">89.99</span><span class="p">:</span> <span class="n">llcrnrlat</span> <span class="o">=</span> <span class="o">-</span><span class="mf">89.99</span>
                    <span class="k">if</span> <span class="n">llcrnrlat</span> <span class="o">&gt;</span> <span class="mf">89.99</span><span class="p">:</span> <span class="n">llcrnrlat</span> <span class="o">=</span> <span class="mf">89.99</span>
                    <span class="k">if</span> <span class="n">urcrnrlat</span> <span class="o">&lt;</span> <span class="o">-</span><span class="mf">89.99</span><span class="p">:</span> <span class="n">urcrnrlat</span> <span class="o">=</span> <span class="o">-</span><span class="mf">89.99</span>
                    <span class="k">if</span> <span class="n">urcrnrlat</span> <span class="o">&gt;</span> <span class="mf">89.99</span><span class="p">:</span> <span class="n">urcrnrlat</span> <span class="o">=</span> <span class="mf">89.99</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">llcrnrlon</span> <span class="o">=</span> <span class="n">llcrnrlon</span><span class="p">;</span> <span class="bp">self</span><span class="o">.</span><span class="n">llcrnrlat</span> <span class="o">=</span> <span class="n">llcrnrlat</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">urcrnrlon</span> <span class="o">=</span> <span class="n">urcrnrlon</span><span class="p">;</span> <span class="bp">self</span><span class="o">.</span><span class="n">urcrnrlat</span> <span class="o">=</span> <span class="n">urcrnrlat</span>
            <span class="k">if</span> <span class="n">width</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">height</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;warning: width and height keywords ignored for </span><span class="si">%s</span><span class="s1"> projection&#39;</span> <span class="o">%</span> <span class="n">_projnames</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">projection</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">lon_0</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">projparams</span><span class="p">[</span><span class="s1">&#39;lon_0&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">lon_0</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">projparams</span><span class="p">[</span><span class="s1">&#39;lon_0&#39;</span><span class="p">]</span><span class="o">=</span><span class="mf">0.5</span><span class="o">*</span><span class="p">(</span><span class="n">llcrnrlon</span><span class="o">+</span><span class="n">urcrnrlon</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">projection</span> <span class="o">==</span> <span class="s1">&#39;rotpole&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">lon_0</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">o_lon_p</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">o_lat_p</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;must specify lon_0,o_lat_p,o_lon_p for rotated pole Basemap&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">width</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">height</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;warning: width and height keywords ignored for </span><span class="si">%s</span><span class="s1"> projection&#39;</span> <span class="o">%</span> <span class="n">_projnames</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">projection</span><span class="p">])</span>
            <span class="n">projparams</span><span class="p">[</span><span class="s1">&#39;lon_0&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">lon_0</span>
            <span class="n">projparams</span><span class="p">[</span><span class="s1">&#39;o_lon_p&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">o_lon_p</span>
            <span class="n">projparams</span><span class="p">[</span><span class="s1">&#39;o_lat_p&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">o_lat_p</span>
            <span class="n">projparams</span><span class="p">[</span><span class="s1">&#39;o_proj&#39;</span><span class="p">]</span><span class="o">=</span><span class="s1">&#39;longlat&#39;</span>
            <span class="n">projparams</span><span class="p">[</span><span class="s1">&#39;proj&#39;</span><span class="p">]</span><span class="o">=</span><span class="s1">&#39;ob_tran&#39;</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">using_corners</span> <span class="ow">and</span> <span class="kc">None</span> <span class="ow">in</span> <span class="p">[</span><span class="n">llcrnrx</span><span class="p">,</span><span class="n">llcrnry</span><span class="p">,</span><span class="n">urcrnrx</span><span class="p">,</span><span class="n">urcrnry</span><span class="p">]:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;must specify lat/lon values of corners in degrees&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="kc">None</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="n">llcrnrx</span><span class="p">,</span><span class="n">llcrnry</span><span class="p">,</span><span class="n">urcrnrx</span><span class="p">,</span><span class="n">urcrnry</span><span class="p">]:</span>
                <span class="n">p</span> <span class="o">=</span> <span class="n">pyproj</span><span class="o">.</span><span class="n">Proj</span><span class="p">(</span><span class="n">projparams</span><span class="p">)</span>
                <span class="n">llcrnrx</span> <span class="o">=</span> <span class="n">_dg2rad</span><span class="o">*</span><span class="n">llcrnrx</span><span class="p">;</span> <span class="n">llcrnry</span> <span class="o">=</span> <span class="n">_dg2rad</span><span class="o">*</span><span class="n">llcrnry</span>
                <span class="n">urcrnrx</span> <span class="o">=</span> <span class="n">_dg2rad</span><span class="o">*</span><span class="n">urcrnrx</span><span class="p">;</span> <span class="n">urcrnry</span> <span class="o">=</span> <span class="n">_dg2rad</span><span class="o">*</span><span class="n">urcrnry</span>
                <span class="n">llcrnrlon</span><span class="p">,</span> <span class="n">llcrnrlat</span> <span class="o">=</span> <span class="n">p</span><span class="p">(</span><span class="n">llcrnrx</span><span class="p">,</span><span class="n">llcrnry</span><span class="p">,</span><span class="n">inverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="n">urcrnrlon</span><span class="p">,</span> <span class="n">urcrnrlat</span> <span class="o">=</span> <span class="n">p</span><span class="p">(</span><span class="n">urcrnrx</span><span class="p">,</span><span class="n">urcrnry</span><span class="p">,</span><span class="n">inverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">llcrnrlon</span> <span class="o">=</span> <span class="n">llcrnrlon</span><span class="p">;</span> <span class="bp">self</span><span class="o">.</span><span class="n">llcrnrlat</span> <span class="o">=</span> <span class="n">llcrnrlat</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">urcrnrlon</span> <span class="o">=</span> <span class="n">urcrnrlon</span><span class="p">;</span> <span class="bp">self</span><span class="o">.</span><span class="n">urcrnrlat</span> <span class="o">=</span> <span class="n">urcrnrlat</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">_unsupported_projection</span> <span class="o">%</span> <span class="n">projection</span><span class="p">)</span>

        <span class="c1"># initialize proj4</span>
        <span class="n">proj</span> <span class="o">=</span> <span class="n">Proj</span><span class="p">(</span><span class="n">projparams</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">llcrnrlon</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">llcrnrlat</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">urcrnrlon</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">urcrnrlat</span><span class="p">)</span>

        <span class="c1"># make sure axis ticks are suppressed.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">noticks</span> <span class="o">=</span> <span class="n">suppress_ticks</span>
        <span class="c1"># map boundary not yet drawn.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_mapboundarydrawn</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="c1"># make Proj instance a Basemap instance variable.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">projtran</span> <span class="o">=</span> <span class="n">proj</span>
        <span class="c1"># copy some Proj attributes.</span>
        <span class="n">atts</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;rmajor&#39;</span><span class="p">,</span><span class="s1">&#39;rminor&#39;</span><span class="p">,</span><span class="s1">&#39;esq&#39;</span><span class="p">,</span><span class="s1">&#39;flattening&#39;</span><span class="p">,</span><span class="s1">&#39;ellipsoid&#39;</span><span class="p">,</span><span class="s1">&#39;projparams&#39;</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">att</span> <span class="ow">in</span> <span class="n">atts</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">[</span><span class="n">att</span><span class="p">]</span> <span class="o">=</span> <span class="n">proj</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">[</span><span class="n">att</span><span class="p">]</span>
        <span class="c1"># these only exist for geostationary projection.</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">proj</span><span class="p">,</span><span class="s1">&#39;_width&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">[</span><span class="s1">&#39;_width&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">proj</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">[</span><span class="s1">&#39;_width&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">proj</span><span class="p">,</span><span class="s1">&#39;_height&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">[</span><span class="s1">&#39;_height&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">proj</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">[</span><span class="s1">&#39;_height&#39;</span><span class="p">]</span>
        <span class="c1"># spatial reference string (useful for georeferencing output</span>
        <span class="c1"># images with gdal_translate).</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="s1">&#39;_proj4&#39;</span><span class="p">):</span>
            <span class="c1">#self.srs = proj._proj4.srs</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">srs</span> <span class="o">=</span> <span class="n">proj</span><span class="o">.</span><span class="n">_proj4</span><span class="o">.</span><span class="n">pjinitstring</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">pjargs</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">key</span><span class="p">,</span><span class="n">value</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">projparams</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="c1"># &#39;cyl&#39; projection translates to &#39;eqc&#39; in PROJ.4</span>
                <span class="k">if</span> <span class="n">projection</span> <span class="o">==</span> <span class="s1">&#39;cyl&#39;</span> <span class="ow">and</span> <span class="n">key</span> <span class="o">==</span> <span class="s1">&#39;proj&#39;</span><span class="p">:</span>
                    <span class="n">value</span> <span class="o">=</span> <span class="s1">&#39;eqc&#39;</span>
                <span class="c1"># ignore x_0 and y_0 settings for &#39;cyl&#39; projection</span>
                <span class="c1"># (they are not consistent with what PROJ.4 uses)</span>
                <span class="k">elif</span> <span class="n">projection</span> <span class="o">==</span> <span class="s1">&#39;cyl&#39;</span> <span class="ow">and</span> <span class="n">key</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;x_0&#39;</span><span class="p">,</span><span class="s1">&#39;y_0&#39;</span><span class="p">]:</span>
                    <span class="k">continue</span>
                <span class="n">pjargs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;+&#39;</span><span class="o">+</span><span class="n">key</span><span class="o">+</span><span class="s2">&quot;=&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">value</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39; &#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">srs</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">pjargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">proj4string</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">srs</span>
        <span class="c1"># set instance variables defining map region.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">xmin</span> <span class="o">=</span> <span class="n">proj</span><span class="o">.</span><span class="n">xmin</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">xmax</span> <span class="o">=</span> <span class="n">proj</span><span class="o">.</span><span class="n">xmax</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ymin</span> <span class="o">=</span> <span class="n">proj</span><span class="o">.</span><span class="n">ymin</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ymax</span> <span class="o">=</span> <span class="n">proj</span><span class="o">.</span><span class="n">ymax</span>
        <span class="k">if</span> <span class="n">projection</span> <span class="o">==</span> <span class="s1">&#39;cyl&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">aspect</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">urcrnrlat</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">llcrnrlat</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">urcrnrlon</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">llcrnrlon</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">aspect</span> <span class="o">=</span> <span class="p">(</span><span class="n">proj</span><span class="o">.</span><span class="n">ymax</span><span class="o">-</span><span class="n">proj</span><span class="o">.</span><span class="n">ymin</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">proj</span><span class="o">.</span><span class="n">xmax</span><span class="o">-</span><span class="n">proj</span><span class="o">.</span><span class="n">xmin</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">projection</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;geos&#39;</span><span class="p">,</span><span class="s1">&#39;ortho&#39;</span><span class="p">,</span><span class="s1">&#39;nsper&#39;</span><span class="p">]</span> <span class="ow">and</span> \
           <span class="kc">None</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="n">llcrnrx</span><span class="p">,</span><span class="n">llcrnry</span><span class="p">,</span><span class="n">urcrnrx</span><span class="p">,</span><span class="n">urcrnry</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">llcrnrx</span> <span class="o">=</span> <span class="n">llcrnrx</span><span class="o">+</span><span class="mf">0.5</span><span class="o">*</span><span class="n">proj</span><span class="o">.</span><span class="n">xmax</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">llcrnry</span> <span class="o">=</span> <span class="n">llcrnry</span><span class="o">+</span><span class="mf">0.5</span><span class="o">*</span><span class="n">proj</span><span class="o">.</span><span class="n">ymax</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">urcrnrx</span> <span class="o">=</span> <span class="n">urcrnrx</span><span class="o">+</span><span class="mf">0.5</span><span class="o">*</span><span class="n">proj</span><span class="o">.</span><span class="n">xmax</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">urcrnry</span> <span class="o">=</span> <span class="n">urcrnry</span><span class="o">+</span><span class="mf">0.5</span><span class="o">*</span><span class="n">proj</span><span class="o">.</span><span class="n">ymax</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_fulldisk</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">llcrnrx</span> <span class="o">=</span> <span class="n">proj</span><span class="o">.</span><span class="n">llcrnrx</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">llcrnry</span> <span class="o">=</span> <span class="n">proj</span><span class="o">.</span><span class="n">llcrnry</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">urcrnrx</span> <span class="o">=</span> <span class="n">proj</span><span class="o">.</span><span class="n">urcrnrx</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">urcrnry</span> <span class="o">=</span> <span class="n">proj</span><span class="o">.</span><span class="n">urcrnry</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">projection</span> <span class="o">==</span> <span class="s1">&#39;rotpole&#39;</span><span class="p">:</span>
            <span class="n">lon0</span><span class="p">,</span><span class="n">lat0</span> <span class="o">=</span> <span class="bp">self</span><span class="p">(</span><span class="mf">0.5</span><span class="o">*</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">llcrnrx</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">urcrnrx</span><span class="p">),</span>\
                             <span class="mf">0.5</span><span class="o">*</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">llcrnry</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">urcrnry</span><span class="p">),</span>\
                             <span class="n">inverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">projparams</span><span class="p">[</span><span class="s1">&#39;lat_0&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">lat0</span>

        <span class="c1"># if ax == None, pyplot.gca may be used.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ax</span> <span class="o">=</span> <span class="n">ax</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lsmask</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1"># This will record hashs of Axes instances.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_initialized_axes</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>

        <span class="c1"># set defaults for area_thresh.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">resolution</span> <span class="o">=</span> <span class="n">resolution</span>
        <span class="c1"># celestial=True implies resolution=None (no coastlines).</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">celestial</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">resolution</span><span class="o">=</span><span class="kc">None</span>
        <span class="k">if</span> <span class="n">area_thresh</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">resolution</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">resolution</span> <span class="o">==</span> <span class="s1">&#39;c&#39;</span><span class="p">:</span>
                <span class="n">area_thresh</span> <span class="o">=</span> <span class="mf">10000.</span>
            <span class="k">elif</span> <span class="n">resolution</span> <span class="o">==</span> <span class="s1">&#39;l&#39;</span><span class="p">:</span>
                <span class="n">area_thresh</span> <span class="o">=</span> <span class="mf">1000.</span>
            <span class="k">elif</span> <span class="n">resolution</span> <span class="o">==</span> <span class="s1">&#39;i&#39;</span><span class="p">:</span>
                <span class="n">area_thresh</span> <span class="o">=</span> <span class="mf">100.</span>
            <span class="k">elif</span> <span class="n">resolution</span> <span class="o">==</span> <span class="s1">&#39;h&#39;</span><span class="p">:</span>
                <span class="n">area_thresh</span> <span class="o">=</span> <span class="mf">10.</span>
            <span class="k">elif</span> <span class="n">resolution</span> <span class="o">==</span> <span class="s1">&#39;f&#39;</span><span class="p">:</span>
                <span class="n">area_thresh</span> <span class="o">=</span> <span class="mf">1.</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;boundary resolution must be one of &#39;c&#39;,&#39;l&#39;,&#39;i&#39;,&#39;h&#39; or &#39;f&#39;&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">area_thresh</span> <span class="o">=</span> <span class="n">area_thresh</span>
        <span class="c1"># define map boundary polygon (in lat/lon coordinates)</span>
        <span class="n">blons</span><span class="p">,</span> <span class="n">blats</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_boundarypolyll</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_boundarypolyxy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_getmapboundary</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">boundarylats</span> <span class="o">=</span> <span class="n">blats</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">boundarylons</span> <span class="o">=</span> <span class="n">blons</span>
        <span class="c1"># set min/max lats for projection domain.</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">projection</span> <span class="ow">in</span> <span class="n">_cylproj</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">latmin</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">llcrnrlat</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">latmax</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">urcrnrlat</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lonmin</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">llcrnrlon</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lonmax</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">urcrnrlon</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">projection</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;ortho&#39;</span><span class="p">,</span><span class="s1">&#39;geos&#39;</span><span class="p">,</span><span class="s1">&#39;nsper&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">_pseudocyl</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">latmin</span> <span class="o">=</span> <span class="o">-</span><span class="mf">90.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">latmax</span> <span class="o">=</span> <span class="mf">90.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lonmin</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">llcrnrlon</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lonmax</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">urcrnrlon</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">lons</span><span class="p">,</span> <span class="n">lats</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">makegrid</span><span class="p">(</span><span class="mi">1001</span><span class="p">,</span><span class="mi">1001</span><span class="p">)</span>
            <span class="n">lats</span> <span class="o">=</span> <span class="n">ma</span><span class="o">.</span><span class="n">masked_where</span><span class="p">(</span><span class="n">lats</span> <span class="o">&gt;</span> <span class="mf">1.e20</span><span class="p">,</span><span class="n">lats</span><span class="p">)</span>
            <span class="n">lons</span> <span class="o">=</span> <span class="n">ma</span><span class="o">.</span><span class="n">masked_where</span><span class="p">(</span><span class="n">lons</span> <span class="o">&gt;</span> <span class="mf">1.e20</span><span class="p">,</span><span class="n">lons</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">latmin</span> <span class="o">=</span> <span class="n">lats</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">latmax</span> <span class="o">=</span> <span class="n">lats</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lonmin</span> <span class="o">=</span> <span class="n">lons</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lonmax</span> <span class="o">=</span> <span class="n">lons</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
            <span class="n">NPole</span> <span class="o">=</span> <span class="n">_geoslib</span><span class="o">.</span><span class="n">Point</span><span class="p">(</span><span class="bp">self</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span><span class="mf">90.</span><span class="p">))</span>
            <span class="n">SPole</span> <span class="o">=</span> <span class="n">_geoslib</span><span class="o">.</span><span class="n">Point</span><span class="p">(</span><span class="bp">self</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span><span class="o">-</span><span class="mf">90.</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">lat_0</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">lon_0</span><span class="p">,</span> <span class="n">lat_0</span> <span class="o">=</span>\
                <span class="bp">self</span><span class="p">(</span><span class="mf">0.5</span><span class="o">*</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">xmin</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">xmax</span><span class="p">),</span>
                     <span class="mf">0.5</span><span class="o">*</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ymin</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">ymax</span><span class="p">),</span><span class="n">inverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">Dateline</span> <span class="o">=</span> <span class="n">_geoslib</span><span class="o">.</span><span class="n">Point</span><span class="p">(</span><span class="bp">self</span><span class="p">(</span><span class="mf">180.</span><span class="p">,</span><span class="n">lat_0</span><span class="p">))</span>
            <span class="n">Greenwich</span> <span class="o">=</span> <span class="n">_geoslib</span><span class="o">.</span><span class="n">Point</span><span class="p">(</span><span class="bp">self</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span><span class="n">lat_0</span><span class="p">))</span>
            <span class="n">hasNP</span> <span class="o">=</span> <span class="n">NPole</span><span class="o">.</span><span class="n">within</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_boundarypolyxy</span><span class="p">)</span>
            <span class="n">hasSP</span> <span class="o">=</span> <span class="n">SPole</span><span class="o">.</span><span class="n">within</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_boundarypolyxy</span><span class="p">)</span>
            <span class="n">hasPole</span> <span class="o">=</span> <span class="n">hasNP</span> <span class="ow">or</span> <span class="n">hasSP</span>
            <span class="n">hasDateline</span> <span class="o">=</span> <span class="n">Dateline</span><span class="o">.</span><span class="n">within</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_boundarypolyxy</span><span class="p">)</span>
            <span class="n">hasGreenwich</span> <span class="o">=</span> <span class="n">Greenwich</span><span class="o">.</span><span class="n">within</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_boundarypolyxy</span><span class="p">)</span>
            <span class="c1"># projection crosses dateline (and not Greenwich or pole).</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">hasPole</span> <span class="ow">and</span> <span class="n">hasDateline</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">hasGreenwich</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">lonmin</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">lonmax</span> <span class="o">&gt;</span> <span class="mf">0.</span><span class="p">:</span>
                    <span class="n">lons</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">lons</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">,</span> <span class="n">lons</span><span class="o">+</span><span class="mi">360</span><span class="p">,</span> <span class="n">lons</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lonmin</span> <span class="o">=</span> <span class="n">lons</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lonmax</span> <span class="o">=</span> <span class="n">lons</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
        <span class="c1"># read in coastline polygons, only keeping those that</span>
        <span class="c1"># intersect map boundary polygon.</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">resolution</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">coastsegs</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">coastpolygontypes</span> <span class="o">=</span>\
            <span class="bp">self</span><span class="o">.</span><span class="n">_readboundarydata</span><span class="p">(</span><span class="s1">&#39;gshhs&#39;</span><span class="p">,</span><span class="n">as_polygons</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="c1"># reformat for use in matplotlib.patches.Polygon.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">coastpolygons</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">seg</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">coastsegs</span><span class="p">:</span>
                <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="n">seg</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">coastpolygons</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">))</span>
            <span class="c1"># replace coastsegs with line segments (instead of polygons)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">coastsegs</span><span class="p">,</span> <span class="n">types</span> <span class="o">=</span>\
            <span class="bp">self</span><span class="o">.</span><span class="n">_readboundarydata</span><span class="p">(</span><span class="s1">&#39;gshhs&#39;</span><span class="p">,</span><span class="n">as_polygons</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">coastsegs</span> <span class="o">=</span> <span class="p">[</span><span class="n">sg</span> <span class="k">for</span> <span class="n">sg</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">coastsegs</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">sg</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span>
        <span class="c1"># create geos Polygon structures for land areas.</span>
        <span class="c1"># currently only used in is_land method.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">landpolygons</span><span class="o">=</span><span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lakepolygons</span><span class="o">=</span><span class="p">[]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">resolution</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">coastpolygons</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="c1">#self.islandinlakepolygons=[]</span>
            <span class="c1">#self.lakeinislandinlakepolygons=[]</span>
            <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">coastpolygons</span><span class="p">))</span>
            <span class="k">for</span> <span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">typ</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">coastpolygontypes</span><span class="p">):</span>
                <span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">([</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">])</span><span class="o">.</span><span class="n">T</span>
                <span class="k">if</span> <span class="n">typ</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">landpolygons</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">_geoslib</span><span class="o">.</span><span class="n">Polygon</span><span class="p">(</span><span class="n">b</span><span class="p">))</span>
                <span class="k">if</span> <span class="n">typ</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">lakepolygons</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">_geoslib</span><span class="o">.</span><span class="n">Polygon</span><span class="p">(</span><span class="n">b</span><span class="p">))</span></div>

                <span class="c1">#if typ == 3: self.islandinlakepolygons.append(_geoslib.Polygon(b))</span>
                <span class="c1">#if typ == 4: self.lakeinislandinlakepolygons.append(_geoslib.Polygon(b))</span>

    <span class="c1"># set __init__&#39;s docstring</span>
    <span class="fm">__init__</span><span class="o">.</span><span class="vm">__doc__</span> <span class="o">=</span> <span class="n">_Basemap_init_doc</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">inverse</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calling a Basemap class instance with the arguments lon, lat will</span>
<span class="sd">        convert lon/lat (in degrees) to x/y map projection</span>
<span class="sd">        coordinates (in meters).  If optional keyword ``inverse`` is</span>
<span class="sd">        True (default is False), the inverse transformation from x/y</span>
<span class="sd">        to lon/lat is performed.</span>

<span class="sd">        For cylindrical equidistant projection (``cyl``), this</span>
<span class="sd">        does nothing (i.e. x,y == lon,lat).</span>

<span class="sd">        For non-cylindrical projections, the inverse transformation</span>
<span class="sd">        always returns longitudes between -180 and 180 degrees. For</span>
<span class="sd">        cylindrical projections (self.projection == ``cyl``,</span>
<span class="sd">        ``cea``, ``mill``, ``gall`` or ``merc``)</span>
<span class="sd">        the inverse transformation will return longitudes between</span>
<span class="sd">        self.llcrnrlon and self.llcrnrlat.</span>

<span class="sd">        Input arguments lon, lat can be either scalar floats,</span>
<span class="sd">        sequences, or numpy arrays.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">celestial</span><span class="p">:</span>
            <span class="c1"># don&#39;t assume center of map is at greenwich</span>
            <span class="c1"># (only relevant for cyl or pseudo-cyl projections)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">projection</span> <span class="ow">in</span> <span class="n">_pseudocyl</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">projection</span> <span class="ow">in</span> <span class="n">_cylproj</span><span class="p">:</span>
                <span class="n">lon_0</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">projparams</span><span class="p">[</span><span class="s1">&#39;lon_0&#39;</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">lon_0</span> <span class="o">=</span> <span class="mf">0.</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">celestial</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">inverse</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">x</span> <span class="o">=</span> <span class="mf">2.</span><span class="o">*</span><span class="n">lon_0</span><span class="o">-</span><span class="n">x</span>
            <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
                <span class="n">x</span> <span class="o">=</span> <span class="p">[</span><span class="mi">2</span><span class="o">*</span><span class="n">lon_0</span><span class="o">-</span><span class="n">xx</span> <span class="k">for</span> <span class="n">xx</span> <span class="ow">in</span> <span class="n">x</span><span class="p">]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">projection</span> <span class="o">==</span> <span class="s1">&#39;rotpole&#39;</span> <span class="ow">and</span> <span class="n">inverse</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">x</span> <span class="o">=</span> <span class="n">_dg2rad</span><span class="o">*</span><span class="n">x</span>
            <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
                <span class="n">x</span> <span class="o">=</span> <span class="p">[</span><span class="n">_dg2rad</span><span class="o">*</span><span class="n">xx</span> <span class="k">for</span> <span class="n">xx</span> <span class="ow">in</span> <span class="n">x</span><span class="p">]</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">y</span> <span class="o">=</span> <span class="n">_dg2rad</span><span class="o">*</span><span class="n">y</span>
            <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
                <span class="n">y</span> <span class="o">=</span> <span class="p">[</span><span class="n">_dg2rad</span><span class="o">*</span><span class="n">yy</span> <span class="k">for</span> <span class="n">yy</span> <span class="ow">in</span> <span class="n">y</span><span class="p">]</span>
        <span class="n">xout</span><span class="p">,</span><span class="n">yout</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">projtran</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">inverse</span><span class="o">=</span><span class="n">inverse</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">celestial</span> <span class="ow">and</span> <span class="n">inverse</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">xout</span> <span class="o">=</span> <span class="o">-</span><span class="mf">2.</span><span class="o">*</span><span class="n">lon_0</span><span class="o">-</span><span class="n">xout</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="n">xout</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mf">2.</span><span class="o">*</span><span class="n">lon_0</span><span class="o">-</span><span class="n">xx</span> <span class="k">for</span> <span class="n">xx</span> <span class="ow">in</span> <span class="n">xout</span><span class="p">]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">projection</span> <span class="o">==</span> <span class="s1">&#39;rotpole&#39;</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">inverse</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">xout</span> <span class="o">=</span> <span class="n">_rad2dg</span><span class="o">*</span><span class="n">xout</span>
                <span class="n">xout</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">xout</span> <span class="o">&lt;</span> <span class="mf">0.</span><span class="p">,</span> <span class="n">xout</span><span class="o">+</span><span class="mi">360</span><span class="p">,</span> <span class="n">xout</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
                <span class="n">xout</span> <span class="o">=</span> <span class="p">[</span><span class="n">_rad2dg</span><span class="o">*</span><span class="n">xx</span> <span class="k">for</span> <span class="n">xx</span> <span class="ow">in</span> <span class="n">xout</span><span class="p">]</span>
                <span class="n">xout</span> <span class="o">=</span> <span class="p">[</span><span class="n">xx</span><span class="o">+</span><span class="mf">360.</span> <span class="k">if</span> <span class="n">xx</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="n">xx</span> <span class="k">for</span> <span class="n">xx</span> <span class="ow">in</span> <span class="n">xout</span><span class="p">]</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">yout</span> <span class="o">=</span> <span class="n">_rad2dg</span><span class="o">*</span><span class="n">yout</span>
            <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
                <span class="n">yout</span> <span class="o">=</span> <span class="p">[</span><span class="n">_rad2dg</span><span class="o">*</span><span class="n">yy</span> <span class="k">for</span> <span class="n">yy</span> <span class="ow">in</span> <span class="n">yout</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">xout</span><span class="p">,</span><span class="n">yout</span>

<div class="viewcode-block" id="Basemap.makegrid">
<a class="viewcode-back" href="../../api/basemap_api.html#mpl_toolkits.basemap.Basemap.makegrid">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">makegrid</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">nx</span><span class="p">,</span><span class="n">ny</span><span class="p">,</span><span class="n">returnxy</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        return arrays of shape (ny,nx) containing lon,lat coordinates of</span>
<span class="sd">        an equally spaced native projection grid.</span>

<span class="sd">        If ``returnxy = True``, the x,y values of the grid are returned also.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">projtran</span><span class="o">.</span><span class="n">makegrid</span><span class="p">(</span><span class="n">nx</span><span class="p">,</span><span class="n">ny</span><span class="p">,</span><span class="n">returnxy</span><span class="o">=</span><span class="n">returnxy</span><span class="p">)</span></div>


    <span class="k">def</span><span class="w"> </span><span class="nf">_readboundarydata</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">name</span><span class="p">,</span><span class="n">as_polygons</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        read boundary data, clip to map projection region.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># only gshhs coastlines can be polygons.</span>
        <span class="k">if</span> <span class="n">name</span> <span class="o">!=</span> <span class="s1">&#39;gshhs&#39;</span><span class="p">:</span> <span class="n">as_polygons</span><span class="o">=</span><span class="kc">False</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">bdatfile</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">basemap_datadir</span><span class="p">,</span><span class="n">name</span><span class="o">+</span><span class="s1">&#39;_&#39;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">resolution</span><span class="o">+</span><span class="s1">&#39;.dat&#39;</span><span class="p">),</span><span class="s1">&#39;rb&#39;</span><span class="p">)</span>
            <span class="n">bdatmetafile</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">basemap_datadir</span><span class="p">,</span><span class="n">name</span><span class="o">+</span><span class="s1">&#39;meta_&#39;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">resolution</span><span class="o">+</span><span class="s1">&#39;.dat&#39;</span><span class="p">),</span><span class="s1">&#39;r&#39;</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span>
                <span class="s2">&quot;Unable to open boundary dataset file. Only the &#39;crude&#39;, &#39;low&#39; &quot;</span>
                <span class="s2">&quot;and &#39;intermediate&#39; resolution datasets are installed by default. &quot;</span>
                <span class="s2">&quot;If you are requesting a &#39;high&#39; or &#39;full&#39; resolution dataset, &quot;</span>
                <span class="s2">&quot;you need to install the `basemap-data-hires` package&quot;</span><span class="p">)</span>
        <span class="n">polygons</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">polygon_types</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="c1"># coastlines are polygons, other boundaries are line segments.</span>
        <span class="k">if</span> <span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;gshhs&#39;</span><span class="p">:</span>
            <span class="n">Shape</span> <span class="o">=</span> <span class="n">_geoslib</span><span class="o">.</span><span class="n">Polygon</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">Shape</span> <span class="o">=</span> <span class="n">_geoslib</span><span class="o">.</span><span class="n">LineString</span>
        <span class="c1"># see if map projection region polygon contains a pole.</span>
        <span class="n">NPole</span> <span class="o">=</span> <span class="n">_geoslib</span><span class="o">.</span><span class="n">Point</span><span class="p">(</span><span class="bp">self</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span><span class="mf">90.</span><span class="p">))</span>
        <span class="n">SPole</span> <span class="o">=</span> <span class="n">_geoslib</span><span class="o">.</span><span class="n">Point</span><span class="p">(</span><span class="bp">self</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span><span class="o">-</span><span class="mf">90.</span><span class="p">))</span>
        <span class="n">boundarypolyxy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_boundarypolyxy</span>
        <span class="n">boundarypolyll</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_boundarypolyll</span>
        <span class="n">hasNP</span> <span class="o">=</span> <span class="n">NPole</span><span class="o">.</span><span class="n">within</span><span class="p">(</span><span class="n">boundarypolyxy</span><span class="p">)</span>
        <span class="n">hasSP</span> <span class="o">=</span> <span class="n">SPole</span><span class="o">.</span><span class="n">within</span><span class="p">(</span><span class="n">boundarypolyxy</span><span class="p">)</span>
        <span class="n">containsPole</span> <span class="o">=</span> <span class="n">hasNP</span> <span class="ow">or</span> <span class="n">hasSP</span>
        <span class="c1"># these projections cannot cross pole.</span>
        <span class="k">if</span> <span class="n">containsPole</span> <span class="ow">and</span>\
            <span class="bp">self</span><span class="o">.</span><span class="n">projection</span> <span class="ow">in</span> <span class="n">_cylproj</span> <span class="o">+</span> <span class="n">_pseudocyl</span> <span class="o">+</span> <span class="p">[</span><span class="s1">&#39;geos&#39;</span><span class="p">]:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1"> projection cannot cross pole&#39;</span><span class="o">%</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">projection</span><span class="p">))</span>
        <span class="c1"># make sure some projections have has containsPole=True</span>
        <span class="c1"># we will compute the intersections in stereographic</span>
        <span class="c1"># coordinates, then transform back. This is</span>
        <span class="c1"># because these projections are only defined on a hemisphere, and</span>
        <span class="c1"># some boundary features (like Eurasia) would be undefined otherwise.</span>
        <span class="n">tostere</span> <span class="o">=</span>\
        <span class="p">[</span><span class="s1">&#39;omerc&#39;</span><span class="p">,</span><span class="s1">&#39;ortho&#39;</span><span class="p">,</span><span class="s1">&#39;gnom&#39;</span><span class="p">,</span><span class="s1">&#39;nsper&#39;</span><span class="p">,</span><span class="s1">&#39;nplaea&#39;</span><span class="p">,</span><span class="s1">&#39;npaeqd&#39;</span><span class="p">,</span><span class="s1">&#39;splaea&#39;</span><span class="p">,</span><span class="s1">&#39;spaeqd&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">projection</span> <span class="ow">in</span> <span class="n">tostere</span> <span class="ow">and</span> <span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;gshhs&#39;</span><span class="p">:</span>
            <span class="n">containsPole</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">lon_0</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">projparams</span><span class="p">[</span><span class="s1">&#39;lon_0&#39;</span><span class="p">]</span>
            <span class="n">lat_0</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">projparams</span><span class="p">[</span><span class="s1">&#39;lat_0&#39;</span><span class="p">]</span>
            <span class="n">re</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">projparams</span><span class="p">[</span><span class="s1">&#39;R&#39;</span><span class="p">]</span>
            <span class="c1"># center of stereographic projection restricted to be</span>
            <span class="c1"># nearest one of 6 points on the sphere (every 90 deg lat/lon).</span>
            <span class="n">lon0</span> <span class="o">=</span> <span class="mf">90.</span><span class="o">*</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">lon_0</span><span class="o">/</span><span class="mf">90.</span><span class="p">))</span>
            <span class="n">lat0</span> <span class="o">=</span> <span class="mf">90.</span><span class="o">*</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">lat_0</span><span class="o">/</span><span class="mf">90.</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">lat0</span><span class="p">))</span> <span class="o">==</span> <span class="mi">90</span><span class="p">:</span> <span class="n">lon0</span><span class="o">=</span><span class="mf">0.</span>
            <span class="n">maptran</span> <span class="o">=</span> <span class="n">pyproj</span><span class="o">.</span><span class="n">Proj</span><span class="p">(</span><span class="n">proj</span><span class="o">=</span><span class="s1">&#39;stere&#39;</span><span class="p">,</span><span class="n">lon_0</span><span class="o">=</span><span class="n">lon0</span><span class="p">,</span><span class="n">lat_0</span><span class="o">=</span><span class="n">lat0</span><span class="p">,</span><span class="n">R</span><span class="o">=</span><span class="n">re</span><span class="p">)</span>
            <span class="c1"># boundary polygon for ortho/gnom/nsper projection</span>
            <span class="c1"># in stereographic coordinates.</span>
            <span class="n">b</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_boundarypolyll</span><span class="o">.</span><span class="n">boundary</span>
            <span class="n">blons</span> <span class="o">=</span> <span class="n">b</span><span class="p">[:,</span><span class="mi">0</span><span class="p">];</span> <span class="n">blats</span> <span class="o">=</span> <span class="n">b</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">b</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span> <span class="n">b</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">maptran</span><span class="p">(</span><span class="n">blons</span><span class="p">,</span> <span class="n">blats</span><span class="p">)</span>
            <span class="n">boundarypolyxy</span> <span class="o">=</span> <span class="n">_geoslib</span><span class="o">.</span><span class="n">Polygon</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">bdatmetafile</span><span class="p">:</span>
            <span class="n">linesplit</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
            <span class="n">area</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">linesplit</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">south</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">linesplit</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>
            <span class="n">north</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">linesplit</span><span class="p">[</span><span class="mi">4</span><span class="p">])</span>
            <span class="n">crossdatelineE</span><span class="o">=</span><span class="kc">False</span><span class="p">;</span> <span class="n">crossdatelineW</span><span class="o">=</span><span class="kc">False</span>
            <span class="k">if</span> <span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;gshhs&#39;</span><span class="p">:</span>
                <span class="nb">id</span> <span class="o">=</span> <span class="n">linesplit</span><span class="p">[</span><span class="mi">7</span><span class="p">]</span>
                <span class="k">if</span> <span class="nb">id</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;E&#39;</span><span class="p">):</span>
                    <span class="n">crossdatelineE</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="k">elif</span> <span class="nb">id</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;W&#39;</span><span class="p">):</span>
                    <span class="n">crossdatelineW</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="c1"># make sure south/north limits of dateline crossing polygons</span>
            <span class="c1"># (Eurasia) are the same, since they will be merged into one.</span>
            <span class="c1"># (this avoids having one filtered out and not the other).</span>
            <span class="k">if</span> <span class="n">crossdatelineE</span><span class="p">:</span>
                <span class="n">south_save</span><span class="o">=</span><span class="n">south</span>
                <span class="n">north_save</span><span class="o">=</span><span class="n">north</span>
            <span class="k">if</span> <span class="n">crossdatelineW</span><span class="p">:</span>
                <span class="n">south</span><span class="o">=</span><span class="n">south_save</span>
                <span class="n">north</span><span class="o">=</span><span class="n">north_save</span>
            <span class="k">if</span> <span class="n">area</span> <span class="o">&lt;</span> <span class="mf">0.</span><span class="p">:</span> <span class="n">area</span> <span class="o">=</span> <span class="mf">1.e30</span>
            <span class="n">useit</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">latmax</span><span class="o">&gt;=</span><span class="n">south</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">latmin</span><span class="o">&lt;=</span><span class="n">north</span> <span class="ow">and</span> <span class="n">area</span><span class="o">&gt;</span><span class="bp">self</span><span class="o">.</span><span class="n">area_thresh</span>
            <span class="k">if</span> <span class="n">useit</span><span class="p">:</span>
                <span class="n">typ</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">linesplit</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                <span class="n">npts</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">linesplit</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
                <span class="n">offsetbytes</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">linesplit</span><span class="p">[</span><span class="mi">5</span><span class="p">])</span>
                <span class="n">bytecount</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">linesplit</span><span class="p">[</span><span class="mi">6</span><span class="p">])</span>
                <span class="n">bdatfile</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="n">offsetbytes</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
                <span class="c1"># read in binary string convert into an npts by 2</span>
                <span class="c1"># numpy array (first column is lons, second is lats).</span>
                <span class="n">polystring</span> <span class="o">=</span> <span class="n">bdatfile</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">bytecount</span><span class="p">)</span>
                <span class="c1"># binary data is little endian.</span>
                <span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">frombuffer</span><span class="p">(</span><span class="n">polystring</span><span class="p">,</span><span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;&lt;f4&#39;</span><span class="p">),</span><span class="s1">&#39;f8&#39;</span><span class="p">)</span>
                <span class="n">b</span><span class="o">.</span><span class="n">shape</span> <span class="o">=</span> <span class="p">(</span><span class="n">npts</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
                <span class="n">b2</span> <span class="o">=</span> <span class="n">b</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
                <span class="c1"># merge polygons that cross dateline.</span>
                <span class="n">poly</span> <span class="o">=</span> <span class="n">Shape</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
                <span class="c1"># hack to try to avoid having Antartica filled polygon</span>
                <span class="c1"># covering entire map (if skipAnart = False, this happens</span>
                <span class="c1"># for ortho lon_0=-120, lat_0=60, for example).</span>
                <span class="n">skipAntart</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">projection</span> <span class="ow">in</span> <span class="n">tostere</span> <span class="ow">and</span> <span class="n">south</span> <span class="o">&lt;</span> <span class="o">-</span><span class="mi">89</span> <span class="ow">and</span> \
                 <span class="ow">not</span> <span class="n">hasSP</span>
                <span class="k">if</span> <span class="n">crossdatelineE</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">skipAntart</span><span class="p">:</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">poly</span><span class="o">.</span><span class="n">is_valid</span><span class="p">():</span> <span class="n">poly</span><span class="o">=</span><span class="n">poly</span><span class="o">.</span><span class="n">fix</span><span class="p">()</span>
                    <span class="n">polyE</span> <span class="o">=</span> <span class="n">poly</span>
                    <span class="k">continue</span>
                <span class="k">elif</span> <span class="n">crossdatelineW</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">skipAntart</span><span class="p">:</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">poly</span><span class="o">.</span><span class="n">is_valid</span><span class="p">():</span> <span class="n">poly</span><span class="o">=</span><span class="n">poly</span><span class="o">.</span><span class="n">fix</span><span class="p">()</span>
                    <span class="n">b</span> <span class="o">=</span> <span class="n">poly</span><span class="o">.</span><span class="n">boundary</span>
                    <span class="n">b</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">b</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="mf">360.</span>
                    <span class="n">poly</span> <span class="o">=</span> <span class="n">Shape</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
                    <span class="n">poly</span> <span class="o">=</span> <span class="n">poly</span><span class="o">.</span><span class="n">union</span><span class="p">(</span><span class="n">polyE</span><span class="p">)</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">poly</span><span class="o">.</span><span class="n">is_valid</span><span class="p">():</span> <span class="n">poly</span><span class="o">=</span><span class="n">poly</span><span class="o">.</span><span class="n">fix</span><span class="p">()</span>
                    <span class="n">b</span> <span class="o">=</span> <span class="n">poly</span><span class="o">.</span><span class="n">boundary</span>
                    <span class="n">b2</span> <span class="o">=</span> <span class="n">b</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
                    <span class="c1"># fix Antartica.</span>
                    <span class="k">if</span> <span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;gshhs&#39;</span> <span class="ow">and</span> <span class="n">south</span> <span class="o">&lt;</span> <span class="o">-</span><span class="mi">89</span><span class="p">:</span>
                        <span class="n">b</span> <span class="o">=</span> <span class="n">b</span><span class="p">[</span><span class="mi">3</span><span class="p">:,:]</span>
                        <span class="n">b2</span> <span class="o">=</span> <span class="n">b</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
                        <span class="n">poly</span> <span class="o">=</span> <span class="n">Shape</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
                <span class="c1"># if map boundary polygon is a valid one in lat/lon</span>
                <span class="c1"># coordinates (i.e. it does not contain either pole),</span>
                <span class="c1"># the intersections of the boundary geometries</span>
                <span class="c1"># and the map projection region can be computed before</span>
                <span class="c1"># transforming the boundary geometry to map projection</span>
                <span class="c1"># coordinates (this saves time, especially for small map</span>
                <span class="c1"># regions and high-resolution boundary geometries).</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">containsPole</span><span class="p">:</span>
                    <span class="c1"># close Antarctica.</span>
                    <span class="k">if</span> <span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;gshhs&#39;</span> <span class="ow">and</span> <span class="n">south</span> <span class="o">&lt;</span> <span class="o">-</span><span class="mi">89</span><span class="p">:</span>
                        <span class="n">lons2</span> <span class="o">=</span> <span class="n">b</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span>
                        <span class="n">lats</span> <span class="o">=</span> <span class="n">b</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span>
                        <span class="n">lons1</span> <span class="o">=</span> <span class="n">lons2</span> <span class="o">-</span> <span class="mf">360.</span>
                        <span class="n">lons3</span> <span class="o">=</span> <span class="n">lons2</span> <span class="o">+</span> <span class="mf">360.</span>
                        <span class="n">lons</span> <span class="o">=</span> <span class="n">lons1</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span><span class="o">+</span><span class="n">lons2</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span><span class="o">+</span><span class="n">lons3</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
                        <span class="n">lats</span> <span class="o">=</span> <span class="n">lats</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span><span class="o">+</span><span class="n">lats</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span><span class="o">+</span><span class="n">lats</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
                        <span class="n">lonstart</span><span class="p">,</span><span class="n">latstart</span> <span class="o">=</span> <span class="n">lons</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">lats</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                        <span class="n">lonend</span><span class="p">,</span><span class="n">latend</span> <span class="o">=</span> <span class="n">lons</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">lats</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                        <span class="n">lons</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">lonstart</span><span class="p">)</span>
                        <span class="n">lats</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="o">-</span><span class="mf">90.</span><span class="p">)</span>
                        <span class="n">lons</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">lonend</span><span class="p">)</span>
                        <span class="n">lats</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="o">-</span><span class="mf">90.</span><span class="p">)</span>
                        <span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">lons</span><span class="p">),</span><span class="mi">2</span><span class="p">),</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
                        <span class="n">b</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">lons</span><span class="p">;</span> <span class="n">b</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">lats</span>
                        <span class="n">poly</span> <span class="o">=</span> <span class="n">Shape</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
                        <span class="k">if</span> <span class="ow">not</span> <span class="n">poly</span><span class="o">.</span><span class="n">is_valid</span><span class="p">():</span> <span class="n">poly</span><span class="o">=</span><span class="n">poly</span><span class="o">.</span><span class="n">fix</span><span class="p">()</span>
                        <span class="c1"># if polygon instersects map projection</span>
                        <span class="c1"># region, process it.</span>
                        <span class="k">if</span> <span class="n">poly</span><span class="o">.</span><span class="n">intersects</span><span class="p">(</span><span class="n">boundarypolyll</span><span class="p">):</span>
                            <span class="k">if</span> <span class="n">name</span> <span class="o">!=</span> <span class="s1">&#39;gshhs&#39;</span> <span class="ow">or</span> <span class="n">as_polygons</span><span class="p">:</span>
                                <span class="n">geoms</span> <span class="o">=</span> <span class="n">poly</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="n">boundarypolyll</span><span class="p">)</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="c1"># convert polygons to line segments</span>
                                <span class="n">poly</span> <span class="o">=</span> <span class="n">_geoslib</span><span class="o">.</span><span class="n">LineString</span><span class="p">(</span><span class="n">poly</span><span class="o">.</span><span class="n">boundary</span><span class="p">)</span>
                                <span class="n">geoms</span> <span class="o">=</span> <span class="n">poly</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="n">boundarypolyll</span><span class="p">)</span>
                            <span class="c1"># iterate over geometries in intersection.</span>
                            <span class="k">for</span> <span class="n">psub</span> <span class="ow">in</span> <span class="n">geoms</span><span class="p">:</span>
                                <span class="n">b</span> <span class="o">=</span> <span class="n">psub</span><span class="o">.</span><span class="n">boundary</span>
                                <span class="n">blons</span> <span class="o">=</span> <span class="n">b</span><span class="p">[:,</span><span class="mi">0</span><span class="p">];</span> <span class="n">blats</span> <span class="o">=</span> <span class="n">b</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span>
                                <span class="n">bx</span><span class="p">,</span> <span class="n">by</span> <span class="o">=</span> <span class="bp">self</span><span class="p">(</span><span class="n">blons</span><span class="p">,</span> <span class="n">blats</span><span class="p">)</span>
                                <span class="n">polygons</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">bx</span><span class="p">,</span><span class="n">by</span><span class="p">)))</span>
                                <span class="n">polygon_types</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">typ</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="c1"># create duplicate polygons shifted by -360 and +360</span>
                        <span class="c1"># (so as to properly treat polygons that cross</span>
                        <span class="c1"># Greenwich meridian).</span>
                        <span class="n">b2</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">b</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="mi">360</span>
                        <span class="n">poly1</span> <span class="o">=</span> <span class="n">Shape</span><span class="p">(</span><span class="n">b2</span><span class="p">)</span>
                        <span class="n">b2</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">b</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="mi">360</span>
                        <span class="n">poly2</span> <span class="o">=</span> <span class="n">Shape</span><span class="p">(</span><span class="n">b2</span><span class="p">)</span>
                        <span class="n">polys</span> <span class="o">=</span> <span class="p">[</span><span class="n">poly1</span><span class="p">,</span><span class="n">poly</span><span class="p">,</span><span class="n">poly2</span><span class="p">]</span>
                        <span class="k">for</span> <span class="n">poly</span> <span class="ow">in</span> <span class="n">polys</span><span class="p">:</span>
                            <span class="c1"># try to fix &quot;non-noded intersection&quot; errors.</span>
                            <span class="k">if</span> <span class="ow">not</span> <span class="n">poly</span><span class="o">.</span><span class="n">is_valid</span><span class="p">():</span> <span class="n">poly</span><span class="o">=</span><span class="n">poly</span><span class="o">.</span><span class="n">fix</span><span class="p">()</span>
                            <span class="c1"># if polygon instersects map projection</span>
                            <span class="c1"># region, process it.</span>
                            <span class="k">if</span> <span class="n">poly</span><span class="o">.</span><span class="n">intersects</span><span class="p">(</span><span class="n">boundarypolyll</span><span class="p">):</span>
                                <span class="k">if</span> <span class="n">name</span> <span class="o">!=</span> <span class="s1">&#39;gshhs&#39;</span> <span class="ow">or</span> <span class="n">as_polygons</span><span class="p">:</span>
                                    <span class="n">geoms</span> <span class="o">=</span> <span class="n">poly</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="n">boundarypolyll</span><span class="p">)</span>
                                <span class="k">else</span><span class="p">:</span>
                                    <span class="c1"># convert polygons to line segments</span>
                                    <span class="c1"># note: use fix method here or Eurasia</span>
                                    <span class="c1"># line segments sometimes disappear.</span>
                                    <span class="n">poly</span> <span class="o">=</span> <span class="n">_geoslib</span><span class="o">.</span><span class="n">LineString</span><span class="p">(</span><span class="n">poly</span><span class="o">.</span><span class="n">fix</span><span class="p">()</span><span class="o">.</span><span class="n">boundary</span><span class="p">)</span>
                                    <span class="n">geoms</span> <span class="o">=</span> <span class="n">poly</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="n">boundarypolyll</span><span class="p">)</span>
                                <span class="c1"># iterate over geometries in intersection.</span>
                                <span class="k">for</span> <span class="n">psub</span> <span class="ow">in</span> <span class="n">geoms</span><span class="p">:</span>
                                    <span class="n">b</span> <span class="o">=</span> <span class="n">psub</span><span class="o">.</span><span class="n">boundary</span>
                                    <span class="n">blons</span> <span class="o">=</span> <span class="n">b</span><span class="p">[:,</span><span class="mi">0</span><span class="p">];</span> <span class="n">blats</span> <span class="o">=</span> <span class="n">b</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span>
                                    <span class="c1"># transformation from lat/lon to</span>
                                    <span class="c1"># map projection coordinates.</span>
                                    <span class="n">bx</span><span class="p">,</span> <span class="n">by</span> <span class="o">=</span> <span class="bp">self</span><span class="p">(</span><span class="n">blons</span><span class="p">,</span> <span class="n">blats</span><span class="p">)</span>
                                    <span class="k">if</span> <span class="ow">not</span> <span class="n">as_polygons</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">bx</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">4</span><span class="p">:</span>
                                        <span class="n">polygons</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">bx</span><span class="p">,</span><span class="n">by</span><span class="p">)))</span>
                                        <span class="n">polygon_types</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">typ</span><span class="p">)</span>
                <span class="c1"># if map boundary polygon is not valid in lat/lon</span>
                <span class="c1"># coordinates, compute intersection between map</span>
                <span class="c1"># projection region and boundary geometries in map</span>
                <span class="c1"># projection coordinates.</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="c1"># transform coordinates from lat/lon</span>
                    <span class="c1"># to map projection coordinates.</span>
                    <span class="c1"># special case for ortho/gnom/nsper, compute coastline polygon</span>
                    <span class="c1"># vertices in stereographic coords.</span>
                    <span class="k">if</span> <span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;gshhs&#39;</span> <span class="ow">and</span> <span class="n">as_polygons</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">projection</span> <span class="ow">in</span> <span class="n">tostere</span><span class="p">:</span>
                        <span class="n">b</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span> <span class="n">b</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">maptran</span><span class="p">(</span><span class="n">b</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span> <span class="n">b</span><span class="p">[:,</span><span class="mi">1</span><span class="p">])</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">b</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span> <span class="n">b</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="p">(</span><span class="n">b</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span> <span class="n">b</span><span class="p">[:,</span><span class="mi">1</span><span class="p">])</span>
                    <span class="n">goodmask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span><span class="n">b</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span><span class="o">&lt;</span><span class="mf">1.e20</span><span class="p">,</span><span class="n">b</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span><span class="o">&lt;</span><span class="mf">1.e20</span><span class="p">)</span>
                    <span class="c1"># if less than two points are valid in</span>
                    <span class="c1"># map proj coords, skip this geometry.</span>
                    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">goodmask</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">:</span> <span class="k">continue</span>
                    <span class="k">if</span> <span class="n">name</span> <span class="o">!=</span> <span class="s1">&#39;gshhs&#39;</span> <span class="ow">or</span> <span class="p">(</span><span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;gshhs&#39;</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">as_polygons</span><span class="p">):</span>
                        <span class="c1"># if not a polygon,</span>
                        <span class="c1"># just remove parts of geometry that are undefined</span>
                        <span class="c1"># in this map projection.</span>
                        <span class="n">bx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">compress</span><span class="p">(</span><span class="n">goodmask</span><span class="p">,</span> <span class="n">b</span><span class="p">[:,</span><span class="mi">0</span><span class="p">])</span>
                        <span class="n">by</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">compress</span><span class="p">(</span><span class="n">goodmask</span><span class="p">,</span> <span class="n">b</span><span class="p">[:,</span><span class="mi">1</span><span class="p">])</span>
                        <span class="c1"># split coastline segments that jump across entire plot.</span>
                        <span class="n">xd</span> <span class="o">=</span> <span class="p">(</span><span class="n">bx</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span><span class="o">-</span><span class="n">bx</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span>
                        <span class="n">yd</span> <span class="o">=</span> <span class="p">(</span><span class="n">by</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span><span class="o">-</span><span class="n">by</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span>
                        <span class="n">dist</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">xd</span><span class="o">+</span><span class="n">yd</span><span class="p">)</span>
                        <span class="n">split</span> <span class="o">=</span> <span class="n">dist</span> <span class="o">&gt;</span> <span class="mf">0.1</span><span class="o">*</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">xmax</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">xmin</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">split</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">projection</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">_cylproj</span><span class="p">:</span>
                            <span class="n">ind</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">compress</span><span class="p">(</span><span class="n">split</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">split</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">indices</span><span class="p">(</span><span class="n">xd</span><span class="o">.</span><span class="n">shape</span><span class="p">)))</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
                            <span class="n">iprev</span> <span class="o">=</span> <span class="mi">0</span>
                            <span class="n">ind</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">xd</span><span class="p">))</span>
                            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">ind</span><span class="p">:</span>
                                <span class="c1"># don&#39;t add empty lists.</span>
                                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">iprev</span><span class="p">,</span><span class="n">i</span><span class="p">))):</span>
                                    <span class="n">polygons</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">bx</span><span class="p">[</span><span class="n">iprev</span><span class="p">:</span><span class="n">i</span><span class="p">],</span><span class="n">by</span><span class="p">[</span><span class="n">iprev</span><span class="p">:</span><span class="n">i</span><span class="p">])))</span>
                                <span class="n">iprev</span> <span class="o">=</span> <span class="n">i</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">polygons</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">bx</span><span class="p">,</span><span class="n">by</span><span class="p">)))</span>
                        <span class="n">polygon_types</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">typ</span><span class="p">)</span>
                        <span class="k">continue</span>
                    <span class="c1"># create a GEOS geometry object.</span>
                    <span class="k">if</span> <span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;gshhs&#39;</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">as_polygons</span><span class="p">:</span>
                        <span class="c1"># convert polygons to line segments</span>
                        <span class="n">poly</span> <span class="o">=</span> <span class="n">_geoslib</span><span class="o">.</span><span class="n">LineString</span><span class="p">(</span><span class="n">poly</span><span class="o">.</span><span class="n">boundary</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="c1"># this is a workaround to avoid</span>
                        <span class="c1"># GEOS_ERROR: CGAlgorithmsDD::orientationIndex encountered NaN/Inf numbers</span>
                        <span class="n">b</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">isposinf</span><span class="p">(</span><span class="n">b</span><span class="p">)]</span> <span class="o">=</span> <span class="mf">1e20</span>
                        <span class="n">b</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">isneginf</span><span class="p">(</span><span class="n">b</span><span class="p">)]</span> <span class="o">=</span> <span class="o">-</span><span class="mf">1e20</span>
                        <span class="n">poly</span> <span class="o">=</span> <span class="n">Shape</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
                    <span class="c1"># this is a workaround to avoid</span>
                    <span class="c1"># &quot;GEOS_ERROR: TopologyException:</span>
                    <span class="c1"># found non-noded intersection between ...&quot;</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">poly</span><span class="o">.</span><span class="n">is_valid</span><span class="p">():</span> <span class="n">poly</span><span class="o">=</span><span class="n">poly</span><span class="o">.</span><span class="n">fix</span><span class="p">()</span>
                    <span class="c1"># if geometry instersects map projection</span>
                    <span class="c1"># region, and doesn&#39;t have any invalid points, process it.</span>
                    <span class="k">if</span> <span class="n">goodmask</span><span class="o">.</span><span class="n">all</span><span class="p">()</span> <span class="ow">and</span> <span class="n">poly</span><span class="o">.</span><span class="n">intersects</span><span class="p">(</span><span class="n">boundarypolyxy</span><span class="p">):</span>
                        <span class="c1"># if geometry intersection calculation fails,</span>
                        <span class="c1"># just move on.</span>
                        <span class="k">try</span><span class="p">:</span>
                            <span class="n">geoms</span> <span class="o">=</span> <span class="n">poly</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="n">boundarypolyxy</span><span class="p">)</span>
                        <span class="k">except</span><span class="p">:</span>
                            <span class="k">continue</span>
                        <span class="c1"># iterate over geometries in intersection.</span>
                        <span class="k">for</span> <span class="n">psub</span> <span class="ow">in</span> <span class="n">geoms</span><span class="p">:</span>
                            <span class="n">b</span> <span class="o">=</span> <span class="n">psub</span><span class="o">.</span><span class="n">boundary</span>
                            <span class="c1"># if projection in [&#39;ortho&#39;,&#39;gnom&#39;,&#39;nsper&#39;],</span>
                            <span class="c1"># transform polygon from stereographic</span>
                            <span class="c1"># to ortho/gnom/nsper coordinates.</span>
                            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">projection</span> <span class="ow">in</span> <span class="n">tostere</span><span class="p">:</span>
                                <span class="c1"># if coastline polygon covers more than 99%</span>
                                <span class="c1"># of map region for fulldisk projection,</span>
                                <span class="c1"># it&#39;s probably bogus, so skip it.</span>
                                <span class="c1">#areafrac = psub.area()/boundarypolyxy.area()</span>
                                <span class="c1">#if self.projection == [&#39;ortho&#39;,&#39;nsper&#39;]:</span>
                                <span class="c1">#    if name == &#39;gshhs&#39; and\</span>
                                <span class="c1">#       self._fulldisk and\</span>
                                <span class="c1">#       areafrac &gt; 0.99: continue</span>
                                <span class="c1"># inverse transform from stereographic</span>
                                <span class="c1"># to lat/lon.</span>
                                <span class="n">b</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span> <span class="n">b</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">maptran</span><span class="p">(</span><span class="n">b</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span> <span class="n">b</span><span class="p">[:,</span><span class="mi">1</span><span class="p">],</span> <span class="n">inverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                                <span class="c1"># orthographic/gnomonic/nsper.</span>
                                <span class="n">b</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span> <span class="n">b</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span><span class="o">=</span> <span class="bp">self</span><span class="p">(</span><span class="n">b</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span> <span class="n">b</span><span class="p">[:,</span><span class="mi">1</span><span class="p">])</span>
                            <span class="k">if</span> <span class="ow">not</span> <span class="n">as_polygons</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">b</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">4</span><span class="p">:</span>
                                <span class="n">polygons</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">b</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span><span class="n">b</span><span class="p">[:,</span><span class="mi">1</span><span class="p">])))</span>
                                <span class="n">polygon_types</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">typ</span><span class="p">)</span>
        <span class="n">bdatfile</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="n">bdatmetafile</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">polygons</span><span class="p">,</span> <span class="n">polygon_types</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_getmapboundary</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        create map boundary polygon (in lat/lon and x/y coordinates)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">nx</span> <span class="o">=</span> <span class="mi">100</span><span class="p">;</span> <span class="n">ny</span> <span class="o">=</span> <span class="mi">100</span>
        <span class="n">maptran</span> <span class="o">=</span> <span class="bp">self</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">projection</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;ortho&#39;</span><span class="p">,</span><span class="s1">&#39;geos&#39;</span><span class="p">,</span><span class="s1">&#39;nsper&#39;</span><span class="p">]:</span>
            <span class="c1"># circular region.</span>
            <span class="n">thetas</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span><span class="mf">2.</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span><span class="mi">2</span><span class="o">*</span><span class="n">nx</span><span class="o">*</span><span class="n">ny</span><span class="p">)[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">rminor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_height</span>
            <span class="n">rmajor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_width</span>
            <span class="n">x</span> <span class="o">=</span> <span class="n">rmajor</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">thetas</span><span class="p">)</span> <span class="o">+</span> <span class="n">rmajor</span>
            <span class="n">y</span> <span class="o">=</span> <span class="n">rminor</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">thetas</span><span class="p">)</span> <span class="o">+</span> <span class="n">rminor</span>
            <span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">),</span><span class="mi">2</span><span class="p">),</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
            <span class="n">b</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span><span class="o">=</span><span class="n">x</span><span class="p">;</span> <span class="n">b</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span><span class="o">=</span><span class="n">y</span>
            <span class="n">boundaryxy</span> <span class="o">=</span> <span class="n">_geoslib</span><span class="o">.</span><span class="n">Polygon</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
            <span class="c1"># compute proj instance for full disk, if necessary.</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fulldisk</span><span class="p">:</span>
                <span class="n">projparms</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">projparams</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
                <span class="k">del</span> <span class="n">projparms</span><span class="p">[</span><span class="s1">&#39;x_0&#39;</span><span class="p">]</span>
                <span class="k">del</span> <span class="n">projparms</span><span class="p">[</span><span class="s1">&#39;y_0&#39;</span><span class="p">]</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">projection</span> <span class="o">==</span> <span class="s1">&#39;ortho&#39;</span><span class="p">:</span>
                    <span class="n">llcrnrx</span> <span class="o">=</span> <span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">rmajor</span>
                    <span class="n">llcrnry</span> <span class="o">=</span> <span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">rmajor</span>
                    <span class="n">urcrnrx</span> <span class="o">=</span> <span class="o">-</span><span class="n">llcrnrx</span>
                    <span class="n">urcrnry</span> <span class="o">=</span> <span class="o">-</span><span class="n">llcrnry</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">llcrnrx</span> <span class="o">=</span> <span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">_width</span>
                    <span class="n">llcrnry</span> <span class="o">=</span> <span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">_height</span>
                    <span class="n">urcrnrx</span> <span class="o">=</span> <span class="o">-</span><span class="n">llcrnrx</span>
                    <span class="n">urcrnry</span> <span class="o">=</span> <span class="o">-</span><span class="n">llcrnry</span>
                <span class="n">projparms</span><span class="p">[</span><span class="s1">&#39;x_0&#39;</span><span class="p">]</span><span class="o">=-</span><span class="n">llcrnrx</span>
                <span class="n">projparms</span><span class="p">[</span><span class="s1">&#39;y_0&#39;</span><span class="p">]</span><span class="o">=-</span><span class="n">llcrnry</span>
                <span class="n">maptran</span> <span class="o">=</span> <span class="n">pyproj</span><span class="o">.</span><span class="n">Proj</span><span class="p">(</span><span class="n">projparms</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">projection</span> <span class="o">==</span> <span class="s1">&#39;aeqd&#39;</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fulldisk</span><span class="p">:</span>
            <span class="c1"># circular region.</span>
            <span class="n">thetas</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span><span class="mf">2.</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span><span class="mi">2</span><span class="o">*</span><span class="n">nx</span><span class="o">*</span><span class="n">ny</span><span class="p">)[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">rminor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_height</span>
            <span class="n">rmajor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_width</span>
            <span class="n">x</span> <span class="o">=</span> <span class="n">rmajor</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">thetas</span><span class="p">)</span> <span class="o">+</span> <span class="n">rmajor</span>
            <span class="n">y</span> <span class="o">=</span> <span class="n">rminor</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">thetas</span><span class="p">)</span> <span class="o">+</span> <span class="n">rminor</span>
            <span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">),</span><span class="mi">2</span><span class="p">),</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
            <span class="n">b</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span><span class="o">=</span><span class="n">x</span><span class="p">;</span> <span class="n">b</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span><span class="o">=</span><span class="n">y</span>
            <span class="n">boundaryxy</span> <span class="o">=</span> <span class="n">_geoslib</span><span class="o">.</span><span class="n">Polygon</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">projection</span> <span class="ow">in</span> <span class="n">_pseudocyl</span><span class="p">:</span>
            <span class="n">nx</span> <span class="o">=</span> <span class="mi">10</span><span class="o">*</span><span class="n">nx</span><span class="p">;</span> <span class="n">ny</span> <span class="o">=</span> <span class="mi">10</span><span class="o">*</span><span class="n">ny</span>
            <span class="c1"># quasi-elliptical region.</span>
            <span class="n">lon_0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">projparams</span><span class="p">[</span><span class="s1">&#39;lon_0&#39;</span><span class="p">]</span>
            <span class="c1"># left side</span>
            <span class="n">lats1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mf">89.9999</span><span class="p">,</span><span class="mf">89.9999</span><span class="p">,</span><span class="n">ny</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
            <span class="n">lons1</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">lats1</span><span class="p">)</span><span class="o">*</span><span class="p">[</span><span class="n">lon_0</span><span class="o">-</span><span class="mf">179.9</span><span class="p">]</span>
            <span class="c1"># top.</span>
            <span class="n">lons2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">lon_0</span><span class="o">-</span><span class="mf">179.9</span><span class="p">,</span><span class="n">lon_0</span><span class="o">+</span><span class="mf">179.9</span><span class="p">,</span><span class="n">nx</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
            <span class="n">lats2</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">lons2</span><span class="p">)</span><span class="o">*</span><span class="p">[</span><span class="mf">89.9999</span><span class="p">]</span>
            <span class="c1"># right side</span>
            <span class="n">lats3</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">89.9999</span><span class="p">,</span><span class="o">-</span><span class="mf">89.9999</span><span class="p">,</span><span class="n">ny</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
            <span class="n">lons3</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">lats3</span><span class="p">)</span><span class="o">*</span><span class="p">[</span><span class="n">lon_0</span><span class="o">+</span><span class="mf">179.9</span><span class="p">]</span>
            <span class="c1"># bottom.</span>
            <span class="n">lons4</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">lon_0</span><span class="o">+</span><span class="mf">179.9</span><span class="p">,</span><span class="n">lon_0</span><span class="o">-</span><span class="mf">179.9</span><span class="p">,</span><span class="n">nx</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
            <span class="n">lats4</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">lons4</span><span class="p">)</span><span class="o">*</span><span class="p">[</span><span class="o">-</span><span class="mf">89.9999</span><span class="p">]</span>
            <span class="n">lons</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">lons1</span><span class="o">+</span><span class="n">lons2</span><span class="o">+</span><span class="n">lons3</span><span class="o">+</span><span class="n">lons4</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
            <span class="n">lats</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">lats1</span><span class="o">+</span><span class="n">lats2</span><span class="o">+</span><span class="n">lats3</span><span class="o">+</span><span class="n">lats4</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
            <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">maptran</span><span class="p">(</span><span class="n">lons</span><span class="p">,</span><span class="n">lats</span><span class="p">)</span>
            <span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">),</span><span class="mi">2</span><span class="p">),</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
            <span class="n">b</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span><span class="o">=</span><span class="n">x</span><span class="p">;</span> <span class="n">b</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span><span class="o">=</span><span class="n">y</span>
            <span class="n">boundaryxy</span> <span class="o">=</span> <span class="n">_geoslib</span><span class="o">.</span><span class="n">Polygon</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span> <span class="c1"># all other projections are rectangular.</span>
            <span class="n">nx</span> <span class="o">=</span> <span class="mi">100</span><span class="o">*</span><span class="n">nx</span><span class="p">;</span> <span class="n">ny</span> <span class="o">=</span> <span class="mi">100</span><span class="o">*</span><span class="n">ny</span>
            <span class="c1"># left side (x = xmin, ymin &lt;= y &lt;= ymax)</span>
            <span class="n">yy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ymin</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ymax</span><span class="p">,</span> <span class="n">ny</span><span class="p">)[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">x</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">yy</span><span class="p">)</span><span class="o">*</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">xmin</span><span class="p">];</span> <span class="n">y</span> <span class="o">=</span> <span class="n">yy</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
            <span class="c1"># top (y = ymax, xmin &lt;= x &lt;= xmax)</span>
            <span class="n">xx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">xmin</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">xmax</span><span class="p">,</span> <span class="n">nx</span><span class="p">)[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">x</span> <span class="o">=</span> <span class="n">x</span> <span class="o">+</span> <span class="n">xx</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
            <span class="n">y</span> <span class="o">=</span> <span class="n">y</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">xx</span><span class="p">)</span><span class="o">*</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">ymax</span><span class="p">]</span>
            <span class="c1"># right side (x = xmax, ymin &lt;= y &lt;= ymax)</span>
            <span class="n">yy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ymax</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ymin</span><span class="p">,</span> <span class="n">ny</span><span class="p">)[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">x</span> <span class="o">=</span> <span class="n">x</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">yy</span><span class="p">)</span><span class="o">*</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">xmax</span><span class="p">];</span> <span class="n">y</span> <span class="o">=</span> <span class="n">y</span> <span class="o">+</span> <span class="n">yy</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
            <span class="c1"># bottom (y = ymin, xmin &lt;= x &lt;= xmax)</span>
            <span class="n">xx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">xmax</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">xmin</span><span class="p">,</span> <span class="n">nx</span><span class="p">)[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">x</span> <span class="o">=</span> <span class="n">x</span> <span class="o">+</span> <span class="n">xx</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
            <span class="n">y</span> <span class="o">=</span> <span class="n">y</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">xx</span><span class="p">)</span><span class="o">*</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">ymin</span><span class="p">]</span>
            <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
            <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">y</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
            <span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="mi">4</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
            <span class="n">b</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span><span class="o">=</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">xmin</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">xmin</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">xmax</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">xmax</span><span class="p">]</span>
            <span class="n">b</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span><span class="o">=</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">ymin</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">ymax</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">ymax</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">ymin</span><span class="p">]</span>
            <span class="n">boundaryxy</span> <span class="o">=</span> <span class="n">_geoslib</span><span class="o">.</span><span class="n">Polygon</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">projection</span> <span class="ow">in</span> <span class="n">_cylproj</span><span class="p">:</span>
            <span class="c1"># make sure map boundary doesn&#39;t quite include pole.</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">urcrnrlat</span> <span class="o">&gt;</span> <span class="mf">89.9999</span><span class="p">:</span>
                <span class="n">urcrnrlat</span> <span class="o">=</span> <span class="mf">89.9999</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">urcrnrlat</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">urcrnrlat</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">llcrnrlat</span> <span class="o">&lt;</span> <span class="o">-</span><span class="mf">89.9999</span><span class="p">:</span>
                <span class="n">llcrnrlat</span> <span class="o">=</span> <span class="o">-</span><span class="mf">89.9999</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">llcrnrlat</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">llcrnrlat</span>
            <span class="n">lons</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">llcrnrlon</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">llcrnrlon</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">urcrnrlon</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">urcrnrlon</span><span class="p">]</span>
            <span class="n">lats</span> <span class="o">=</span> <span class="p">[</span><span class="n">llcrnrlat</span><span class="p">,</span> <span class="n">urcrnrlat</span><span class="p">,</span> <span class="n">urcrnrlat</span><span class="p">,</span> <span class="n">llcrnrlat</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">boundarylonmin</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">lons</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">boundarylonmax</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">lons</span><span class="p">)</span>
            <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="p">(</span><span class="n">lons</span><span class="p">,</span> <span class="n">lats</span><span class="p">)</span>
            <span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">),</span><span class="mi">2</span><span class="p">),</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
            <span class="n">b</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span><span class="o">=</span><span class="n">x</span><span class="p">;</span> <span class="n">b</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span><span class="o">=</span><span class="n">y</span>
            <span class="n">boundaryxy</span> <span class="o">=</span> <span class="n">_geoslib</span><span class="o">.</span><span class="n">Polygon</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">projection</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">_pseudocyl</span><span class="p">:</span>
                <span class="n">lons</span><span class="p">,</span> <span class="n">lats</span> <span class="o">=</span> <span class="n">maptran</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">inverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="c1"># fix lons so there are no jumps.</span>
                <span class="n">n</span> <span class="o">=</span> <span class="mi">1</span>
                <span class="n">lonprev</span> <span class="o">=</span> <span class="n">lons</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="k">for</span> <span class="n">lon</span><span class="p">,</span><span class="n">lat</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">lons</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span><span class="n">lats</span><span class="p">[</span><span class="mi">1</span><span class="p">:]):</span>
                    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">lon</span><span class="o">-</span><span class="n">lonprev</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mf">90.</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">lonprev</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
                            <span class="n">lon</span> <span class="o">=</span> <span class="n">lon</span> <span class="o">-</span> <span class="mf">360.</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">lon</span> <span class="o">=</span> <span class="n">lon</span> <span class="o">+</span> <span class="mi">360</span>
                        <span class="n">lons</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="o">=</span> <span class="n">lon</span>
                    <span class="n">lonprev</span> <span class="o">=</span> <span class="n">lon</span>
                    <span class="n">n</span> <span class="o">=</span> <span class="n">n</span> <span class="o">+</span> <span class="mi">1</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">boundarylonmin</span> <span class="o">=</span> <span class="n">lons</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">boundarylonmax</span> <span class="o">=</span> <span class="n">lons</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
                <span class="c1"># for circular full disk projections where boundary is</span>
                <span class="c1"># a latitude circle, set boundarylonmax and boundarylonmin</span>
                <span class="c1"># to cover entire world (so parallels will be drawn).</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fulldisk</span> <span class="ow">and</span> \
                   <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">boundarylonmax</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">boundarylonmin</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">1.</span><span class="p">:</span>
                   <span class="bp">self</span><span class="o">.</span><span class="n">boundarylonmin</span> <span class="o">=</span> <span class="o">-</span><span class="mf">180.</span>
                   <span class="bp">self</span><span class="o">.</span><span class="n">boundarylonmax</span> <span class="o">=</span> <span class="mf">180.</span>
        <span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">lons</span><span class="p">),</span><span class="mi">2</span><span class="p">),</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
        <span class="n">b</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">lons</span><span class="p">;</span> <span class="n">b</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">lats</span>
        <span class="n">boundaryll</span> <span class="o">=</span> <span class="n">_geoslib</span><span class="o">.</span><span class="n">Polygon</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">lons</span><span class="p">,</span> <span class="n">lats</span><span class="p">,</span> <span class="n">boundaryll</span><span class="p">,</span> <span class="n">boundaryxy</span>

<div class="viewcode-block" id="Basemap.drawmapboundary">
<a class="viewcode-back" href="../../api/basemap_api.html#mpl_toolkits.basemap.Basemap.drawmapboundary">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">drawmapboundary</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span><span class="n">linewidth</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span><span class="n">fill_color</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>\
                        <span class="n">zorder</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        draw boundary around map projection region, optionally</span>
<span class="sd">        filling interior of region.</span>

<span class="sd">        .. tabularcolumns:: |l|L|</span>

<span class="sd">        ==============   ====================================================</span>
<span class="sd">        Keyword          Description</span>
<span class="sd">        ==============   ====================================================</span>
<span class="sd">        linewidth        line width for boundary (default 1.)</span>
<span class="sd">        color            color of boundary line (default black)</span>
<span class="sd">        fill_color       fill the map region background with this</span>
<span class="sd">                         color (default is to fill with axis</span>
<span class="sd">                         background color). If set to the string</span>
<span class="sd">                         &#39;none&#39;, no filling is done.</span>
<span class="sd">        zorder           sets the zorder for filling map background</span>
<span class="sd">                         (default 0).</span>
<span class="sd">        ax               axes instance to use</span>
<span class="sd">                         (default None, use default axes instance).</span>
<span class="sd">        ==============   ====================================================</span>

<span class="sd">        returns matplotlib.collections.PatchCollection representing map boundary.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># get current axes instance (if none specified).</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="n">ax</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check_ax</span><span class="p">()</span>
        <span class="c1"># if no fill_color given, use axes background color.</span>
        <span class="c1"># if fill_color is string &#39;none&#39;, really don&#39;t fill.</span>
        <span class="k">if</span> <span class="n">fill_color</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">mpl_version</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="n">mpl</span><span class="o">.</span><span class="n">__version__</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)[:</span><span class="mi">2</span><span class="p">]))</span>
            <span class="k">if</span> <span class="n">mpl_version</span> <span class="o">&gt;=</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">):</span>
                <span class="n">fill_color</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_facecolor</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">fill_color</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_axis_bgcolor</span><span class="p">()</span>
        <span class="k">elif</span> <span class="n">fill_color</span> <span class="o">==</span> <span class="s1">&#39;none&#39;</span> <span class="ow">or</span> <span class="n">fill_color</span> <span class="o">==</span> <span class="s1">&#39;None&#39;</span><span class="p">:</span>
            <span class="n">fill_color</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">limb</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">projection</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;ortho&#39;</span><span class="p">,</span><span class="s1">&#39;geos&#39;</span><span class="p">,</span><span class="s1">&#39;nsper&#39;</span><span class="p">]</span> <span class="ow">or</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">projection</span><span class="o">==</span><span class="s1">&#39;aeqd&#39;</span> <span class="ow">and</span>\
           <span class="bp">self</span><span class="o">.</span><span class="n">_fulldisk</span><span class="p">):</span>
            <span class="n">limb</span> <span class="o">=</span> <span class="n">Ellipse</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">_width</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">_height</span><span class="p">),</span><span class="mf">2.</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">_width</span><span class="p">,</span><span class="mf">2.</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">_height</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">projection</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;ortho&#39;</span><span class="p">,</span><span class="s1">&#39;geos&#39;</span><span class="p">,</span><span class="s1">&#39;nsper&#39;</span><span class="p">,</span><span class="s1">&#39;aeqd&#39;</span><span class="p">]</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fulldisk</span><span class="p">:</span>
            <span class="c1"># elliptical region.</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_frame_on</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">projection</span> <span class="ow">in</span> <span class="n">_pseudocyl</span><span class="p">:</span>  <span class="c1"># elliptical region.</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_frame_on</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
            <span class="n">nx</span> <span class="o">=</span> <span class="mi">100</span><span class="p">;</span> <span class="n">ny</span> <span class="o">=</span> <span class="mi">100</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">projection</span> <span class="o">==</span> <span class="s1">&#39;vandg&#39;</span><span class="p">:</span>
                <span class="n">nx</span> <span class="o">=</span> <span class="mi">10</span><span class="o">*</span><span class="n">nx</span><span class="p">;</span> <span class="n">ny</span> <span class="o">=</span> <span class="mi">10</span><span class="o">*</span><span class="n">ny</span>
            <span class="c1"># quasi-elliptical region.</span>
            <span class="n">lon_0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">projparams</span><span class="p">[</span><span class="s1">&#39;lon_0&#39;</span><span class="p">]</span>
            <span class="c1"># left side</span>
            <span class="n">lats1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mf">89.9999</span><span class="p">,</span><span class="mf">89.99999</span><span class="p">,</span><span class="n">ny</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
            <span class="n">lons1</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">lats1</span><span class="p">)</span><span class="o">*</span><span class="p">[</span><span class="n">lon_0</span><span class="o">-</span><span class="mf">179.9</span><span class="p">]</span>
            <span class="c1"># top.</span>
            <span class="n">lons2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">lon_0</span><span class="o">-</span><span class="mf">179.9999</span><span class="p">,</span><span class="n">lon_0</span><span class="o">+</span><span class="mf">179.9999</span><span class="p">,</span><span class="n">nx</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
            <span class="n">lats2</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">lons2</span><span class="p">)</span><span class="o">*</span><span class="p">[</span><span class="mf">89.9999</span><span class="p">]</span>
            <span class="c1"># right side</span>
            <span class="n">lats3</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">89.9999</span><span class="p">,</span><span class="o">-</span><span class="mf">89.9999</span><span class="p">,</span><span class="n">ny</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
            <span class="n">lons3</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">lats3</span><span class="p">)</span><span class="o">*</span><span class="p">[</span><span class="n">lon_0</span><span class="o">+</span><span class="mf">179.9999</span><span class="p">]</span>
            <span class="c1"># bottom.</span>
            <span class="n">lons4</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">lon_0</span><span class="o">+</span><span class="mf">179.9999</span><span class="p">,</span><span class="n">lon_0</span><span class="o">-</span><span class="mf">179.9999</span><span class="p">,</span><span class="n">nx</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
            <span class="n">lats4</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">lons4</span><span class="p">)</span><span class="o">*</span><span class="p">[</span><span class="o">-</span><span class="mf">89.9999</span><span class="p">]</span>
            <span class="n">lons</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">lons1</span><span class="o">+</span><span class="n">lons2</span><span class="o">+</span><span class="n">lons3</span><span class="o">+</span><span class="n">lons4</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
            <span class="n">lats</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">lats1</span><span class="o">+</span><span class="n">lats2</span><span class="o">+</span><span class="n">lats3</span><span class="o">+</span><span class="n">lats4</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
            <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="p">(</span><span class="n">lons</span><span class="p">,</span><span class="n">lats</span><span class="p">)</span>
            <span class="n">xy</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">))</span>
            <span class="n">limb</span> <span class="o">=</span> <span class="n">Polygon</span><span class="p">(</span><span class="n">xy</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">round</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_frame_on</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
            <span class="n">limb</span> <span class="o">=</span> <span class="n">Circle</span><span class="p">((</span><span class="mf">0.5</span><span class="o">*</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">xmax</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">xmin</span><span class="p">),</span><span class="mf">0.5</span><span class="o">*</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ymax</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">ymin</span><span class="p">)),</span>
                    <span class="n">radius</span><span class="o">=</span><span class="mf">0.5</span><span class="o">*</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">xmax</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">xmin</span><span class="p">),</span><span class="n">fc</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span> <span class="c1"># all other projections are rectangular.</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_frame_on</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">spine</span> <span class="ow">in</span> <span class="n">ax</span><span class="o">.</span><span class="n">spines</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
                <span class="n">spine</span><span class="o">.</span><span class="n">set_linewidth</span><span class="p">(</span><span class="n">linewidth</span><span class="p">)</span>
                <span class="n">spine</span><span class="o">.</span><span class="n">set_edgecolor</span><span class="p">(</span><span class="n">color</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">zorder</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">spine</span><span class="o">.</span><span class="n">set_zorder</span><span class="p">(</span><span class="n">zorder</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">projection</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;geos&#39;</span><span class="p">,</span><span class="s1">&#39;ortho&#39;</span><span class="p">,</span><span class="s1">&#39;nsper&#39;</span><span class="p">]:</span>
                <span class="n">limb</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">patch</span>

        <span class="k">if</span> <span class="n">limb</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">limb</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">ax</span><span class="o">.</span><span class="n">patch</span><span class="p">:</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span><span class="n">limb</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_mapboundarydrawn</span> <span class="o">=</span> <span class="n">limb</span>
            <span class="k">if</span> <span class="n">fill_color</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">limb</span><span class="o">.</span><span class="n">set_fill</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">limb</span><span class="o">.</span><span class="n">set_facecolor</span><span class="p">(</span><span class="n">fill_color</span><span class="p">)</span>
                <span class="n">limb</span><span class="o">.</span><span class="n">set_zorder</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">limb</span><span class="o">.</span><span class="n">set_edgecolor</span><span class="p">(</span><span class="n">color</span><span class="p">)</span>
            <span class="n">limb</span><span class="o">.</span><span class="n">set_linewidth</span><span class="p">(</span><span class="n">linewidth</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">zorder</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">limb</span><span class="o">.</span><span class="n">set_zorder</span><span class="p">(</span><span class="n">zorder</span><span class="p">)</span>
            <span class="n">limb</span><span class="o">.</span><span class="n">set_clip_on</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="c1"># set axes limits to fit map region.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_axes_limits</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">limb</span></div>


<div class="viewcode-block" id="Basemap.fillcontinents">
<a class="viewcode-back" href="../../api/basemap_api.html#mpl_toolkits.basemap.Basemap.fillcontinents">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">fillcontinents</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;0.8&#39;</span><span class="p">,</span><span class="n">lake_color</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">zorder</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Fill continents.</span>

<span class="sd">        .. tabularcolumns:: |l|L|</span>

<span class="sd">        ==============   ====================================================</span>
<span class="sd">        Keyword          Description</span>
<span class="sd">        ==============   ====================================================</span>
<span class="sd">        color            color to fill continents (default gray).</span>
<span class="sd">        lake_color       color to fill inland lakes (default axes background).</span>
<span class="sd">        ax               axes instance (overrides default axes instance).</span>
<span class="sd">        zorder           sets the zorder for the continent polygons (if not</span>
<span class="sd">                         specified, uses default zorder for a Polygon patch).</span>
<span class="sd">                         Set to zero if you want to paint over the filled</span>
<span class="sd">                         continents).</span>
<span class="sd">        alpha            sets alpha transparency for continent polygons</span>
<span class="sd">        ==============   ====================================================</span>

<span class="sd">        After filling continents, lakes are re-filled with</span>
<span class="sd">        axis background color.</span>

<span class="sd">        returns a list of matplotlib.patches.Polygon objects.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">resolution</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="s1">&#39;there are no boundary datasets associated with this Basemap instance&#39;</span><span class="p">)</span>
        <span class="c1"># get current axes instance (if none specified).</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="n">ax</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check_ax</span><span class="p">()</span>
        <span class="c1"># get axis background color.</span>
        <span class="n">mpl_version</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="n">mpl</span><span class="o">.</span><span class="n">__version__</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)[:</span><span class="mi">2</span><span class="p">]))</span>
        <span class="k">if</span> <span class="n">mpl_version</span> <span class="o">&gt;=</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">):</span>
            <span class="n">axisbgc</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_facecolor</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">axisbgc</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_axis_bgcolor</span><span class="p">()</span>
        <span class="n">npoly</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">polys</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">x</span><span class="p">,</span><span class="n">y</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">coastpolygons</span><span class="p">:</span>
            <span class="n">xa</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
            <span class="n">ya</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">y</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
        <span class="c1"># check to see if all four corners of domain in polygon (if so,</span>
        <span class="c1"># don&#39;t draw since it will just fill in the whole map).</span>
        <span class="c1"># ** turn this off for now since it prevents continents that</span>
        <span class="c1"># fill the whole map from being filled **</span>
            <span class="c1">#delx = 10; dely = 10</span>
            <span class="c1">#if self.projection in [&#39;cyl&#39;]:</span>
            <span class="c1">#    delx = 0.1</span>
            <span class="c1">#    dely = 0.1</span>
            <span class="c1">#test1 = np.fabs(xa-self.urcrnrx) &lt; delx</span>
            <span class="c1">#test2 = np.fabs(xa-self.llcrnrx) &lt; delx</span>
            <span class="c1">#test3 = np.fabs(ya-self.urcrnry) &lt; dely</span>
            <span class="c1">#test4 = np.fabs(ya-self.llcrnry) &lt; dely</span>
            <span class="c1">#hasp1 = np.sum(test1*test3)</span>
            <span class="c1">#hasp2 = np.sum(test2*test3)</span>
            <span class="c1">#hasp4 = np.sum(test2*test4)</span>
            <span class="c1">#hasp3 = np.sum(test1*test4)</span>
            <span class="c1">#if not hasp1 or not hasp2 or not hasp3 or not hasp4:</span>
            <span class="k">if</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">xy</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">xa</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span><span class="n">ya</span><span class="o">.</span><span class="n">tolist</span><span class="p">()))</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">coastpolygontypes</span><span class="p">[</span><span class="n">npoly</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">4</span><span class="p">]:</span>
                    <span class="n">poly</span> <span class="o">=</span> <span class="n">Polygon</span><span class="p">(</span><span class="n">xy</span><span class="p">,</span><span class="n">facecolor</span><span class="o">=</span><span class="n">color</span><span class="p">,</span><span class="n">edgecolor</span><span class="o">=</span><span class="n">color</span><span class="p">,</span><span class="n">linewidth</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span> <span class="c1"># lakes filled with background color by default</span>
                    <span class="k">if</span> <span class="n">lake_color</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="n">poly</span> <span class="o">=</span> <span class="n">Polygon</span><span class="p">(</span><span class="n">xy</span><span class="p">,</span><span class="n">facecolor</span><span class="o">=</span><span class="n">axisbgc</span><span class="p">,</span><span class="n">edgecolor</span><span class="o">=</span><span class="n">axisbgc</span><span class="p">,</span><span class="n">linewidth</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">poly</span> <span class="o">=</span> <span class="n">Polygon</span><span class="p">(</span><span class="n">xy</span><span class="p">,</span><span class="n">facecolor</span><span class="o">=</span><span class="n">lake_color</span><span class="p">,</span><span class="n">edgecolor</span><span class="o">=</span><span class="n">lake_color</span><span class="p">,</span><span class="n">linewidth</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">zorder</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">poly</span><span class="o">.</span><span class="n">set_zorder</span><span class="p">(</span><span class="n">zorder</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">alpha</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">poly</span><span class="o">.</span><span class="n">set_alpha</span><span class="p">(</span><span class="n">alpha</span><span class="p">)</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span><span class="n">poly</span><span class="p">)</span>
                <span class="n">polys</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">poly</span><span class="p">)</span>
            <span class="n">npoly</span> <span class="o">=</span> <span class="n">npoly</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="c1"># set axes limits to fit map region.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_axes_limits</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
        <span class="c1"># clip continent polygons to map limbs</span>
        <span class="n">polys</span><span class="p">,</span><span class="n">c</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cliplimb</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span><span class="n">polys</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">polys</span></div>


    <span class="k">def</span><span class="w"> </span><span class="nf">_cliplimb</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">ax</span><span class="p">,</span><span class="n">coll</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mapboundarydrawn</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">coll</span><span class="p">,</span> <span class="kc">None</span>
        <span class="n">c</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mapboundarydrawn</span>
        <span class="k">if</span> <span class="n">c</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">ax</span><span class="o">.</span><span class="n">patches</span><span class="p">:</span>
            <span class="n">p</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
            <span class="c1">#p.set_clip_on(False)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">coll</span><span class="o">.</span><span class="n">set_clip_path</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">coll</span><span class="p">:</span>
                <span class="n">item</span><span class="o">.</span><span class="n">set_clip_path</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">coll</span><span class="p">,</span><span class="n">c</span>

<div class="viewcode-block" id="Basemap.drawcoastlines">
<a class="viewcode-back" href="../../api/basemap_api.html#mpl_toolkits.basemap.Basemap.drawcoastlines">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">drawcoastlines</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">linewidth</span><span class="o">=</span><span class="mf">1.</span><span class="p">,</span><span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;solid&#39;</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span><span class="n">antialiased</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">zorder</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Draw coastlines.</span>

<span class="sd">        .. tabularcolumns:: |l|L|</span>

<span class="sd">        ==============   ====================================================</span>
<span class="sd">        Keyword          Description</span>
<span class="sd">        ==============   ====================================================</span>
<span class="sd">        linewidth        coastline width (default 1.)</span>
<span class="sd">        linestyle        coastline linestyle (default solid)</span>
<span class="sd">        color            coastline color (default black)</span>
<span class="sd">        antialiased      antialiasing switch for coastlines (default True).</span>
<span class="sd">        ax               axes instance (overrides default axes instance)</span>
<span class="sd">        zorder           sets the zorder for the coastlines (if not specified,</span>
<span class="sd">                         uses default zorder for</span>
<span class="sd">                         matplotlib.patches.LineCollections).</span>
<span class="sd">        ==============   ====================================================</span>

<span class="sd">        returns a matplotlib.patches.LineCollection object.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">resolution</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="s1">&#39;there are no boundary datasets associated with this Basemap instance&#39;</span><span class="p">)</span>
        <span class="c1"># get current axes instance (if none specified).</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="n">ax</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check_ax</span><span class="p">()</span>
        <span class="n">coastlines</span> <span class="o">=</span> <span class="n">LineCollection</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">coastsegs</span><span class="p">,</span><span class="n">antialiaseds</span><span class="o">=</span><span class="p">(</span><span class="n">antialiased</span><span class="p">,))</span>
        <span class="n">coastlines</span><span class="o">.</span><span class="n">set_color</span><span class="p">(</span><span class="n">color</span><span class="p">)</span>
        <span class="n">coastlines</span><span class="o">.</span><span class="n">set_linestyle</span><span class="p">(</span><span class="n">linestyle</span><span class="p">)</span>
        <span class="n">coastlines</span><span class="o">.</span><span class="n">set_linewidth</span><span class="p">(</span><span class="n">linewidth</span><span class="p">)</span>
        <span class="n">coastlines</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="s1">&#39;_nolabel_&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">zorder</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">coastlines</span><span class="o">.</span><span class="n">set_zorder</span><span class="p">(</span><span class="n">zorder</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">add_collection</span><span class="p">(</span><span class="n">coastlines</span><span class="p">)</span>
        <span class="c1"># set axes limits to fit map region.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_axes_limits</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
        <span class="c1"># clip to map limbs</span>
        <span class="n">coastlines</span><span class="p">,</span><span class="n">c</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cliplimb</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span><span class="n">coastlines</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">coastlines</span></div>


<div class="viewcode-block" id="Basemap.drawcountries">
<a class="viewcode-back" href="../../api/basemap_api.html#mpl_toolkits.basemap.Basemap.drawcountries">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">drawcountries</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">linewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span><span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;solid&#39;</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span><span class="n">antialiased</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">zorder</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Draw country boundaries.</span>

<span class="sd">        .. tabularcolumns:: |l|L|</span>

<span class="sd">        ==============   ====================================================</span>
<span class="sd">        Keyword          Description</span>
<span class="sd">        ==============   ====================================================</span>
<span class="sd">        linewidth        country boundary line width (default 0.5)</span>
<span class="sd">        linestyle        coastline linestyle (default solid)</span>
<span class="sd">        color            country boundary line color (default black)</span>
<span class="sd">        antialiased      antialiasing switch for country boundaries (default</span>
<span class="sd">                         True).</span>
<span class="sd">        ax               axes instance (overrides default axes instance)</span>
<span class="sd">        zorder           sets the zorder for the country boundaries (if not</span>
<span class="sd">                         specified uses default zorder for</span>
<span class="sd">                         matplotlib.patches.LineCollections).</span>
<span class="sd">        ==============   ====================================================</span>

<span class="sd">        returns a matplotlib.patches.LineCollection object.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">resolution</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="s1">&#39;there are no boundary datasets associated with this Basemap instance&#39;</span><span class="p">)</span>
        <span class="c1"># read in country line segments, only keeping those that</span>
        <span class="c1"># intersect map boundary polygon.</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="s1">&#39;cntrysegs&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cntrysegs</span><span class="p">,</span> <span class="n">types</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_readboundarydata</span><span class="p">(</span><span class="s1">&#39;countries&#39;</span><span class="p">)</span>
        <span class="c1"># get current axes instance (if none specified).</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="n">ax</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check_ax</span><span class="p">()</span>
        <span class="n">countries</span> <span class="o">=</span> <span class="n">LineCollection</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cntrysegs</span><span class="p">,</span><span class="n">antialiaseds</span><span class="o">=</span><span class="p">(</span><span class="n">antialiased</span><span class="p">,))</span>
        <span class="n">countries</span><span class="o">.</span><span class="n">set_color</span><span class="p">(</span><span class="n">color</span><span class="p">)</span>
        <span class="n">countries</span><span class="o">.</span><span class="n">set_linestyle</span><span class="p">(</span><span class="n">linestyle</span><span class="p">)</span>
        <span class="n">countries</span><span class="o">.</span><span class="n">set_linewidth</span><span class="p">(</span><span class="n">linewidth</span><span class="p">)</span>
        <span class="n">countries</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="s1">&#39;_nolabel_&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">zorder</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">countries</span><span class="o">.</span><span class="n">set_zorder</span><span class="p">(</span><span class="n">zorder</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">add_collection</span><span class="p">(</span><span class="n">countries</span><span class="p">)</span>
        <span class="c1"># set axes limits to fit map region.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_axes_limits</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
        <span class="c1"># clip countries to map limbs</span>
        <span class="n">countries</span><span class="p">,</span><span class="n">c</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cliplimb</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span><span class="n">countries</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">countries</span></div>


<div class="viewcode-block" id="Basemap.drawstates">
<a class="viewcode-back" href="../../api/basemap_api.html#mpl_toolkits.basemap.Basemap.drawstates">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">drawstates</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">linewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span><span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;solid&#39;</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span><span class="n">antialiased</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">zorder</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Draw state boundaries in Americas.</span>

<span class="sd">        .. tabularcolumns:: |l|L|</span>

<span class="sd">        ==============   ====================================================</span>
<span class="sd">        Keyword          Description</span>
<span class="sd">        ==============   ====================================================</span>
<span class="sd">        linewidth        state boundary line width (default 0.5)</span>
<span class="sd">        linestyle        coastline linestyle (default solid)</span>
<span class="sd">        color            state boundary line color (default black)</span>
<span class="sd">        antialiased      antialiasing switch for state boundaries</span>
<span class="sd">                         (default True).</span>
<span class="sd">        ax               axes instance (overrides default axes instance)</span>
<span class="sd">        zorder           sets the zorder for the state boundaries (if not</span>
<span class="sd">                         specified, uses default zorder for</span>
<span class="sd">                         matplotlib.patches.LineCollections).</span>
<span class="sd">        ==============   ====================================================</span>

<span class="sd">        returns a matplotlib.patches.LineCollection object.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">resolution</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="s1">&#39;there are no boundary datasets associated with this Basemap instance&#39;</span><span class="p">)</span>
        <span class="c1"># read in state line segments, only keeping those that</span>
        <span class="c1"># intersect map boundary polygon.</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="s1">&#39;statesegs&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">statesegs</span><span class="p">,</span> <span class="n">types</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_readboundarydata</span><span class="p">(</span><span class="s1">&#39;states&#39;</span><span class="p">)</span>
        <span class="c1"># get current axes instance (if none specified).</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="n">ax</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check_ax</span><span class="p">()</span>
        <span class="n">states</span> <span class="o">=</span> <span class="n">LineCollection</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">statesegs</span><span class="p">,</span><span class="n">antialiaseds</span><span class="o">=</span><span class="p">(</span><span class="n">antialiased</span><span class="p">,))</span>
        <span class="n">states</span><span class="o">.</span><span class="n">set_color</span><span class="p">(</span><span class="n">color</span><span class="p">)</span>
        <span class="n">states</span><span class="o">.</span><span class="n">set_linestyle</span><span class="p">(</span><span class="n">linestyle</span><span class="p">)</span>
        <span class="n">states</span><span class="o">.</span><span class="n">set_linewidth</span><span class="p">(</span><span class="n">linewidth</span><span class="p">)</span>
        <span class="n">states</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="s1">&#39;_nolabel_&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">zorder</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">states</span><span class="o">.</span><span class="n">set_zorder</span><span class="p">(</span><span class="n">zorder</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">add_collection</span><span class="p">(</span><span class="n">states</span><span class="p">)</span>
        <span class="c1"># set axes limits to fit map region.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_axes_limits</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
        <span class="c1"># clip states to map limbs</span>
        <span class="n">states</span><span class="p">,</span><span class="n">c</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cliplimb</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span><span class="n">states</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">states</span></div>


<div class="viewcode-block" id="Basemap.drawcounties">
<a class="viewcode-back" href="../../api/basemap_api.html#mpl_toolkits.basemap.Basemap.drawcounties">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">drawcounties</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">linewidth</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span><span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;solid&#39;</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span><span class="n">antialiased</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                     <span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">zorder</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">drawbounds</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Draw county boundaries in US. The county boundary shapefile</span>
<span class="sd">        originates with the NOAA Coastal Geospatial Data Project</span>
<span class="sd">        (http://coastalgeospatial.noaa.gov/data_gis.html).</span>

<span class="sd">        .. tabularcolumns:: |l|L|</span>

<span class="sd">        ==============   ====================================================</span>
<span class="sd">        Keyword          Description</span>
<span class="sd">        ==============   ====================================================</span>
<span class="sd">        linewidth        county boundary line width (default 0.1)</span>
<span class="sd">        linestyle        coastline linestyle (default solid)</span>
<span class="sd">        color            county boundary line color (default black)</span>
<span class="sd">        facecolor        fill color of county (default is no fill)</span>
<span class="sd">        antialiased      antialiasing switch for county boundaries</span>
<span class="sd">                         (default True).</span>
<span class="sd">        ax               axes instance (overrides default axes instance)</span>
<span class="sd">        zorder           sets the zorder for the county boundaries (if not</span>
<span class="sd">                         specified, uses default zorder for</span>
<span class="sd">                         matplotlib.patches.LineCollections).</span>
<span class="sd">        ==============   ====================================================</span>

<span class="sd">        returns a matplotlib.patches.LineCollection object.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="n">ax</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check_ax</span><span class="p">()</span>
        <span class="n">gis_file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">basemap_datadir</span><span class="p">,</span><span class="s1">&#39;UScounties&#39;</span><span class="p">)</span>
        <span class="n">county_info</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">readshapefile</span><span class="p">(</span><span class="n">gis_file</span><span class="p">,</span><span class="s1">&#39;counties&#39;</span><span class="p">,</span>\
                      <span class="n">default_encoding</span><span class="o">=</span><span class="s1">&#39;latin-1&#39;</span><span class="p">,</span><span class="n">drawbounds</span><span class="o">=</span><span class="n">drawbounds</span><span class="p">)</span>
        <span class="n">counties</span> <span class="o">=</span> <span class="p">[</span><span class="n">coords</span> <span class="k">for</span> <span class="n">coords</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">counties</span><span class="p">]</span>
        <span class="n">counties</span> <span class="o">=</span> <span class="n">PolyCollection</span><span class="p">(</span><span class="n">counties</span><span class="p">,</span> <span class="n">antialiaseds</span><span class="o">=</span><span class="p">(</span><span class="n">antialiased</span><span class="p">,))</span>
        <span class="n">counties</span><span class="o">.</span><span class="n">set_linestyle</span><span class="p">(</span><span class="n">linestyle</span><span class="p">)</span>
        <span class="n">counties</span><span class="o">.</span><span class="n">set_linewidth</span><span class="p">(</span><span class="n">linewidth</span><span class="p">)</span>
        <span class="n">counties</span><span class="o">.</span><span class="n">set_edgecolor</span><span class="p">(</span><span class="n">color</span><span class="p">)</span>
        <span class="n">counties</span><span class="o">.</span><span class="n">set_facecolor</span><span class="p">(</span><span class="n">facecolor</span><span class="p">)</span>
        <span class="n">counties</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="s1">&#39;counties&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">zorder</span><span class="p">:</span>
            <span class="n">counties</span><span class="o">.</span><span class="n">set_zorder</span><span class="p">(</span><span class="n">zorder</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">add_collection</span><span class="p">(</span><span class="n">counties</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">counties</span></div>


<div class="viewcode-block" id="Basemap.drawrivers">
<a class="viewcode-back" href="../../api/basemap_api.html#mpl_toolkits.basemap.Basemap.drawrivers">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">drawrivers</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">linewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span><span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;solid&#39;</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span><span class="n">antialiased</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">zorder</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Draw major rivers.</span>

<span class="sd">        .. tabularcolumns:: |l|L|</span>

<span class="sd">        ==============   ====================================================</span>
<span class="sd">        Keyword          Description</span>
<span class="sd">        ==============   ====================================================</span>
<span class="sd">        linewidth        river boundary line width (default 0.5)</span>
<span class="sd">        linestyle        coastline linestyle (default solid)</span>
<span class="sd">        color            river boundary line color (default black)</span>
<span class="sd">        antialiased      antialiasing switch for river boundaries (default</span>
<span class="sd">                         True).</span>
<span class="sd">        ax               axes instance (overrides default axes instance)</span>
<span class="sd">        zorder           sets the zorder for the rivers (if not</span>
<span class="sd">                         specified uses default zorder for</span>
<span class="sd">                         matplotlib.patches.LineCollections).</span>
<span class="sd">        ==============   ====================================================</span>

<span class="sd">        returns a matplotlib.patches.LineCollection object.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">resolution</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="s1">&#39;there are no boundary datasets associated with this Basemap instance&#39;</span><span class="p">)</span>
        <span class="c1"># read in river line segments, only keeping those that</span>
        <span class="c1"># intersect map boundary polygon.</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="s1">&#39;riversegs&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">riversegs</span><span class="p">,</span> <span class="n">types</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_readboundarydata</span><span class="p">(</span><span class="s1">&#39;rivers&#39;</span><span class="p">)</span>
        <span class="c1"># get current axes instance (if none specified).</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="n">ax</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check_ax</span><span class="p">()</span>
        <span class="n">rivers</span> <span class="o">=</span> <span class="n">LineCollection</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">riversegs</span><span class="p">,</span><span class="n">antialiaseds</span><span class="o">=</span><span class="p">(</span><span class="n">antialiased</span><span class="p">,))</span>
        <span class="n">rivers</span><span class="o">.</span><span class="n">set_color</span><span class="p">(</span><span class="n">color</span><span class="p">)</span>
        <span class="n">rivers</span><span class="o">.</span><span class="n">set_linestyle</span><span class="p">(</span><span class="n">linestyle</span><span class="p">)</span>
        <span class="n">rivers</span><span class="o">.</span><span class="n">set_linewidth</span><span class="p">(</span><span class="n">linewidth</span><span class="p">)</span>
        <span class="n">rivers</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="s1">&#39;_nolabel_&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">zorder</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">rivers</span><span class="o">.</span><span class="n">set_zorder</span><span class="p">(</span><span class="n">zorder</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">add_collection</span><span class="p">(</span><span class="n">rivers</span><span class="p">)</span>
        <span class="c1"># set axes limits to fit map region.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_axes_limits</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
        <span class="c1"># clip rivers to map limbs</span>
        <span class="n">rivers</span><span class="p">,</span><span class="n">c</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cliplimb</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span><span class="n">rivers</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">rivers</span></div>


<div class="viewcode-block" id="Basemap.is_land">
<a class="viewcode-back" href="../../api/basemap_api.html#mpl_toolkits.basemap.Basemap.is_land">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">is_land</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">xpt</span><span class="p">,</span><span class="n">ypt</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns True if the given x,y point (in projection coordinates) is</span>
<span class="sd">        over land, False otherwise.  The definition of land is based upon</span>
<span class="sd">        the GSHHS coastline polygons associated with the class instance.</span>
<span class="sd">        Points over lakes inside land regions are not counted as land points.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">resolution</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="k">return</span> <span class="kc">None</span>
        <span class="n">landpt</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">for</span> <span class="n">poly</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">landpolygons</span><span class="p">:</span>
            <span class="n">landpt</span> <span class="o">=</span> <span class="n">_geoslib</span><span class="o">.</span><span class="n">Point</span><span class="p">((</span><span class="n">xpt</span><span class="p">,</span><span class="n">ypt</span><span class="p">))</span><span class="o">.</span><span class="n">within</span><span class="p">(</span><span class="n">poly</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">landpt</span><span class="p">:</span> <span class="k">break</span>
        <span class="n">lakept</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">for</span> <span class="n">poly</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lakepolygons</span><span class="p">:</span>
            <span class="n">lakept</span> <span class="o">=</span> <span class="n">_geoslib</span><span class="o">.</span><span class="n">Point</span><span class="p">((</span><span class="n">xpt</span><span class="p">,</span><span class="n">ypt</span><span class="p">))</span><span class="o">.</span><span class="n">within</span><span class="p">(</span><span class="n">poly</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">lakept</span><span class="p">:</span> <span class="k">break</span>
        <span class="k">return</span> <span class="n">landpt</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">lakept</span></div>


<div class="viewcode-block" id="Basemap.readshapefile">
<a class="viewcode-back" href="../../api/basemap_api.html#mpl_toolkits.basemap.Basemap.readshapefile">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">readshapefile</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">shapefile</span><span class="p">,</span><span class="n">name</span><span class="p">,</span><span class="n">drawbounds</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">zorder</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                      <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span><span class="n">antialiased</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                      <span class="n">default_encoding</span><span class="o">=</span><span class="s1">&#39;utf-8&#39;</span><span class="p">,</span><span class="n">encoding_errors</span><span class="o">=</span><span class="s1">&#39;strict&#39;</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Read in shape file, optionally draw boundaries on map.</span>

<span class="sd">        .. note::</span>
<span class="sd">          - Assumes shapes are 2D</span>
<span class="sd">          - only works for Point, MultiPoint, Polyline and Polygon shapes.</span>
<span class="sd">          - vertices/points must be in geographic (lat/lon) coordinates.</span>

<span class="sd">        Mandatory Arguments:</span>

<span class="sd">        .. tabularcolumns:: |l|L|</span>

<span class="sd">        ================ ====================================================</span>
<span class="sd">        Argument         Description</span>
<span class="sd">        ================ ====================================================</span>
<span class="sd">        shapefile        path to shapefile components.  Example:</span>
<span class="sd">                         shapefile=&#39;/home/jeff/esri/world_borders&#39; assumes</span>
<span class="sd">                         that world_borders.shp, world_borders.shx and</span>
<span class="sd">                         world_borders.dbf live in /home/jeff/esri.</span>
<span class="sd">        name             name for Basemap attribute to hold the shapefile</span>
<span class="sd">                         vertices or points in map projection</span>
<span class="sd">                         coordinates. Class attribute name+&#39;_info&#39; is a list</span>
<span class="sd">                         of dictionaries, one for each shape, containing</span>
<span class="sd">                         attributes of each shape from dbf file, For</span>
<span class="sd">                         example, if name=&#39;counties&#39;, self.counties</span>
<span class="sd">                         will be a list of x,y vertices for each shape in</span>
<span class="sd">                         map projection  coordinates and self.counties_info</span>
<span class="sd">                         will be a list of dictionaries with shape</span>
<span class="sd">                         attributes.  Rings in individual Polygon</span>
<span class="sd">                         shapes are split out into separate polygons, and</span>
<span class="sd">                         additional keys &#39;RINGNUM&#39; and &#39;SHAPENUM&#39; are added</span>
<span class="sd">                         to the shape attribute dictionary.</span>
<span class="sd">        ================ ====================================================</span>

<span class="sd">        The following optional keyword arguments are only relevant for Polyline</span>
<span class="sd">        and Polygon shape types, for Point and MultiPoint shapes they are</span>
<span class="sd">        ignored.</span>

<span class="sd">        .. tabularcolumns:: |l|L|</span>

<span class="sd">        ================ =====================================================</span>
<span class="sd">        Keyword          Description</span>
<span class="sd">        ================ =====================================================</span>
<span class="sd">        drawbounds       draw boundaries of shapes (default True).</span>
<span class="sd">        zorder           shape boundary zorder (if not specified,</span>
<span class="sd">                         default for mathplotlib.lines.LineCollection</span>
<span class="sd">                         is used).</span>
<span class="sd">        linewidth        shape boundary line width (default 0.5)</span>
<span class="sd">        color            shape boundary line color (default black)</span>
<span class="sd">        antialiased      antialiasing switch for shape boundaries</span>
<span class="sd">                         (default True).</span>
<span class="sd">        ax               axes instance (overrides default axes instance)</span>
<span class="sd">        default_encoding encoding used to parse properties from .dbf files</span>
<span class="sd">                         (default utf-8)</span>
<span class="sd">        encoding_errors  encoding error handling (default strict), other</span>
<span class="sd">                         possible values: ignore, replace and backslashreplace</span>
<span class="sd">        ================ =====================================================</span>

<span class="sd">        A tuple (num_shapes, type, min, max) containing shape file info</span>
<span class="sd">        is returned.</span>
<span class="sd">        num_shapes is the number of shapes, type is the type code (one of</span>
<span class="sd">        the SHPT* constants defined in the shapelib module, see</span>
<span class="sd">        http://shapelib.maptools.org/shp_api.html) and min and</span>
<span class="sd">        max are 4-element lists with the minimum and maximum values of the</span>
<span class="sd">        vertices. If ``drawbounds=True`` a</span>
<span class="sd">        matplotlib.patches.LineCollection object is appended to the tuple.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">import</span><span class="w"> </span><span class="nn">shapefile</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">shp</span>
        <span class="kn">from</span><span class="w"> </span><span class="nn">shapefile</span><span class="w"> </span><span class="kn">import</span> <span class="n">Reader</span>
        <span class="n">shp</span><span class="o">.</span><span class="n">default_encoding</span> <span class="o">=</span> <span class="n">default_encoding</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">.shp&#39;</span><span class="o">%</span><span class="n">shapefile</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="s1">&#39;cannot locate </span><span class="si">%s</span><span class="s1">.shp&#39;</span><span class="o">%</span><span class="n">shapefile</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">.shx&#39;</span><span class="o">%</span><span class="n">shapefile</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="s1">&#39;cannot locate </span><span class="si">%s</span><span class="s1">.shx&#39;</span><span class="o">%</span><span class="n">shapefile</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">.dbf&#39;</span><span class="o">%</span><span class="n">shapefile</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="s1">&#39;cannot locate </span><span class="si">%s</span><span class="s1">.dbf&#39;</span><span class="o">%</span><span class="n">shapefile</span><span class="p">)</span>
        <span class="c1"># open shapefile, read vertices for each object, convert</span>
        <span class="c1"># to map projection coordinates (only works for 2D shape types).</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">shf</span> <span class="o">=</span> <span class="n">Reader</span><span class="p">(</span><span class="n">shapefile</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="n">default_encoding</span><span class="p">,</span>
                         <span class="n">encodingErrors</span><span class="o">=</span><span class="n">encoding_errors</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="s1">&#39;error reading shapefile </span><span class="si">%s</span><span class="s1">.shp&#39;</span> <span class="o">%</span> <span class="n">shapefile</span><span class="p">)</span>
        <span class="n">fields</span> <span class="o">=</span> <span class="n">shf</span><span class="o">.</span><span class="n">fields</span>
        <span class="n">coords</span> <span class="o">=</span> <span class="p">[];</span> <span class="n">attributes</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span>
            <span class="s2">&quot;shapefile must have lat/lon vertices - it looks like this one&quot;</span><span class="p">,</span>
            <span class="s2">&quot;has vertices in map projection coordinates. You can convert the&quot;</span><span class="p">,</span>
            <span class="s2">&quot;shapefile to geographic coordinates using the shpproj utility&quot;</span><span class="p">,</span>
            <span class="s2">&quot;from the shapelib tools (http://shapelib.maptools.org/shapelib-tools.html)&quot;</span><span class="p">])</span>
        <span class="n">shptype</span> <span class="o">=</span> <span class="n">shf</span><span class="o">.</span><span class="n">shapes</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">shapeType</span>
        <span class="n">bbox</span> <span class="o">=</span> <span class="n">shf</span><span class="o">.</span><span class="n">bbox</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
        <span class="n">info</span> <span class="o">=</span> <span class="p">(</span><span class="n">shf</span><span class="o">.</span><span class="n">numRecords</span><span class="p">,</span><span class="n">shptype</span><span class="p">,</span><span class="n">bbox</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="p">]</span><span class="o">+</span><span class="p">[</span><span class="mf">0.</span><span class="p">,</span><span class="mf">0.</span><span class="p">],</span><span class="n">bbox</span><span class="p">[</span><span class="mi">2</span><span class="p">:]</span><span class="o">+</span><span class="p">[</span><span class="mf">0.</span><span class="p">,</span><span class="mf">0.</span><span class="p">])</span>
        <span class="n">npoly</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">shprec</span> <span class="ow">in</span> <span class="n">shf</span><span class="o">.</span><span class="n">shapeRecords</span><span class="p">():</span>
            <span class="n">shp</span> <span class="o">=</span> <span class="n">shprec</span><span class="o">.</span><span class="n">shape</span><span class="p">;</span> <span class="n">rec</span> <span class="o">=</span> <span class="n">shprec</span><span class="o">.</span><span class="n">record</span>
            <span class="n">npoly</span> <span class="o">=</span> <span class="n">npoly</span> <span class="o">+</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="n">shptype</span> <span class="o">!=</span> <span class="n">shp</span><span class="o">.</span><span class="n">shapeType</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;readshapefile can only handle a single shape type per file&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">shptype</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">8</span><span class="p">]:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;readshapefile can only handle 2D shape types&#39;</span><span class="p">)</span>
            <span class="n">verts</span> <span class="o">=</span> <span class="n">shp</span><span class="o">.</span><span class="n">points</span>
            <span class="k">if</span> <span class="n">shptype</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">8</span><span class="p">]:</span> <span class="c1"># a Point or MultiPoint shape.</span>
                <span class="n">lons</span><span class="p">,</span> <span class="n">lats</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="n">verts</span><span class="p">))</span>
                <span class="k">if</span> <span class="nb">max</span><span class="p">(</span><span class="n">lons</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mf">721.</span> <span class="ow">or</span> <span class="nb">min</span><span class="p">(</span><span class="n">lons</span><span class="p">)</span> <span class="o">&lt;</span> <span class="o">-</span><span class="mf">721.</span> <span class="ow">or</span> <span class="nb">max</span><span class="p">(</span><span class="n">lats</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mf">90.01</span> <span class="ow">or</span> <span class="nb">min</span><span class="p">(</span><span class="n">lats</span><span class="p">)</span> <span class="o">&lt;</span> <span class="o">-</span><span class="mf">90.01</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
                <span class="c1"># if latitude is slightly greater than 90, truncate to 90</span>
                <span class="n">lats</span> <span class="o">=</span> <span class="p">[</span><span class="nb">max</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">lat</span><span class="p">,</span> <span class="mf">90.0</span><span class="p">),</span> <span class="o">-</span><span class="mf">90.0</span><span class="p">)</span> <span class="k">for</span> <span class="n">lat</span> <span class="ow">in</span> <span class="n">lats</span><span class="p">]</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">verts</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span> <span class="c1"># MultiPoint</span>
                    <span class="n">x</span><span class="p">,</span><span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="p">(</span><span class="n">lons</span><span class="p">,</span> <span class="n">lats</span><span class="p">)</span>
                    <span class="n">coords</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">)))</span>
                <span class="k">else</span><span class="p">:</span> <span class="c1"># single Point</span>
                    <span class="n">x</span><span class="p">,</span><span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="p">(</span><span class="n">lons</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">lats</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                    <span class="n">coords</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">))</span>
                <span class="n">attdict</span><span class="o">=</span><span class="p">{}</span>
                <span class="k">for</span> <span class="n">r</span><span class="p">,</span><span class="n">key</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">rec</span><span class="p">,</span><span class="n">fields</span><span class="p">[</span><span class="mi">1</span><span class="p">:]):</span>
                    <span class="n">attdict</span><span class="p">[</span><span class="n">key</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span><span class="o">=</span><span class="n">r</span>
                <span class="n">attributes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">attdict</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span> <span class="c1"># a Polyline or Polygon shape.</span>
                <span class="n">parts</span> <span class="o">=</span> <span class="n">shp</span><span class="o">.</span><span class="n">parts</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
                <span class="n">ringnum</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="k">for</span> <span class="n">indx1</span><span class="p">,</span><span class="n">indx2</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">parts</span><span class="p">,</span><span class="n">parts</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span><span class="o">+</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">verts</span><span class="p">)]):</span>
                    <span class="n">ringnum</span> <span class="o">=</span> <span class="n">ringnum</span> <span class="o">+</span> <span class="mi">1</span>
                    <span class="n">lons</span><span class="p">,</span> <span class="n">lats</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="n">verts</span><span class="p">[</span><span class="n">indx1</span><span class="p">:</span><span class="n">indx2</span><span class="p">]))</span>
                    <span class="k">if</span> <span class="nb">max</span><span class="p">(</span><span class="n">lons</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mf">721.</span> <span class="ow">or</span> <span class="nb">min</span><span class="p">(</span><span class="n">lons</span><span class="p">)</span> <span class="o">&lt;</span> <span class="o">-</span><span class="mf">721.</span> <span class="ow">or</span> <span class="nb">max</span><span class="p">(</span><span class="n">lats</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mf">90.01</span> <span class="ow">or</span> <span class="nb">min</span><span class="p">(</span><span class="n">lats</span><span class="p">)</span> <span class="o">&lt;</span> <span class="o">-</span><span class="mf">90.01</span><span class="p">:</span>
                        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
                    <span class="c1"># if latitude is slightly greater than 90, truncate to 90</span>
                    <span class="n">lats</span> <span class="o">=</span> <span class="p">[</span><span class="nb">max</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">lat</span><span class="p">,</span> <span class="mf">90.0</span><span class="p">),</span> <span class="o">-</span><span class="mf">90.0</span><span class="p">)</span> <span class="k">for</span> <span class="n">lat</span> <span class="ow">in</span> <span class="n">lats</span><span class="p">]</span>
                    <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="p">(</span><span class="n">lons</span><span class="p">,</span> <span class="n">lats</span><span class="p">)</span>
                    <span class="n">coords</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">)))</span>
                    <span class="n">attdict</span><span class="o">=</span><span class="p">{}</span>
                    <span class="k">for</span> <span class="n">r</span><span class="p">,</span><span class="n">key</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">rec</span><span class="p">,</span><span class="n">fields</span><span class="p">[</span><span class="mi">1</span><span class="p">:]):</span>
                        <span class="n">attdict</span><span class="p">[</span><span class="n">key</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span><span class="o">=</span><span class="n">r</span>
                    <span class="c1"># add information about ring number to dictionary.</span>
                    <span class="n">attdict</span><span class="p">[</span><span class="s1">&#39;RINGNUM&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ringnum</span>
                    <span class="n">attdict</span><span class="p">[</span><span class="s1">&#39;SHAPENUM&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">npoly</span>
                    <span class="n">attributes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">attdict</span><span class="p">)</span>
        <span class="c1"># draw shape boundaries for polylines, polygons  using LineCollection.</span>
        <span class="k">if</span> <span class="n">shptype</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">8</span><span class="p">]</span> <span class="ow">and</span> <span class="n">drawbounds</span><span class="p">:</span>
            <span class="c1"># get current axes instance (if none specified).</span>
            <span class="n">ax</span> <span class="o">=</span> <span class="n">ax</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check_ax</span><span class="p">()</span>
            <span class="c1"># make LineCollections for each polygon.</span>
            <span class="n">lines</span> <span class="o">=</span> <span class="n">LineCollection</span><span class="p">(</span><span class="n">coords</span><span class="p">,</span><span class="n">antialiaseds</span><span class="o">=</span><span class="p">(</span><span class="n">antialiased</span><span class="p">,))</span>
            <span class="n">lines</span><span class="o">.</span><span class="n">set_color</span><span class="p">(</span><span class="n">color</span><span class="p">)</span>
            <span class="n">lines</span><span class="o">.</span><span class="n">set_linewidth</span><span class="p">(</span><span class="n">linewidth</span><span class="p">)</span>
            <span class="n">lines</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="s1">&#39;_nolabel_&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">zorder</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
               <span class="n">lines</span><span class="o">.</span><span class="n">set_zorder</span><span class="p">(</span><span class="n">zorder</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">add_collection</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span>
            <span class="c1"># set axes limits to fit map region.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_axes_limits</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
            <span class="c1"># clip boundaries to map limbs</span>
            <span class="n">lines</span><span class="p">,</span><span class="n">c</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cliplimb</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span><span class="n">lines</span><span class="p">)</span>
            <span class="n">info</span> <span class="o">=</span> <span class="n">info</span> <span class="o">+</span> <span class="p">(</span><span class="n">lines</span><span class="p">,)</span>
        <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">[</span><span class="n">name</span><span class="p">]</span><span class="o">=</span><span class="n">coords</span>
        <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">[</span><span class="n">name</span><span class="o">+</span><span class="s1">&#39;_info&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">attributes</span>
        <span class="k">return</span> <span class="n">info</span></div>


<div class="viewcode-block" id="Basemap.drawparallels">
<a class="viewcode-back" href="../../api/basemap_api.html#mpl_toolkits.basemap.Basemap.drawparallels">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">drawparallels</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">circles</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span><span class="n">textcolor</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span><span class="n">linewidth</span><span class="o">=</span><span class="mf">1.</span><span class="p">,</span><span class="n">zorder</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> \
                      <span class="n">dashes</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span><span class="n">labels</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span><span class="n">labelstyle</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> \
                      <span class="n">fmt</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%g</span><span class="s1">&#39;</span><span class="p">,</span><span class="n">xoffset</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">yoffset</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">latmax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                      <span class="o">**</span><span class="n">text_kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Draw and label parallels (latitude lines) for values (in degrees)</span>
<span class="sd">        given in the sequence ``circles``.</span>

<span class="sd">        .. tabularcolumns:: |l|L|</span>

<span class="sd">        ==============   ====================================================</span>
<span class="sd">        Keyword          Description</span>
<span class="sd">        ==============   ====================================================</span>
<span class="sd">        color            color to draw parallels (default black).</span>
<span class="sd">        textcolor        color to draw labels (default black).</span>
<span class="sd">        linewidth        line width for parallels (default 1.)</span>
<span class="sd">        zorder           sets the zorder for parallels (if not specified,</span>
<span class="sd">                         uses default zorder for matplotlib.lines.Line2D</span>
<span class="sd">                         objects).</span>
<span class="sd">        dashes           dash pattern for parallels (default [1,1], i.e.</span>
<span class="sd">                         1 pixel on, 1 pixel off).</span>
<span class="sd">        labels           list of 4 values (default [0,0,0,0]) that control</span>
<span class="sd">                         whether parallels are labelled where they intersect</span>
<span class="sd">                         the left, right, top or bottom of the plot. For</span>
<span class="sd">                         example labels=[1,0,0,1] will cause parallels</span>
<span class="sd">                         to be labelled where they intersect the left and</span>
<span class="sd">                         and bottom of the plot, but not the right and top.</span>
<span class="sd">        labelstyle       if set to &quot;+/-&quot;, north and south latitudes are</span>
<span class="sd">                         labelled with &quot;+&quot; and &quot;-&quot;, otherwise they are</span>
<span class="sd">                         labelled with &quot;N&quot; and &quot;S&quot;.</span>
<span class="sd">        fmt              a format string to format the parallel labels</span>
<span class="sd">                         (default &#39;%g&#39;) **or** a function that takes a</span>
<span class="sd">                         latitude value in degrees as it&#39;s only argument</span>
<span class="sd">                         and returns a formatted string.</span>
<span class="sd">        xoffset          label offset from edge of map in x-direction</span>
<span class="sd">                         (default is 0.01 times width of map in map</span>
<span class="sd">                         projection coordinates).</span>
<span class="sd">        yoffset          label offset from edge of map in y-direction</span>
<span class="sd">                         (default is 0.01 times height of map in map</span>
<span class="sd">                         projection coordinates).</span>
<span class="sd">        ax               axes instance (overrides default axes instance)</span>
<span class="sd">        latmax           absolute value of latitude to which meridians are drawn</span>
<span class="sd">                         (default is 80).</span>
<span class="sd">        \**text_kwargs   additional keyword arguments controlling text</span>
<span class="sd">                         for labels that are passed on to</span>
<span class="sd">                         the text method of the axes instance (see</span>
<span class="sd">                         matplotlib.pyplot.text documentation).</span>
<span class="sd">        ==============   ====================================================</span>

<span class="sd">        returns a dictionary whose keys are the parallel values, and</span>
<span class="sd">        whose values are tuples containing lists of the</span>
<span class="sd">        matplotlib.lines.Line2D and matplotlib.text.Text instances</span>
<span class="sd">        associated with each parallel. Deleting an item from the</span>
<span class="sd">        dictionary removes the corresponding parallel from the plot.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">text_kwargs</span><span class="p">[</span><span class="s1">&#39;color&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">textcolor</span> <span class="c1"># pass textcolor kwarg on to ax.text</span>
        <span class="c1"># if celestial=True, don&#39;t use &quot;N&quot; and &quot;S&quot; labels.</span>
        <span class="k">if</span> <span class="n">labelstyle</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">celestial</span><span class="p">:</span>
            <span class="n">labelstyle</span><span class="o">=</span><span class="s2">&quot;+/-&quot;</span>
        <span class="c1"># get current axes instance (if none specified).</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="n">ax</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check_ax</span><span class="p">()</span>
        <span class="c1"># don&#39;t draw meridians past latmax, always draw parallel at latmax.</span>
        <span class="k">if</span> <span class="n">latmax</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="n">latmax</span> <span class="o">=</span> <span class="mf">80.</span>
        <span class="c1"># offset for labels.</span>
        <span class="k">if</span> <span class="n">yoffset</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">yoffset</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">urcrnry</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">llcrnry</span><span class="p">)</span><span class="o">/</span><span class="mf">100.</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">aspect</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">yoffset</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">aspect</span><span class="o">*</span><span class="n">yoffset</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">yoffset</span> <span class="o">=</span> <span class="n">yoffset</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">aspect</span>
        <span class="k">if</span> <span class="n">xoffset</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">xoffset</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">urcrnrx</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">llcrnrx</span><span class="p">)</span><span class="o">/</span><span class="mf">100.</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">projection</span> <span class="ow">in</span> <span class="n">_cylproj</span> <span class="o">+</span> <span class="n">_pseudocyl</span><span class="p">:</span>
            <span class="n">lons</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">llcrnrlon</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">urcrnrlon</span><span class="p">,</span> <span class="mi">10001</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">projection</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;tmerc&#39;</span><span class="p">]:</span>
            <span class="n">lon_0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">projparams</span><span class="p">[</span><span class="s1">&#39;lon_0&#39;</span><span class="p">]</span>
            <span class="c1"># tmerc only defined within +/- 90 degrees of lon_0</span>
            <span class="n">lons</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">lon_0</span><span class="o">-</span><span class="mi">90</span><span class="p">,</span><span class="n">lon_0</span><span class="o">+</span><span class="mi">90</span><span class="p">,</span><span class="mi">100001</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">lonmin</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">boundarylonmin</span><span class="p">;</span> <span class="n">lonmax</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">boundarylonmax</span>
            <span class="n">lons</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">lonmin</span><span class="p">,</span> <span class="n">lonmax</span><span class="p">,</span> <span class="mi">10001</span><span class="p">)</span>
        <span class="c1"># make sure latmax degree parallel is drawn if projection not merc or cyl or miller</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">circlesl</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">circles</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="n">circlesl</span> <span class="o">=</span> <span class="n">circles</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">projection</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">_cylproj</span> <span class="o">+</span> <span class="n">_pseudocyl</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">max</span><span class="p">(</span><span class="n">circlesl</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">latmax</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">circlesl</span><span class="p">:</span>
                <span class="n">circlesl</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">latmax</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">min</span><span class="p">(</span><span class="n">circlesl</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="o">-</span><span class="n">latmax</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">circlesl</span><span class="p">:</span>
                <span class="n">circlesl</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="o">-</span><span class="n">latmax</span><span class="p">)</span>
        <span class="n">xdelta</span> <span class="o">=</span> <span class="mf">0.01</span><span class="o">*</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">xmax</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">xmin</span><span class="p">)</span>
        <span class="n">ydelta</span> <span class="o">=</span> <span class="mf">0.01</span><span class="o">*</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ymax</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">ymin</span><span class="p">)</span>
        <span class="n">linecolls</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">circ</span> <span class="ow">in</span> <span class="n">circlesl</span><span class="p">:</span>
            <span class="n">lats</span> <span class="o">=</span> <span class="n">circ</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">lons</span><span class="p">),</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
            <span class="n">x</span><span class="p">,</span><span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="p">(</span><span class="n">lons</span><span class="p">,</span><span class="n">lats</span><span class="p">)</span>
            <span class="c1"># remove points outside domain.</span>
            <span class="c1"># leave a little slop around edges (3*xdelta)</span>
            <span class="c1"># don&#39;t really know why, but this appears to be needed to</span>
            <span class="c1"># or lines sometimes don&#39;t reach edge of plot.</span>
            <span class="n">testx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span><span class="n">x</span><span class="o">&gt;=</span><span class="bp">self</span><span class="o">.</span><span class="n">xmin</span><span class="o">-</span><span class="mi">3</span><span class="o">*</span><span class="n">xdelta</span><span class="p">,</span><span class="n">x</span><span class="o">&lt;=</span><span class="bp">self</span><span class="o">.</span><span class="n">xmax</span><span class="o">+</span><span class="mi">3</span><span class="o">*</span><span class="n">xdelta</span><span class="p">)</span>
            <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">compress</span><span class="p">(</span><span class="n">testx</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
            <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">compress</span><span class="p">(</span><span class="n">testx</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
            <span class="n">testy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span><span class="n">y</span><span class="o">&gt;=</span><span class="bp">self</span><span class="o">.</span><span class="n">ymin</span><span class="o">-</span><span class="mi">3</span><span class="o">*</span><span class="n">ydelta</span><span class="p">,</span><span class="n">y</span><span class="o">&lt;=</span><span class="bp">self</span><span class="o">.</span><span class="n">ymax</span><span class="o">+</span><span class="mi">3</span><span class="o">*</span><span class="n">ydelta</span><span class="p">)</span>
            <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">compress</span><span class="p">(</span><span class="n">testy</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
            <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">compress</span><span class="p">(</span><span class="n">testy</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
            <span class="n">lines</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">y</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="c1"># split into separate line segments if necessary.</span>
                <span class="c1"># (not necessary for cylindrical or pseudocylindricl projections)</span>
                <span class="n">xd</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span><span class="o">-</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span>
                <span class="n">yd</span> <span class="o">=</span> <span class="p">(</span><span class="n">y</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span><span class="o">-</span><span class="n">y</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span>
                <span class="n">dist</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">xd</span><span class="o">+</span><span class="n">yd</span><span class="p">)</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">projection</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;cyl&#39;</span><span class="p">,</span><span class="s1">&#39;rotpole&#39;</span><span class="p">]:</span>
                    <span class="n">split</span> <span class="o">=</span> <span class="n">dist</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">rmajor</span><span class="o">/</span><span class="mf">10.</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">split</span> <span class="o">=</span> <span class="n">dist</span> <span class="o">&gt;</span> <span class="mf">1.</span>
                <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">split</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">projection</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">_cylproj</span><span class="p">:</span>
                    <span class="n">ind</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">compress</span><span class="p">(</span><span class="n">split</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">split</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">indices</span><span class="p">(</span><span class="n">xd</span><span class="o">.</span><span class="n">shape</span><span class="p">)))</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
                    <span class="n">xl</span> <span class="o">=</span> <span class="p">[]</span>
                    <span class="n">yl</span> <span class="o">=</span> <span class="p">[]</span>
                    <span class="n">iprev</span> <span class="o">=</span> <span class="mi">0</span>
                    <span class="n">ind</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">xd</span><span class="p">))</span>
                    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">ind</span><span class="p">:</span>
                        <span class="n">xl</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">iprev</span><span class="p">:</span><span class="n">i</span><span class="p">])</span>
                        <span class="n">yl</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">y</span><span class="p">[</span><span class="n">iprev</span><span class="p">:</span><span class="n">i</span><span class="p">])</span>
                        <span class="n">iprev</span> <span class="o">=</span> <span class="n">i</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">xl</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="p">]</span>
                    <span class="n">yl</span> <span class="o">=</span> <span class="p">[</span><span class="n">y</span><span class="p">]</span>
                <span class="c1"># draw each line segment.</span>
                <span class="k">for</span> <span class="n">x</span><span class="p">,</span><span class="n">y</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">xl</span><span class="p">,</span><span class="n">yl</span><span class="p">):</span>
                    <span class="c1"># skip if only a point.</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">y</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                        <span class="n">l</span> <span class="o">=</span> <span class="n">Line2D</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">linewidth</span><span class="o">=</span><span class="n">linewidth</span><span class="p">)</span>
                        <span class="n">l</span><span class="o">.</span><span class="n">set_color</span><span class="p">(</span><span class="n">color</span><span class="p">)</span>
                        <span class="n">l</span><span class="o">.</span><span class="n">set_dashes</span><span class="p">(</span><span class="n">dashes</span><span class="p">)</span>
                        <span class="n">l</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="s1">&#39;_nolabel_&#39;</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">zorder</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                            <span class="n">l</span><span class="o">.</span><span class="n">set_zorder</span><span class="p">(</span><span class="n">zorder</span><span class="p">)</span>
                        <span class="n">ax</span><span class="o">.</span><span class="n">add_line</span><span class="p">(</span><span class="n">l</span><span class="p">)</span>
                        <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">l</span><span class="p">)</span>
            <span class="n">linecolls</span><span class="p">[</span><span class="n">circ</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">lines</span><span class="p">,[])</span>
        <span class="c1"># draw labels for parallels</span>
        <span class="c1"># parallels not labelled for fulldisk orthographic or geostationary</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">projection</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;ortho&#39;</span><span class="p">,</span><span class="s1">&#39;geos&#39;</span><span class="p">,</span><span class="s1">&#39;nsper&#39;</span><span class="p">,</span><span class="s1">&#39;vandg&#39;</span><span class="p">,</span><span class="s1">&#39;aeqd&#39;</span><span class="p">]</span> <span class="ow">and</span> <span class="nb">max</span><span class="p">(</span><span class="n">labels</span><span class="p">):</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">projection</span> <span class="o">==</span> <span class="s1">&#39;vandg&#39;</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fulldisk</span><span class="p">:</span>
                <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;Warning: Cannot label parallels on </span><span class="si">%s</span><span class="s1"> basemap&#39;</span> <span class="o">%</span> <span class="n">_projnames</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">projection</span><span class="p">])</span>
                <span class="n">labels</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>
        <span class="c1"># search along edges of map to see if parallels intersect.</span>
        <span class="c1"># if so, find x,y location of intersection and draw a label there.</span>
        <span class="n">dx</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">xmax</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">xmin</span><span class="p">)</span><span class="o">/</span><span class="mf">1000.</span>
        <span class="n">dy</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ymax</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">ymin</span><span class="p">)</span><span class="o">/</span><span class="mf">1000.</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">projection</span> <span class="ow">in</span> <span class="n">_pseudocyl</span><span class="p">:</span>
            <span class="n">lon_0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">projparams</span><span class="p">[</span><span class="s1">&#39;lon_0&#39;</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">dolab</span><span class="p">,</span><span class="n">side</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">labels</span><span class="p">,[</span><span class="s1">&#39;l&#39;</span><span class="p">,</span><span class="s1">&#39;r&#39;</span><span class="p">,</span><span class="s1">&#39;t&#39;</span><span class="p">,</span><span class="s1">&#39;b&#39;</span><span class="p">]):</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">dolab</span><span class="p">:</span> <span class="k">continue</span>
            <span class="c1"># for cylindrical projections, don&#39;t draw parallels on top or bottom.</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">projection</span> <span class="ow">in</span> <span class="n">_cylproj</span> <span class="o">+</span> <span class="n">_pseudocyl</span> <span class="ow">and</span> <span class="n">side</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;t&#39;</span><span class="p">,</span><span class="s1">&#39;b&#39;</span><span class="p">]:</span> <span class="k">continue</span>
            <span class="k">if</span> <span class="n">side</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;l&#39;</span><span class="p">,</span><span class="s1">&#39;r&#39;</span><span class="p">]:</span>
                <span class="n">nmax</span> <span class="o">=</span> <span class="nb">int</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">ymax</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">ymin</span><span class="p">)</span><span class="o">/</span><span class="n">dy</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
                <span class="n">yy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">llcrnry</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">urcrnry</span><span class="p">,</span><span class="n">nmax</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">side</span> <span class="o">==</span> <span class="s1">&#39;l&#39;</span><span class="p">:</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">projection</span> <span class="ow">in</span> <span class="n">_pseudocyl</span><span class="p">:</span>
                        <span class="n">lats</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mf">89.99</span><span class="p">,</span><span class="mi">89</span><span class="p">,</span><span class="mi">99</span><span class="p">,</span><span class="n">nmax</span><span class="p">)</span>
                        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">celestial</span><span class="p">:</span>
                            <span class="n">lons</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">projparams</span><span class="p">[</span><span class="s1">&#39;lon_0&#39;</span><span class="p">]</span><span class="o">+</span><span class="mf">180.</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">lats</span><span class="p">),</span><span class="n">lats</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">lons</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">projparams</span><span class="p">[</span><span class="s1">&#39;lon_0&#39;</span><span class="p">]</span><span class="o">-</span><span class="mf">180.</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">lats</span><span class="p">),</span><span class="n">lats</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span>
                        <span class="n">xx</span><span class="p">,</span> <span class="n">yy</span> <span class="o">=</span> <span class="bp">self</span><span class="p">(</span><span class="n">lons</span><span class="p">,</span> <span class="n">lats</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">xx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">llcrnrx</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">yy</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span><span class="n">yy</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span>
                        <span class="n">lons</span><span class="p">,</span><span class="n">lats</span> <span class="o">=</span> <span class="bp">self</span><span class="p">(</span><span class="n">xx</span><span class="p">,</span><span class="n">yy</span><span class="p">,</span><span class="n">inverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                        <span class="n">lons</span> <span class="o">=</span> <span class="n">lons</span><span class="o">.</span><span class="n">tolist</span><span class="p">();</span> <span class="n">lats</span> <span class="o">=</span> <span class="n">lats</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">projection</span> <span class="ow">in</span> <span class="n">_pseudocyl</span><span class="p">:</span>
                        <span class="n">lats</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mf">89.99</span><span class="p">,</span><span class="mi">89</span><span class="p">,</span><span class="mi">99</span><span class="p">,</span><span class="n">nmax</span><span class="p">)</span>
                        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">celestial</span><span class="p">:</span>
                           <span class="n">lons</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">projparams</span><span class="p">[</span><span class="s1">&#39;lon_0&#39;</span><span class="p">]</span><span class="o">-</span><span class="mf">180.</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">lats</span><span class="p">),</span><span class="n">lats</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span>
                        <span class="k">else</span><span class="p">:</span>
                           <span class="n">lons</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">projparams</span><span class="p">[</span><span class="s1">&#39;lon_0&#39;</span><span class="p">]</span><span class="o">+</span><span class="mf">180.</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">lats</span><span class="p">),</span><span class="n">lats</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span>
                        <span class="n">xx</span><span class="p">,</span> <span class="n">yy</span> <span class="o">=</span> <span class="bp">self</span><span class="p">(</span><span class="n">lons</span><span class="p">,</span> <span class="n">lats</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">xx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">urcrnrx</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">yy</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span><span class="n">yy</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span>
                        <span class="n">lons</span><span class="p">,</span><span class="n">lats</span> <span class="o">=</span> <span class="bp">self</span><span class="p">(</span><span class="n">xx</span><span class="p">,</span><span class="n">yy</span><span class="p">,</span><span class="n">inverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                        <span class="n">lons</span> <span class="o">=</span> <span class="n">lons</span><span class="o">.</span><span class="n">tolist</span><span class="p">();</span> <span class="n">lats</span> <span class="o">=</span> <span class="n">lats</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
                <span class="k">if</span> <span class="nb">max</span><span class="p">(</span><span class="n">lons</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mf">1.e20</span> <span class="ow">or</span> <span class="nb">max</span><span class="p">(</span><span class="n">lats</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mf">1.e20</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;inverse transformation undefined - please adjust the map projection region&#39;</span><span class="p">)</span>
                <span class="c1"># adjust so 0 &lt;= lons &lt; 360</span>
                <span class="n">lons</span> <span class="o">=</span> <span class="p">[(</span><span class="n">lon</span><span class="o">+</span><span class="mi">360</span><span class="p">)</span> <span class="o">%</span> <span class="mi">360</span> <span class="k">for</span> <span class="n">lon</span> <span class="ow">in</span> <span class="n">lons</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">nmax</span> <span class="o">=</span> <span class="nb">int</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">xmax</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">xmin</span><span class="p">)</span><span class="o">/</span><span class="n">dx</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
                <span class="n">xx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">llcrnrx</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">urcrnrx</span><span class="p">,</span><span class="n">nmax</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">side</span> <span class="o">==</span> <span class="s1">&#39;b&#39;</span><span class="p">:</span>
                    <span class="n">lons</span><span class="p">,</span><span class="n">lats</span> <span class="o">=</span> <span class="bp">self</span><span class="p">(</span><span class="n">xx</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">llcrnry</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">xx</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">),</span><span class="n">inverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                    <span class="n">lons</span> <span class="o">=</span> <span class="n">lons</span><span class="o">.</span><span class="n">tolist</span><span class="p">();</span> <span class="n">lats</span> <span class="o">=</span> <span class="n">lats</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">lons</span><span class="p">,</span><span class="n">lats</span> <span class="o">=</span> <span class="bp">self</span><span class="p">(</span><span class="n">xx</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">urcrnry</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">xx</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">),</span><span class="n">inverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                    <span class="n">lons</span> <span class="o">=</span> <span class="n">lons</span><span class="o">.</span><span class="n">tolist</span><span class="p">();</span> <span class="n">lats</span> <span class="o">=</span> <span class="n">lats</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
                <span class="k">if</span> <span class="nb">max</span><span class="p">(</span><span class="n">lons</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mf">1.e20</span> <span class="ow">or</span> <span class="nb">max</span><span class="p">(</span><span class="n">lats</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mf">1.e20</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;inverse transformation undefined - please adjust the map projection region&#39;</span><span class="p">)</span>
                <span class="c1"># adjust so 0 &lt;= lons &lt; 360</span>
                <span class="n">lons</span> <span class="o">=</span> <span class="p">[(</span><span class="n">lon</span><span class="o">+</span><span class="mi">360</span><span class="p">)</span> <span class="o">%</span> <span class="mi">360</span> <span class="k">for</span> <span class="n">lon</span> <span class="ow">in</span> <span class="n">lons</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">lat</span> <span class="ow">in</span> <span class="n">circles</span><span class="p">:</span>
                <span class="c1"># don&#39;t label parallels for round polar plots</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">round</span><span class="p">:</span> <span class="k">continue</span>
                <span class="c1"># find index of parallel (there may be two, so</span>
                <span class="c1"># search from left and right).</span>
                <span class="n">nl</span> <span class="o">=</span> <span class="n">_searchlist</span><span class="p">(</span><span class="n">lats</span><span class="p">,</span><span class="n">lat</span><span class="p">)</span>
                <span class="n">nr</span> <span class="o">=</span> <span class="n">_searchlist</span><span class="p">(</span><span class="n">lats</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span><span class="n">lat</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">nr</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span> <span class="n">nr</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">lons</span><span class="p">)</span><span class="o">-</span><span class="n">nr</span><span class="o">-</span><span class="mi">1</span>
                <span class="n">latlab</span> <span class="o">=</span> <span class="n">_setlatlab</span><span class="p">(</span><span class="n">fmt</span><span class="p">,</span><span class="n">lat</span><span class="p">,</span><span class="n">labelstyle</span><span class="p">)</span>
                <span class="c1"># parallels can intersect each map edge twice.</span>
                <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">n</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">([</span><span class="n">nl</span><span class="p">,</span><span class="n">nr</span><span class="p">]):</span>
                    <span class="c1"># don&#39;t bother if close to the first label.</span>
                    <span class="k">if</span> <span class="n">i</span> <span class="ow">and</span> <span class="nb">abs</span><span class="p">(</span><span class="n">nr</span><span class="o">-</span><span class="n">nl</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">100</span><span class="p">:</span> <span class="k">continue</span>
                    <span class="k">if</span> <span class="n">n</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="n">t</span> <span class="o">=</span> <span class="kc">None</span>
                        <span class="k">if</span> <span class="n">side</span> <span class="o">==</span> <span class="s1">&#39;l&#39;</span><span class="p">:</span>
                            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">projection</span> <span class="ow">in</span> <span class="n">_pseudocyl</span><span class="p">:</span>
                                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">celestial</span><span class="p">:</span>
                                    <span class="n">xlab</span><span class="p">,</span><span class="n">ylab</span> <span class="o">=</span> <span class="bp">self</span><span class="p">(</span><span class="n">lon_0</span><span class="o">+</span><span class="mf">179.9</span><span class="p">,</span><span class="n">lat</span><span class="p">)</span>
                                <span class="k">else</span><span class="p">:</span>
                                    <span class="n">xlab</span><span class="p">,</span><span class="n">ylab</span> <span class="o">=</span> <span class="bp">self</span><span class="p">(</span><span class="n">lon_0</span><span class="o">-</span><span class="mf">179.9</span><span class="p">,</span><span class="n">lat</span><span class="p">)</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="n">xlab</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">llcrnrx</span>
                            <span class="n">xlab</span> <span class="o">=</span> <span class="n">xlab</span><span class="o">-</span><span class="n">xoffset</span>
                            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">projection</span> <span class="ow">in</span> <span class="n">_pseudocyl</span><span class="p">:</span>
                                <span class="k">if</span> <span class="n">lat</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
                                   <span class="n">t</span><span class="o">=</span><span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">xlab</span><span class="p">,</span><span class="n">yy</span><span class="p">[</span><span class="n">n</span><span class="p">],</span><span class="n">latlab</span><span class="p">,</span><span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;right&#39;</span><span class="p">,</span><span class="n">verticalalignment</span><span class="o">=</span><span class="s1">&#39;bottom&#39;</span><span class="p">,</span><span class="o">**</span><span class="n">text_kwargs</span><span class="p">)</span>
                                <span class="k">elif</span> <span class="n">lat</span><span class="o">&lt;</span><span class="mi">0</span><span class="p">:</span>
                                   <span class="n">t</span><span class="o">=</span><span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">xlab</span><span class="p">,</span><span class="n">yy</span><span class="p">[</span><span class="n">n</span><span class="p">],</span><span class="n">latlab</span><span class="p">,</span><span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;right&#39;</span><span class="p">,</span><span class="n">verticalalignment</span><span class="o">=</span><span class="s1">&#39;top&#39;</span><span class="p">,</span><span class="o">**</span><span class="n">text_kwargs</span><span class="p">)</span>
                                <span class="k">else</span><span class="p">:</span>
                                   <span class="n">t</span><span class="o">=</span><span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">xlab</span><span class="p">,</span><span class="n">yy</span><span class="p">[</span><span class="n">n</span><span class="p">],</span><span class="n">latlab</span><span class="p">,</span><span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;right&#39;</span><span class="p">,</span><span class="n">verticalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span><span class="o">**</span><span class="n">text_kwargs</span><span class="p">)</span>
                            <span class="k">else</span><span class="p">:</span>
                               <span class="n">t</span><span class="o">=</span><span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">xlab</span><span class="p">,</span><span class="n">yy</span><span class="p">[</span><span class="n">n</span><span class="p">],</span><span class="n">latlab</span><span class="p">,</span><span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;right&#39;</span><span class="p">,</span><span class="n">verticalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span><span class="o">**</span><span class="n">text_kwargs</span><span class="p">)</span>
                        <span class="k">elif</span> <span class="n">side</span> <span class="o">==</span> <span class="s1">&#39;r&#39;</span><span class="p">:</span>
                            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">projection</span> <span class="ow">in</span> <span class="n">_pseudocyl</span><span class="p">:</span>
                                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">celestial</span><span class="p">:</span>
                                   <span class="n">xlab</span><span class="p">,</span><span class="n">ylab</span> <span class="o">=</span> <span class="bp">self</span><span class="p">(</span><span class="n">lon_0</span><span class="o">-</span><span class="mf">179.9</span><span class="p">,</span><span class="n">lat</span><span class="p">)</span>
                                <span class="k">else</span><span class="p">:</span>
                                   <span class="n">xlab</span><span class="p">,</span><span class="n">ylab</span> <span class="o">=</span> <span class="bp">self</span><span class="p">(</span><span class="n">lon_0</span><span class="o">+</span><span class="mf">179.9</span><span class="p">,</span><span class="n">lat</span><span class="p">)</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="n">xlab</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">urcrnrx</span>
                            <span class="n">xlab</span> <span class="o">=</span> <span class="n">xlab</span><span class="o">+</span><span class="n">xoffset</span>
                            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">projection</span> <span class="ow">in</span> <span class="n">_pseudocyl</span><span class="p">:</span>
                                <span class="k">if</span> <span class="n">lat</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
                                   <span class="n">t</span><span class="o">=</span><span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">xlab</span><span class="p">,</span><span class="n">yy</span><span class="p">[</span><span class="n">n</span><span class="p">],</span><span class="n">latlab</span><span class="p">,</span><span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span><span class="n">verticalalignment</span><span class="o">=</span><span class="s1">&#39;bottom&#39;</span><span class="p">,</span><span class="o">**</span><span class="n">text_kwargs</span><span class="p">)</span>
                                <span class="k">elif</span> <span class="n">lat</span><span class="o">&lt;</span><span class="mi">0</span><span class="p">:</span>
                                   <span class="n">t</span><span class="o">=</span><span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">xlab</span><span class="p">,</span><span class="n">yy</span><span class="p">[</span><span class="n">n</span><span class="p">],</span><span class="n">latlab</span><span class="p">,</span><span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span><span class="n">verticalalignment</span><span class="o">=</span><span class="s1">&#39;top&#39;</span><span class="p">,</span><span class="o">**</span><span class="n">text_kwargs</span><span class="p">)</span>
                                <span class="k">else</span><span class="p">:</span>
                                   <span class="n">t</span><span class="o">=</span><span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">xlab</span><span class="p">,</span><span class="n">yy</span><span class="p">[</span><span class="n">n</span><span class="p">],</span><span class="n">latlab</span><span class="p">,</span><span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span><span class="n">verticalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span><span class="o">**</span><span class="n">text_kwargs</span><span class="p">)</span>
                            <span class="k">else</span><span class="p">:</span>
                               <span class="n">t</span><span class="o">=</span><span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">xlab</span><span class="p">,</span><span class="n">yy</span><span class="p">[</span><span class="n">n</span><span class="p">],</span><span class="n">latlab</span><span class="p">,</span><span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span><span class="n">verticalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span><span class="o">**</span><span class="n">text_kwargs</span><span class="p">)</span>
                        <span class="k">elif</span> <span class="n">side</span> <span class="o">==</span> <span class="s1">&#39;b&#39;</span><span class="p">:</span>
                            <span class="n">t</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">xx</span><span class="p">[</span><span class="n">n</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">llcrnry</span><span class="o">-</span><span class="n">yoffset</span><span class="p">,</span><span class="n">latlab</span><span class="p">,</span><span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span><span class="n">verticalalignment</span><span class="o">=</span><span class="s1">&#39;top&#39;</span><span class="p">,</span><span class="o">**</span><span class="n">text_kwargs</span><span class="p">)</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">t</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">xx</span><span class="p">[</span><span class="n">n</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">urcrnry</span><span class="o">+</span><span class="n">yoffset</span><span class="p">,</span><span class="n">latlab</span><span class="p">,</span><span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span><span class="n">verticalalignment</span><span class="o">=</span><span class="s1">&#39;bottom&#39;</span><span class="p">,</span><span class="o">**</span><span class="n">text_kwargs</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">t</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span> <span class="n">linecolls</span><span class="p">[</span><span class="n">lat</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>

        <span class="c1"># set axes limits to fit map region.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_axes_limits</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
        <span class="n">keys</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">linecolls</span><span class="o">.</span><span class="n">keys</span><span class="p">());</span> <span class="n">vals</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">linecolls</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
        <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">v</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">keys</span><span class="p">,</span><span class="n">vals</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">v</span> <span class="o">==</span> <span class="p">([],</span> <span class="p">[]):</span>
                <span class="k">del</span> <span class="n">linecolls</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
            <span class="c1"># add a remove method to each tuple.</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">linecolls</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">_tup</span><span class="p">(</span><span class="n">linecolls</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
        <span class="c1"># override __delitem__ in dict to call remove() on values.</span>
        <span class="n">pardict</span> <span class="o">=</span> <span class="n">_dict</span><span class="p">(</span><span class="n">linecolls</span><span class="p">)</span>
        <span class="c1"># clip parallels for round polar plots (and delete labels).</span>
        <span class="k">for</span> <span class="n">lines</span><span class="p">,</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">pardict</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_cliplimb</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">lines</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">pardict</span></div>


<div class="viewcode-block" id="Basemap.drawmeridians">
<a class="viewcode-back" href="../../api/basemap_api.html#mpl_toolkits.basemap.Basemap.drawmeridians">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">drawmeridians</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">meridians</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span><span class="n">textcolor</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span><span class="n">linewidth</span><span class="o">=</span><span class="mf">1.</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>\
                      <span class="n">dashes</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span><span class="n">labels</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span><span class="n">labelstyle</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>\
                      <span class="n">fmt</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%g</span><span class="s1">&#39;</span><span class="p">,</span><span class="n">xoffset</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">yoffset</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">latmax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                      <span class="o">**</span><span class="n">text_kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Draw and label meridians (longitude lines) for values (in degrees)</span>
<span class="sd">        given in the sequence ``meridians``.</span>

<span class="sd">        .. tabularcolumns:: |l|L|</span>

<span class="sd">        ==============   ====================================================</span>
<span class="sd">        Keyword          Description</span>
<span class="sd">        ==============   ====================================================</span>
<span class="sd">        color            color to draw meridians (default black).</span>
<span class="sd">        textcolor        color to draw labels (default black).</span>
<span class="sd">        linewidth        line width for meridians (default 1.)</span>
<span class="sd">        zorder           sets the zorder for meridians (if not specified,</span>
<span class="sd">                         uses default zorder for matplotlib.lines.Line2D</span>
<span class="sd">                         objects).</span>
<span class="sd">        dashes           dash pattern for meridians (default [1,1], i.e.</span>
<span class="sd">                         1 pixel on, 1 pixel off).</span>
<span class="sd">        labels           list of 4 values (default [0,0,0,0]) that control</span>
<span class="sd">                         whether meridians are labelled where they intersect</span>
<span class="sd">                         the left, right, top or bottom of the plot. For</span>
<span class="sd">                         example labels=[1,0,0,1] will cause meridians</span>
<span class="sd">                         to be labelled where they intersect the left and</span>
<span class="sd">                         and bottom of the plot, but not the right and top.</span>
<span class="sd">        labelstyle       if set to &quot;+/-&quot;, east and west longitudes are</span>
<span class="sd">                         labelled with &quot;+&quot; and &quot;-&quot;, otherwise they are</span>
<span class="sd">                         labelled with &quot;E&quot; and &quot;W&quot;.</span>
<span class="sd">        fmt              a format string to format the meridian labels</span>
<span class="sd">                         (default &#39;%g&#39;) **or** a function that takes a</span>
<span class="sd">                         longitude value in degrees as it&#39;s only argument</span>
<span class="sd">                         and returns a formatted string.</span>
<span class="sd">        xoffset          label offset from edge of map in x-direction</span>
<span class="sd">                         (default is 0.01 times width of map in map</span>
<span class="sd">                         projection coordinates).</span>
<span class="sd">        yoffset          label offset from edge of map in y-direction</span>
<span class="sd">                         (default is 0.01 times height of map in map</span>
<span class="sd">                         projection coordinates).</span>
<span class="sd">        ax               axes instance (overrides default axes instance)</span>
<span class="sd">        latmax           absolute value of latitude to which meridians are drawn</span>
<span class="sd">                         (default is 80).</span>
<span class="sd">        \**text_kwargs   additional keyword arguments controlling text</span>
<span class="sd">                         for labels that are passed on to</span>
<span class="sd">                         the text method of the axes instance (see</span>
<span class="sd">                         matplotlib.pyplot.text documentation).</span>
<span class="sd">        ==============   ====================================================</span>

<span class="sd">        returns a dictionary whose keys are the meridian values, and</span>
<span class="sd">        whose values are tuples containing lists of the</span>
<span class="sd">        matplotlib.lines.Line2D and matplotlib.text.Text instances</span>
<span class="sd">        associated with each meridian. Deleting an item from the</span>
<span class="sd">        dictionary removes the correpsonding meridian from the plot.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">text_kwargs</span><span class="p">[</span><span class="s1">&#39;color&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">textcolor</span> <span class="c1"># pass textcolor kwarg on to ax.text</span>
        <span class="c1"># for cylindrical projections, try to handle wraparound (i.e. if</span>
        <span class="c1"># projection is defined in -180 to 0 and user asks for meridians from</span>
        <span class="c1"># 180 to 360 to be drawn, it should work)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">projection</span> <span class="ow">in</span> <span class="n">_cylproj</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">projection</span> <span class="ow">in</span> <span class="n">_pseudocyl</span><span class="p">:</span>
            <span class="k">def</span><span class="w"> </span><span class="nf">addlon</span><span class="p">(</span><span class="n">meridians</span><span class="p">,</span><span class="n">madd</span><span class="p">):</span>
                <span class="n">minside</span> <span class="o">=</span> <span class="p">(</span><span class="n">madd</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">llcrnrlon</span> <span class="ow">and</span> <span class="n">madd</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">urcrnrlon</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">minside</span> <span class="ow">and</span> <span class="n">madd</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">meridians</span><span class="p">:</span> <span class="n">meridians</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">madd</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">meridians</span>
            <span class="n">merids</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">meridians</span><span class="p">)</span>
            <span class="n">meridians</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">merids</span><span class="p">:</span>
                <span class="n">meridians</span> <span class="o">=</span> <span class="n">addlon</span><span class="p">(</span><span class="n">meridians</span><span class="p">,</span><span class="n">m</span><span class="p">)</span>
                <span class="n">meridians</span> <span class="o">=</span> <span class="n">addlon</span><span class="p">(</span><span class="n">meridians</span><span class="p">,</span><span class="n">m</span><span class="o">+</span><span class="mi">360</span><span class="p">)</span>
                <span class="n">meridians</span> <span class="o">=</span> <span class="n">addlon</span><span class="p">(</span><span class="n">meridians</span><span class="p">,</span><span class="n">m</span><span class="o">-</span><span class="mi">360</span><span class="p">)</span>
            <span class="n">meridians</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
        <span class="c1"># if celestial=True, don&#39;t use &quot;E&quot; and &quot;W&quot; labels.</span>
        <span class="k">if</span> <span class="n">labelstyle</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">celestial</span><span class="p">:</span>
            <span class="n">labelstyle</span><span class="o">=</span><span class="s2">&quot;+/-&quot;</span>
        <span class="c1"># get current axes instance (if none specified).</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="n">ax</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check_ax</span><span class="p">()</span>
        <span class="c1"># don&#39;t draw meridians past latmax, always draw parallel at latmax.</span>
        <span class="k">if</span> <span class="n">latmax</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="n">latmax</span> <span class="o">=</span> <span class="mf">80.</span> <span class="c1"># unused w/ cyl, merc or miller proj.</span>
        <span class="c1"># offset for labels.</span>
        <span class="k">if</span> <span class="n">yoffset</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">yoffset</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">urcrnry</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">llcrnry</span><span class="p">)</span><span class="o">/</span><span class="mf">100.</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">aspect</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">yoffset</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">aspect</span><span class="o">*</span><span class="n">yoffset</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">yoffset</span> <span class="o">=</span> <span class="n">yoffset</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">aspect</span>
        <span class="k">if</span> <span class="n">xoffset</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">xoffset</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">urcrnrx</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">llcrnrx</span><span class="p">)</span><span class="o">/</span><span class="mf">100.</span>

        <span class="n">lats</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">latmin</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">latmax</span><span class="p">,</span><span class="mi">10001</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">projection</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">_cylproj</span> <span class="o">+</span> <span class="n">_pseudocyl</span><span class="p">:</span>
            <span class="n">testlat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span><span class="n">lats</span><span class="o">&gt;-</span><span class="n">latmax</span><span class="p">,</span><span class="n">lats</span><span class="o">&lt;</span><span class="n">latmax</span><span class="p">)</span>
            <span class="n">lats</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">compress</span><span class="p">(</span><span class="n">testlat</span><span class="p">,</span><span class="n">lats</span><span class="p">)</span>

        <span class="n">xdelta</span> <span class="o">=</span> <span class="mf">0.01</span><span class="o">*</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">xmax</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">xmin</span><span class="p">)</span>
        <span class="n">ydelta</span> <span class="o">=</span> <span class="mf">0.01</span><span class="o">*</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ymax</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">ymin</span><span class="p">)</span>
        <span class="n">linecolls</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">merid</span> <span class="ow">in</span> <span class="n">meridians</span><span class="p">:</span>
            <span class="n">lons</span> <span class="o">=</span> <span class="n">merid</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">lats</span><span class="p">),</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
            <span class="n">x</span><span class="p">,</span><span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="p">(</span><span class="n">lons</span><span class="p">,</span><span class="n">lats</span><span class="p">)</span>
            <span class="c1"># remove points outside domain.</span>
            <span class="c1"># leave a little slop around edges (3*xdelta)</span>
            <span class="c1"># don&#39;t really know why, but this appears to be needed to</span>
            <span class="c1"># or lines sometimes don&#39;t reach edge of plot.</span>
            <span class="n">testx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span><span class="n">x</span><span class="o">&gt;=</span><span class="bp">self</span><span class="o">.</span><span class="n">xmin</span><span class="o">-</span><span class="mi">3</span><span class="o">*</span><span class="n">xdelta</span><span class="p">,</span><span class="n">x</span><span class="o">&lt;=</span><span class="bp">self</span><span class="o">.</span><span class="n">xmax</span><span class="o">+</span><span class="mi">3</span><span class="o">*</span><span class="n">xdelta</span><span class="p">)</span>
            <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">compress</span><span class="p">(</span><span class="n">testx</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
            <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">compress</span><span class="p">(</span><span class="n">testx</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
            <span class="n">testy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span><span class="n">y</span><span class="o">&gt;=</span><span class="bp">self</span><span class="o">.</span><span class="n">ymin</span><span class="o">-</span><span class="mi">3</span><span class="o">*</span><span class="n">ydelta</span><span class="p">,</span><span class="n">y</span><span class="o">&lt;=</span><span class="bp">self</span><span class="o">.</span><span class="n">ymax</span><span class="o">+</span><span class="mi">3</span><span class="o">*</span><span class="n">ydelta</span><span class="p">)</span>
            <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">compress</span><span class="p">(</span><span class="n">testy</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
            <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">compress</span><span class="p">(</span><span class="n">testy</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
            <span class="n">lines</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">y</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="c1"># split into separate line segments if necessary.</span>
                <span class="c1"># (not necessary for mercator or cylindrical or miller).</span>
                <span class="n">xd</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span><span class="o">-</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span>
                <span class="n">yd</span> <span class="o">=</span> <span class="p">(</span><span class="n">y</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span><span class="o">-</span><span class="n">y</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span>
                <span class="n">dist</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">xd</span><span class="o">+</span><span class="n">yd</span><span class="p">)</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">projection</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;cyl&#39;</span><span class="p">,</span><span class="s1">&#39;rotpole&#39;</span><span class="p">]:</span>
                    <span class="n">split</span> <span class="o">=</span> <span class="n">dist</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">rmajor</span><span class="o">/</span><span class="mf">10.</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">split</span> <span class="o">=</span> <span class="n">dist</span> <span class="o">&gt;</span> <span class="mf">1.</span>
                <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">split</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">projection</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">_cylproj</span><span class="p">:</span>
                    <span class="n">ind</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">compress</span><span class="p">(</span><span class="n">split</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">split</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">indices</span><span class="p">(</span><span class="n">xd</span><span class="o">.</span><span class="n">shape</span><span class="p">)))</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
                    <span class="n">xl</span> <span class="o">=</span> <span class="p">[]</span>
                    <span class="n">yl</span> <span class="o">=</span> <span class="p">[]</span>
                    <span class="n">iprev</span> <span class="o">=</span> <span class="mi">0</span>
                    <span class="n">ind</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">xd</span><span class="p">))</span>
                    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">ind</span><span class="p">:</span>
                        <span class="n">xl</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">iprev</span><span class="p">:</span><span class="n">i</span><span class="p">])</span>
                        <span class="n">yl</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">y</span><span class="p">[</span><span class="n">iprev</span><span class="p">:</span><span class="n">i</span><span class="p">])</span>
                        <span class="n">iprev</span> <span class="o">=</span> <span class="n">i</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">xl</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="p">]</span>
                    <span class="n">yl</span> <span class="o">=</span> <span class="p">[</span><span class="n">y</span><span class="p">]</span>
                <span class="c1"># draw each line segment.</span>
                <span class="k">for</span> <span class="n">x</span><span class="p">,</span><span class="n">y</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">xl</span><span class="p">,</span><span class="n">yl</span><span class="p">):</span>
                    <span class="c1"># skip if only a point.</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">y</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                        <span class="n">l</span> <span class="o">=</span> <span class="n">Line2D</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">linewidth</span><span class="o">=</span><span class="n">linewidth</span><span class="p">)</span>
                        <span class="n">l</span><span class="o">.</span><span class="n">set_color</span><span class="p">(</span><span class="n">color</span><span class="p">)</span>
                        <span class="n">l</span><span class="o">.</span><span class="n">set_dashes</span><span class="p">(</span><span class="n">dashes</span><span class="p">)</span>
                        <span class="n">l</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="s1">&#39;_nolabel_&#39;</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">zorder</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                            <span class="n">l</span><span class="o">.</span><span class="n">set_zorder</span><span class="p">(</span><span class="n">zorder</span><span class="p">)</span>
                        <span class="n">ax</span><span class="o">.</span><span class="n">add_line</span><span class="p">(</span><span class="n">l</span><span class="p">)</span>
                        <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">l</span><span class="p">)</span>
            <span class="n">linecolls</span><span class="p">[</span><span class="n">merid</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">lines</span><span class="p">,[])</span>
        <span class="c1"># draw labels for meridians.</span>
        <span class="c1"># meridians not labelled for sinusoidal, hammer, mollweide,</span>
        <span class="c1"># VanDerGrinten or full-disk orthographic/geostationary.</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">projection</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;sinu&#39;</span><span class="p">,</span><span class="s1">&#39;moll&#39;</span><span class="p">,</span><span class="s1">&#39;hammer&#39;</span><span class="p">,</span><span class="s1">&#39;vandg&#39;</span><span class="p">]</span> <span class="ow">and</span> <span class="nb">max</span><span class="p">(</span><span class="n">labels</span><span class="p">):</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;Warning: Cannot label meridians on </span><span class="si">%s</span><span class="s1"> basemap&#39;</span> <span class="o">%</span> <span class="n">_projnames</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">projection</span><span class="p">])</span>
            <span class="n">labels</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">projection</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;ortho&#39;</span><span class="p">,</span><span class="s1">&#39;geos&#39;</span><span class="p">,</span><span class="s1">&#39;nsper&#39;</span><span class="p">,</span><span class="s1">&#39;aeqd&#39;</span><span class="p">]</span> <span class="ow">and</span> <span class="nb">max</span><span class="p">(</span><span class="n">labels</span><span class="p">):</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fulldisk</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">boundinglat</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span>
                    <span class="s2">&quot;Warning: Cannot label meridians on full-disk Geostationary,&quot;</span>
                    <span class="s2">&quot;Orthographic or Azimuthal equidistant basemap&quot;</span><span class="p">]))</span>
                <span class="n">labels</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>
        <span class="c1"># search along edges of map to see if parallels intersect.</span>
        <span class="c1"># if so, find x,y location of intersection and draw a label there.</span>
        <span class="n">dx</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">xmax</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">xmin</span><span class="p">)</span><span class="o">/</span><span class="mf">1000.</span>
        <span class="n">dy</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ymax</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">ymin</span><span class="p">)</span><span class="o">/</span><span class="mf">1000.</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">projection</span> <span class="ow">in</span> <span class="n">_pseudocyl</span><span class="p">:</span>
            <span class="n">lon_0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">projparams</span><span class="p">[</span><span class="s1">&#39;lon_0&#39;</span><span class="p">]</span>
            <span class="n">xmin</span><span class="p">,</span><span class="n">ymin</span> <span class="o">=</span> <span class="bp">self</span><span class="p">(</span><span class="n">lon_0</span><span class="o">-</span><span class="mf">179.9</span><span class="p">,</span><span class="o">-</span><span class="mi">90</span><span class="p">)</span>
            <span class="n">xmax</span><span class="p">,</span><span class="n">ymax</span> <span class="o">=</span> <span class="bp">self</span><span class="p">(</span><span class="n">lon_0</span><span class="o">+</span><span class="mf">179.9</span><span class="p">,</span><span class="mi">90</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">dolab</span><span class="p">,</span><span class="n">side</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">labels</span><span class="p">,[</span><span class="s1">&#39;l&#39;</span><span class="p">,</span><span class="s1">&#39;r&#39;</span><span class="p">,</span><span class="s1">&#39;t&#39;</span><span class="p">,</span><span class="s1">&#39;b&#39;</span><span class="p">]):</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">dolab</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">round</span><span class="p">:</span> <span class="k">continue</span>
            <span class="c1"># for cylindrical projections, don&#39;t draw meridians on left or right.</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">projection</span> <span class="ow">in</span> <span class="n">_cylproj</span> <span class="o">+</span> <span class="n">_pseudocyl</span> <span class="ow">and</span> <span class="n">side</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;l&#39;</span><span class="p">,</span><span class="s1">&#39;r&#39;</span><span class="p">]:</span> <span class="k">continue</span>
            <span class="k">if</span> <span class="n">side</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;l&#39;</span><span class="p">,</span><span class="s1">&#39;r&#39;</span><span class="p">]:</span>
                <span class="n">nmax</span> <span class="o">=</span> <span class="nb">int</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">ymax</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">ymin</span><span class="p">)</span><span class="o">/</span><span class="n">dy</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
                <span class="n">yy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">llcrnry</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">urcrnry</span><span class="p">,</span><span class="n">nmax</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">side</span> <span class="o">==</span> <span class="s1">&#39;l&#39;</span><span class="p">:</span>
                    <span class="n">lons</span><span class="p">,</span><span class="n">lats</span> <span class="o">=</span> <span class="bp">self</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">llcrnrx</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">yy</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">),</span><span class="n">yy</span><span class="p">,</span><span class="n">inverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                    <span class="n">lons</span> <span class="o">=</span> <span class="n">lons</span><span class="o">.</span><span class="n">tolist</span><span class="p">();</span> <span class="n">lats</span> <span class="o">=</span> <span class="n">lats</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">lons</span><span class="p">,</span><span class="n">lats</span> <span class="o">=</span> <span class="bp">self</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">urcrnrx</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">yy</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">),</span><span class="n">yy</span><span class="p">,</span><span class="n">inverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                    <span class="n">lons</span> <span class="o">=</span> <span class="n">lons</span><span class="o">.</span><span class="n">tolist</span><span class="p">();</span> <span class="n">lats</span> <span class="o">=</span> <span class="n">lats</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
                <span class="k">if</span> <span class="nb">max</span><span class="p">(</span><span class="n">lons</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mf">1.e20</span> <span class="ow">or</span> <span class="nb">max</span><span class="p">(</span><span class="n">lats</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mf">1.e20</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;inverse transformation undefined - please adjust the map projection region&#39;</span><span class="p">)</span>
                <span class="c1"># adjust so 0 &lt;= lons &lt; 360</span>
                <span class="n">lons</span> <span class="o">=</span> <span class="p">[(</span><span class="n">lon</span><span class="o">+</span><span class="mi">360</span><span class="p">)</span> <span class="o">%</span> <span class="mi">360</span> <span class="k">for</span> <span class="n">lon</span> <span class="ow">in</span> <span class="n">lons</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">nmax</span> <span class="o">=</span> <span class="nb">int</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">xmax</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">xmin</span><span class="p">)</span><span class="o">/</span><span class="n">dx</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">projection</span> <span class="ow">in</span> <span class="n">_pseudocyl</span><span class="p">:</span>
                    <span class="n">xx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">xmin</span><span class="p">,</span><span class="n">xmax</span><span class="p">,</span><span class="n">nmax</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">xx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">llcrnrx</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">urcrnrx</span><span class="p">,</span><span class="n">nmax</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">side</span> <span class="o">==</span> <span class="s1">&#39;b&#39;</span><span class="p">:</span>
                    <span class="n">lons</span><span class="p">,</span><span class="n">lats</span> <span class="o">=</span> <span class="bp">self</span><span class="p">(</span><span class="n">xx</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">llcrnry</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">xx</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">),</span><span class="n">inverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                    <span class="n">lons</span> <span class="o">=</span> <span class="n">lons</span><span class="o">.</span><span class="n">tolist</span><span class="p">();</span> <span class="n">lats</span> <span class="o">=</span> <span class="n">lats</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">lons</span><span class="p">,</span><span class="n">lats</span> <span class="o">=</span> <span class="bp">self</span><span class="p">(</span><span class="n">xx</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">urcrnry</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">xx</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">),</span><span class="n">inverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                    <span class="n">lons</span> <span class="o">=</span> <span class="n">lons</span><span class="o">.</span><span class="n">tolist</span><span class="p">();</span> <span class="n">lats</span> <span class="o">=</span> <span class="n">lats</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
                <span class="k">if</span> <span class="nb">max</span><span class="p">(</span><span class="n">lons</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mf">1.e20</span> <span class="ow">or</span> <span class="nb">max</span><span class="p">(</span><span class="n">lats</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mf">1.e20</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;inverse transformation undefined - please adjust the map projection region&#39;</span><span class="p">)</span>
                <span class="c1"># adjust so 0 &lt;= lons &lt; 360</span>
                <span class="n">lons</span> <span class="o">=</span> <span class="p">[(</span><span class="n">lon</span><span class="o">+</span><span class="mi">360</span><span class="p">)</span> <span class="o">%</span> <span class="mi">360</span> <span class="k">for</span> <span class="n">lon</span> <span class="ow">in</span> <span class="n">lons</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">lon</span> <span class="ow">in</span> <span class="n">meridians</span><span class="p">:</span>
                <span class="c1"># adjust so 0 &lt;= lon &lt; 360</span>
                <span class="n">lon2</span> <span class="o">=</span> <span class="p">(</span><span class="n">lon</span><span class="o">+</span><span class="mi">360</span><span class="p">)</span> <span class="o">%</span> <span class="mi">360</span>
                <span class="c1"># find index of meridian (there may be two, so</span>
                <span class="c1"># search from left and right).</span>
                <span class="n">nl</span> <span class="o">=</span> <span class="n">_searchlist</span><span class="p">(</span><span class="n">lons</span><span class="p">,</span><span class="n">lon2</span><span class="p">)</span>
                <span class="n">nr</span> <span class="o">=</span> <span class="n">_searchlist</span><span class="p">(</span><span class="n">lons</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span><span class="n">lon2</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">nr</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span> <span class="n">nr</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">lons</span><span class="p">)</span><span class="o">-</span><span class="n">nr</span><span class="o">-</span><span class="mi">1</span>
                <span class="n">lonlab</span> <span class="o">=</span> <span class="n">_setlonlab</span><span class="p">(</span><span class="n">fmt</span><span class="p">,</span><span class="n">lon2</span><span class="p">,</span><span class="n">labelstyle</span><span class="p">)</span>
                <span class="c1"># meridians can intersect each map edge twice.</span>
                <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">n</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">([</span><span class="n">nl</span><span class="p">,</span><span class="n">nr</span><span class="p">]):</span>
                    <span class="n">lat</span> <span class="o">=</span> <span class="n">lats</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">/</span><span class="mf">100.</span>
                    <span class="c1"># no meridians &gt; latmax for projections other than merc,cyl,miller.</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">projection</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">_cylproj</span> <span class="ow">and</span> <span class="n">lat</span> <span class="o">&gt;</span> <span class="n">latmax</span><span class="p">:</span> <span class="k">continue</span>
                    <span class="c1"># don&#39;t bother if close to the first label.</span>
                    <span class="k">if</span> <span class="n">i</span> <span class="ow">and</span> <span class="nb">abs</span><span class="p">(</span><span class="n">nr</span><span class="o">-</span><span class="n">nl</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">100</span><span class="p">:</span> <span class="k">continue</span>
                    <span class="k">if</span> <span class="n">n</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="n">t</span> <span class="o">=</span> <span class="kc">None</span>
                        <span class="k">if</span> <span class="n">side</span> <span class="o">==</span> <span class="s1">&#39;l&#39;</span><span class="p">:</span>
                            <span class="n">t</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">llcrnrx</span><span class="o">-</span><span class="n">xoffset</span><span class="p">,</span><span class="n">yy</span><span class="p">[</span><span class="n">n</span><span class="p">],</span><span class="n">lonlab</span><span class="p">,</span><span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;right&#39;</span><span class="p">,</span><span class="n">verticalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span><span class="o">**</span><span class="n">text_kwargs</span><span class="p">)</span>
                        <span class="k">elif</span> <span class="n">side</span> <span class="o">==</span> <span class="s1">&#39;r&#39;</span><span class="p">:</span>
                            <span class="n">t</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">urcrnrx</span><span class="o">+</span><span class="n">xoffset</span><span class="p">,</span><span class="n">yy</span><span class="p">[</span><span class="n">n</span><span class="p">],</span><span class="n">lonlab</span><span class="p">,</span><span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span><span class="n">verticalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span><span class="o">**</span><span class="n">text_kwargs</span><span class="p">)</span>
                        <span class="k">elif</span> <span class="n">side</span> <span class="o">==</span> <span class="s1">&#39;b&#39;</span><span class="p">:</span>
                            <span class="n">t</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">xx</span><span class="p">[</span><span class="n">n</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">llcrnry</span><span class="o">-</span><span class="n">yoffset</span><span class="p">,</span><span class="n">lonlab</span><span class="p">,</span><span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span><span class="n">verticalalignment</span><span class="o">=</span><span class="s1">&#39;top&#39;</span><span class="p">,</span><span class="o">**</span><span class="n">text_kwargs</span><span class="p">)</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">t</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">xx</span><span class="p">[</span><span class="n">n</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">urcrnry</span><span class="o">+</span><span class="n">yoffset</span><span class="p">,</span><span class="n">lonlab</span><span class="p">,</span><span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span><span class="n">verticalalignment</span><span class="o">=</span><span class="s1">&#39;bottom&#39;</span><span class="p">,</span><span class="o">**</span><span class="n">text_kwargs</span><span class="p">)</span>

                        <span class="k">if</span> <span class="n">t</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span> <span class="n">linecolls</span><span class="p">[</span><span class="n">lon</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
        <span class="c1"># set axes limits to fit map region.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_axes_limits</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
        <span class="c1"># remove empty values from linecolls dictionary</span>
        <span class="n">keys</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">linecolls</span><span class="o">.</span><span class="n">keys</span><span class="p">());</span> <span class="n">vals</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">linecolls</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
        <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">v</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">keys</span><span class="p">,</span><span class="n">vals</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">v</span> <span class="o">==</span> <span class="p">([],</span> <span class="p">[]):</span>
                <span class="k">del</span> <span class="n">linecolls</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
            <span class="c1"># add a remove method to each tuple.</span>
                <span class="n">linecolls</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">_tup</span><span class="p">(</span><span class="n">linecolls</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
        <span class="c1"># override __delitem__ in dict to call remove() on values.</span>
        <span class="n">meridict</span> <span class="o">=</span> <span class="n">_dict</span><span class="p">(</span><span class="n">linecolls</span><span class="p">)</span>
        <span class="c1"># for round polar plots, clip meridian lines and label them.</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">round</span><span class="p">:</span>
            <span class="c1"># label desired?</span>
            <span class="n">label</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">for</span> <span class="n">lab</span> <span class="ow">in</span> <span class="n">labels</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">lab</span><span class="p">:</span> <span class="n">label</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">for</span> <span class="n">merid</span> <span class="ow">in</span> <span class="n">meridict</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">label</span><span class="p">:</span> <span class="k">continue</span>
                <span class="c1"># label</span>
                <span class="n">lonlab</span> <span class="o">=</span> <span class="n">_setlonlab</span><span class="p">(</span><span class="n">fmt</span><span class="p">,</span><span class="n">merid</span><span class="p">,</span><span class="n">labelstyle</span><span class="p">)</span>
                <span class="n">x</span><span class="p">,</span><span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="p">(</span><span class="n">merid</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">boundinglat</span><span class="p">)</span>
                <span class="n">r</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="n">x</span><span class="o">-</span><span class="mf">0.5</span><span class="o">*</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">xmin</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">xmax</span><span class="p">))</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span>
                            <span class="p">(</span><span class="n">y</span><span class="o">-</span><span class="mf">0.5</span><span class="o">*</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ymin</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">ymax</span><span class="p">))</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
                <span class="n">r</span> <span class="o">=</span> <span class="n">r</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">xoffset</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="n">yoffset</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">projection</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;np&#39;</span><span class="p">):</span>
                    <span class="n">pole</span> <span class="o">=</span> <span class="mi">1</span>
                <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">projection</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;sp&#39;</span><span class="p">):</span>
                    <span class="n">pole</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
                <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">projection</span> <span class="o">==</span> <span class="s1">&#39;ortho&#39;</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">round</span><span class="p">:</span>
                    <span class="n">pole</span> <span class="o">=</span> <span class="mi">1</span>
                <span class="k">if</span> <span class="n">pole</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">theta</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mf">180.</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">merid</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">projparams</span><span class="p">[</span><span class="s1">&#39;lon_0&#39;</span><span class="p">]</span><span class="o">-</span><span class="mi">90</span><span class="p">)</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">projection</span> <span class="o">==</span> <span class="s1">&#39;ortho&#39;</span> <span class="ow">and</span>\
                       <span class="bp">self</span><span class="o">.</span><span class="n">projparams</span><span class="p">[</span><span class="s1">&#39;lat_0&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="o">-</span><span class="mi">90</span><span class="p">:</span>
                        <span class="n">theta</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mf">180.</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="o">-</span><span class="n">merid</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">projparams</span><span class="p">[</span><span class="s1">&#39;lon_0&#39;</span><span class="p">]</span><span class="o">+</span><span class="mi">90</span><span class="p">)</span>
                    <span class="n">x</span> <span class="o">=</span> <span class="n">r</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span><span class="o">+</span><span class="mf">0.5</span><span class="o">*</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">xmin</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">xmax</span><span class="p">)</span>
                    <span class="n">y</span> <span class="o">=</span> <span class="n">r</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span><span class="o">+</span><span class="mf">0.5</span><span class="o">*</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ymin</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">ymax</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">x</span> <span class="o">&gt;</span> <span class="mf">0.5</span><span class="o">*</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">xmin</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">xmax</span><span class="p">)</span><span class="o">+</span><span class="n">xoffset</span><span class="p">:</span>
                        <span class="n">horizalign</span> <span class="o">=</span> <span class="s1">&#39;left&#39;</span>
                    <span class="k">elif</span> <span class="n">x</span> <span class="o">&lt;</span> <span class="mf">0.5</span><span class="o">*</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">xmin</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">xmax</span><span class="p">)</span><span class="o">-</span><span class="n">xoffset</span><span class="p">:</span>
                        <span class="n">horizalign</span> <span class="o">=</span> <span class="s1">&#39;right&#39;</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">horizalign</span> <span class="o">=</span> <span class="s1">&#39;center&#39;</span>
                    <span class="k">if</span> <span class="n">y</span> <span class="o">&gt;</span> <span class="mf">0.5</span><span class="o">*</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ymin</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">ymax</span><span class="p">)</span><span class="o">+</span><span class="n">yoffset</span><span class="p">:</span>
                        <span class="n">vertalign</span> <span class="o">=</span> <span class="s1">&#39;bottom&#39;</span>
                    <span class="k">elif</span> <span class="n">y</span> <span class="o">&lt;</span> <span class="mf">0.5</span><span class="o">*</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ymin</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">ymax</span><span class="p">)</span><span class="o">-</span><span class="n">yoffset</span><span class="p">:</span>
                        <span class="n">vertalign</span> <span class="o">=</span> <span class="s1">&#39;top&#39;</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">vertalign</span> <span class="o">=</span> <span class="s1">&#39;center&#39;</span>
                    <span class="c1"># labels [l,r,t,b]</span>
                    <span class="k">if</span> <span class="n">labels</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">labels</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="ow">and</span> <span class="n">x</span> <span class="o">&gt;=</span> <span class="mf">0.5</span><span class="o">*</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">xmin</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">xmax</span><span class="p">)</span><span class="o">+</span><span class="n">xoffset</span><span class="p">:</span> <span class="k">continue</span>
                    <span class="k">if</span> <span class="n">labels</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">labels</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">and</span> <span class="n">x</span> <span class="o">&lt;=</span> <span class="mf">0.5</span><span class="o">*</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">xmin</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">xmax</span><span class="p">)</span><span class="o">-</span><span class="n">xoffset</span><span class="p">:</span> <span class="k">continue</span>
                    <span class="k">if</span> <span class="n">labels</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">labels</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="ow">and</span> <span class="n">y</span> <span class="o">&lt;=</span> <span class="mf">0.5</span><span class="o">*</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ymin</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">ymax</span><span class="p">)</span><span class="o">-</span><span class="n">yoffset</span><span class="p">:</span> <span class="k">continue</span>
                    <span class="k">if</span> <span class="n">labels</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">labels</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="ow">and</span> <span class="n">y</span> <span class="o">&gt;=</span> <span class="mf">0.5</span><span class="o">*</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ymin</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">ymax</span><span class="p">)</span><span class="o">+</span><span class="n">yoffset</span><span class="p">:</span> <span class="k">continue</span>
                <span class="k">elif</span> <span class="n">pole</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                    <span class="n">theta</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mf">180.</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="o">-</span><span class="n">merid</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">projparams</span><span class="p">[</span><span class="s1">&#39;lon_0&#39;</span><span class="p">]</span><span class="o">+</span><span class="mi">90</span><span class="p">)</span>
                    <span class="n">x</span> <span class="o">=</span> <span class="n">r</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span><span class="o">+</span><span class="mf">0.5</span><span class="o">*</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">xmin</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">xmax</span><span class="p">)</span>
                    <span class="n">y</span> <span class="o">=</span> <span class="n">r</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span><span class="o">+</span><span class="mf">0.5</span><span class="o">*</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ymin</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">ymax</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">x</span> <span class="o">&gt;</span> <span class="mf">0.5</span><span class="o">*</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">xmin</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">xmax</span><span class="p">)</span><span class="o">-</span><span class="n">xoffset</span><span class="p">:</span>
                        <span class="n">horizalign</span> <span class="o">=</span> <span class="s1">&#39;right&#39;</span>
                    <span class="k">elif</span> <span class="n">x</span> <span class="o">&lt;</span> <span class="mf">0.5</span><span class="o">*</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">xmin</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">xmax</span><span class="p">)</span><span class="o">+</span><span class="n">xoffset</span><span class="p">:</span>
                        <span class="n">horizalign</span> <span class="o">=</span> <span class="s1">&#39;left&#39;</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">horizalign</span> <span class="o">=</span> <span class="s1">&#39;center&#39;</span>
                    <span class="k">if</span> <span class="n">y</span> <span class="o">&gt;</span> <span class="mf">0.5</span><span class="o">*</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ymin</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">ymax</span><span class="p">)</span><span class="o">-</span><span class="n">yoffset</span><span class="p">:</span>
                        <span class="n">vertalign</span> <span class="o">=</span> <span class="s1">&#39;top&#39;</span>
                    <span class="k">elif</span> <span class="n">y</span> <span class="o">&lt;</span> <span class="mf">0.5</span><span class="o">*</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ymin</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">ymax</span><span class="p">)</span><span class="o">+</span><span class="n">yoffset</span><span class="p">:</span>
                        <span class="n">vertalign</span> <span class="o">=</span> <span class="s1">&#39;bottom&#39;</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">vertalign</span> <span class="o">=</span> <span class="s1">&#39;center&#39;</span>
                    <span class="c1"># labels [l,r,t,b]</span>
                    <span class="k">if</span> <span class="n">labels</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">labels</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="ow">and</span> <span class="n">x</span> <span class="o">&lt;=</span>  <span class="mf">0.5</span><span class="o">*</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">xmin</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">xmax</span><span class="p">)</span><span class="o">+</span><span class="n">xoffset</span><span class="p">:</span> <span class="k">continue</span>
                    <span class="k">if</span> <span class="n">labels</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">labels</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">and</span> <span class="n">x</span> <span class="o">&gt;=</span>  <span class="mf">0.5</span><span class="o">*</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">xmin</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">xmax</span><span class="p">)</span><span class="o">-</span><span class="n">xoffset</span><span class="p">:</span> <span class="k">continue</span>
                    <span class="k">if</span> <span class="n">labels</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">labels</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="ow">and</span> <span class="n">y</span> <span class="o">&gt;=</span>  <span class="mf">0.5</span><span class="o">*</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ymin</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">ymax</span><span class="p">)</span><span class="o">-</span><span class="n">yoffset</span><span class="p">:</span> <span class="k">continue</span>
                    <span class="k">if</span> <span class="n">labels</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">labels</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="ow">and</span> <span class="n">y</span> <span class="o">&lt;=</span>  <span class="mf">0.5</span><span class="o">*</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ymin</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">ymax</span><span class="p">)</span><span class="o">+</span><span class="n">yoffset</span><span class="p">:</span> <span class="k">continue</span>
                <span class="n">t</span><span class="o">=</span><span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">lonlab</span><span class="p">,</span><span class="n">horizontalalignment</span><span class="o">=</span><span class="n">horizalign</span><span class="p">,</span><span class="n">verticalalignment</span><span class="o">=</span><span class="n">vertalign</span><span class="p">,</span><span class="o">**</span><span class="n">text_kwargs</span><span class="p">)</span>
                <span class="n">meridict</span><span class="p">[</span><span class="n">merid</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">lines</span><span class="p">,</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">meridict</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_cliplimb</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">lines</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">meridict</span></div>


<div class="viewcode-block" id="Basemap.tissot">
<a class="viewcode-back" href="../../api/basemap_api.html#mpl_toolkits.basemap.Basemap.tissot">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">tissot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">lon_0</span><span class="p">,</span><span class="n">lat_0</span><span class="p">,</span><span class="n">radius_deg</span><span class="p">,</span><span class="n">npts</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Draw a polygon centered at ``lon_0,lat_0``.  The polygon</span>
<span class="sd">        approximates a circle on the surface of the earth with radius</span>
<span class="sd">        ``radius_deg`` degrees latitude along longitude ``lon_0``,</span>
<span class="sd">        made up of ``npts`` vertices.</span>
<span class="sd">        The polygon represents a Tissot&#39;s indicatrix</span>
<span class="sd">        (http://en.wikipedia.org/wiki/Tissot&#39;s_Indicatrix),</span>
<span class="sd">        which when drawn on a map shows the distortion</span>
<span class="sd">        inherent in the map projection.</span>

<span class="sd">        .. note::</span>
<span class="sd">         Cannot handle situations in which the polygon intersects</span>
<span class="sd">         the edge of the map projection domain, and then re-enters the domain.</span>

<span class="sd">        Extra keyword ``ax`` can be used to override the default axis instance.</span>

<span class="sd">        Other \**kwargs passed on to matplotlib.patches.Polygon.</span>

<span class="sd">        returns a matplotlib.patches.Polygon object.&quot;&quot;&quot;</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;ax&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check_ax</span><span class="p">()</span>
        <span class="n">g</span> <span class="o">=</span> <span class="n">pyproj</span><span class="o">.</span><span class="n">Geod</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">rmajor</span><span class="p">,</span><span class="n">b</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">rminor</span><span class="p">)</span>
        <span class="n">az12</span><span class="p">,</span><span class="n">az21</span><span class="p">,</span><span class="n">dist</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">inv</span><span class="p">(</span><span class="n">lon_0</span><span class="p">,</span><span class="n">lat_0</span><span class="p">,</span><span class="n">lon_0</span><span class="p">,</span><span class="n">lat_0</span><span class="o">+</span><span class="n">radius_deg</span><span class="p">)</span>
        <span class="n">seg</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="p">(</span><span class="n">lon_0</span><span class="p">,</span><span class="n">lat_0</span><span class="o">+</span><span class="n">radius_deg</span><span class="p">)]</span>
        <span class="n">delaz</span> <span class="o">=</span> <span class="mf">360.</span><span class="o">/</span><span class="n">npts</span>
        <span class="n">az</span> <span class="o">=</span> <span class="n">az12</span>
        <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">npts</span><span class="p">):</span>
            <span class="n">az</span> <span class="o">=</span> <span class="n">az</span><span class="o">+</span><span class="n">delaz</span>
            <span class="n">lon</span><span class="p">,</span> <span class="n">lat</span><span class="p">,</span> <span class="n">az21</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">fwd</span><span class="p">(</span><span class="n">lon_0</span><span class="p">,</span> <span class="n">lat_0</span><span class="p">,</span> <span class="n">az</span><span class="p">,</span> <span class="n">dist</span><span class="p">)</span>
            <span class="n">x</span><span class="p">,</span><span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="p">(</span><span class="n">lon</span><span class="p">,</span><span class="n">lat</span><span class="p">)</span>
            <span class="c1"># add segment if it is in the map projection region.</span>
            <span class="k">if</span> <span class="n">x</span> <span class="o">&lt;</span> <span class="mf">1.e20</span> <span class="ow">and</span> <span class="n">y</span> <span class="o">&lt;</span> <span class="mf">1.e20</span><span class="p">:</span>
                <span class="n">seg</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">))</span>
        <span class="n">poly</span> <span class="o">=</span> <span class="n">Polygon</span><span class="p">(</span><span class="n">seg</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span><span class="n">poly</span><span class="p">)</span>
        <span class="c1"># set axes limits to fit map region.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_axes_limits</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
        <span class="c1"># clip polygons to map limbs</span>
        <span class="n">poly</span><span class="p">,</span><span class="n">c</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cliplimb</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span><span class="n">poly</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">poly</span></div>


<div class="viewcode-block" id="Basemap.gcpoints">
<a class="viewcode-back" href="../../api/basemap_api.html#mpl_toolkits.basemap.Basemap.gcpoints">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">gcpoints</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">lon1</span><span class="p">,</span><span class="n">lat1</span><span class="p">,</span><span class="n">lon2</span><span class="p">,</span><span class="n">lat2</span><span class="p">,</span><span class="n">npoints</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        compute ``points`` points along a great circle with endpoints</span>
<span class="sd">        ``(lon1,lat1)`` and ``(lon2,lat2)``.</span>

<span class="sd">        Returns arrays x,y with map projection coordinates.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">gc</span> <span class="o">=</span> <span class="n">pyproj</span><span class="o">.</span><span class="n">Geod</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">rmajor</span><span class="p">,</span><span class="n">b</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">rminor</span><span class="p">)</span>
        <span class="n">lonlats</span> <span class="o">=</span> <span class="n">gc</span><span class="o">.</span><span class="n">npts</span><span class="p">(</span><span class="n">lon1</span><span class="p">,</span><span class="n">lat1</span><span class="p">,</span><span class="n">lon2</span><span class="p">,</span><span class="n">lat2</span><span class="p">,</span><span class="n">npoints</span><span class="o">-</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">lons</span><span class="o">=</span><span class="p">[</span><span class="n">lon1</span><span class="p">];</span><span class="n">lats</span><span class="o">=</span><span class="p">[</span><span class="n">lat1</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">lon</span><span class="p">,</span><span class="n">lat</span> <span class="ow">in</span> <span class="n">lonlats</span><span class="p">:</span>
            <span class="n">lons</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">lon</span><span class="p">);</span> <span class="n">lats</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">lat</span><span class="p">)</span>
        <span class="n">lons</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">lon2</span><span class="p">);</span> <span class="n">lats</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">lat2</span><span class="p">)</span>
        <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="p">(</span><span class="n">lons</span><span class="p">,</span> <span class="n">lats</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">x</span><span class="p">,</span><span class="n">y</span></div>


<div class="viewcode-block" id="Basemap.drawgreatcircle">
<a class="viewcode-back" href="../../api/basemap_api.html#mpl_toolkits.basemap.Basemap.drawgreatcircle">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">drawgreatcircle</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">lon1</span><span class="p">,</span><span class="n">lat1</span><span class="p">,</span><span class="n">lon2</span><span class="p">,</span><span class="n">lat2</span><span class="p">,</span><span class="n">del_s</span><span class="o">=</span><span class="mf">100.</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Draw a great circle on the map from the longitude-latitude</span>
<span class="sd">        pair ``lon1,lat1`` to ``lon2,lat2``</span>

<span class="sd">        .. tabularcolumns:: |l|L|</span>

<span class="sd">        ==============   =======================================================</span>
<span class="sd">        Keyword          Description</span>
<span class="sd">        ==============   =======================================================</span>
<span class="sd">        del_s            points on great circle computed every del_s kilometers</span>
<span class="sd">                         (default 100).</span>
<span class="sd">        \**kwargs        other keyword arguments are passed on to :meth:`plot`</span>
<span class="sd">                         method of Basemap instance.</span>
<span class="sd">        ==============   =======================================================</span>

<span class="sd">        Returns a list with a single ``matplotlib.lines.Line2D`` object like a</span>
<span class="sd">        call to ``pyplot.plot()``.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># use great circle formula for a perfect sphere.</span>
        <span class="n">gc</span> <span class="o">=</span> <span class="n">pyproj</span><span class="o">.</span><span class="n">Geod</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">rmajor</span><span class="p">,</span><span class="n">b</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">rminor</span><span class="p">)</span>
        <span class="n">az12</span><span class="p">,</span><span class="n">az21</span><span class="p">,</span><span class="n">dist</span> <span class="o">=</span> <span class="n">gc</span><span class="o">.</span><span class="n">inv</span><span class="p">(</span><span class="n">lon1</span><span class="p">,</span><span class="n">lat1</span><span class="p">,</span><span class="n">lon2</span><span class="p">,</span><span class="n">lat2</span><span class="p">)</span>
        <span class="n">npoints</span> <span class="o">=</span> <span class="nb">int</span><span class="p">((</span><span class="n">dist</span><span class="o">+</span><span class="mf">0.5</span><span class="o">*</span><span class="mf">1000.</span><span class="o">*</span><span class="n">del_s</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mf">1000.</span><span class="o">*</span><span class="n">del_s</span><span class="p">))</span>
        <span class="n">lonlats</span> <span class="o">=</span> <span class="n">gc</span><span class="o">.</span><span class="n">npts</span><span class="p">(</span><span class="n">lon1</span><span class="p">,</span><span class="n">lat1</span><span class="p">,</span><span class="n">lon2</span><span class="p">,</span><span class="n">lat2</span><span class="p">,</span><span class="n">npoints</span><span class="p">)</span>
        <span class="n">lons</span> <span class="o">=</span> <span class="p">[</span><span class="n">lon1</span><span class="p">];</span> <span class="n">lats</span> <span class="o">=</span> <span class="p">[</span><span class="n">lat1</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">lon</span><span class="p">,</span> <span class="n">lat</span> <span class="ow">in</span> <span class="n">lonlats</span><span class="p">:</span>
            <span class="n">lons</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">lon</span><span class="p">)</span>
            <span class="n">lats</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">lat</span><span class="p">)</span>
        <span class="n">lons</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">lon2</span><span class="p">);</span> <span class="n">lats</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">lat2</span><span class="p">)</span>
        <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="p">(</span><span class="n">lons</span><span class="p">,</span> <span class="n">lats</span><span class="p">)</span>

        <span class="c1"># Correct wrap around effect of great circles</span>

        <span class="c1"># get points</span>
        <span class="n">_p</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">p</span> <span class="o">=</span> <span class="n">_p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get_path</span><span class="p">()</span>

        <span class="c1"># since we know the difference between any two points, we can use this to find wrap arounds on the plot</span>
        <span class="n">max_dist</span> <span class="o">=</span> <span class="mi">1000</span><span class="o">*</span><span class="n">del_s</span><span class="o">*</span><span class="mi">2</span>

        <span class="c1"># calculate distances and compare with max allowable distance</span>
        <span class="n">dists</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">vertices</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]))</span>
        <span class="n">cuts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span> <span class="n">dists</span> <span class="o">&gt;</span> <span class="n">max_dist</span> <span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

        <span class="c1"># if there are any cut points, cut them and begin again at the next point</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">k</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">cuts</span><span class="p">):</span>
            <span class="c1"># vertex to cut at</span>
            <span class="n">cut_point</span> <span class="o">=</span> <span class="n">cuts</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>

            <span class="c1"># create new vertices with a nan inbetween and set those as the path&#39;s vertices</span>
            <span class="n">verts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span>
                                       <span class="p">[</span><span class="n">p</span><span class="o">.</span><span class="n">vertices</span><span class="p">[:</span><span class="n">cut_point</span><span class="p">,</span> <span class="p">:],</span>
                                        <span class="p">[[</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">]],</span>
                                        <span class="n">p</span><span class="o">.</span><span class="n">vertices</span><span class="p">[</span><span class="n">cut_point</span><span class="o">+</span><span class="mi">1</span><span class="p">:,</span> <span class="p">:]]</span>
                                       <span class="p">)</span>
            <span class="n">p</span><span class="o">.</span><span class="n">codes</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">p</span><span class="o">.</span><span class="n">vertices</span> <span class="o">=</span> <span class="n">verts</span>

        <span class="k">return</span> <span class="n">_p</span></div>


<div class="viewcode-block" id="Basemap.transform_scalar">
<a class="viewcode-back" href="../../api/basemap_api.html#mpl_toolkits.basemap.Basemap.transform_scalar">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">transform_scalar</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">datin</span><span class="p">,</span><span class="n">lons</span><span class="p">,</span><span class="n">lats</span><span class="p">,</span><span class="n">nx</span><span class="p">,</span><span class="n">ny</span><span class="p">,</span><span class="n">returnxy</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">checkbounds</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">order</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">masked</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Interpolate a scalar field (``datin``) from a lat/lon grid with</span>
<span class="sd">        longitudes = ``lons`` and latitudes = ``lats`` to a ``ny`` by ``nx``</span>
<span class="sd">        map projection grid.  Typically used to transform data to</span>
<span class="sd">        map projection coordinates for plotting on a map with</span>
<span class="sd">        the :meth:`imshow`.</span>

<span class="sd">        .. tabularcolumns:: |l|L|</span>

<span class="sd">        ==============   ====================================================</span>
<span class="sd">        Argument         Description</span>
<span class="sd">        ==============   ====================================================</span>
<span class="sd">        datin            input data on a lat/lon grid.</span>
<span class="sd">        lons, lats       rank-1 arrays containing longitudes and latitudes</span>
<span class="sd">                         (in degrees) of input data in increasing order.</span>
<span class="sd">                         For non-cylindrical projections (those other than</span>
<span class="sd">                         ``cyl``, ``merc``, ``cea``, ``gall`` and ``mill``) lons</span>
<span class="sd">                         must fit within range -180 to 180.</span>
<span class="sd">        nx, ny           The size of the output regular grid in map</span>
<span class="sd">                         projection coordinates</span>
<span class="sd">        ==============   ====================================================</span>

<span class="sd">        .. tabularcolumns:: |l|L|</span>

<span class="sd">        ==============   ====================================================</span>
<span class="sd">        Keyword          Description</span>
<span class="sd">        ==============   ====================================================</span>
<span class="sd">        returnxy         If True, the x and y values of the map</span>
<span class="sd">                         projection grid are also returned (Default False).</span>
<span class="sd">        checkbounds      If True, values of lons and lats are checked to see</span>
<span class="sd">                         that they lie within the map projection region.</span>
<span class="sd">                         Default is False, and data outside map projection</span>
<span class="sd">                         region is clipped to values on boundary.</span>
<span class="sd">        masked           If True, interpolated data is returned as a masked</span>
<span class="sd">                         array with values outside map projection region</span>
<span class="sd">                         masked (Default False).</span>
<span class="sd">        order            0 for nearest-neighbor interpolation, 1 for</span>
<span class="sd">                         bilinear, 3 for cubic spline (Default 1).</span>
<span class="sd">                         Cubic spline interpolation requires scipy.ndimage.</span>
<span class="sd">        ==============   ====================================================</span>

<span class="sd">        Returns ``datout`` (data on map projection grid).</span>
<span class="sd">        If returnxy=True, returns ``data,x,y``.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># check that lons, lats increasing</span>
        <span class="n">delon</span> <span class="o">=</span> <span class="n">lons</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span><span class="o">-</span><span class="n">lons</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">delat</span> <span class="o">=</span> <span class="n">lats</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span><span class="o">-</span><span class="n">lats</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">min</span><span class="p">(</span><span class="n">delon</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">0.</span> <span class="ow">or</span> <span class="nb">min</span><span class="p">(</span><span class="n">delat</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">0.</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;lons and lats must be increasing!&#39;</span><span class="p">)</span>
        <span class="c1"># check that lons in -180,180 for non-cylindrical projections.</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">projection</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">_cylproj</span><span class="p">:</span>
            <span class="n">lonsa</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">lons</span><span class="p">)</span>
            <span class="n">count</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">lonsa</span> <span class="o">&lt;</span> <span class="o">-</span><span class="mf">180.00001</span><span class="p">)</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">lonsa</span> <span class="o">&gt;</span> <span class="mf">180.00001</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">count</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;grid must be shifted so that lons are monotonically increasing and fit in range -180,+180 (see shiftgrid function)&#39;</span><span class="p">)</span>
            <span class="c1"># allow for wraparound point to be outside.</span>
            <span class="k">elif</span> <span class="n">count</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">math</span><span class="o">.</span><span class="n">fabs</span><span class="p">(</span><span class="n">lons</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">lons</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="mf">360.</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mf">1.e-4</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;grid must be shifted so that lons are monotonically increasing and fit in range -180,+180 (see shiftgrid function)&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">returnxy</span><span class="p">:</span>
            <span class="n">lonsout</span><span class="p">,</span> <span class="n">latsout</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">makegrid</span><span class="p">(</span><span class="n">nx</span><span class="p">,</span><span class="n">ny</span><span class="p">,</span><span class="n">returnxy</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">lonsout</span><span class="p">,</span> <span class="n">latsout</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">makegrid</span><span class="p">(</span><span class="n">nx</span><span class="p">,</span><span class="n">ny</span><span class="p">)</span>
        <span class="n">datout</span> <span class="o">=</span> <span class="n">interp</span><span class="p">(</span><span class="n">datin</span><span class="p">,</span><span class="n">lons</span><span class="p">,</span><span class="n">lats</span><span class="p">,</span><span class="n">lonsout</span><span class="p">,</span><span class="n">latsout</span><span class="p">,</span><span class="n">checkbounds</span><span class="o">=</span><span class="n">checkbounds</span><span class="p">,</span><span class="n">order</span><span class="o">=</span><span class="n">order</span><span class="p">,</span><span class="n">masked</span><span class="o">=</span><span class="n">masked</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">returnxy</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">datout</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">datout</span></div>


<div class="viewcode-block" id="Basemap.transform_vector">
<a class="viewcode-back" href="../../api/basemap_api.html#mpl_toolkits.basemap.Basemap.transform_vector">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">transform_vector</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">uin</span><span class="p">,</span><span class="n">vin</span><span class="p">,</span><span class="n">lons</span><span class="p">,</span><span class="n">lats</span><span class="p">,</span><span class="n">nx</span><span class="p">,</span><span class="n">ny</span><span class="p">,</span><span class="n">returnxy</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">checkbounds</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">order</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">masked</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Rotate and interpolate a vector field (``uin,vin``) from a</span>
<span class="sd">        lat/lon grid with longitudes = ``lons`` and latitudes = ``lats``</span>
<span class="sd">        to a ``ny`` by ``nx`` map projection grid.</span>

<span class="sd">        The input vector field is defined in spherical coordinates (it</span>
<span class="sd">        has eastward and northward components) while the output</span>
<span class="sd">        vector field is rotated to map projection coordinates (relative</span>
<span class="sd">        to x and y). The magnitude of the vector is preserved.</span>

<span class="sd">        .. tabularcolumns:: |l|L|</span>

<span class="sd">        ==============   ====================================================</span>
<span class="sd">        Arguments        Description</span>
<span class="sd">        ==============   ====================================================</span>
<span class="sd">        uin, vin         input vector field on a lat/lon grid.</span>
<span class="sd">        lons, lats       rank-1 arrays containing longitudes and latitudes</span>
<span class="sd">                         (in degrees) of input data in increasing order.</span>
<span class="sd">                         For non-cylindrical projections (those other than</span>
<span class="sd">                         ``cyl``, ``merc``, ``cea``, ``gall`` and ``mill``) lons</span>
<span class="sd">                         must fit within range -180 to 180.</span>
<span class="sd">        nx, ny           The size of the output regular grid in map</span>
<span class="sd">                         projection coordinates</span>
<span class="sd">        ==============   ====================================================</span>

<span class="sd">        .. tabularcolumns:: |l|L|</span>

<span class="sd">        ==============   ====================================================</span>
<span class="sd">        Keyword          Description</span>
<span class="sd">        ==============   ====================================================</span>
<span class="sd">        returnxy         If True, the x and y values of the map</span>
<span class="sd">                         projection grid are also returned (Default False).</span>
<span class="sd">        checkbounds      If True, values of lons and lats are checked to see</span>
<span class="sd">                         that they lie within the map projection region.</span>
<span class="sd">                         Default is False, and data outside map projection</span>
<span class="sd">                         region is clipped to values on boundary.</span>
<span class="sd">        masked           If True, interpolated data is returned as a masked</span>
<span class="sd">                         array with values outside map projection region</span>
<span class="sd">                         masked (Default False).</span>
<span class="sd">        order            0 for nearest-neighbor interpolation, 1 for</span>
<span class="sd">                         bilinear, 3 for cubic spline (Default 1).</span>
<span class="sd">                         Cubic spline interpolation requires scipy.ndimage.</span>
<span class="sd">        ==============   ====================================================</span>

<span class="sd">        Returns ``uout, vout`` (vector field on map projection grid).</span>
<span class="sd">        If returnxy=True, returns ``uout,vout,x,y``.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># check that lons, lats increasing</span>
        <span class="n">delon</span> <span class="o">=</span> <span class="n">lons</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span><span class="o">-</span><span class="n">lons</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">delat</span> <span class="o">=</span> <span class="n">lats</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span><span class="o">-</span><span class="n">lats</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">min</span><span class="p">(</span><span class="n">delon</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">0.</span> <span class="ow">or</span> <span class="nb">min</span><span class="p">(</span><span class="n">delat</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">0.</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;lons and lats must be increasing!&#39;</span><span class="p">)</span>
        <span class="c1"># check that lons in -180,180 for non-cylindrical projections.</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">projection</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">_cylproj</span><span class="p">:</span>
            <span class="n">lonsa</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">lons</span><span class="p">)</span>
            <span class="n">count</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">lonsa</span> <span class="o">&lt;</span> <span class="o">-</span><span class="mf">180.00001</span><span class="p">)</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">lonsa</span> <span class="o">&gt;</span> <span class="mf">180.00001</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">count</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;grid must be shifted so that lons are monotonically increasing and fit in range -180,+180 (see shiftgrid function)&#39;</span><span class="p">)</span>
            <span class="c1"># allow for wraparound point to be outside.</span>
            <span class="k">elif</span> <span class="n">count</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">math</span><span class="o">.</span><span class="n">fabs</span><span class="p">(</span><span class="n">lons</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">lons</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="mf">360.</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mf">1.e-4</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;grid must be shifted so that lons are monotonically increasing and fit in range -180,+180 (see shiftgrid function)&#39;</span><span class="p">)</span>
        <span class="n">lonsout</span><span class="p">,</span> <span class="n">latsout</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">makegrid</span><span class="p">(</span><span class="n">nx</span><span class="p">,</span><span class="n">ny</span><span class="p">,</span><span class="n">returnxy</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="c1"># interpolate to map projection coordinates.</span>
        <span class="n">uin</span> <span class="o">=</span> <span class="n">interp</span><span class="p">(</span><span class="n">uin</span><span class="p">,</span><span class="n">lons</span><span class="p">,</span><span class="n">lats</span><span class="p">,</span><span class="n">lonsout</span><span class="p">,</span><span class="n">latsout</span><span class="p">,</span><span class="n">checkbounds</span><span class="o">=</span><span class="n">checkbounds</span><span class="p">,</span><span class="n">order</span><span class="o">=</span><span class="n">order</span><span class="p">,</span><span class="n">masked</span><span class="o">=</span><span class="n">masked</span><span class="p">)</span>
        <span class="n">vin</span> <span class="o">=</span> <span class="n">interp</span><span class="p">(</span><span class="n">vin</span><span class="p">,</span><span class="n">lons</span><span class="p">,</span><span class="n">lats</span><span class="p">,</span><span class="n">lonsout</span><span class="p">,</span><span class="n">latsout</span><span class="p">,</span><span class="n">checkbounds</span><span class="o">=</span><span class="n">checkbounds</span><span class="p">,</span><span class="n">order</span><span class="o">=</span><span class="n">order</span><span class="p">,</span><span class="n">masked</span><span class="o">=</span><span class="n">masked</span><span class="p">)</span>
        <span class="c1"># rotate from geographic to map coordinates.</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">rotate_vector</span><span class="p">(</span><span class="n">uin</span><span class="p">,</span><span class="n">vin</span><span class="p">,</span><span class="n">lonsout</span><span class="p">,</span><span class="n">latsout</span><span class="p">,</span><span class="n">returnxy</span><span class="o">=</span><span class="n">returnxy</span><span class="p">)</span></div>


<div class="viewcode-block" id="Basemap.rotate_vector">
<a class="viewcode-back" href="../../api/basemap_api.html#mpl_toolkits.basemap.Basemap.rotate_vector">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">rotate_vector</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">uin</span><span class="p">,</span><span class="n">vin</span><span class="p">,</span><span class="n">lons</span><span class="p">,</span><span class="n">lats</span><span class="p">,</span><span class="n">returnxy</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Rotate a vector field (``uin,vin``) on a rectilinear grid</span>
<span class="sd">        with longitudes = ``lons`` and latitudes = ``lats`` from</span>
<span class="sd">        geographical (lat/lon) into map projection (x/y) coordinates.</span>

<span class="sd">        Differs from transform_vector in that no interpolation is done.</span>
<span class="sd">        The vector is returned on the same grid, but rotated into</span>
<span class="sd">        x,y coordinates.</span>

<span class="sd">        The input vector field is defined in spherical coordinates (it</span>
<span class="sd">        has eastward and northward components) while the output</span>
<span class="sd">        vector field is rotated to map projection coordinates (relative</span>
<span class="sd">        to x and y). The magnitude of the vector is preserved.</span>

<span class="sd">        .. tabularcolumns:: |l|L|</span>

<span class="sd">        ==============   ====================================================</span>
<span class="sd">        Arguments        Description</span>
<span class="sd">        ==============   ====================================================</span>
<span class="sd">        uin, vin         input vector field on a lat/lon grid.</span>
<span class="sd">        lons, lats       Arrays containing longitudes and latitudes</span>
<span class="sd">                         (in degrees) of input data in increasing order.</span>
<span class="sd">                         For non-cylindrical projections (those other than</span>
<span class="sd">                         ``cyl``, ``merc``, ``cyl``, ``gall`` and ``mill``) lons</span>
<span class="sd">                         must fit within range -180 to 180.</span>
<span class="sd">        ==============   ====================================================</span>

<span class="sd">        Returns ``uout, vout`` (rotated vector field).</span>
<span class="sd">        If the optional keyword argument</span>
<span class="sd">        ``returnxy`` is True (default is False),</span>
<span class="sd">        returns ``uout,vout,x,y`` (where ``x,y`` are the map projection</span>
<span class="sd">        coordinates of the grid defined by ``lons,lats``).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># if lons,lats are 1d and uin,vin are 2d, and</span>
        <span class="c1"># lats describes 1st dim of uin,vin, and</span>
        <span class="c1"># lons describes 2nd dim of uin,vin, make lons,lats 2d</span>
        <span class="c1"># with meshgrid.</span>
        <span class="k">if</span> <span class="n">lons</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="n">lats</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">uin</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="n">vin</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">2</span> <span class="ow">and</span>\
           <span class="n">uin</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="n">vin</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="n">lons</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">and</span>\
           <span class="n">uin</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">vin</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">lats</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
            <span class="n">lons</span><span class="p">,</span> <span class="n">lats</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">lons</span><span class="p">,</span> <span class="n">lats</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">lons</span><span class="o">.</span><span class="n">shape</span> <span class="o">==</span> <span class="n">lats</span><span class="o">.</span><span class="n">shape</span> <span class="o">==</span> <span class="n">uin</span><span class="o">.</span><span class="n">shape</span> <span class="o">==</span> <span class="n">vin</span><span class="o">.</span><span class="n">shape</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;shapes of lons,lats and uin,vin don&#39;t match&quot;</span><span class="p">)</span>
        <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="p">(</span><span class="n">lons</span><span class="p">,</span> <span class="n">lats</span><span class="p">)</span>
        <span class="c1"># rotate from geographic to map coordinates.</span>
        <span class="k">if</span> <span class="n">ma</span><span class="o">.</span><span class="n">isMaskedArray</span><span class="p">(</span><span class="n">uin</span><span class="p">):</span>
            <span class="n">mask</span> <span class="o">=</span> <span class="n">ma</span><span class="o">.</span><span class="n">getmaskarray</span><span class="p">(</span><span class="n">uin</span><span class="p">)</span>
            <span class="n">masked</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">uin</span> <span class="o">=</span> <span class="n">uin</span><span class="o">.</span><span class="n">filled</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">vin</span> <span class="o">=</span> <span class="n">vin</span><span class="o">.</span><span class="n">filled</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">masked</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="c1"># Map the (lon, lat) vector in the complex plane.</span>
        <span class="n">uvc</span> <span class="o">=</span> <span class="n">uin</span> <span class="o">+</span> <span class="mi">1</span><span class="n">j</span><span class="o">*</span><span class="n">vin</span>
        <span class="n">uvmag</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">uvc</span><span class="p">)</span>
        <span class="n">theta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">angle</span><span class="p">(</span><span class="n">uvc</span><span class="p">)</span>

        <span class="c1"># Define a displacement (dlon, dlat) that moves all</span>
        <span class="c1"># positions (lons, lats) a small distance in the</span>
        <span class="c1"># direction of the original vector.</span>
        <span class="n">dc</span> <span class="o">=</span> <span class="mf">1E-5</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">theta</span><span class="o">*</span><span class="mi">1</span><span class="n">j</span><span class="p">)</span>
        <span class="n">dlat</span> <span class="o">=</span> <span class="n">dc</span><span class="o">.</span><span class="n">imag</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">lats</span><span class="p">))</span>
        <span class="n">dlon</span> <span class="o">=</span> <span class="n">dc</span><span class="o">.</span><span class="n">real</span>

        <span class="c1"># Deal with displacements that overshoot the North or South Pole.</span>
        <span class="n">farnorth</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">lats</span><span class="o">+</span><span class="n">dlat</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mf">90.0</span>
        <span class="n">somenorth</span> <span class="o">=</span> <span class="n">farnorth</span><span class="o">.</span><span class="n">any</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">somenorth</span><span class="p">:</span>
            <span class="n">dlon</span><span class="p">[</span><span class="n">farnorth</span><span class="p">]</span> <span class="o">*=</span> <span class="o">-</span><span class="mf">1.0</span>
            <span class="n">dlat</span><span class="p">[</span><span class="n">farnorth</span><span class="p">]</span> <span class="o">*=</span> <span class="o">-</span><span class="mf">1.0</span>

        <span class="c1"># Add displacement to original location and find the native coordinates.</span>
        <span class="n">lon1</span> <span class="o">=</span> <span class="n">lons</span> <span class="o">+</span> <span class="n">dlon</span>
        <span class="n">lat1</span> <span class="o">=</span> <span class="n">lats</span> <span class="o">+</span> <span class="n">dlat</span>
        <span class="n">xn</span><span class="p">,</span> <span class="n">yn</span> <span class="o">=</span> <span class="bp">self</span><span class="p">(</span><span class="n">lon1</span><span class="p">,</span> <span class="n">lat1</span><span class="p">)</span>

        <span class="c1"># Determine the angle of the displacement in the native coordinates.</span>
        <span class="n">vecangle</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arctan2</span><span class="p">(</span><span class="n">yn</span><span class="o">-</span><span class="n">y</span><span class="p">,</span> <span class="n">xn</span><span class="o">-</span><span class="n">x</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">somenorth</span><span class="p">:</span>
            <span class="n">vecangle</span><span class="p">[</span><span class="n">farnorth</span><span class="p">]</span> <span class="o">+=</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span>

        <span class="c1"># Compute the x-y components of the original vector.</span>
        <span class="n">uvcout</span> <span class="o">=</span> <span class="n">uvmag</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="mi">1</span><span class="n">j</span><span class="o">*</span><span class="n">vecangle</span><span class="p">)</span>
        <span class="n">uout</span> <span class="o">=</span> <span class="n">uvcout</span><span class="o">.</span><span class="n">real</span>
        <span class="n">vout</span> <span class="o">=</span> <span class="n">uvcout</span><span class="o">.</span><span class="n">imag</span>

        <span class="k">if</span> <span class="n">masked</span><span class="p">:</span>
            <span class="n">uout</span> <span class="o">=</span> <span class="n">ma</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">uout</span><span class="p">,</span> <span class="n">mask</span><span class="o">=</span><span class="n">mask</span><span class="p">)</span>
            <span class="n">vout</span> <span class="o">=</span> <span class="n">ma</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">vout</span><span class="p">,</span> <span class="n">mask</span><span class="o">=</span><span class="n">mask</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">returnxy</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">uout</span><span class="p">,</span><span class="n">vout</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="n">y</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">uout</span><span class="p">,</span><span class="n">vout</span></div>


<div class="viewcode-block" id="Basemap.set_axes_limits">
<a class="viewcode-back" href="../../api/basemap_api.html#mpl_toolkits.basemap.Basemap.set_axes_limits">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">set_axes_limits</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Final step in Basemap method wrappers of Axes plotting methods:</span>

<span class="sd">        Set axis limits, fix aspect ratio for map domain using current</span>
<span class="sd">        or specified axes instance.  This is done only once per axes</span>
<span class="sd">        instance.</span>

<span class="sd">        In interactive mode, this method always calls draw_if_interactive</span>
<span class="sd">        before returning.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># get current axes instance (if none specified).</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="n">ax</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check_ax</span><span class="p">()</span>

        <span class="c1"># If we have already set the axes limits, and if the user</span>
        <span class="c1"># has not defeated this by turning autoscaling back on,</span>
        <span class="c1"># then all we need to do is plot if interactive.</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">hash</span><span class="p">(</span><span class="n">ax</span><span class="p">)</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_initialized_axes</span>
                                 <span class="ow">and</span> <span class="ow">not</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_autoscalex_on</span><span class="p">()</span>
                                 <span class="ow">and</span> <span class="ow">not</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_autoscaley_on</span><span class="p">()):</span>
            <span class="k">if</span> <span class="n">mpl</span><span class="o">.</span><span class="n">is_interactive</span><span class="p">():</span>
                <span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">draw_if_interactive</span><span class="p">()</span>
            <span class="k">return</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_initialized_axes</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="nb">hash</span><span class="p">(</span><span class="n">ax</span><span class="p">))</span>
        <span class="c1"># Take control of axis scaling:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_autoscale_on</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="c1"># update data limits for map domain.</span>
        <span class="n">corners</span> <span class="o">=</span> <span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">llcrnrx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">llcrnry</span><span class="p">),</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">urcrnrx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">urcrnry</span><span class="p">))</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">update_datalim</span><span class="p">(</span><span class="n">corners</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">llcrnrx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">urcrnrx</span><span class="p">))</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">llcrnry</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">urcrnry</span><span class="p">))</span>
        <span class="c1"># if map boundary not yet drawn for elliptical maps, draw it with default values.</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mapboundarydrawn</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mapboundarydrawn</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">ax</span><span class="o">.</span><span class="n">patches</span><span class="p">:</span>
            <span class="c1"># elliptical map, draw boundary manually.</span>
            <span class="k">if</span> <span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">projection</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;ortho&#39;</span><span class="p">,</span> <span class="s1">&#39;geos&#39;</span><span class="p">,</span> <span class="s1">&#39;nsper&#39;</span><span class="p">,</span> <span class="s1">&#39;aeqd&#39;</span><span class="p">]</span> <span class="ow">and</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_fulldisk</span><span class="p">)</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">round</span> <span class="ow">or</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">projection</span> <span class="ow">in</span> <span class="n">_pseudocyl</span><span class="p">):</span>
                <span class="c1"># first draw boundary, no fill</span>
                <span class="n">limb1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">drawmapboundary</span><span class="p">(</span><span class="n">fill_color</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
                <span class="c1"># draw another filled patch, with no boundary.</span>
                <span class="n">limb2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">drawmapboundary</span><span class="p">(</span><span class="n">fill_color</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_mapboundarydrawn</span> <span class="o">=</span> <span class="n">limb2</span>
        <span class="c1"># for elliptical map, always turn off axis_frame.</span>
        <span class="k">if</span> <span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">projection</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;ortho&#39;</span><span class="p">,</span> <span class="s1">&#39;geos&#39;</span><span class="p">,</span> <span class="s1">&#39;nsper&#39;</span><span class="p">,</span> <span class="s1">&#39;aeqd&#39;</span><span class="p">]</span> <span class="ow">and</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_fulldisk</span><span class="p">)</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">round</span> <span class="ow">or</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">projection</span> <span class="ow">in</span> <span class="n">_pseudocyl</span><span class="p">):</span>
            <span class="c1"># turn off axes frame.</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_frame_on</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="c1"># make sure aspect ratio of map preserved.</span>
        <span class="c1"># plot is re-centered in bounding rectangle.</span>
        <span class="c1"># (anchor instance var determines where plot is placed)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">fix_aspect</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_aspect</span><span class="p">(</span><span class="s1">&#39;equal&#39;</span><span class="p">,</span><span class="n">anchor</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">anchor</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_aspect</span><span class="p">(</span><span class="s1">&#39;auto&#39;</span><span class="p">,</span><span class="n">anchor</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">anchor</span><span class="p">)</span>
        <span class="c1"># make sure axis ticks are turned off.</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">noticks</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">([])</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">([])</span>
        <span class="c1"># force draw if in interactive mode.</span>
        <span class="k">if</span> <span class="n">mpl</span><span class="o">.</span><span class="n">is_interactive</span><span class="p">():</span>
            <span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">draw_if_interactive</span><span class="p">()</span></div>


    <span class="k">def</span><span class="w"> </span><span class="nf">_save_use_hold</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ax</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">):</span>
        <span class="n">h</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;hold&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="s1">&#39;_hold&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_tmp_hold</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">_hold</span>
            <span class="k">if</span> <span class="n">h</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">_hold</span> <span class="o">=</span> <span class="n">h</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_restore_hold</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ax</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="s1">&#39;_hold&#39;</span><span class="p">):</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">_hold</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tmp_hold</span>

<div class="viewcode-block" id="Basemap.scatter">
<a class="viewcode-back" href="../../api/basemap_api.html#mpl_toolkits.basemap.Basemap.scatter">[docs]</a>
    <span class="nd">@_transform1d</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">scatter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Plot points with markers on the map</span>
<span class="sd">        (see matplotlib.pyplot.scatter documentation).</span>

<span class="sd">        If ``latlon`` keyword is set to True, x,y are intrepreted as</span>
<span class="sd">        longitude and latitude in degrees.  Data and longitudes are</span>
<span class="sd">        automatically shifted to match map projection region for cylindrical</span>
<span class="sd">        and pseudocylindrical projections, and x,y are transformed to map</span>
<span class="sd">        projection coordinates. If ``latlon`` is False (default), x and y</span>
<span class="sd">        are assumed to be map projection coordinates.</span>

<span class="sd">        Extra keyword ``ax`` can be used to override the default axes instance.</span>

<span class="sd">        Other \**kwargs passed on to matplotlib.pyplot.scatter.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">ax</span><span class="p">,</span> <span class="n">plt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ax_plt_from_kw</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_save_use_hold</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">ret</span> <span class="o">=</span>  <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_restore_hold</span><span class="p">(</span><span class="n">ax</span><span class="p">)</span>
        <span class="c1"># reset current active image (only if pyplot is imported).</span>
        <span class="k">if</span> <span class="n">plt</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">sci</span><span class="p">(</span><span class="n">ret</span><span class="p">)</span>
        <span class="c1"># set axes limits to fit map region.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_axes_limits</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
        <span class="c1"># clip to map limbs</span>
        <span class="n">ret</span><span class="p">,</span><span class="n">c</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cliplimb</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span><span class="n">ret</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">ret</span></div>


<div class="viewcode-block" id="Basemap.plot">
<a class="viewcode-back" href="../../api/basemap_api.html#mpl_toolkits.basemap.Basemap.plot">[docs]</a>
    <span class="nd">@_transform1d</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">plot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Draw lines and/or markers on the map</span>
<span class="sd">        (see matplotlib.pyplot.plot documentation).</span>

<span class="sd">        If ``latlon`` keyword is set to True, x,y are intrepreted as</span>
<span class="sd">        longitude and latitude in degrees.  Data and longitudes are</span>
<span class="sd">        automatically shifted to match map projection region for cylindrical</span>
<span class="sd">        and pseudocylindrical projections, and x,y are transformed to map</span>
<span class="sd">        projection coordinates. If ``latlon`` is False (default), x and y</span>
<span class="sd">        are assumed to be map projection coordinates.</span>

<span class="sd">        Extra keyword ``ax`` can be used to override the default axis instance.</span>

<span class="sd">        Other \**kwargs passed on to matplotlib.pyplot.plot.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;ax&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check_ax</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_save_use_hold</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">ret</span> <span class="o">=</span>  <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_restore_hold</span><span class="p">(</span><span class="n">ax</span><span class="p">)</span>
        <span class="c1"># set axes limits to fit map region.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_axes_limits</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
        <span class="c1"># clip to map limbs</span>
        <span class="n">ret</span><span class="p">,</span><span class="n">c</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cliplimb</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span><span class="n">ret</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">ret</span></div>


<div class="viewcode-block" id="Basemap.imshow">
<a class="viewcode-back" href="../../api/basemap_api.html#mpl_toolkits.basemap.Basemap.imshow">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">imshow</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Display an image over the map</span>
<span class="sd">        (see matplotlib.pyplot.imshow documentation).</span>

<span class="sd">        ``extent`` and ``origin`` keywords set automatically so image</span>
<span class="sd">        will be drawn over map region.</span>

<span class="sd">        Extra keyword ``ax`` can be used to override the default axis instance.</span>

<span class="sd">        Other \**kwargs passed on to matplotlib.pyplot.plot.</span>

<span class="sd">        returns an matplotlib.image.AxesImage instance.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">ax</span><span class="p">,</span> <span class="n">plt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ax_plt_from_kw</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;extent&#39;</span><span class="p">]</span><span class="o">=</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">llcrnrx</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">urcrnrx</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">llcrnry</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">urcrnry</span><span class="p">)</span>
        <span class="c1"># use origin=&#39;lower&#39;, unless overridden.</span>
        <span class="k">if</span> <span class="s1">&#39;origin&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;origin&#39;</span><span class="p">]</span><span class="o">=</span><span class="s1">&#39;lower&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_save_use_hold</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">warnings</span><span class="o">.</span><span class="n">catch_warnings</span><span class="p">():</span>
                <span class="n">warnings</span><span class="o">.</span><span class="n">simplefilter</span><span class="p">(</span><span class="s2">&quot;ignore&quot;</span><span class="p">,</span> <span class="n">category</span><span class="o">=</span><span class="ne">DeprecationWarning</span><span class="p">)</span>
                <span class="n">ret</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_restore_hold</span><span class="p">(</span><span class="n">ax</span><span class="p">)</span>
        <span class="c1"># reset current active image (only if pyplot is imported).</span>
        <span class="k">if</span> <span class="n">plt</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">sci</span><span class="p">(</span><span class="n">ret</span><span class="p">)</span>
        <span class="c1"># set axes limits to fit map region.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_axes_limits</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
        <span class="c1"># clip image to map limbs</span>
        <span class="n">ret</span><span class="p">,</span><span class="n">c</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cliplimb</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span><span class="n">ret</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">ret</span></div>


<div class="viewcode-block" id="Basemap.pcolor">
<a class="viewcode-back" href="../../api/basemap_api.html#mpl_toolkits.basemap.Basemap.pcolor">[docs]</a>
    <span class="nd">@_transform</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">pcolor</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">data</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Make a pseudo-color plot over the map</span>
<span class="sd">        (see matplotlib.pyplot.pcolor documentation).</span>

<span class="sd">        If ``latlon`` keyword is set to True, x,y are intrepreted as</span>
<span class="sd">        longitude and latitude in degrees.  Data and longitudes are</span>
<span class="sd">        automatically shifted to match map projection region for cylindrical</span>
<span class="sd">        and pseudocylindrical projections, and x,y are transformed to map</span>
<span class="sd">        projection coordinates. If ``latlon`` is False (default), x and y</span>
<span class="sd">        are assumed to be map projection coordinates.</span>

<span class="sd">        If x or y are outside projection limb (i.e. they have values &gt; 1.e20)</span>
<span class="sd">        they will be convert to masked arrays with those values masked.</span>
<span class="sd">        As a result, those values will not be plotted.</span>

<span class="sd">        If ``tri`` is set to ``True``, an unstructured grid is assumed</span>
<span class="sd">        (x,y,data must be 1-d) and matplotlib.pyplot.tripcolor is used.</span>

<span class="sd">        Extra keyword ``ax`` can be used to override the default axis instance.</span>

<span class="sd">        Other \**kwargs passed on to matplotlib.pyplot.pcolor (or tripcolor if</span>
<span class="sd">        ``tri=True``).</span>

<span class="sd">        Note: (taken from matplotlib.pyplot.pcolor documentation)</span>
<span class="sd">        Ideally the dimensions of x and y should be one greater than those of data;</span>
<span class="sd">        if the dimensions are the same, then the last row and column of data will be ignored.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">ax</span><span class="p">,</span> <span class="n">plt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ax_plt_from_kw</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_save_use_hold</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;tri&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
                <span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.tri</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">tri</span>
                <span class="c1"># for unstructured grids, toss out points outside</span>
                <span class="c1"># projection limb (don&#39;t use those points in triangulation).</span>
                <span class="k">if</span> <span class="n">ma</span><span class="o">.</span><span class="n">isMA</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
                    <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">filled</span><span class="p">(</span><span class="n">fill_value</span><span class="o">=</span><span class="mf">1.e30</span><span class="p">)</span>
                    <span class="n">masked</span><span class="o">=</span><span class="kc">True</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">masked</span><span class="o">=</span><span class="kc">False</span>
                <span class="n">mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logical_or</span><span class="p">(</span><span class="n">x</span><span class="o">&lt;</span><span class="mf">1.e20</span><span class="p">,</span><span class="n">y</span><span class="o">&lt;</span><span class="mf">1.e20</span><span class="p">)</span>
                <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">compress</span><span class="p">(</span><span class="n">mask</span><span class="p">,</span><span class="n">x</span><span class="p">)</span>
                <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">compress</span><span class="p">(</span><span class="n">mask</span><span class="p">,</span><span class="n">y</span><span class="p">)</span>
                <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">compress</span><span class="p">(</span><span class="n">mask</span><span class="p">,</span><span class="n">data</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">masked</span><span class="p">:</span>
                    <span class="n">triang</span> <span class="o">=</span> <span class="n">tri</span><span class="o">.</span><span class="n">Triangulation</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
                    <span class="n">z</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">triang</span><span class="o">.</span><span class="n">triangles</span><span class="p">]</span>
                    <span class="n">mask</span> <span class="o">=</span> <span class="p">(</span><span class="n">z</span> <span class="o">&gt;</span> <span class="mf">1.e20</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
                    <span class="n">triang</span><span class="o">.</span><span class="n">set_mask</span><span class="p">(</span><span class="n">mask</span><span class="p">)</span>
                    <span class="n">ret</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">tripcolor</span><span class="p">(</span><span class="n">triang</span><span class="p">,</span><span class="n">data</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">ret</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">tripcolor</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">data</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># make x,y masked arrays</span>
                <span class="c1"># (masked where data is outside of projection limb)</span>
                <span class="n">x</span> <span class="o">=</span> <span class="n">ma</span><span class="o">.</span><span class="n">masked_values</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">x</span> <span class="o">&gt;</span> <span class="mf">1.e20</span><span class="p">,</span><span class="mf">1.e20</span><span class="p">,</span><span class="n">x</span><span class="p">),</span> <span class="mf">1.e20</span><span class="p">)</span>
                <span class="n">y</span> <span class="o">=</span> <span class="n">ma</span><span class="o">.</span><span class="n">masked_values</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">y</span> <span class="o">&gt;</span> <span class="mf">1.e20</span><span class="p">,</span><span class="mf">1.e20</span><span class="p">,</span><span class="n">y</span><span class="p">),</span> <span class="mf">1.e20</span><span class="p">)</span>
                <span class="n">ret</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">pcolor</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">data</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_restore_hold</span><span class="p">(</span><span class="n">ax</span><span class="p">)</span>
        <span class="c1"># reset current active image (only if pyplot is imported).</span>
        <span class="k">if</span> <span class="n">plt</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">sci</span><span class="p">(</span><span class="n">ret</span><span class="p">)</span>
        <span class="c1"># set axes limits to fit map region.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_axes_limits</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
        <span class="c1"># clip to map limbs</span>
        <span class="n">ret</span><span class="p">,</span><span class="n">c</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cliplimb</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span><span class="n">ret</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">round</span><span class="p">:</span>
            <span class="c1"># for some reason, frame gets turned on.</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_frame_on</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">ret</span></div>


<div class="viewcode-block" id="Basemap.pcolormesh">
<a class="viewcode-back" href="../../api/basemap_api.html#mpl_toolkits.basemap.Basemap.pcolormesh">[docs]</a>
    <span class="nd">@_transform</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">pcolormesh</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">data</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Make a pseudo-color plot over the map</span>
<span class="sd">        (see matplotlib.pyplot.pcolormesh documentation).</span>

<span class="sd">        If ``latlon`` keyword is set to True, x,y are intrepreted as</span>
<span class="sd">        longitude and latitude in degrees.  Data and longitudes are</span>
<span class="sd">        automatically shifted to match map projection region for cylindrical</span>
<span class="sd">        and pseudocylindrical projections, and x,y are transformed to map</span>
<span class="sd">        projection coordinates. If ``latlon`` is False (default), x and y</span>
<span class="sd">        are assumed to be map projection coordinates.</span>

<span class="sd">        Extra keyword ``ax`` can be used to override the default axis instance.</span>

<span class="sd">        Other \**kwargs passed on to matplotlib.pyplot.pcolormesh.</span>

<span class="sd">        Note: (taken from matplotlib.pyplot.pcolor documentation)</span>
<span class="sd">        Ideally the dimensions of x and y should be one greater than those of data;</span>
<span class="sd">        if the dimensions are the same, then the last row and column of data will be ignored.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">ax</span><span class="p">,</span> <span class="n">plt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ax_plt_from_kw</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="c1"># fix for invalid grid points</span>
        <span class="k">if</span> <span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">x</span> <span class="o">&gt;</span> <span class="mf">1e20</span><span class="p">)</span> <span class="ow">or</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">y</span> <span class="o">&gt;</span> <span class="mf">1e20</span><span class="p">))</span> <span class="ow">and</span>
            <span class="n">x</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">2</span> <span class="ow">and</span> <span class="n">y</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">2</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">x</span><span class="o">.</span><span class="n">shape</span> <span class="o">!=</span> <span class="n">y</span><span class="o">.</span><span class="n">shape</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;pcolormesh: x and y need same dimension&#39;</span><span class="p">)</span>
            <span class="n">nx</span><span class="p">,</span><span class="n">ny</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">shape</span>
            <span class="k">if</span> <span class="n">nx</span> <span class="o">&lt;</span> <span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">or</span> <span class="n">ny</span> <span class="o">&lt;</span> <span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;pcolormesh: data dimension needs to be at least that of x and y.&#39;</span><span class="p">)</span>
            <span class="n">mask</span> <span class="o">=</span> <span class="p">(</span>
                <span class="p">(</span><span class="n">x</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">,:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mf">1e20</span><span class="p">)</span> <span class="o">|</span>
                <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">:,:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mf">1e20</span><span class="p">)</span> <span class="o">|</span>
                <span class="p">(</span><span class="n">x</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">:]</span> <span class="o">&gt;</span> <span class="mf">1e20</span><span class="p">)</span> <span class="o">|</span>
                <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">:,</span><span class="mi">1</span><span class="p">:]</span> <span class="o">&gt;</span> <span class="mf">1e20</span><span class="p">)</span> <span class="o">|</span>
                <span class="p">(</span><span class="n">y</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">,:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mf">1e20</span><span class="p">)</span> <span class="o">|</span>
                <span class="p">(</span><span class="n">y</span><span class="p">[</span><span class="mi">1</span><span class="p">:,:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mf">1e20</span><span class="p">)</span> <span class="o">|</span>
                <span class="p">(</span><span class="n">y</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">:]</span> <span class="o">&gt;</span> <span class="mf">1e20</span><span class="p">)</span> <span class="o">|</span>
                <span class="p">(</span><span class="n">y</span><span class="p">[</span><span class="mi">1</span><span class="p">:,</span><span class="mi">1</span><span class="p">:]</span> <span class="o">&gt;</span> <span class="mf">1e20</span><span class="p">)</span>
                <span class="p">)</span>
            <span class="c1"># we do not want to overwrite original array</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="p">[:</span><span class="n">nx</span><span class="o">-</span><span class="mi">1</span><span class="p">,:</span><span class="n">ny</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="n">data</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_save_use_hold</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">ret</span> <span class="o">=</span>  <span class="n">ax</span><span class="o">.</span><span class="n">pcolormesh</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">data</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_restore_hold</span><span class="p">(</span><span class="n">ax</span><span class="p">)</span>
        <span class="c1"># reset current active image (only if pyplot is imported).</span>
        <span class="k">if</span> <span class="n">plt</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">sci</span><span class="p">(</span><span class="n">ret</span><span class="p">)</span>
        <span class="c1"># set axes limits to fit map region.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_axes_limits</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
        <span class="c1"># clip to map limbs</span>
        <span class="n">ret</span><span class="p">,</span><span class="n">c</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cliplimb</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span><span class="n">ret</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">round</span><span class="p">:</span>
            <span class="c1"># for some reason, frame gets turned on.</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_frame_on</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">ret</span></div>


<div class="viewcode-block" id="Basemap.hexbin">
<a class="viewcode-back" href="../../api/basemap_api.html#mpl_toolkits.basemap.Basemap.hexbin">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">hexbin</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Make a hexagonal binning plot of x versus y, where x, y are 1-D</span>
<span class="sd">        sequences of the same length, N. If C is None (the default), this is a</span>
<span class="sd">        histogram of the number of occurences of the observations at</span>
<span class="sd">        (x[i],y[i]).</span>

<span class="sd">        If C is specified, it specifies values at the coordinate (x[i],y[i]).</span>
<span class="sd">        These values are accumulated for each hexagonal bin and then reduced</span>
<span class="sd">        according to reduce_C_function, which defaults to the numpy mean function</span>
<span class="sd">        (np.mean). (If C is specified, it must also be a 1-D sequence of the</span>
<span class="sd">        same length as x and y.)</span>

<span class="sd">        x, y and/or C may be masked arrays, in which case only unmasked points</span>
<span class="sd">        will be plotted.</span>

<span class="sd">        (see matplotlib.pyplot.hexbin documentation).</span>

<span class="sd">        Extra keyword ``ax`` can be used to override the default axis instance.</span>

<span class="sd">        Other \**kwargs passed on to matplotlib.pyplot.hexbin</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">ax</span><span class="p">,</span> <span class="n">plt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ax_plt_from_kw</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_save_use_hold</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># make x,y masked arrays</span>
            <span class="c1"># (masked where data is outside of projection limb)</span>
            <span class="n">x</span> <span class="o">=</span> <span class="n">ma</span><span class="o">.</span><span class="n">masked_values</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">x</span> <span class="o">&gt;</span> <span class="mf">1.e20</span><span class="p">,</span><span class="mf">1.e20</span><span class="p">,</span><span class="n">x</span><span class="p">),</span> <span class="mf">1.e20</span><span class="p">)</span>
            <span class="n">y</span> <span class="o">=</span> <span class="n">ma</span><span class="o">.</span><span class="n">masked_values</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">y</span> <span class="o">&gt;</span> <span class="mf">1.e20</span><span class="p">,</span><span class="mf">1.e20</span><span class="p">,</span><span class="n">y</span><span class="p">),</span> <span class="mf">1.e20</span><span class="p">)</span>
            <span class="n">ret</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">hexbin</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_restore_hold</span><span class="p">(</span><span class="n">ax</span><span class="p">)</span>
        <span class="c1"># reset current active image (only if pyplot is imported).</span>
        <span class="k">if</span> <span class="n">plt</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">sci</span><span class="p">(</span><span class="n">ret</span><span class="p">)</span>
        <span class="c1"># set axes limits to fit map region.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_axes_limits</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
        <span class="c1"># clip to map limbs</span>
        <span class="n">ret</span><span class="p">,</span><span class="n">c</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cliplimb</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span><span class="n">ret</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">ret</span></div>


<div class="viewcode-block" id="Basemap.contour">
<a class="viewcode-back" href="../../api/basemap_api.html#mpl_toolkits.basemap.Basemap.contour">[docs]</a>
    <span class="nd">@_transform</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">contour</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">data</span><span class="p">,</span><span class="o">*</span><span class="n">args</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Make a contour plot over the map</span>
<span class="sd">        (see matplotlib.pyplot.contour documentation).</span>

<span class="sd">        If ``latlon`` keyword is set to True, x,y are intrepreted as</span>
<span class="sd">        longitude and latitude in degrees.  Data and longitudes are</span>
<span class="sd">        automatically shifted to match map projection region for cylindrical</span>
<span class="sd">        and pseudocylindrical projections, and x,y are transformed to map</span>
<span class="sd">        projection coordinates. If ``latlon`` is False (default), x and y</span>
<span class="sd">        are assumed to be map projection coordinates.</span>

<span class="sd">        Extra keyword ``ax`` can be used to override the default axis instance.</span>

<span class="sd">        If ``tri`` is set to ``True``, an unstructured grid is assumed</span>
<span class="sd">        (x,y,data must be 1-d) and matplotlib.pyplot.tricontour is used.</span>

<span class="sd">        Other \*args and \**kwargs passed on to matplotlib.pyplot.contour</span>
<span class="sd">        (or tricontour if ``tri=True``).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">ax</span><span class="p">,</span> <span class="n">plt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ax_plt_from_kw</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_save_use_hold</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;tri&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
                <span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.tri</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">tri</span>
                <span class="c1"># for unstructured grids, toss out points outside</span>
                <span class="c1"># projection limb (don&#39;t use those points in triangulation).</span>
                <span class="k">if</span> <span class="n">ma</span><span class="o">.</span><span class="n">isMA</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
                    <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">filled</span><span class="p">(</span><span class="n">fill_value</span><span class="o">=</span><span class="mf">1.e30</span><span class="p">)</span>
                    <span class="n">masked</span><span class="o">=</span><span class="kc">True</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">masked</span><span class="o">=</span><span class="kc">False</span>
                <span class="n">mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logical_or</span><span class="p">(</span><span class="n">x</span><span class="o">&lt;</span><span class="bp">self</span><span class="o">.</span><span class="n">xmin</span><span class="p">,</span><span class="n">y</span><span class="o">&lt;</span><span class="bp">self</span><span class="o">.</span><span class="n">xmin</span><span class="p">)</span> <span class="o">+</span>\
                       <span class="n">np</span><span class="o">.</span><span class="n">logical_or</span><span class="p">(</span><span class="n">x</span><span class="o">&gt;</span><span class="bp">self</span><span class="o">.</span><span class="n">xmax</span><span class="p">,</span><span class="n">y</span><span class="o">&gt;</span><span class="bp">self</span><span class="o">.</span><span class="n">xmax</span><span class="p">)</span>
                <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">compress</span><span class="p">(</span><span class="n">mask</span><span class="p">,</span><span class="n">x</span><span class="p">)</span>
                <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">compress</span><span class="p">(</span><span class="n">mask</span><span class="p">,</span><span class="n">y</span><span class="p">)</span>
                <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">compress</span><span class="p">(</span><span class="n">mask</span><span class="p">,</span><span class="n">data</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">masked</span><span class="p">:</span>
                    <span class="n">triang</span> <span class="o">=</span> <span class="n">tri</span><span class="o">.</span><span class="n">Triangulation</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
                    <span class="n">z</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">triang</span><span class="o">.</span><span class="n">triangles</span><span class="p">]</span>
                    <span class="n">mask</span> <span class="o">=</span> <span class="p">(</span><span class="n">z</span> <span class="o">&gt;</span> <span class="mf">1.e20</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
                    <span class="n">triang</span><span class="o">.</span><span class="n">set_mask</span><span class="p">(</span><span class="n">mask</span><span class="p">)</span>
                    <span class="n">CS</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">tricontour</span><span class="p">(</span><span class="n">triang</span><span class="p">,</span><span class="n">data</span><span class="p">,</span><span class="o">*</span><span class="n">args</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">CS</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">tricontour</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">data</span><span class="p">,</span><span class="o">*</span><span class="n">args</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># make sure x is monotonically increasing - if not,</span>
                <span class="c1"># print warning suggesting that the data be shifted in longitude</span>
                <span class="c1"># with the shiftgrid function.</span>
                <span class="c1"># only do this check for global projections.</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">projection</span> <span class="ow">in</span> <span class="n">_cylproj</span> <span class="o">+</span> <span class="n">_pseudocyl</span><span class="p">:</span>
                    <span class="n">xx</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">//</span><span class="mi">2</span><span class="p">,:]</span>
                    <span class="n">condition</span> <span class="o">=</span> <span class="p">(</span><span class="n">xx</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">xmin</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">xx</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">xmax</span><span class="p">)</span>
                    <span class="n">xl</span> <span class="o">=</span> <span class="n">xx</span><span class="o">.</span><span class="n">compress</span><span class="p">(</span><span class="n">condition</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
                    <span class="n">xs</span> <span class="o">=</span> <span class="n">xl</span><span class="p">[:]</span>
                    <span class="n">xs</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
                    <span class="k">if</span> <span class="n">xl</span> <span class="o">!=</span> <span class="n">xs</span><span class="p">:</span>
                        <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span>
                            <span class="s2">&quot;WARNING: x coordinate not montonically increasing&quot;</span><span class="p">,</span>
                            <span class="s2">&quot;- contour plot may not be what you expect. If it&quot;</span><span class="p">,</span>
                            <span class="s2">&quot;looks odd, you can either adjust the map projection&quot;</span><span class="p">,</span>
                            <span class="s2">&quot;region to be consistent with your data, or (if your&quot;</span><span class="p">,</span>
                            <span class="s2">&quot;data is on a global lat/lon grid) use the shiftdata&quot;</span><span class="p">,</span>
                            <span class="s2">&quot;method to adjust the data to be consistent with the&quot;</span><span class="p">,</span>
                            <span class="s2">&quot;map projection region (see doc/examples/shiftdata.py)&quot;</span><span class="p">]))</span>
                <span class="c1"># mask for points more than one grid length outside projection limb.</span>
                <span class="n">xx</span> <span class="o">=</span> <span class="n">ma</span><span class="o">.</span><span class="n">masked_where</span><span class="p">(</span><span class="n">x</span> <span class="o">&gt;</span> <span class="mf">1.e20</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
                <span class="n">yy</span> <span class="o">=</span> <span class="n">ma</span><span class="o">.</span><span class="n">masked_where</span><span class="p">(</span><span class="n">y</span> <span class="o">&gt;</span> <span class="mf">1.e20</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
                <span class="n">epsx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">xx</span><span class="p">[:,</span><span class="mi">1</span><span class="p">:]</span><span class="o">-</span><span class="n">xx</span><span class="p">[:,</span><span class="mi">0</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
                <span class="n">epsy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">yy</span><span class="p">[</span><span class="mi">1</span><span class="p">:,:]</span><span class="o">-</span><span class="n">yy</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">,:])</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
                <span class="n">xymask</span> <span class="o">=</span> \
                <span class="n">np</span><span class="o">.</span><span class="n">logical_or</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">greater</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">xmax</span><span class="o">+</span><span class="n">epsx</span><span class="p">),</span><span class="n">np</span><span class="o">.</span><span class="n">greater</span><span class="p">(</span><span class="n">y</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">ymax</span><span class="o">+</span><span class="n">epsy</span><span class="p">))</span>
                <span class="n">xymask</span> <span class="o">=</span> <span class="n">xymask</span> <span class="o">+</span> \
                <span class="n">np</span><span class="o">.</span><span class="n">logical_or</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">less</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">xmin</span><span class="o">-</span><span class="n">epsx</span><span class="p">),</span><span class="n">np</span><span class="o">.</span><span class="n">less</span><span class="p">(</span><span class="n">y</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">ymin</span><span class="o">-</span><span class="n">epsy</span><span class="p">))</span>
                <span class="n">data</span> <span class="o">=</span> <span class="n">ma</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
                <span class="c1"># combine with data mask.</span>
                <span class="n">mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logical_or</span><span class="p">(</span><span class="n">ma</span><span class="o">.</span><span class="n">getmaskarray</span><span class="p">(</span><span class="n">data</span><span class="p">),</span><span class="n">xymask</span><span class="p">)</span>
                <span class="n">data</span> <span class="o">=</span> <span class="n">ma</span><span class="o">.</span><span class="n">masked_array</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="n">mask</span><span class="o">=</span><span class="n">mask</span><span class="p">)</span>
                <span class="n">CS</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">contour</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">data</span><span class="p">,</span><span class="o">*</span><span class="n">args</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_restore_hold</span><span class="p">(</span><span class="n">ax</span><span class="p">)</span>
        <span class="c1"># reset current active image (only if pyplot is imported).</span>
        <span class="k">if</span> <span class="n">plt</span> <span class="ow">and</span> <span class="n">CS</span><span class="o">.</span><span class="n">get_array</span><span class="p">()</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">sci</span><span class="p">(</span><span class="n">CS</span><span class="p">)</span>
        <span class="c1"># set axes limits to fit map region.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_axes_limits</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
        <span class="c1"># clip to map limbs</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">CS</span><span class="p">,</span> <span class="n">Artist</span><span class="p">):</span>
            <span class="c1"># Since MPL 3.8, `QuadContourSet` objects are `Artist` objects too.</span>
            <span class="n">CS</span><span class="p">,</span> <span class="n">c</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cliplimb</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">CS</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">CS</span><span class="o">.</span><span class="n">collections</span><span class="p">,</span> <span class="n">c</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cliplimb</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">CS</span><span class="o">.</span><span class="n">collections</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">CS</span></div>


<div class="viewcode-block" id="Basemap.contourf">
<a class="viewcode-back" href="../../api/basemap_api.html#mpl_toolkits.basemap.Basemap.contourf">[docs]</a>
    <span class="nd">@_transform</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">contourf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">data</span><span class="p">,</span><span class="o">*</span><span class="n">args</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Make a filled contour plot over the map</span>
<span class="sd">        (see matplotlib.pyplot.contourf documentation).</span>

<span class="sd">        If ``latlon`` keyword is set to True, x,y are intrepreted as</span>
<span class="sd">        longitude and latitude in degrees.  Data and longitudes are</span>
<span class="sd">        automatically shifted to match map projection region for cylindrical</span>
<span class="sd">        and pseudocylindrical projections, and x,y are transformed to map</span>
<span class="sd">        projection coordinates. If ``latlon`` is False (default), x and y</span>
<span class="sd">        are assumed to be map projection coordinates.</span>

<span class="sd">        If x or y are outside projection limb (i.e. they have values &gt; 1.e20),</span>
<span class="sd">        the corresponing data elements will be masked.</span>

<span class="sd">        Extra keyword &#39;ax&#39; can be used to override the default axis instance.</span>

<span class="sd">        If ``tri`` is set to ``True``, an unstructured grid is assumed</span>
<span class="sd">        (x,y,data must be 1-d) and matplotlib.pyplot.tricontourf is used.</span>

<span class="sd">        Other \*args and \**kwargs passed on to matplotlib.pyplot.contourf</span>
<span class="sd">        (or tricontourf if ``tri=True``).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">ax</span><span class="p">,</span> <span class="n">plt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ax_plt_from_kw</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_save_use_hold</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;tri&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
                <span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.tri</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">tri</span>
                <span class="c1"># for unstructured grids, toss out points outside</span>
                <span class="c1"># projection limb (don&#39;t use those points in triangulation).</span>
                <span class="k">if</span> <span class="n">ma</span><span class="o">.</span><span class="n">isMA</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
                    <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">filled</span><span class="p">(</span><span class="n">fill_value</span><span class="o">=</span><span class="mf">1.e30</span><span class="p">)</span>
                    <span class="n">masked</span><span class="o">=</span><span class="kc">True</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">masked</span><span class="o">=</span><span class="kc">False</span>
                <span class="n">mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logical_or</span><span class="p">(</span><span class="n">x</span><span class="o">&lt;</span><span class="mf">1.e20</span><span class="p">,</span><span class="n">y</span><span class="o">&lt;</span><span class="mf">1.e20</span><span class="p">)</span>
                <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">compress</span><span class="p">(</span><span class="n">mask</span><span class="p">,</span><span class="n">x</span><span class="p">)</span>
                <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">compress</span><span class="p">(</span><span class="n">mask</span><span class="p">,</span><span class="n">y</span><span class="p">)</span>
                <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">compress</span><span class="p">(</span><span class="n">mask</span><span class="p">,</span><span class="n">data</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">masked</span><span class="p">:</span>
                    <span class="n">triang</span> <span class="o">=</span> <span class="n">tri</span><span class="o">.</span><span class="n">Triangulation</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
                    <span class="n">z</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">triang</span><span class="o">.</span><span class="n">triangles</span><span class="p">]</span>
                    <span class="n">mask</span> <span class="o">=</span> <span class="p">(</span><span class="n">z</span> <span class="o">&gt;</span> <span class="mf">1.e20</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
                    <span class="n">triang</span><span class="o">.</span><span class="n">set_mask</span><span class="p">(</span><span class="n">mask</span><span class="p">)</span>
                    <span class="n">CS</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">tricontourf</span><span class="p">(</span><span class="n">triang</span><span class="p">,</span><span class="n">data</span><span class="p">,</span><span class="o">*</span><span class="n">args</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">CS</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">tricontourf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">data</span><span class="p">,</span><span class="o">*</span><span class="n">args</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># make sure x is monotonically increasing - if not,</span>
                <span class="c1"># print warning suggesting that the data be shifted in longitude</span>
                <span class="c1"># with the shiftgrid function.</span>
                <span class="c1"># only do this check for global projections.</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">projection</span> <span class="ow">in</span> <span class="n">_cylproj</span> <span class="o">+</span> <span class="n">_pseudocyl</span><span class="p">:</span>
                    <span class="n">xx</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">//</span><span class="mi">2</span><span class="p">,:]</span>
                    <span class="n">condition</span> <span class="o">=</span> <span class="p">(</span><span class="n">xx</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">xmin</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">xx</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">xmax</span><span class="p">)</span>
                    <span class="n">xl</span> <span class="o">=</span> <span class="n">xx</span><span class="o">.</span><span class="n">compress</span><span class="p">(</span><span class="n">condition</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
                    <span class="n">xs</span> <span class="o">=</span> <span class="n">xl</span><span class="p">[:]</span>
                    <span class="n">xs</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
                    <span class="k">if</span> <span class="n">xl</span> <span class="o">!=</span> <span class="n">xs</span><span class="p">:</span>
                        <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span>
                            <span class="s2">&quot;WARNING: x coordinate not montonically increasing&quot;</span><span class="p">,</span>
                            <span class="s2">&quot;- contour plot may not be what you expect. If it&quot;</span><span class="p">,</span>
                            <span class="s2">&quot;looks odd, you can either adjust the map projection&quot;</span><span class="p">,</span>
                            <span class="s2">&quot;region to be consistent with your data, or (if your&quot;</span><span class="p">,</span>
                            <span class="s2">&quot;data is on a global lat/lon grid) use the shiftgrid&quot;</span><span class="p">,</span>
                            <span class="s2">&quot;function to adjust the data to be consistent with the&quot;</span><span class="p">,</span>
                            <span class="s2">&quot;map projection region (see doc/examples/contour_demo.py)&quot;</span><span class="p">]))</span>
                <span class="c1"># mask for points more than one grid length outside projection limb.</span>
                <span class="n">xx</span> <span class="o">=</span> <span class="n">ma</span><span class="o">.</span><span class="n">masked_where</span><span class="p">(</span><span class="n">x</span> <span class="o">&gt;</span> <span class="mf">1.e20</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
                <span class="n">yy</span> <span class="o">=</span> <span class="n">ma</span><span class="o">.</span><span class="n">masked_where</span><span class="p">(</span><span class="n">y</span> <span class="o">&gt;</span> <span class="mf">1.e20</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">projection</span> <span class="o">!=</span> <span class="s1">&#39;omerc&#39;</span><span class="p">:</span>
                    <span class="n">epsx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">xx</span><span class="p">[:,</span><span class="mi">1</span><span class="p">:]</span><span class="o">-</span><span class="n">xx</span><span class="p">[:,</span><span class="mi">0</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
                    <span class="n">epsy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">yy</span><span class="p">[</span><span class="mi">1</span><span class="p">:,:]</span><span class="o">-</span><span class="n">yy</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">,:])</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
                <span class="k">else</span><span class="p">:</span> <span class="c1"># doesn&#39;t work for omerc (FIXME)</span>
                    <span class="n">epsx</span> <span class="o">=</span> <span class="mf">0.</span><span class="p">;</span> <span class="n">epsy</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="n">xymask</span> <span class="o">=</span> \
                <span class="n">np</span><span class="o">.</span><span class="n">logical_or</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">greater</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">xmax</span><span class="o">+</span><span class="n">epsx</span><span class="p">),</span><span class="n">np</span><span class="o">.</span><span class="n">greater</span><span class="p">(</span><span class="n">y</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">ymax</span><span class="o">+</span><span class="n">epsy</span><span class="p">))</span>
                <span class="n">xymask</span> <span class="o">=</span> <span class="n">xymask</span> <span class="o">+</span> \
                <span class="n">np</span><span class="o">.</span><span class="n">logical_or</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">less</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">xmin</span><span class="o">-</span><span class="n">epsx</span><span class="p">),</span><span class="n">np</span><span class="o">.</span><span class="n">less</span><span class="p">(</span><span class="n">y</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">ymin</span><span class="o">-</span><span class="n">epsy</span><span class="p">))</span>
                <span class="n">data</span> <span class="o">=</span> <span class="n">ma</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
                <span class="c1"># combine with data mask.</span>
                <span class="n">mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logical_or</span><span class="p">(</span><span class="n">ma</span><span class="o">.</span><span class="n">getmaskarray</span><span class="p">(</span><span class="n">data</span><span class="p">),</span><span class="n">xymask</span><span class="p">)</span>
                <span class="n">data</span> <span class="o">=</span> <span class="n">ma</span><span class="o">.</span><span class="n">masked_array</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="n">mask</span><span class="o">=</span><span class="n">mask</span><span class="p">)</span>
                <span class="n">CS</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">contourf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">data</span><span class="p">,</span><span class="o">*</span><span class="n">args</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_restore_hold</span><span class="p">(</span><span class="n">ax</span><span class="p">)</span>
        <span class="c1"># reset current active image (only if pyplot is imported).</span>
        <span class="k">if</span> <span class="n">plt</span> <span class="ow">and</span> <span class="n">CS</span><span class="o">.</span><span class="n">get_array</span><span class="p">()</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">sci</span><span class="p">(</span><span class="n">CS</span><span class="p">)</span>
        <span class="c1"># set axes limits to fit map region.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_axes_limits</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
        <span class="c1"># clip to map limbs</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">CS</span><span class="p">,</span> <span class="n">Artist</span><span class="p">):</span>
            <span class="c1"># Since MPL 3.8, `QuadContourSet` objects are `Artist` objects too.</span>
            <span class="n">CS</span><span class="p">,</span> <span class="n">c</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cliplimb</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">CS</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">CS</span><span class="o">.</span><span class="n">collections</span><span class="p">,</span> <span class="n">c</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cliplimb</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">CS</span><span class="o">.</span><span class="n">collections</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">CS</span></div>


<div class="viewcode-block" id="Basemap.quiver">
<a class="viewcode-back" href="../../api/basemap_api.html#mpl_toolkits.basemap.Basemap.quiver">[docs]</a>
    <span class="nd">@_transformuv</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">quiver</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Make a vector plot (u, v) with arrows on the map.</span>

<span class="sd">        Arguments may be 1-D or 2-D arrays or sequences</span>
<span class="sd">        (see matplotlib.pyplot.quiver documentation for details).</span>

<span class="sd">        If ``latlon`` keyword is set to True, x,y are intrepreted as</span>
<span class="sd">        longitude and latitude in degrees.  Data and longitudes are</span>
<span class="sd">        automatically shifted to match map projection region for cylindrical</span>
<span class="sd">        and pseudocylindrical projections, and x,y are transformed to map</span>
<span class="sd">        projection coordinates. If ``latlon`` is False (default), x and y</span>
<span class="sd">        are assumed to be map projection coordinates.</span>

<span class="sd">        Extra keyword ``ax`` can be used to override the default axis instance.</span>

<span class="sd">        Other \*args and \**kwargs passed on to matplotlib.pyplot.quiver.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">ax</span><span class="p">,</span> <span class="n">plt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ax_plt_from_kw</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_save_use_hold</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">ret</span> <span class="o">=</span>  <span class="n">ax</span><span class="o">.</span><span class="n">quiver</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">u</span><span class="p">,</span><span class="n">v</span><span class="p">,</span><span class="o">*</span><span class="n">args</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_restore_hold</span><span class="p">(</span><span class="n">ax</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">plt</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">ret</span><span class="o">.</span><span class="n">get_array</span><span class="p">()</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">sci</span><span class="p">(</span><span class="n">ret</span><span class="p">)</span>
        <span class="c1"># set axes limits to fit map region.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_axes_limits</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
        <span class="c1"># clip to map limbs</span>
        <span class="n">ret</span><span class="p">,</span><span class="n">c</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cliplimb</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span><span class="n">ret</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">ret</span></div>


<div class="viewcode-block" id="Basemap.streamplot">
<a class="viewcode-back" href="../../api/basemap_api.html#mpl_toolkits.basemap.Basemap.streamplot">[docs]</a>
    <span class="nd">@_transformuv</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">streamplot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Draws streamlines of a vector flow.</span>
<span class="sd">        (see matplotlib.pyplot.streamplot documentation).</span>

<span class="sd">        If ``latlon`` keyword is set to True, x,y are intrepreted as</span>
<span class="sd">        longitude and latitude in degrees.  Data and longitudes are</span>
<span class="sd">        automatically shifted to match map projection region for cylindrical</span>
<span class="sd">        and pseudocylindrical projections, and x,y are transformed to map</span>
<span class="sd">        projection coordinates. If ``latlon`` is False (default), x and y</span>
<span class="sd">        are assumed to be map projection coordinates.</span>

<span class="sd">        Extra keyword ``ax`` can be used to override the default axis instance.</span>

<span class="sd">        Other \*args and \**kwargs passed on to matplotlib.pyplot.streamplot.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">ax</span><span class="p">,</span> <span class="n">plt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ax_plt_from_kw</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_save_use_hold</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">ret</span> <span class="o">=</span>  <span class="n">ax</span><span class="o">.</span><span class="n">streamplot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">u</span><span class="p">,</span><span class="n">v</span><span class="p">,</span><span class="o">*</span><span class="n">args</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_restore_hold</span><span class="p">(</span><span class="n">ax</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">plt</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">ret</span><span class="o">.</span><span class="n">lines</span><span class="o">.</span><span class="n">get_array</span><span class="p">()</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">sci</span><span class="p">(</span><span class="n">ret</span><span class="o">.</span><span class="n">lines</span><span class="p">)</span>
        <span class="c1"># set axes limits to fit map region.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_axes_limits</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
        <span class="c1"># clip to map limbs</span>
        <span class="n">ret</span><span class="o">.</span><span class="n">lines</span><span class="p">,</span><span class="n">c</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cliplimb</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span><span class="n">ret</span><span class="o">.</span><span class="n">lines</span><span class="p">)</span>
        <span class="n">ret</span><span class="o">.</span><span class="n">arrows</span><span class="p">,</span><span class="n">c</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cliplimb</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span><span class="n">ret</span><span class="o">.</span><span class="n">arrows</span><span class="p">)</span>
        <span class="c1"># streamplot arrows not returned in matplotlib 1.1.1, so clip all</span>
        <span class="c1"># FancyArrow patches attached to axes instance.</span>
        <span class="k">if</span> <span class="n">c</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">ax</span><span class="o">.</span><span class="n">patches</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">FancyArrowPatch</span><span class="p">):</span> <span class="n">p</span><span class="o">.</span><span class="n">set_clip_path</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">ret</span></div>


<div class="viewcode-block" id="Basemap.barbs">
<a class="viewcode-back" href="../../api/basemap_api.html#mpl_toolkits.basemap.Basemap.barbs">[docs]</a>
    <span class="nd">@_transformuv</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">barbs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Make a wind barb plot (u, v) with on the map.</span>
<span class="sd">        (see matplotlib.pyplot.barbs documentation).</span>

<span class="sd">        If ``latlon`` keyword is set to True, x,y are intrepreted as</span>
<span class="sd">        longitude and latitude in degrees.  Data and longitudes are</span>
<span class="sd">        automatically shifted to match map projection region for cylindrical</span>
<span class="sd">        and pseudocylindrical projections, and x,y are transformed to map</span>
<span class="sd">        projection coordinates. If ``latlon`` is False (default), x and y</span>
<span class="sd">        are assumed to be map projection coordinates.</span>

<span class="sd">        Extra keyword ``ax`` can be used to override the default axis instance.</span>

<span class="sd">        Other \*args and \**kwargs passed on to matplotlib.pyplot.barbs</span>

<span class="sd">        Returns two matplotlib.axes.Barbs instances, one for the Northern</span>
<span class="sd">        Hemisphere and one for the Southern Hemisphere.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">ax</span><span class="p">,</span> <span class="n">plt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ax_plt_from_kw</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">lons</span><span class="p">,</span> <span class="n">lats</span> <span class="o">=</span> <span class="bp">self</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">inverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">unh</span> <span class="o">=</span> <span class="n">ma</span><span class="o">.</span><span class="n">masked_where</span><span class="p">(</span><span class="n">lats</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">u</span><span class="p">)</span>
        <span class="n">vnh</span> <span class="o">=</span> <span class="n">ma</span><span class="o">.</span><span class="n">masked_where</span><span class="p">(</span><span class="n">lats</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span>
        <span class="n">ush</span> <span class="o">=</span> <span class="n">ma</span><span class="o">.</span><span class="n">masked_where</span><span class="p">(</span><span class="n">lats</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span> <span class="n">u</span><span class="p">)</span>
        <span class="n">vsh</span> <span class="o">=</span> <span class="n">ma</span><span class="o">.</span><span class="n">masked_where</span><span class="p">(</span><span class="n">lats</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_save_use_hold</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">retnh</span> <span class="o">=</span>  <span class="n">ax</span><span class="o">.</span><span class="n">barbs</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">unh</span><span class="p">,</span><span class="n">vnh</span><span class="p">,</span><span class="o">*</span><span class="n">args</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;flip_barb&#39;</span><span class="p">]</span><span class="o">=</span><span class="kc">True</span>
            <span class="n">retsh</span> <span class="o">=</span>  <span class="n">ax</span><span class="o">.</span><span class="n">barbs</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">ush</span><span class="p">,</span><span class="n">vsh</span><span class="p">,</span><span class="o">*</span><span class="n">args</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_restore_hold</span><span class="p">(</span><span class="n">ax</span><span class="p">)</span>
        <span class="c1"># Because there are two collections returned in general,</span>
        <span class="c1"># we can&#39;t set the current image...</span>
        <span class="c1">#if plt is not None and ret.get_array() is not None:</span>
        <span class="c1">#    plt.sci(retnh)</span>
        <span class="c1"># set axes limits to fit map region.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_axes_limits</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
        <span class="c1"># clip to map limbs</span>
        <span class="n">retnh</span><span class="p">,</span><span class="n">c</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cliplimb</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span><span class="n">retnh</span><span class="p">)</span>
        <span class="n">retsh</span><span class="p">,</span><span class="n">c</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cliplimb</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span><span class="n">retsh</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">retnh</span><span class="p">,</span><span class="n">retsh</span></div>


<div class="viewcode-block" id="Basemap.drawlsmask">
<a class="viewcode-back" href="../../api/basemap_api.html#mpl_toolkits.basemap.Basemap.drawlsmask">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">drawlsmask</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">land_color</span><span class="o">=</span><span class="s2">&quot;0.8&quot;</span><span class="p">,</span><span class="n">ocean_color</span><span class="o">=</span><span class="s2">&quot;w&quot;</span><span class="p">,</span><span class="n">lsmask</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                   <span class="n">lsmask_lons</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">lsmask_lats</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">lakes</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">resolution</span><span class="o">=</span><span class="s1">&#39;l&#39;</span><span class="p">,</span><span class="n">grid</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Draw land-sea mask image.</span>

<span class="sd">        .. note::</span>
<span class="sd">         The land-sea mask image cannot be overlaid on top</span>
<span class="sd">         of other images, due to limitations in matplotlib image handling</span>
<span class="sd">         (you can&#39;t specify the zorder of an image).</span>

<span class="sd">        .. tabularcolumns:: |l|L|</span>

<span class="sd">        ==============   ====================================================</span>
<span class="sd">        Keywords         Description</span>
<span class="sd">        ==============   ====================================================</span>
<span class="sd">        land_color       desired land color (color name or rgba tuple).</span>
<span class="sd">                         Default gray (&quot;0.8&quot;).</span>
<span class="sd">        ocean_color      desired water color (color name or rgba tuple).</span>
<span class="sd">                         Default white.</span>
<span class="sd">        lsmask           An array of 0&#39;s for ocean pixels, 1&#39;s for</span>
<span class="sd">                         land pixels and 2&#39;s for lake/pond pixels.</span>
<span class="sd">                         Default is None</span>
<span class="sd">                         (default 5-minute resolution land-sea mask is used).</span>
<span class="sd">        lakes            Plot lakes and ponds (Default True)</span>
<span class="sd">        lsmask_lons      1d array of longitudes for lsmask (ignored</span>
<span class="sd">                         if lsmask is None). Longitudes must be ordered</span>
<span class="sd">                         from -180 W eastward.</span>
<span class="sd">        lsmask_lats      1d array of latitudes for lsmask (ignored</span>
<span class="sd">                         if lsmask is None). Latitudes must be ordered</span>
<span class="sd">                         from -90 S northward.</span>
<span class="sd">        resolution       gshhs coastline resolution used to define land/sea</span>
<span class="sd">                         mask (default &#39;l&#39;, available &#39;c&#39;,&#39;l&#39;,&#39;i&#39;,&#39;h&#39; or &#39;f&#39;)</span>
<span class="sd">        grid             land/sea mask grid spacing in minutes (Default 5;</span>
<span class="sd">                         10, 2.5 and 1.25 are also available).</span>
<span class="sd">        \**kwargs        extra keyword arguments passed on to</span>
<span class="sd">                         :meth:`imshow`</span>
<span class="sd">        ==============   ====================================================</span>

<span class="sd">        If any of the lsmask, lsmask_lons or lsmask_lats keywords are not</span>
<span class="sd">        set, the built in GSHHS land-sea mask datasets are used.</span>

<span class="sd">        Extra keyword ``ax`` can be used to override the default axis instance.</span>

<span class="sd">        returns a matplotlib.image.AxesImage instance.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># convert land and water colors to integer rgba tuples with</span>
        <span class="c1"># values between 0 and 255.</span>
        <span class="kn">from</span><span class="w"> </span><span class="nn">matplotlib.colors</span><span class="w"> </span><span class="kn">import</span> <span class="n">ColorConverter</span>
        <span class="n">c</span> <span class="o">=</span> <span class="n">ColorConverter</span><span class="p">()</span>
        <span class="c1"># if conversion fails, assume it&#39;s because the color</span>
        <span class="c1"># given is already an rgba tuple with values between 0 and 255.</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">cl</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">to_rgba</span><span class="p">(</span><span class="n">land_color</span><span class="p">)</span>
            <span class="n">rgba_land</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">([</span><span class="nb">int</span><span class="p">(</span><span class="mi">255</span><span class="o">*</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">cl</span><span class="p">])</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="n">rgba_land</span> <span class="o">=</span> <span class="n">land_color</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">co</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">to_rgba</span><span class="p">(</span><span class="n">ocean_color</span><span class="p">)</span>
            <span class="n">rgba_ocean</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">([</span><span class="nb">int</span><span class="p">(</span><span class="mi">255</span><span class="o">*</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">co</span><span class="p">])</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="n">rgba_ocean</span> <span class="o">=</span> <span class="n">ocean_color</span>
        <span class="c1"># look for axes instance (as keyword, an instance variable</span>
        <span class="c1"># or from plt.gca().</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;ax&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check_ax</span><span class="p">()</span>
        <span class="c1"># Clear saved lsmask if new lsmask is passed</span>
        <span class="k">if</span> <span class="n">lsmask</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">lsmask_lons</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> \
                <span class="ow">or</span> <span class="n">lsmask_lats</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># Make sure passed lsmask is not the same as cached mask</span>
            <span class="k">if</span> <span class="n">lsmask</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">lsmask</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lsmask</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1"># if lsmask,lsmask_lons,lsmask_lats keywords not given,</span>
        <span class="c1"># read default land-sea mask in from file.</span>
        <span class="k">if</span> <span class="n">lsmask</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">lsmask_lons</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">lsmask_lats</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># if lsmask instance variable already set, data already</span>
            <span class="c1"># read in.</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">lsmask</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="c1"># read in land/sea mask.</span>
                <span class="n">lsmask_lons</span><span class="p">,</span> <span class="n">lsmask_lats</span><span class="p">,</span> <span class="n">lsmask</span> <span class="o">=</span>\
                <span class="n">_readlsmask</span><span class="p">(</span><span class="n">lakes</span><span class="o">=</span><span class="n">lakes</span><span class="p">,</span><span class="n">resolution</span><span class="o">=</span><span class="n">resolution</span><span class="p">,</span><span class="n">grid</span><span class="o">=</span><span class="n">grid</span><span class="p">)</span>
                <span class="c1"># instance variable lsmask is set on first invocation,</span>
                <span class="c1"># it contains the land-sea mask interpolated to the native</span>
                <span class="c1"># projection grid.  Further calls to drawlsmask will not</span>
                <span class="c1"># redo the interpolation (unless a new land-sea mask is passed</span>
                <span class="c1"># in via the lsmask, lsmask_lons, lsmask_lats keywords).</span>

                <span class="c1"># is it a cylindrical projection whose limits lie</span>
                <span class="c1"># outside the limits of the image?</span>
                <span class="n">cylproj</span> <span class="o">=</span>  <span class="bp">self</span><span class="o">.</span><span class="n">projection</span> <span class="ow">in</span> <span class="n">_cylproj</span> <span class="ow">and</span> \
                          <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">urcrnrlon</span> <span class="o">&gt;</span> <span class="n">lsmask_lons</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="ow">or</span> \
                           <span class="bp">self</span><span class="o">.</span><span class="n">llcrnrlon</span> <span class="o">&lt;</span> <span class="n">lsmask_lons</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                <span class="k">if</span> <span class="n">cylproj</span><span class="p">:</span>
                    <span class="c1"># stack grids side-by-side (in longitiudinal direction), so</span>
                    <span class="c1"># any range of longitudes may be plotted on a world map.</span>
                    <span class="c1"># in versions of NumPy later than 1.10.0, concatenate will</span>
                    <span class="c1"># not stack these arrays as expected. If axis 1 is outside</span>
                    <span class="c1"># the dimensions of the array, concatenate will now raise</span>
                    <span class="c1"># an IndexError. Using hstack instead.</span>
                    <span class="n">lsmask_lons</span> <span class="o">=</span> \
                            <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">lsmask_lons</span><span class="p">,</span><span class="n">lsmask_lons</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="o">+</span> <span class="mi">360</span><span class="p">))</span>
                    <span class="n">lsmask</span> <span class="o">=</span> \
                            <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">lsmask</span><span class="p">,</span><span class="n">lsmask</span><span class="p">[:,</span><span class="mi">1</span><span class="p">:]))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">lakes</span><span class="p">:</span> <span class="n">lsmask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">lsmask</span><span class="o">==</span><span class="mi">2</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">),</span><span class="n">lsmask</span><span class="p">)</span>

        <span class="c1"># transform mask to nx x ny regularly spaced native projection grid</span>
        <span class="c1"># nx and ny chosen to have roughly the same horizontal</span>
        <span class="c1"># resolution as mask.</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">lsmask</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">nlons</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">lsmask_lons</span><span class="p">)</span>
            <span class="n">nlats</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">lsmask_lats</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">projection</span> <span class="o">==</span> <span class="s1">&#39;cyl&#39;</span><span class="p">:</span>
                <span class="n">dx</span> <span class="o">=</span> <span class="n">lsmask_lons</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">lsmask_lons</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">dx</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mf">180.</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">lsmask_lons</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">lsmask_lons</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">rmajor</span>
            <span class="n">nx</span> <span class="o">=</span> <span class="nb">int</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">xmax</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">xmin</span><span class="p">)</span><span class="o">/</span><span class="n">dx</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">;</span> <span class="n">ny</span> <span class="o">=</span> <span class="nb">int</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">ymax</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">ymin</span><span class="p">)</span><span class="o">/</span><span class="n">dx</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span>
        <span class="c1"># interpolate rgba values from proj=&#39;cyl&#39; (geographic coords)</span>
        <span class="c1"># to a rectangular map projection grid.</span>
            <span class="n">mask</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">transform_scalar</span><span class="p">(</span><span class="n">lsmask</span><span class="p">,</span><span class="n">lsmask_lons</span><span class="p">,</span>\
                       <span class="n">lsmask_lats</span><span class="p">,</span><span class="n">nx</span><span class="p">,</span><span class="n">ny</span><span class="p">,</span><span class="n">returnxy</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">order</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">masked</span><span class="o">=</span><span class="mi">255</span><span class="p">)</span>
            <span class="n">lsmask_lats</span><span class="o">.</span><span class="n">dtype</span>
            <span class="c1"># for these projections, points outside the projection</span>
            <span class="c1"># limb have to be set to transparent manually.</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">projection</span> <span class="ow">in</span> <span class="n">_pseudocyl</span><span class="p">:</span>
                <span class="n">lons</span><span class="p">,</span> <span class="n">lats</span> <span class="o">=</span> <span class="bp">self</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">inverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="n">lon_0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">projparams</span><span class="p">[</span><span class="s1">&#39;lon_0&#39;</span><span class="p">]</span>
                <span class="n">lats</span> <span class="o">=</span> <span class="n">lats</span><span class="p">[:,</span><span class="n">nx</span><span class="o">//</span><span class="mi">2</span><span class="p">]</span>
                <span class="n">lons1</span> <span class="o">=</span> <span class="p">(</span><span class="n">lon_0</span><span class="o">+</span><span class="mf">180.</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">lons</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
                <span class="n">lons2</span> <span class="o">=</span> <span class="p">(</span><span class="n">lon_0</span><span class="o">-</span><span class="mf">180.</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">lons</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
                <span class="n">xmax</span><span class="p">,</span><span class="n">ytmp</span> <span class="o">=</span> <span class="bp">self</span><span class="p">(</span><span class="n">lons1</span><span class="p">,</span><span class="n">lats</span><span class="p">)</span>
                <span class="n">xmin</span><span class="p">,</span><span class="n">ytmp</span> <span class="o">=</span> <span class="bp">self</span><span class="p">(</span><span class="n">lons2</span><span class="p">,</span><span class="n">lats</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">lats</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
                    <span class="n">xx</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="n">j</span><span class="p">,:]</span>
                    <span class="n">mask</span><span class="p">[</span><span class="n">j</span><span class="p">,:]</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">logical_or</span><span class="p">(</span><span class="n">xx</span><span class="o">&lt;</span><span class="n">xmin</span><span class="p">[</span><span class="n">j</span><span class="p">],</span><span class="n">xx</span><span class="o">&gt;</span><span class="n">xmax</span><span class="p">[</span><span class="n">j</span><span class="p">]),</span>\
                                        <span class="mi">255</span><span class="p">,</span><span class="n">mask</span><span class="p">[</span><span class="n">j</span><span class="p">,:])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lsmask</span> <span class="o">=</span> <span class="n">mask</span>
        <span class="n">ny</span><span class="p">,</span> <span class="n">nx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lsmask</span><span class="o">.</span><span class="n">shape</span>
        <span class="n">rgba</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="n">ny</span><span class="p">,</span><span class="n">nx</span><span class="p">,</span><span class="mi">4</span><span class="p">),</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span>
        <span class="n">rgba_land</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">rgba_land</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span>
        <span class="n">rgba_ocean</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">rgba_ocean</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">):</span>
            <span class="n">rgba</span><span class="p">[:,:,</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lsmask</span><span class="p">,</span><span class="n">rgba_land</span><span class="p">[</span><span class="n">k</span><span class="p">],</span><span class="n">rgba_ocean</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
        <span class="c1"># make points outside projection limb transparent.</span>
        <span class="n">rgba</span><span class="p">[:,:,</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lsmask</span><span class="o">==</span><span class="mi">255</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">rgba</span><span class="p">[:,:,</span><span class="mi">3</span><span class="p">])</span>
        <span class="c1"># plot mask as rgba image.</span>
        <span class="n">im</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">rgba</span><span class="p">,</span><span class="n">interpolation</span><span class="o">=</span><span class="s1">&#39;nearest&#39;</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="c1"># clip to map limbs.</span>
        <span class="n">im</span><span class="p">,</span><span class="n">c</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cliplimb</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span><span class="n">im</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">im</span></div>


<div class="viewcode-block" id="Basemap.bluemarble">
<a class="viewcode-back" href="../../api/basemap_api.html#mpl_toolkits.basemap.Basemap.bluemarble">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">bluemarble</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Display blue marble image as map background.</span>

<span class="sd">        The original image is available at::</span>

<span class="sd">            https://visibleearth.nasa.gov/</span>

<span class="sd">        The default image size is 5400x2700, which can be a bit slow</span>
<span class="sd">        memory-consuming. The ``scale`` keyword allows to downsample</span>
<span class="sd">        the image (e.g. ``scale=0.5`` downsamples to 2700x1350).</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        ax : matplotlib.image.AxesImage, optional</span>
<span class="sd">            if given, alternative axes instance where the image is drawn</span>

<span class="sd">        scale : float, optional</span>
<span class="sd">            if given, rescale the image by the given factor</span>

<span class="sd">        \**kwargs : dict, optional</span>
<span class="sd">            keyword arguments passed on to :meth:`Basemap.imshow`.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>

<span class="sd">        ax : matplotlib.image.AxesImage</span>
<span class="sd">            axes instance</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">image</span> <span class="o">=</span> <span class="s2">&quot;bluemarble&quot;</span>
        <span class="k">if</span> <span class="n">ax</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">warpimage</span><span class="p">(</span><span class="n">image</span><span class="o">=</span><span class="n">image</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="n">scale</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">warpimage</span><span class="p">(</span><span class="n">image</span><span class="o">=</span><span class="n">image</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="n">scale</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>


<div class="viewcode-block" id="Basemap.shadedrelief">
<a class="viewcode-back" href="../../api/basemap_api.html#mpl_toolkits.basemap.Basemap.shadedrelief">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">shadedrelief</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Display shaded relief image as map background.</span>

<span class="sd">        The original image is available at::</span>

<span class="sd">            https://www.shadedrelief.com/</span>

<span class="sd">        The default image size is 5400x2700, which can be a bit slow</span>
<span class="sd">        memory-consuming. The ``scale`` keyword allows to downsample</span>
<span class="sd">        the image (e.g. ``scale=0.5`` downsamples to 2700x1350).</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        ax : matplotlib.image.AxesImage, optional</span>
<span class="sd">            if given, alternative axes instance where the image is drawn</span>

<span class="sd">        scale : float, optional</span>
<span class="sd">            if given, rescale the image by the given factor</span>

<span class="sd">        \**kwargs : dict, optional</span>
<span class="sd">            keyword arguments passed on to :meth:`Basemap.imshow`.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>

<span class="sd">        ax : matplotlib.image.AxesImage</span>
<span class="sd">            axes instance</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">image</span> <span class="o">=</span> <span class="s2">&quot;shadedrelief&quot;</span>
        <span class="k">if</span> <span class="n">ax</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">warpimage</span><span class="p">(</span><span class="n">image</span><span class="o">=</span><span class="n">image</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="n">scale</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">warpimage</span><span class="p">(</span><span class="n">image</span><span class="o">=</span><span class="n">image</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="n">scale</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>


<div class="viewcode-block" id="Basemap.etopo">
<a class="viewcode-back" href="../../api/basemap_api.html#mpl_toolkits.basemap.Basemap.etopo">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">etopo</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Display ETOPO relief image as map background.</span>

<span class="sd">        The original image is available at::</span>

<span class="sd">            http://www.ngdc.noaa.gov/mgg/global/global.html</span>

<span class="sd">        The default image size is 5400x2700, which can be a bit slow</span>
<span class="sd">        memory-consuming. The ``scale`` keyword allows to downsample</span>
<span class="sd">        the image (e.g. ``scale=0.5`` downsamples to 2700x1350).</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        ax : matplotlib.image.AxesImage, optional</span>
<span class="sd">            if given, alternative axes instance where the image is drawn</span>

<span class="sd">        scale : float, optional</span>
<span class="sd">            if given, rescale the image by the given factor</span>

<span class="sd">        \**kwargs : dict, optional</span>
<span class="sd">            keyword arguments passed on to :meth:`Basemap.imshow`.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>

<span class="sd">        ax : matplotlib.image.AxesImage</span>
<span class="sd">            axes instance</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">image</span> <span class="o">=</span> <span class="s2">&quot;etopo&quot;</span>
        <span class="k">if</span> <span class="n">ax</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">warpimage</span><span class="p">(</span><span class="n">image</span><span class="o">=</span><span class="n">image</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="n">scale</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">warpimage</span><span class="p">(</span><span class="n">image</span><span class="o">=</span><span class="n">image</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="n">scale</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>


<div class="viewcode-block" id="Basemap.warpimage">
<a class="viewcode-back" href="../../api/basemap_api.html#mpl_toolkits.basemap.Basemap.warpimage">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">warpimage</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">image</span><span class="o">=</span><span class="s2">&quot;bluemarble&quot;</span><span class="p">,</span><span class="n">scale</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Display an image (filename given by ``image`` keyword) as a map background.</span>
<span class="sd">        If image is a URL (starts with &#39;http&#39;), it is downloaded to a temp</span>
<span class="sd">        file using urllib.urlretrieve.</span>

<span class="sd">        Default (if ``image`` not specified) is to display</span>
<span class="sd">        &#39;blue marble next generation&#39; image from http://visibleearth.nasa.gov/.</span>

<span class="sd">        Specified image must have pixels covering the whole globe in a regular</span>
<span class="sd">        lat/lon grid, starting and -180W and the South Pole.</span>
<span class="sd">        Works with the global images from</span>
<span class="sd">        http://earthobservatory.nasa.gov/Features/BlueMarble/BlueMarble_monthlies.php.</span>

<span class="sd">        The ``scale`` keyword can be used to downsample (rescale) the image.</span>
<span class="sd">        Values less than 1.0 will speed things up at the expense of image</span>
<span class="sd">        resolution.</span>

<span class="sd">        Extra keyword ``ax`` can be used to override the default axis instance.</span>

<span class="sd">        \**kwargs passed on to :meth:`imshow`.</span>

<span class="sd">        returns a matplotlib.image.AxesImage instance.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># fix PIL import on some versions of OSX and scipy</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="kn">from</span><span class="w"> </span><span class="nn">PIL</span><span class="w"> </span><span class="kn">import</span> <span class="n">Image</span>
        <span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="kn">import</span><span class="w"> </span><span class="nn">Image</span>
            <span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ImportError</span><span class="p">(</span><span class="s2">&quot;warpimage method requires PIL &quot;</span>
                                  <span class="s2">&quot;(http://pillow.readthedocs.io)&quot;</span><span class="p">)</span>

        <span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.image</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">mpimg</span>

        <span class="k">def</span><span class="w"> </span><span class="nf">pil_to_array</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;Call :func:`~mpimg.pil_to_array` ignoring deprecation warnings.&quot;&quot;&quot;</span>

            <span class="k">with</span> <span class="n">warnings</span><span class="o">.</span><span class="n">catch_warnings</span><span class="p">():</span>
                <span class="n">warnings</span><span class="o">.</span><span class="n">simplefilter</span><span class="p">(</span><span class="s2">&quot;ignore&quot;</span><span class="p">,</span> <span class="n">category</span><span class="o">=</span><span class="ne">DeprecationWarning</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">mpimg</span><span class="o">.</span><span class="n">pil_to_array</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">celestial</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;warpimage does not work in celestial coordinates&quot;</span><span class="p">)</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;ax&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check_ax</span><span class="p">()</span>
        <span class="c1"># default image file is blue marble next generation</span>
        <span class="c1"># from NASA (http://visibleearth.nasa.gov).</span>
        <span class="k">if</span> <span class="n">image</span> <span class="o">==</span> <span class="s2">&quot;bluemarble&quot;</span><span class="p">:</span>
            <span class="n">file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">basemap_datadir</span><span class="p">,</span><span class="s1">&#39;bmng.jpg&#39;</span><span class="p">)</span>
        <span class="c1"># display shaded relief image (from</span>
        <span class="c1"># http://www.shadedreliefdata.com)</span>
        <span class="k">elif</span> <span class="n">image</span> <span class="o">==</span> <span class="s2">&quot;shadedrelief&quot;</span><span class="p">:</span>
            <span class="n">file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">basemap_datadir</span><span class="p">,</span><span class="s1">&#39;shadedrelief.jpg&#39;</span><span class="p">)</span>
        <span class="c1"># display etopo image (from</span>
        <span class="c1"># http://www.ngdc.noaa.gov/mgg/image/globalimages.html)</span>
        <span class="k">elif</span> <span class="n">image</span> <span class="o">==</span> <span class="s2">&quot;etopo&quot;</span><span class="p">:</span>
            <span class="n">file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">basemap_datadir</span><span class="p">,</span><span class="s1">&#39;etopo1.jpg&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">file</span> <span class="o">=</span> <span class="n">image</span>
        <span class="c1"># if image is same as previous invocation, used cached data.</span>
        <span class="c1"># if not, regenerate rgba data.</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="s1">&#39;_bm_file&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_bm_file</span> <span class="o">!=</span> <span class="n">file</span><span class="p">:</span>
            <span class="n">newfile</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">newfile</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="n">file</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;http&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_bm_file</span><span class="p">,</span> <span class="n">headers</span> <span class="o">=</span> <span class="n">urlretrieve</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_bm_file</span> <span class="o">=</span> <span class="n">file</span>
        <span class="c1"># bmproj is True if map projection region is same as</span>
        <span class="c1"># image region.</span>
        <span class="n">bmproj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">projection</span> <span class="o">==</span> <span class="s1">&#39;cyl&#39;</span> <span class="ow">and</span> \
                 <span class="bp">self</span><span class="o">.</span><span class="n">llcrnrlon</span> <span class="o">==</span> <span class="o">-</span><span class="mi">180</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">urcrnrlon</span> <span class="o">==</span> <span class="mi">180</span> <span class="ow">and</span> \
                 <span class="bp">self</span><span class="o">.</span><span class="n">llcrnrlat</span> <span class="o">==</span> <span class="o">-</span><span class="mi">90</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">urcrnrlat</span> <span class="o">==</span> <span class="mi">90</span>
        <span class="c1"># read in jpeg image to rgba array of normalized floats.</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="s1">&#39;_bm_rgba&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">newfile</span><span class="p">:</span>
            <span class="n">pilImage</span> <span class="o">=</span> <span class="n">Image</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_bm_file</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">scale</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">w</span><span class="p">,</span> <span class="n">h</span> <span class="o">=</span> <span class="n">pilImage</span><span class="o">.</span><span class="n">size</span>
                <span class="n">width</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">w</span><span class="o">*</span><span class="n">scale</span><span class="p">))</span>
                <span class="n">height</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">h</span><span class="o">*</span><span class="n">scale</span><span class="p">))</span>
                <span class="n">pilImage</span> <span class="o">=</span> <span class="n">pilImage</span><span class="o">.</span><span class="n">resize</span><span class="p">((</span><span class="n">width</span><span class="p">,</span><span class="n">height</span><span class="p">),</span><span class="n">Image</span><span class="o">.</span><span class="n">LANCZOS</span><span class="p">)</span>
            <span class="c1"># orientation of arrays returned by pil_to_array changed in</span>
            <span class="c1"># matplotlib 1.2 (https://github.com/matplotlib/matplotlib/pull/616)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_bm_rgba</span> <span class="o">=</span> <span class="n">pil_to_array</span><span class="p">(</span><span class="n">pilImage</span><span class="p">)[::</span><span class="o">-</span><span class="mi">1</span><span class="p">,:]</span>
            <span class="c1"># define lat/lon grid that image spans.</span>
            <span class="n">nlons</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_bm_rgba</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span> <span class="n">nlats</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_bm_rgba</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">delta</span> <span class="o">=</span> <span class="mf">360.</span><span class="o">/</span><span class="nb">float</span><span class="p">(</span><span class="n">nlons</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_bm_lons</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="o">-</span><span class="mf">180.</span><span class="o">+</span><span class="mf">0.5</span><span class="o">*</span><span class="n">delta</span><span class="p">,</span><span class="mf">180.</span><span class="p">,</span><span class="n">delta</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_bm_lats</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="o">-</span><span class="mf">90.</span><span class="o">+</span><span class="mf">0.5</span><span class="o">*</span><span class="n">delta</span><span class="p">,</span><span class="mf">90.</span><span class="p">,</span><span class="n">delta</span><span class="p">)</span>
            <span class="c1"># is it a cylindrical projection whose limits lie</span>
            <span class="c1"># outside the limits of the image?</span>
            <span class="n">cylproj</span> <span class="o">=</span>  <span class="bp">self</span><span class="o">.</span><span class="n">projection</span> <span class="ow">in</span> <span class="n">_cylproj</span> <span class="ow">and</span> \
                      <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">urcrnrlon</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">_bm_lons</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="ow">or</span> \
                       <span class="bp">self</span><span class="o">.</span><span class="n">llcrnrlon</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">_bm_lons</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="c1"># if pil_to_array returns a 2D array, it&#39;s a grayscale image.</span>
            <span class="c1"># create an RGB image, with R==G==B.</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_bm_rgba</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                <span class="n">tmp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_bm_rgba</span><span class="o">.</span><span class="n">shape</span><span class="o">+</span><span class="p">(</span><span class="mi">3</span><span class="p">,),</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
                    <span class="n">tmp</span><span class="p">[:,:,</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_bm_rgba</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_bm_rgba</span> <span class="o">=</span> <span class="n">tmp</span>
            <span class="k">if</span> <span class="n">cylproj</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">bmproj</span><span class="p">:</span>
                <span class="c1"># stack grids side-by-side (in longitiudinal direction), so</span>
                <span class="c1"># any range of longitudes may be plotted on a world map.</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_bm_lons</span> <span class="o">=</span> \
                <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">_bm_lons</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">_bm_lons</span><span class="o">+</span><span class="mi">360</span><span class="p">),</span><span class="mi">0</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_bm_rgba</span> <span class="o">=</span> \
                <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">_bm_rgba</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">_bm_rgba</span><span class="p">),</span><span class="mi">1</span><span class="p">)</span>
            <span class="c1"># convert to normalized floats.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_bm_rgba</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_bm_rgba</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span><span class="o">/</span><span class="mf">255.</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">bmproj</span><span class="p">:</span> <span class="c1"># interpolation necessary.</span>
            <span class="k">if</span> <span class="n">newfile</span> <span class="ow">or</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="s1">&#39;_bm_rgba_warped&#39;</span><span class="p">):</span>
                <span class="c1"># transform to nx x ny regularly spaced native</span>
                <span class="c1"># projection grid.</span>
                <span class="c1"># nx and ny chosen to have roughly the</span>
                <span class="c1"># same horizontal res as original image.</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">projection</span> <span class="o">!=</span> <span class="s1">&#39;cyl&#39;</span><span class="p">:</span>
                    <span class="n">dx</span> <span class="o">=</span> <span class="mf">2.</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">rmajor</span><span class="o">/</span><span class="nb">float</span><span class="p">(</span><span class="n">nlons</span><span class="p">)</span>
                    <span class="n">nx</span> <span class="o">=</span> <span class="nb">int</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">xmax</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">xmin</span><span class="p">)</span><span class="o">/</span><span class="n">dx</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span>
                    <span class="n">ny</span> <span class="o">=</span> <span class="nb">int</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">ymax</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">ymin</span><span class="p">)</span><span class="o">/</span><span class="n">dx</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">dx</span> <span class="o">=</span> <span class="mf">360.</span><span class="o">/</span><span class="nb">float</span><span class="p">(</span><span class="n">nlons</span><span class="p">)</span>
                    <span class="n">nx</span> <span class="o">=</span> <span class="nb">int</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">urcrnrlon</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">llcrnrlon</span><span class="p">)</span><span class="o">/</span><span class="n">dx</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span>
                    <span class="n">ny</span> <span class="o">=</span> <span class="nb">int</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">urcrnrlat</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">llcrnrlat</span><span class="p">)</span><span class="o">/</span><span class="n">dx</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_bm_rgba_warped</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="n">ny</span><span class="p">,</span><span class="n">nx</span><span class="p">,</span><span class="mi">4</span><span class="p">),</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
                <span class="c1"># interpolate rgba values from geographic coords (proj=&#39;cyl&#39;)</span>
                <span class="c1"># to map projection coords.</span>
                <span class="c1"># if masked=True, values outside of</span>
                <span class="c1"># projection limb will be masked.</span>
                <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_bm_rgba</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_bm_rgba_warped</span><span class="p">[:,:,</span><span class="n">k</span><span class="p">],</span><span class="n">x</span><span class="p">,</span><span class="n">y</span> <span class="o">=</span> \
                    <span class="bp">self</span><span class="o">.</span><span class="n">transform_scalar</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_bm_rgba</span><span class="p">[:,:,</span><span class="n">k</span><span class="p">],</span>\
                    <span class="bp">self</span><span class="o">.</span><span class="n">_bm_lons</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">_bm_lats</span><span class="p">,</span><span class="n">nx</span><span class="p">,</span><span class="n">ny</span><span class="p">,</span><span class="n">returnxy</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="c1"># for ortho,geos mask pixels outside projection limb.</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">projection</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;geos&#39;</span><span class="p">,</span><span class="s1">&#39;ortho&#39;</span><span class="p">,</span><span class="s1">&#39;nsper&#39;</span><span class="p">]</span> <span class="ow">or</span> \
                   <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">projection</span> <span class="o">==</span> <span class="s1">&#39;aeqd&#39;</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fulldisk</span><span class="p">):</span>
                    <span class="n">lonsr</span><span class="p">,</span><span class="n">latsr</span> <span class="o">=</span> <span class="bp">self</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">inverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                    <span class="n">mask</span> <span class="o">=</span> <span class="n">ma</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">ny</span><span class="p">,</span><span class="n">nx</span><span class="p">,</span><span class="mi">4</span><span class="p">),</span><span class="n">np</span><span class="o">.</span><span class="n">int8</span><span class="p">)</span>
                    <span class="n">mask</span><span class="p">[:,:,</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logical_or</span><span class="p">(</span><span class="n">lonsr</span><span class="o">&gt;</span><span class="mf">1.e20</span><span class="p">,</span><span class="n">latsr</span><span class="o">&gt;</span><span class="mf">1.e30</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">4</span><span class="p">):</span>
                        <span class="n">mask</span><span class="p">[:,:,</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">mask</span><span class="p">[:,:,</span><span class="mi">0</span><span class="p">]</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_bm_rgba_warped</span> <span class="o">=</span> \
                    <span class="n">ma</span><span class="o">.</span><span class="n">masked_array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_bm_rgba_warped</span><span class="p">,</span><span class="n">mask</span><span class="o">=</span><span class="n">mask</span><span class="p">)</span>
                    <span class="c1"># make points outside projection limb transparent.</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_bm_rgba_warped</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_bm_rgba_warped</span><span class="o">.</span><span class="n">filled</span><span class="p">(</span><span class="mf">0.</span><span class="p">)</span>
                <span class="c1"># treat pseudo-cyl projections such as mollweide, robinson and sinusoidal.</span>
                <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">projection</span> <span class="ow">in</span> <span class="n">_pseudocyl</span> <span class="ow">and</span> \
                     <span class="bp">self</span><span class="o">.</span><span class="n">projection</span> <span class="o">!=</span> <span class="s1">&#39;hammer&#39;</span><span class="p">:</span>
                    <span class="n">lonsr</span><span class="p">,</span><span class="n">latsr</span> <span class="o">=</span> <span class="bp">self</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">inverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                    <span class="n">mask</span> <span class="o">=</span> <span class="n">ma</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">ny</span><span class="p">,</span><span class="n">nx</span><span class="p">,</span><span class="mi">4</span><span class="p">),</span><span class="n">np</span><span class="o">.</span><span class="n">int8</span><span class="p">)</span>
                    <span class="n">lon_0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">projparams</span><span class="p">[</span><span class="s1">&#39;lon_0&#39;</span><span class="p">]</span>
                    <span class="n">lonright</span> <span class="o">=</span> <span class="n">lon_0</span> <span class="o">+</span> <span class="mf">180.</span> <span class="o">-</span> <span class="mf">1E-10</span>
                    <span class="n">lonleft</span> <span class="o">=</span> <span class="n">lon_0</span> <span class="o">-</span> <span class="mf">180.</span> <span class="o">+</span> <span class="mf">1E-10</span>
                    <span class="n">x1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">ny</span><span class="o">*</span><span class="p">[</span><span class="mf">0.5</span><span class="o">*</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">xmax</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">xmin</span><span class="p">)],</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
                    <span class="n">y1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ymin</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ymax</span><span class="p">,</span> <span class="n">ny</span><span class="p">)</span>
                    <span class="n">lons1</span><span class="p">,</span> <span class="n">lats1</span> <span class="o">=</span> <span class="bp">self</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span><span class="n">y1</span><span class="p">,</span><span class="n">inverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                    <span class="n">lats1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">lats1</span> <span class="o">&lt;</span> <span class="o">-</span><span class="mf">89.999999</span><span class="p">,</span> <span class="o">-</span><span class="mf">89.999999</span><span class="p">,</span> <span class="n">lats1</span><span class="p">)</span>
                    <span class="n">lats1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">lats1</span> <span class="o">&gt;</span> <span class="mf">89.999999</span><span class="p">,</span> <span class="mf">89.999999</span><span class="p">,</span> <span class="n">lats1</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">j</span><span class="p">,</span><span class="n">lat</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">lats1</span><span class="p">):</span>
                        <span class="n">xmax</span><span class="p">,</span><span class="n">ymax</span> <span class="o">=</span> <span class="bp">self</span><span class="p">(</span><span class="n">lonright</span><span class="p">,</span><span class="n">lat</span><span class="p">)</span>
                        <span class="n">xmin</span><span class="p">,</span><span class="n">ymin</span> <span class="o">=</span> <span class="bp">self</span><span class="p">(</span><span class="n">lonleft</span><span class="p">,</span><span class="n">lat</span><span class="p">)</span>
                        <span class="n">mask</span><span class="p">[</span><span class="n">j</span><span class="p">,:,</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logical_or</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">j</span><span class="p">,:]</span><span class="o">&gt;</span><span class="n">xmax</span><span class="p">,</span><span class="n">x</span><span class="p">[</span><span class="n">j</span><span class="p">,:]</span><span class="o">&lt;</span><span class="n">xmin</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">4</span><span class="p">):</span>
                        <span class="n">mask</span><span class="p">[:,:,</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">mask</span><span class="p">[:,:,</span><span class="mi">0</span><span class="p">]</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_bm_rgba_warped</span> <span class="o">=</span> \
                    <span class="n">ma</span><span class="o">.</span><span class="n">masked_array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_bm_rgba_warped</span><span class="p">,</span><span class="n">mask</span><span class="o">=</span><span class="n">mask</span><span class="p">)</span>
                    <span class="c1"># make points outside projection limb transparent.</span>
                    <span class="c1"># FIXME: Probably not needed anymore</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_bm_rgba_warped</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_bm_rgba_warped</span><span class="o">.</span><span class="n">filled</span><span class="p">(</span><span class="mf">0.</span><span class="p">)</span>
            <span class="c1"># plot warped rgba image.</span>
            <span class="n">im</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_bm_rgba_warped</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="c1"># for hammer projection, use clip path defined by</span>
            <span class="c1"># projection limb (patch created in drawmapboundary).</span>
            <span class="c1"># FIXME: Is this now redundant?</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">projection</span> <span class="o">==</span> <span class="s1">&#39;hammer&#39;</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mapboundarydrawn</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">drawmapboundary</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">,</span><span class="n">linewidth</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
                <span class="n">im</span><span class="o">.</span><span class="n">set_clip_path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_mapboundarydrawn</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># bmproj True, no interpolation necessary.</span>
            <span class="n">im</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_bm_rgba</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="c1"># clip to map limbs</span>
        <span class="n">im</span><span class="p">,</span><span class="n">c</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cliplimb</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span><span class="n">im</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">im</span></div>


<div class="viewcode-block" id="Basemap.arcgisimage">
<a class="viewcode-back" href="../../api/basemap_api.html#mpl_toolkits.basemap.Basemap.arcgisimage">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">arcgisimage</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">server</span><span class="o">=</span><span class="s2">&quot;http://server.arcgisonline.com/ArcGIS&quot;</span><span class="p">,</span>
                    <span class="n">service</span><span class="o">=</span><span class="s2">&quot;World_Imagery&quot;</span><span class="p">,</span> <span class="n">xpixels</span><span class="o">=</span><span class="mi">400</span><span class="p">,</span> <span class="n">ypixels</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                    <span class="n">dpi</span><span class="o">=</span><span class="mi">96</span><span class="p">,</span> <span class="n">cachedir</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Display background image using ArcGIS Server REST API.</span>

<span class="sd">        In order to use this method, the :class:`Basemap` instance</span>
<span class="sd">        must be created using the ``epsg`` keyword to define the</span>
<span class="sd">        map projection, unless the &quot;cyl&quot; projection is used (in</span>
<span class="sd">        which case the EPSG code 4326 is assumed).</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        server : str, optional</span>
<span class="sd">            base URL of the web map server</span>

<span class="sd">        service : str, optional</span>
<span class="sd">            service (image type) hosted by the server</span>

<span class="sd">        xpixels : int, optional</span>
<span class="sd">            requested number of image pixels in the `x`-direction</span>

<span class="sd">        ypixels : int, optional</span>
<span class="sd">            requested number of image pixels in the `y`-direction;</span>
<span class="sd">            if not given, it is inferred from ``xpixels`` and the</span>
<span class="sd">            aspect ratio of the map projection region</span>

<span class="sd">        dpi : int, optional</span>
<span class="sd">            device resolution of the exported image</span>

<span class="sd">        cachedir : str, optional</span>
<span class="sd">            if given, directory to use as cache folder for the images</span>
<span class="sd">            retrieved from the server</span>

<span class="sd">        verbose : bool, optional</span>
<span class="sd">            if True, print debugging information</span>

<span class="sd">        \**kwargs : dict, optional</span>
<span class="sd">            keyword-only arguments; currently, only ``ax`` is supported</span>
<span class="sd">            to override the default :class:`matplotlib.axes.Axes`</span>
<span class="sd">            instance</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>

<span class="sd">        aximg : matplotlib.image.AxesImage</span>
<span class="sd">            image axes instance</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Fix PIL import on some versions of OSX and scipy.</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="kn">from</span><span class="w"> </span><span class="nn">PIL</span><span class="w"> </span><span class="kn">import</span> <span class="n">Image</span>
        <span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="kn">import</span><span class="w"> </span><span class="nn">Image</span>
            <span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ImportError</span><span class="p">(</span><span class="s2">&quot;arcgisimage method requires PIL &quot;</span>
                                  <span class="s2">&quot;(http://pillow.readthedocs.io)&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;epsg&quot;</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;the Basemap instance must be created using &quot;</span>
                             <span class="s2">&quot;an EPSG code (http://spatialreference.org) &quot;</span>
                             <span class="s2">&quot;in order to use the wmsmap method&quot;</span><span class="p">)</span>

        <span class="n">ax</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;ax&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check_ax</span><span class="p">()</span>

        <span class="c1"># Find the `(x, y)` values at the corner points.</span>
        <span class="k">with</span> <span class="n">warnings</span><span class="o">.</span><span class="n">catch_warnings</span><span class="p">():</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">simplefilter</span><span class="p">(</span><span class="s2">&quot;ignore&quot;</span><span class="p">,</span> <span class="n">category</span><span class="o">=</span><span class="ne">FutureWarning</span><span class="p">)</span>
            <span class="n">p</span> <span class="o">=</span> <span class="n">pyproj</span><span class="o">.</span><span class="n">Proj</span><span class="p">(</span><span class="n">init</span><span class="o">=</span><span class="s2">&quot;epsg:</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">epsg</span><span class="p">,</span> <span class="n">preserve_units</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">xmin</span><span class="p">,</span> <span class="n">ymin</span> <span class="o">=</span> <span class="n">p</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">llcrnrlon</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">llcrnrlat</span><span class="p">)</span>
        <span class="n">xmax</span><span class="p">,</span> <span class="n">ymax</span> <span class="o">=</span> <span class="n">p</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">urcrnrlon</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">urcrnrlat</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">projection</span> <span class="ow">in</span> <span class="n">_cylproj</span><span class="p">:</span>
            <span class="n">dateline</span> <span class="o">=</span> <span class="n">_geoslib</span><span class="o">.</span><span class="n">Point</span><span class="p">(</span><span class="bp">self</span><span class="p">(</span><span class="mf">180.</span><span class="p">,</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">llcrnrlat</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">urcrnrlat</span><span class="p">)))</span>
            <span class="k">if</span> <span class="n">dateline</span><span class="o">.</span><span class="n">within</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_boundarypolyxy</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;arcgisimage cannot handle images that cross &quot;</span>
                                 <span class="s2">&quot;the dateline for cylindrical projections&quot;</span><span class="p">)</span>

        <span class="c1"># If ypixels is not given, compute it with xpixels and aspect ratio.</span>
        <span class="k">if</span> <span class="n">ypixels</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">ypixels</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">aspect</span> <span class="o">*</span> <span class="n">xpixels</span><span class="p">)</span>

        <span class="c1"># Construct a URL using the ArcGIS Server REST API.</span>
        <span class="n">basemap_url</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span>
            <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">/rest/services/</span><span class="si">%s</span><span class="s2">/MapServer/export?&quot;</span><span class="p">,</span>
            <span class="s2">&quot;bbox=</span><span class="si">%s</span><span class="s2">,</span><span class="si">%s</span><span class="s2">,</span><span class="si">%s</span><span class="s2">,</span><span class="si">%s</span><span class="s2">&amp;&quot;</span><span class="p">,</span>
            <span class="s2">&quot;bboxSR=</span><span class="si">%s</span><span class="s2">&amp;&quot;</span><span class="p">,</span>
            <span class="s2">&quot;imageSR=</span><span class="si">%s</span><span class="s2">&amp;&quot;</span><span class="p">,</span>
            <span class="s2">&quot;size=</span><span class="si">%s</span><span class="s2">,</span><span class="si">%s</span><span class="s2">&amp;&quot;</span><span class="p">,</span>
            <span class="s2">&quot;dpi=</span><span class="si">%s</span><span class="s2">&amp;&quot;</span><span class="p">,</span>
            <span class="s2">&quot;format=png32&amp;&quot;</span><span class="p">,</span>
            <span class="s2">&quot;transparent=true&amp;&quot;</span><span class="p">,</span>
            <span class="s2">&quot;f=image&quot;</span><span class="p">,</span>
        <span class="p">])</span> <span class="o">%</span> <span class="p">(</span><span class="n">server</span><span class="p">,</span> <span class="n">service</span><span class="p">,</span> <span class="n">xmin</span><span class="p">,</span> <span class="n">ymin</span><span class="p">,</span> <span class="n">xmax</span><span class="p">,</span> <span class="n">ymax</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">epsg</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">epsg</span><span class="p">,</span> <span class="n">xpixels</span><span class="p">,</span> <span class="n">ypixels</span><span class="p">,</span> <span class="n">dpi</span><span class="p">)</span>

        <span class="c1"># Print URL in verbose mode.</span>
        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>  <span class="c1"># pragma: no cover</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">basemap_url</span><span class="p">)</span>

        <span class="c1"># Try to return fast if cache is enabled.</span>
        <span class="k">if</span> <span class="n">cachedir</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># Generate a filename for the cached file.</span>
            <span class="n">filename</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">-bbox-</span><span class="si">%s</span><span class="s2">-</span><span class="si">%s</span><span class="s2">-</span><span class="si">%s</span><span class="s2">-</span><span class="si">%s</span><span class="s2">-bboxsr</span><span class="si">%s</span><span class="s2">-imagesr</span><span class="si">%s</span><span class="s2">-size-</span><span class="si">%s</span><span class="s2">-</span><span class="si">%s</span><span class="s2">-dpi</span><span class="si">%s</span><span class="s2">.png&quot;</span> <span class="o">%</span> \
                <span class="p">(</span><span class="n">service</span><span class="p">,</span> <span class="n">xmin</span><span class="p">,</span> <span class="n">ymin</span><span class="p">,</span> <span class="n">xmax</span><span class="p">,</span> <span class="n">ymax</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">epsg</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">epsg</span><span class="p">,</span> <span class="n">xpixels</span><span class="p">,</span> <span class="n">ypixels</span><span class="p">,</span> <span class="n">dpi</span><span class="p">)</span>
            <span class="c1"># Return fast if the image is already in the cache.</span>
            <span class="n">cache_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">cachedir</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">cache_path</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>  <span class="c1"># pragma: no cover</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Image already in cache&quot;</span><span class="p">)</span>
                <span class="n">img</span> <span class="o">=</span> <span class="n">Image</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">cache_path</span><span class="p">)</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">origin</span><span class="o">=</span><span class="s2">&quot;upper&quot;</span><span class="p">)</span>

        <span class="c1"># Retrieve image from the remote server.</span>
        <span class="kn">import</span><span class="w"> </span><span class="nn">contextlib</span>
        <span class="n">conn</span> <span class="o">=</span> <span class="n">urlopen</span><span class="p">(</span><span class="n">basemap_url</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">contextlib</span><span class="o">.</span><span class="n">closing</span><span class="p">(</span><span class="n">conn</span><span class="p">):</span>
            <span class="n">img</span> <span class="o">=</span> <span class="n">Image</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">conn</span><span class="p">)</span>
            <span class="c1"># Save to cache if requested.</span>
            <span class="k">if</span> <span class="n">cachedir</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="c1"># Check if the cache directory exists, if not create it.</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">cachedir</span><span class="p">):</span>
                    <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">cachedir</span><span class="p">)</span>
                <span class="n">img</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">cache_path</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">origin</span><span class="o">=</span><span class="s2">&quot;upper&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="Basemap.wmsimage">
<a class="viewcode-back" href="../../api/basemap_api.html#mpl_toolkits.basemap.Basemap.wmsimage">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">wmsimage</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">server</span><span class="p">,</span>\
                 <span class="n">xpixels</span><span class="o">=</span><span class="mi">400</span><span class="p">,</span><span class="n">ypixels</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>\
                 <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;png&#39;</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Retrieve an image using from a WMS server using the</span>
<span class="sd">        Open Geospatial Consortium (OGC) standard interface</span>
<span class="sd">        and display on the map. Requires OWSLib</span>
<span class="sd">        (http://pypi.python.org/pypi/OWSLib).</span>
<span class="sd">        In order to use this method, the Basemap instance must be</span>
<span class="sd">        created using the ``epsg`` keyword to define the map projection, unless</span>
<span class="sd">        the ``cyl`` projection is used (in which case the epsg code 4326 is</span>
<span class="sd">        assumed).</span>

<span class="sd">        .. tabularcolumns:: |l|L|</span>

<span class="sd">        ==============   ====================================================</span>
<span class="sd">        Keywords         Description</span>
<span class="sd">        ==============   ====================================================</span>
<span class="sd">        server           WMS server URL.</span>
<span class="sd">        xpixels          requested number of image pixels in x-direction</span>
<span class="sd">                         (default 400).</span>
<span class="sd">        ypixels          requested number of image pixels in y-direction.</span>
<span class="sd">                         Default (None) is to infer the number from</span>
<span class="sd">                         from xpixels and the aspect ratio of the</span>
<span class="sd">                         map projection region.</span>
<span class="sd">        format           desired image format (default &#39;png&#39;)</span>
<span class="sd">        alpha            The alpha blending value,</span>
<span class="sd">                         between 0 (transparent) and 1 (opaque) (default None)</span>
<span class="sd">        verbose          if True, print WMS server info (default</span>
<span class="sd">                         False).</span>
<span class="sd">        \**kwargs        extra keyword arguments passed on to</span>
<span class="sd">                         OWSLib.wms.WebMapService and</span>
<span class="sd">                         OWSLib.wms.WebMapService.getmap.</span>
<span class="sd">        ==============   ====================================================</span>

<span class="sd">        Extra keyword ``ax`` can be used to override the default axis instance.</span>

<span class="sd">        returns a matplotlib.image.AxesImage instance.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="kn">from</span><span class="w"> </span><span class="nn">owslib.wms</span><span class="w"> </span><span class="kn">import</span> <span class="n">WebMapService</span>
        <span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ImportError</span><span class="p">(</span><span class="s1">&#39;OWSLib required to use wmsimage method&#39;</span><span class="p">)</span>
        <span class="kn">import</span><span class="w"> </span><span class="nn">io</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;ax&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check_ax</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="s1">&#39;epsg&#39;</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;the Basemap instance must be created using &quot;</span>
                             <span class="s2">&quot;an EPSG code (http://spatialreference.org) &quot;</span>
                             <span class="s2">&quot;in order to use the wmsmap method&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="s1">&#39;layers&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;no layers specified&#39;</span><span class="p">)</span>
        <span class="c1"># find the x,y values at the corner points.</span>
        <span class="k">with</span> <span class="n">warnings</span><span class="o">.</span><span class="n">catch_warnings</span><span class="p">():</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">simplefilter</span><span class="p">(</span><span class="s2">&quot;ignore&quot;</span><span class="p">,</span> <span class="n">category</span><span class="o">=</span><span class="ne">FutureWarning</span><span class="p">)</span>
            <span class="n">p</span> <span class="o">=</span> <span class="n">pyproj</span><span class="o">.</span><span class="n">Proj</span><span class="p">(</span><span class="n">init</span><span class="o">=</span><span class="s2">&quot;epsg:</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">epsg</span><span class="p">,</span> <span class="n">preserve_units</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">xmin</span><span class="p">,</span><span class="n">ymin</span> <span class="o">=</span> <span class="n">p</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">llcrnrlon</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">llcrnrlat</span><span class="p">)</span>
        <span class="n">xmax</span><span class="p">,</span><span class="n">ymax</span> <span class="o">=</span> <span class="n">p</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">urcrnrlon</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">urcrnrlat</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">projection</span> <span class="ow">in</span> <span class="n">_cylproj</span><span class="p">:</span>
            <span class="n">Dateline</span> <span class="o">=</span>\
            <span class="n">_geoslib</span><span class="o">.</span><span class="n">Point</span><span class="p">(</span><span class="bp">self</span><span class="p">(</span><span class="mf">180.</span><span class="p">,</span><span class="mf">0.5</span><span class="o">*</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">llcrnrlat</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">urcrnrlat</span><span class="p">)))</span>
            <span class="n">hasDateline</span> <span class="o">=</span> <span class="n">Dateline</span><span class="o">.</span><span class="n">within</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_boundarypolyxy</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">hasDateline</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;wmsimage cannot handle images that cross &quot;</span>
                                 <span class="s2">&quot;the dateline for cylindrical projections&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">projection</span> <span class="o">==</span> <span class="s1">&#39;cyl&#39;</span><span class="p">:</span>
            <span class="n">xmin</span> <span class="o">=</span> <span class="p">(</span><span class="mf">180.</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span><span class="o">*</span><span class="n">xmin</span><span class="p">;</span> <span class="n">xmax</span> <span class="o">=</span> <span class="p">(</span><span class="mf">180.</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span><span class="o">*</span><span class="n">xmax</span>
            <span class="n">ymin</span> <span class="o">=</span> <span class="p">(</span><span class="mf">180.</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span><span class="o">*</span><span class="n">ymin</span><span class="p">;</span> <span class="n">ymax</span> <span class="o">=</span> <span class="p">(</span><span class="mf">180.</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span><span class="o">*</span><span class="n">ymax</span>
        <span class="c1"># ypixels not given, find by scaling xpixels by the map aspect ratio.</span>
        <span class="k">if</span> <span class="n">ypixels</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">ypixels</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">aspect</span><span class="o">*</span><span class="n">xpixels</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="n">server</span><span class="p">)</span>
        <span class="n">wms_keys</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;version&quot;</span><span class="p">,</span> <span class="s2">&quot;xml&quot;</span><span class="p">,</span> <span class="s2">&quot;username&quot;</span><span class="p">,</span> <span class="s2">&quot;password&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;parse_remote_metadata&quot;</span><span class="p">,</span> <span class="s2">&quot;timeout&quot;</span><span class="p">,</span> <span class="s2">&quot;headers&quot;</span><span class="p">,</span> <span class="s2">&quot;auth&quot;</span><span class="p">]</span>
        <span class="n">wms_options</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">kwargs</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">wms_keys</span> <span class="k">if</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">}</span>
        <span class="n">kwargs</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">kwargs</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="k">if</span> <span class="n">k</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">wms_keys</span><span class="p">}</span>
        <span class="n">wms</span> <span class="o">=</span> <span class="n">WebMapService</span><span class="p">(</span><span class="n">server</span><span class="p">,</span> <span class="o">**</span><span class="n">wms_options</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;id: </span><span class="si">%s</span><span class="s1">, version: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span>
            <span class="p">(</span><span class="n">wms</span><span class="o">.</span><span class="n">identification</span><span class="o">.</span><span class="n">type</span><span class="p">,</span><span class="n">wms</span><span class="o">.</span><span class="n">identification</span><span class="o">.</span><span class="n">version</span><span class="p">))</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;title: </span><span class="si">%s</span><span class="s1">, abstract: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span>
            <span class="p">(</span><span class="n">wms</span><span class="o">.</span><span class="n">identification</span><span class="o">.</span><span class="n">title</span><span class="p">,</span><span class="n">wms</span><span class="o">.</span><span class="n">identification</span><span class="o">.</span><span class="n">abstract</span><span class="p">))</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;available layers:&#39;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">wms</span><span class="o">.</span><span class="n">contents</span><span class="p">))</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;projection options:&#39;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">wms</span><span class="p">[</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;layers&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]]</span><span class="o">.</span><span class="n">crsOptions</span><span class="p">)</span>
        <span class="c1"># remove keys from kwargs that are over-ridden</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;format&#39;</span><span class="p">,</span><span class="s1">&#39;bbox&#39;</span><span class="p">,</span><span class="s1">&#39;service&#39;</span><span class="p">,</span><span class="s1">&#39;size&#39;</span><span class="p">,</span><span class="s1">&#39;srs&#39;</span><span class="p">]:</span>
            <span class="k">if</span> <span class="s1">&#39;format&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span> <span class="k">del</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;format&#39;</span><span class="p">]</span>
        <span class="n">img</span> <span class="o">=</span> <span class="n">wms</span><span class="o">.</span><span class="n">getmap</span><span class="p">(</span><span class="n">service</span><span class="o">=</span><span class="s1">&#39;wms&#39;</span><span class="p">,</span><span class="n">bbox</span><span class="o">=</span><span class="p">(</span><span class="n">xmin</span><span class="p">,</span><span class="n">ymin</span><span class="p">,</span><span class="n">xmax</span><span class="p">,</span><span class="n">ymax</span><span class="p">),</span>
                         <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="n">xpixels</span><span class="p">,</span><span class="n">ypixels</span><span class="p">),</span><span class="nb">format</span><span class="o">=</span><span class="s1">&#39;image/</span><span class="si">%s</span><span class="s1">&#39;</span><span class="o">%</span><span class="nb">format</span><span class="p">,</span>
                         <span class="n">srs</span><span class="o">=</span><span class="s1">&#39;EPSG:</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">epsg</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="c1"># return AxesImage instance.</span>
        <span class="c1"># this works for png and jpeg.</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">imread</span><span class="p">(</span><span class="n">io</span><span class="o">.</span><span class="n">BytesIO</span><span class="p">(</span><span class="n">img</span><span class="o">.</span><span class="n">read</span><span class="p">()),</span>
                           <span class="nb">format</span><span class="o">=</span><span class="nb">format</span><span class="p">),</span><span class="n">origin</span><span class="o">=</span><span class="s1">&#39;upper&#39;</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="n">alpha</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span></div>


<div class="viewcode-block" id="Basemap.drawmapscale">
<a class="viewcode-back" href="../../api/basemap_api.html#mpl_toolkits.basemap.Basemap.drawmapscale">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">drawmapscale</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">lon</span><span class="p">,</span><span class="n">lat</span><span class="p">,</span><span class="n">lon0</span><span class="p">,</span><span class="n">lat0</span><span class="p">,</span><span class="n">length</span><span class="p">,</span><span class="n">barstyle</span><span class="o">=</span><span class="s1">&#39;simple&#39;</span><span class="p">,</span>\
                     <span class="n">units</span><span class="o">=</span><span class="s1">&#39;km&#39;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">9</span><span class="p">,</span><span class="n">yoffset</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">labelstyle</span><span class="o">=</span><span class="s1">&#39;simple&#39;</span><span class="p">,</span>\
                     <span class="n">fontcolor</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span><span class="n">fillcolor1</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">,</span><span class="n">fillcolor2</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>\
                     <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%d</span><span class="s1">&#39;</span><span class="p">,</span><span class="n">zorder</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">linecolor</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">linewidth</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Draw a map scale at ``lon,lat`` of length ``length``</span>
<span class="sd">        representing distance in the map</span>
<span class="sd">        projection coordinates at ``lon0,lat0``.</span>

<span class="sd">        .. tabularcolumns:: |l|L|</span>

<span class="sd">        ==============   ====================================================</span>
<span class="sd">        Keywords         Description</span>
<span class="sd">        ==============   ====================================================</span>
<span class="sd">        units            the units of the length argument (Default km).</span>
<span class="sd">        barstyle         ``simple`` or ``fancy`` (roughly corresponding</span>
<span class="sd">                         to the styles provided by Generic Mapping Tools).</span>
<span class="sd">                         Default ``simple``.</span>
<span class="sd">        fontsize         for map scale annotations, default 9.</span>
<span class="sd">        fontcolor            for map scale annotations, default black.</span>
<span class="sd">        labelstyle       ``simple`` (default) or ``fancy``.  For</span>
<span class="sd">                         ``fancy`` the map scale factor (ratio betwee</span>
<span class="sd">                         the actual distance and map projection distance</span>
<span class="sd">                         at lon0,lat0) and the value of lon0,lat0 are also</span>
<span class="sd">                         displayed on the top of the scale bar. For</span>
<span class="sd">                         ``simple``, just the units are display on top</span>
<span class="sd">                         and the distance below the scale bar.</span>
<span class="sd">                         If equal to False, plot an empty label.</span>
<span class="sd">        format           a string formatter to format numeric values</span>
<span class="sd">        yoffset          yoffset controls how tall the scale bar is,</span>
<span class="sd">                         and how far the annotations are offset from the</span>
<span class="sd">                         scale bar.  Default is 0.02 times the height of</span>
<span class="sd">                         the map (0.02*(self.ymax-self.ymin)).</span>
<span class="sd">        fillcolor1(2)    colors of the alternating filled regions</span>
<span class="sd">                         (default white and black).  Only relevant for</span>
<span class="sd">                         &#39;fancy&#39; barstyle.</span>
<span class="sd">        zorder           sets the zorder for the map scale.</span>
<span class="sd">        linecolor        sets the color of the scale, by default, fontcolor</span>
<span class="sd">                         is used</span>
<span class="sd">        linewidth        linewidth for scale and ticks</span>
<span class="sd">        ==============   ====================================================</span>

<span class="sd">        Extra keyword ``ax`` can be used to override the default axis instance.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># get current axes instance (if none specified).</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="n">ax</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check_ax</span><span class="p">()</span>
        <span class="c1"># not valid for cylindrical projection</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">projection</span> <span class="o">==</span> <span class="s1">&#39;cyl&#39;</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;cannot draw map scale for projection=&#39;cyl&#39;&quot;</span><span class="p">)</span>
        <span class="c1"># convert length to meters</span>
        <span class="n">lenlab</span> <span class="o">=</span> <span class="n">length</span>
        <span class="k">if</span> <span class="n">units</span> <span class="o">==</span> <span class="s1">&#39;km&#39;</span><span class="p">:</span>
            <span class="n">length</span> <span class="o">=</span> <span class="n">length</span><span class="o">*</span><span class="mi">1000</span>
        <span class="k">elif</span> <span class="n">units</span> <span class="o">==</span> <span class="s1">&#39;mi&#39;</span><span class="p">:</span>
            <span class="n">length</span> <span class="o">=</span> <span class="n">length</span><span class="o">*</span><span class="mf">1609.344</span>
        <span class="k">elif</span> <span class="n">units</span> <span class="o">==</span> <span class="s1">&#39;nmi&#39;</span><span class="p">:</span>
            <span class="n">length</span> <span class="o">=</span> <span class="n">length</span><span class="o">*</span><span class="mi">1852</span>
        <span class="k">elif</span> <span class="n">units</span> <span class="o">==</span> <span class="s1">&#39;ft&#39;</span><span class="p">:</span>
            <span class="n">length</span> <span class="o">=</span> <span class="n">length</span><span class="o">*</span><span class="mf">0.3048</span>
        <span class="k">elif</span> <span class="n">units</span> <span class="o">!=</span> <span class="s1">&#39;m&#39;</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="s2">&quot;units must be &#39;m&#39; (meters), &#39;km&#39; (kilometers), &quot;</span>
                           <span class="s2">&quot;&#39;mi&#39; (miles), &#39;nmi&#39; (nautical miles), or &#39;ft&#39; (feet)&quot;</span><span class="p">)</span>
        <span class="c1"># reference point and center of scale.</span>
        <span class="n">x0</span><span class="p">,</span><span class="n">y0</span> <span class="o">=</span> <span class="bp">self</span><span class="p">(</span><span class="n">lon0</span><span class="p">,</span><span class="n">lat0</span><span class="p">)</span>
        <span class="n">xc</span><span class="p">,</span><span class="n">yc</span> <span class="o">=</span> <span class="bp">self</span><span class="p">(</span><span class="n">lon</span><span class="p">,</span><span class="n">lat</span><span class="p">)</span>
        <span class="c1"># make sure lon_0 between -180 and 180</span>
        <span class="n">lon_0</span> <span class="o">=</span> <span class="p">((</span><span class="n">lon0</span><span class="o">+</span><span class="mi">360</span><span class="p">)</span> <span class="o">%</span> <span class="mi">360</span><span class="p">)</span> <span class="o">-</span> <span class="mi">360</span>
        <span class="n">degchar</span> <span class="o">=</span> <span class="sa">b</span><span class="s2">&quot;</span><span class="se">\xc2\xb0</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">lat0</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">lon</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
                <span class="n">lonlatstr</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%g%s</span><span class="s1">N, </span><span class="si">%g%s</span><span class="s1">E&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">lat0</span><span class="p">,</span> <span class="n">degchar</span><span class="p">,</span> <span class="n">lon_0</span><span class="p">,</span> <span class="n">degchar</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">lon</span><span class="o">&lt;</span><span class="mi">0</span><span class="p">:</span>
                <span class="n">lonlatstr</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%g%s</span><span class="s1">N, </span><span class="si">%g%s</span><span class="s1">W&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">lat0</span><span class="p">,</span> <span class="n">degchar</span><span class="p">,</span> <span class="n">lon_0</span><span class="p">,</span> <span class="n">degchar</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">lonlatstr</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%g%s</span><span class="s1">, </span><span class="si">%g%s</span><span class="s1">W&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">lat0</span><span class="p">,</span> <span class="n">degchar</span><span class="p">,</span> <span class="n">lon_0</span><span class="p">,</span> <span class="n">degchar</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">lon</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
                <span class="n">lonlatstr</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%g%s</span><span class="s1">S, </span><span class="si">%g%s</span><span class="s1">E&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">lat0</span><span class="p">,</span> <span class="n">degchar</span><span class="p">,</span> <span class="n">lon_0</span><span class="p">,</span> <span class="n">degchar</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">lon</span><span class="o">&lt;</span><span class="mi">0</span><span class="p">:</span>
                <span class="n">lonlatstr</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%g%s</span><span class="s1">S, </span><span class="si">%g%s</span><span class="s1">W&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">lat0</span><span class="p">,</span> <span class="n">degchar</span><span class="p">,</span> <span class="n">lon_0</span><span class="p">,</span> <span class="n">degchar</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">lonlatstr</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%g%s</span><span class="s1">S, </span><span class="si">%g%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">lat0</span><span class="p">,</span> <span class="n">degchar</span><span class="p">,</span> <span class="n">lon_0</span><span class="p">,</span> <span class="n">degchar</span><span class="p">)</span>
        <span class="c1"># left edge of scale</span>
        <span class="n">lon1</span><span class="p">,</span><span class="n">lat1</span> <span class="o">=</span> <span class="bp">self</span><span class="p">(</span><span class="n">x0</span><span class="o">-</span><span class="n">length</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span><span class="n">y0</span><span class="p">,</span><span class="n">inverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">x1</span><span class="p">,</span><span class="n">y1</span> <span class="o">=</span> <span class="bp">self</span><span class="p">(</span><span class="n">lon1</span><span class="p">,</span><span class="n">lat1</span><span class="p">)</span>
        <span class="c1"># right edge of scale</span>
        <span class="n">lon4</span><span class="p">,</span><span class="n">lat4</span> <span class="o">=</span> <span class="bp">self</span><span class="p">(</span><span class="n">x0</span><span class="o">+</span><span class="n">length</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span><span class="n">y0</span><span class="p">,</span><span class="n">inverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">x4</span><span class="p">,</span><span class="n">y4</span> <span class="o">=</span> <span class="bp">self</span><span class="p">(</span><span class="n">lon4</span><span class="p">,</span><span class="n">lat4</span><span class="p">)</span>
        <span class="n">x1</span> <span class="o">=</span> <span class="n">x1</span><span class="o">-</span><span class="n">x0</span><span class="o">+</span><span class="n">xc</span><span class="p">;</span> <span class="n">y1</span> <span class="o">=</span> <span class="n">y1</span><span class="o">-</span><span class="n">y0</span><span class="o">+</span><span class="n">yc</span>
        <span class="n">x4</span> <span class="o">=</span> <span class="n">x4</span><span class="o">-</span><span class="n">x0</span><span class="o">+</span><span class="n">xc</span><span class="p">;</span> <span class="n">y4</span> <span class="o">=</span> <span class="n">y4</span><span class="o">-</span><span class="n">y0</span><span class="o">+</span><span class="n">yc</span>
        <span class="k">if</span> <span class="n">x1</span> <span class="o">&gt;</span> <span class="mf">1.e20</span> <span class="ow">or</span> <span class="n">x4</span> <span class="o">&gt;</span> <span class="mf">1.e20</span> <span class="ow">or</span> <span class="n">y1</span> <span class="o">&gt;</span> <span class="mf">1.e20</span> <span class="ow">or</span> <span class="n">y4</span> <span class="o">&gt;</span> <span class="mf">1.e20</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;scale bar positioned outside projection limb&quot;</span><span class="p">)</span>
        <span class="c1"># scale factor for true distance</span>
        <span class="n">gc</span> <span class="o">=</span> <span class="n">pyproj</span><span class="o">.</span><span class="n">Geod</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">rmajor</span><span class="p">,</span><span class="n">b</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">rminor</span><span class="p">)</span>
        <span class="n">az12</span><span class="p">,</span><span class="n">az21</span><span class="p">,</span><span class="n">dist</span> <span class="o">=</span> <span class="n">gc</span><span class="o">.</span><span class="n">inv</span><span class="p">(</span><span class="n">lon1</span><span class="p">,</span><span class="n">lat1</span><span class="p">,</span><span class="n">lon4</span><span class="p">,</span><span class="n">lat4</span><span class="p">)</span>
        <span class="n">scalefact</span> <span class="o">=</span> <span class="n">dist</span><span class="o">/</span><span class="n">length</span>
        <span class="c1"># label to put on top of scale bar.</span>
        <span class="k">if</span> <span class="n">labelstyle</span><span class="o">==</span><span class="s1">&#39;simple&#39;</span><span class="p">:</span>
            <span class="n">labelstr</span> <span class="o">=</span> <span class="n">units</span>
        <span class="k">elif</span> <span class="n">labelstyle</span> <span class="o">==</span> <span class="s1">&#39;fancy&#39;</span><span class="p">:</span>
            <span class="n">labelstr</span> <span class="o">=</span> <span class="n">units</span><span class="o">+</span><span class="s2">&quot; (scale factor </span><span class="si">%4.2f</span><span class="s2"> at </span><span class="si">%s</span><span class="s2">)&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">scalefact</span><span class="p">,</span><span class="n">lonlatstr</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">labelstyle</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
            <span class="n">labelstr</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="s2">&quot;labelstyle must be &#39;simple&#39; or &#39;fancy&#39;&quot;</span><span class="p">)</span>
        <span class="c1"># default y offset is 2 percent of map height.</span>
        <span class="k">if</span> <span class="n">yoffset</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="n">yoffset</span> <span class="o">=</span> <span class="mf">0.02</span><span class="o">*</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ymax</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">ymin</span><span class="p">)</span>
        <span class="n">rets</span> <span class="o">=</span> <span class="p">[]</span> <span class="c1"># will hold all plot objects generated.</span>
        <span class="c1"># set linecolor</span>
        <span class="k">if</span> <span class="n">linecolor</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">linecolor</span> <span class="o">=</span> <span class="n">fontcolor</span>
        <span class="c1"># &#39;fancy&#39; style</span>
        <span class="k">if</span> <span class="n">barstyle</span> <span class="o">==</span> <span class="s1">&#39;fancy&#39;</span><span class="p">:</span>
            <span class="c1">#we need 5 sets of x coordinates (in map units)</span>
            <span class="c1">#quarter scale</span>
            <span class="n">lon2</span><span class="p">,</span><span class="n">lat2</span> <span class="o">=</span> <span class="bp">self</span><span class="p">(</span><span class="n">x0</span><span class="o">-</span><span class="n">length</span><span class="o">/</span><span class="mi">4</span><span class="p">,</span><span class="n">y0</span><span class="p">,</span><span class="n">inverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">x2</span><span class="p">,</span><span class="n">y2</span> <span class="o">=</span> <span class="bp">self</span><span class="p">(</span><span class="n">lon2</span><span class="p">,</span><span class="n">lat2</span><span class="p">)</span>
            <span class="n">x2</span> <span class="o">=</span> <span class="n">x2</span><span class="o">-</span><span class="n">x0</span><span class="o">+</span><span class="n">xc</span><span class="p">;</span> <span class="n">y2</span> <span class="o">=</span> <span class="n">y2</span><span class="o">-</span><span class="n">y0</span><span class="o">+</span><span class="n">yc</span>
            <span class="c1">#three quarter scale</span>
            <span class="n">lon3</span><span class="p">,</span><span class="n">lat3</span> <span class="o">=</span> <span class="bp">self</span><span class="p">(</span><span class="n">x0</span><span class="o">+</span><span class="n">length</span><span class="o">/</span><span class="mi">4</span><span class="p">,</span><span class="n">y0</span><span class="p">,</span><span class="n">inverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">x3</span><span class="p">,</span><span class="n">y3</span> <span class="o">=</span> <span class="bp">self</span><span class="p">(</span><span class="n">lon3</span><span class="p">,</span><span class="n">lat3</span><span class="p">)</span>
            <span class="n">x3</span> <span class="o">=</span> <span class="n">x3</span><span class="o">-</span><span class="n">x0</span><span class="o">+</span><span class="n">xc</span><span class="p">;</span> <span class="n">y3</span> <span class="o">=</span> <span class="n">y3</span><span class="o">-</span><span class="n">y0</span><span class="o">+</span><span class="n">yc</span>
            <span class="c1">#plot top line</span>
            <span class="n">ytop</span> <span class="o">=</span> <span class="n">yc</span><span class="o">+</span><span class="n">yoffset</span><span class="o">/</span><span class="mi">2</span>
            <span class="n">ybottom</span> <span class="o">=</span> <span class="n">yc</span><span class="o">-</span><span class="n">yoffset</span><span class="o">/</span><span class="mi">2</span>
            <span class="n">ytick</span> <span class="o">=</span> <span class="n">ybottom</span> <span class="o">-</span> <span class="n">yoffset</span><span class="o">/</span><span class="mi">2</span>
            <span class="n">ytext</span> <span class="o">=</span> <span class="n">ytick</span> <span class="o">-</span> <span class="n">yoffset</span><span class="o">/</span><span class="mi">2</span>
            <span class="n">rets</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">x1</span><span class="p">,</span><span class="n">x4</span><span class="p">],[</span><span class="n">ytop</span><span class="p">,</span><span class="n">ytop</span><span class="p">],</span><span class="n">color</span><span class="o">=</span><span class="n">linecolor</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="n">linewidth</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
            <span class="c1">#plot bottom line</span>
            <span class="n">rets</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">x1</span><span class="p">,</span><span class="n">x4</span><span class="p">],[</span><span class="n">ybottom</span><span class="p">,</span><span class="n">ybottom</span><span class="p">],</span><span class="n">color</span><span class="o">=</span><span class="n">linecolor</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="n">linewidth</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
            <span class="c1">#plot left edge</span>
            <span class="n">rets</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">x1</span><span class="p">,</span><span class="n">x1</span><span class="p">],[</span><span class="n">ybottom</span><span class="p">,</span><span class="n">ytop</span><span class="p">],</span><span class="n">color</span><span class="o">=</span><span class="n">linecolor</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="n">linewidth</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
            <span class="c1">#plot right edge</span>
            <span class="n">rets</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">x4</span><span class="p">,</span><span class="n">x4</span><span class="p">],[</span><span class="n">ybottom</span><span class="p">,</span><span class="n">ytop</span><span class="p">],</span><span class="n">color</span><span class="o">=</span><span class="n">linecolor</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="n">linewidth</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
            <span class="c1">#make a filled black box from left edge to 1/4 way across</span>
            <span class="n">rets</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ax</span><span class="o">.</span><span class="n">fill</span><span class="p">([</span><span class="n">x1</span><span class="p">,</span><span class="n">x2</span><span class="p">,</span><span class="n">x2</span><span class="p">,</span><span class="n">x1</span><span class="p">,</span><span class="n">x1</span><span class="p">],[</span><span class="n">ytop</span><span class="p">,</span><span class="n">ytop</span><span class="p">,</span><span class="n">ybottom</span><span class="p">,</span><span class="n">ybottom</span><span class="p">,</span><span class="n">ytop</span><span class="p">],</span>\
                        <span class="n">ec</span><span class="o">=</span><span class="n">fontcolor</span><span class="p">,</span><span class="n">fc</span><span class="o">=</span><span class="n">fillcolor1</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
            <span class="c1">#make a filled white box from 1/4 way across to 1/2 way across</span>
            <span class="n">rets</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ax</span><span class="o">.</span><span class="n">fill</span><span class="p">([</span><span class="n">x2</span><span class="p">,</span><span class="n">xc</span><span class="p">,</span><span class="n">xc</span><span class="p">,</span><span class="n">x2</span><span class="p">,</span><span class="n">x2</span><span class="p">],[</span><span class="n">ytop</span><span class="p">,</span><span class="n">ytop</span><span class="p">,</span><span class="n">ybottom</span><span class="p">,</span><span class="n">ybottom</span><span class="p">,</span><span class="n">ytop</span><span class="p">],</span>\
                        <span class="n">ec</span><span class="o">=</span><span class="n">fontcolor</span><span class="p">,</span><span class="n">fc</span><span class="o">=</span><span class="n">fillcolor2</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
            <span class="c1">#make a filled white box from 1/2 way across to 3/4 way across</span>
            <span class="n">rets</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ax</span><span class="o">.</span><span class="n">fill</span><span class="p">([</span><span class="n">xc</span><span class="p">,</span><span class="n">x3</span><span class="p">,</span><span class="n">x3</span><span class="p">,</span><span class="n">xc</span><span class="p">,</span><span class="n">xc</span><span class="p">],[</span><span class="n">ytop</span><span class="p">,</span><span class="n">ytop</span><span class="p">,</span><span class="n">ybottom</span><span class="p">,</span><span class="n">ybottom</span><span class="p">,</span><span class="n">ytop</span><span class="p">],</span>\
                        <span class="n">ec</span><span class="o">=</span><span class="n">fontcolor</span><span class="p">,</span><span class="n">fc</span><span class="o">=</span><span class="n">fillcolor1</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
            <span class="c1">#make a filled white box from 3/4 way across to end</span>
            <span class="n">rets</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ax</span><span class="o">.</span><span class="n">fill</span><span class="p">([</span><span class="n">x3</span><span class="p">,</span><span class="n">x4</span><span class="p">,</span><span class="n">x4</span><span class="p">,</span><span class="n">x3</span><span class="p">,</span><span class="n">x3</span><span class="p">],[</span><span class="n">ytop</span><span class="p">,</span><span class="n">ytop</span><span class="p">,</span><span class="n">ybottom</span><span class="p">,</span><span class="n">ybottom</span><span class="p">,</span><span class="n">ytop</span><span class="p">],</span>\
                        <span class="n">ec</span><span class="o">=</span><span class="n">fontcolor</span><span class="p">,</span><span class="n">fc</span><span class="o">=</span><span class="n">fillcolor2</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
            <span class="c1">#plot 3 tick marks at left edge, center, and right edge</span>
            <span class="n">rets</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">x1</span><span class="p">,</span><span class="n">x1</span><span class="p">],[</span><span class="n">ytick</span><span class="p">,</span><span class="n">ybottom</span><span class="p">],</span><span class="n">color</span><span class="o">=</span><span class="n">linecolor</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="n">linewidth</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">rets</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">xc</span><span class="p">,</span><span class="n">xc</span><span class="p">],[</span><span class="n">ytick</span><span class="p">,</span><span class="n">ybottom</span><span class="p">],</span><span class="n">color</span><span class="o">=</span><span class="n">linecolor</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="n">linewidth</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">rets</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">x4</span><span class="p">,</span><span class="n">x4</span><span class="p">],[</span><span class="n">ytick</span><span class="p">,</span><span class="n">ybottom</span><span class="p">],</span><span class="n">color</span><span class="o">=</span><span class="n">linecolor</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="n">linewidth</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
            <span class="c1">#label 3 tick marks</span>
            <span class="n">rets</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span><span class="n">ytext</span><span class="p">,</span><span class="nb">format</span> <span class="o">%</span> <span class="p">(</span><span class="mi">0</span><span class="p">),</span>\
            <span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span>\
            <span class="n">verticalalignment</span><span class="o">=</span><span class="s1">&#39;top&#39;</span><span class="p">,</span>\
            <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="n">fontcolor</span><span class="p">))</span>
            <span class="n">rets</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">xc</span><span class="p">,</span><span class="n">ytext</span><span class="p">,</span><span class="nb">format</span> <span class="o">%</span> <span class="p">(</span><span class="mf">0.5</span><span class="o">*</span><span class="n">lenlab</span><span class="p">),</span>\
            <span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span>\
            <span class="n">verticalalignment</span><span class="o">=</span><span class="s1">&#39;top&#39;</span><span class="p">,</span>\
            <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="n">fontcolor</span><span class="p">))</span>
            <span class="n">rets</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">x4</span><span class="p">,</span><span class="n">ytext</span><span class="p">,</span><span class="nb">format</span> <span class="o">%</span> <span class="p">(</span><span class="n">lenlab</span><span class="p">),</span>\
            <span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span>\
            <span class="n">verticalalignment</span><span class="o">=</span><span class="s1">&#39;top&#39;</span><span class="p">,</span>\
            <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="n">fontcolor</span><span class="p">))</span>
            <span class="c1">#put units, scale factor on top</span>
            <span class="n">rets</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">xc</span><span class="p">,</span><span class="n">ytop</span><span class="o">+</span><span class="n">yoffset</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span><span class="n">labelstr</span><span class="p">,</span>\
            <span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span>\
            <span class="n">verticalalignment</span><span class="o">=</span><span class="s1">&#39;bottom&#39;</span><span class="p">,</span>\
            <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="n">fontcolor</span><span class="p">))</span>
        <span class="c1"># &#39;simple&#39; style</span>
        <span class="k">elif</span> <span class="n">barstyle</span> <span class="o">==</span> <span class="s1">&#39;simple&#39;</span><span class="p">:</span>
            <span class="n">rets</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">x1</span><span class="p">,</span><span class="n">x4</span><span class="p">],[</span><span class="n">yc</span><span class="p">,</span><span class="n">yc</span><span class="p">],</span><span class="n">color</span><span class="o">=</span><span class="n">linecolor</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="n">linewidth</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">rets</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">x1</span><span class="p">,</span><span class="n">x1</span><span class="p">],[</span><span class="n">yc</span><span class="o">-</span><span class="n">yoffset</span><span class="p">,</span><span class="n">yc</span><span class="o">+</span><span class="n">yoffset</span><span class="p">],</span><span class="n">color</span><span class="o">=</span><span class="n">linecolor</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="n">linewidth</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">rets</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">x4</span><span class="p">,</span><span class="n">x4</span><span class="p">],[</span><span class="n">yc</span><span class="o">-</span><span class="n">yoffset</span><span class="p">,</span><span class="n">yc</span><span class="o">+</span><span class="n">yoffset</span><span class="p">],</span><span class="n">color</span><span class="o">=</span><span class="n">linecolor</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="n">linewidth</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">rets</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">xc</span><span class="p">,</span><span class="n">yc</span><span class="o">-</span><span class="n">yoffset</span><span class="p">,</span><span class="nb">format</span> <span class="o">%</span> <span class="n">lenlab</span><span class="p">,</span>\
            <span class="n">verticalalignment</span><span class="o">=</span><span class="s1">&#39;top&#39;</span><span class="p">,</span><span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span>\
            <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="n">fontcolor</span><span class="p">))</span>
            <span class="c1">#put units, scale factor on top</span>
            <span class="n">rets</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">xc</span><span class="p">,</span><span class="n">yc</span><span class="o">+</span><span class="n">yoffset</span><span class="p">,</span><span class="n">labelstr</span><span class="p">,</span>\
            <span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span>\
            <span class="n">verticalalignment</span><span class="o">=</span><span class="s1">&#39;bottom&#39;</span><span class="p">,</span>\
            <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="n">fontcolor</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="s2">&quot;barstyle must be &#39;simple&#39; or &#39;fancy&#39;&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">zorder</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">ret</span> <span class="ow">in</span> <span class="n">rets</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">ret</span><span class="o">.</span><span class="n">set_zorder</span><span class="p">(</span><span class="n">zorder</span><span class="p">)</span>
                <span class="k">except</span><span class="p">:</span>
                    <span class="k">pass</span>
        <span class="k">return</span> <span class="n">rets</span></div>


<div class="viewcode-block" id="Basemap.colorbar">
<a class="viewcode-back" href="../../api/basemap_api.html#mpl_toolkits.basemap.Basemap.colorbar">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">colorbar</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">mappable</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">location</span><span class="o">=</span><span class="s1">&#39;right&#39;</span><span class="p">,</span><span class="n">size</span><span class="o">=</span><span class="s2">&quot;5%&quot;</span><span class="p">,</span><span class="n">pad</span><span class="o">=</span><span class="s1">&#39;2%&#39;</span><span class="p">,</span><span class="n">fig</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Add colorbar to axes associated with a map.</span>
<span class="sd">        The colorbar axes instance is created using the axes_grid toolkit.</span>

<span class="sd">        .. tabularcolumns:: |l|L|</span>

<span class="sd">        ==============   ====================================================</span>
<span class="sd">        Keywords         Description</span>
<span class="sd">        ==============   ====================================================</span>
<span class="sd">        mappable         the Image, ContourSet, etc. to which the colorbar</span>
<span class="sd">                         applies.  Default None, matplotlib.pyplot.gci() is</span>
<span class="sd">                         used to retrieve the current image mappable.</span>
<span class="sd">        location         where to put colorbar (&#39;top&#39;,&#39;bottom&#39;,&#39;left&#39;,&#39;right&#39;)</span>
<span class="sd">                         Default &#39;right&#39;.</span>
<span class="sd">        size             width of colorbar axes (string &#39;N%&#39;, where N is</span>
<span class="sd">                         an integer describing the fractional width of the parent</span>
<span class="sd">                         axes). Default &#39;5%&#39;.</span>
<span class="sd">        pad              Padding between parent axes and colorbar axes in</span>
<span class="sd">                         same units as size. Default &#39;2%&#39;.</span>
<span class="sd">        fig              Figure instance the map axes instance is associated</span>
<span class="sd">                         with. Default None, and matplotlib.pyplot.gcf() is used</span>
<span class="sd">                         to retrieve the current active figure instance.</span>
<span class="sd">        ax               The axes instance which the colorbar will be</span>
<span class="sd">                         associated with.  Default None, searches for self.ax,</span>
<span class="sd">                         and if None uses matplotlib.pyplot.gca().</span>
<span class="sd">        \**kwargs        extra keyword arguments passed on to</span>
<span class="sd">                         colorbar method of the figure instance.</span>
<span class="sd">        ==============   ====================================================</span>

<span class="sd">        Returns a matplotlib colorbar instance.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># get current axes instance (if none specified).</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="n">ax</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check_ax</span><span class="p">()</span>
        <span class="c1"># get current figure instance (if none specified).</span>
        <span class="k">if</span> <span class="n">fig</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">mappable</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
        <span class="k">if</span> <span class="n">fig</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gcf</span><span class="p">()</span>
        <span class="c1"># get current mappable if none specified.</span>
        <span class="k">if</span> <span class="n">mappable</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">mappable</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gci</span><span class="p">()</span>
        <span class="c1"># create colorbar axes uses axes_grid toolkit.</span>
        <span class="n">divider</span> <span class="o">=</span> <span class="n">make_axes_locatable</span><span class="p">(</span><span class="n">ax</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">location</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;left&#39;</span><span class="p">,</span><span class="s1">&#39;right&#39;</span><span class="p">]:</span>
            <span class="n">orientation</span> <span class="o">=</span> <span class="s1">&#39;vertical&#39;</span>
        <span class="k">elif</span> <span class="n">location</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;top&#39;</span><span class="p">,</span><span class="s1">&#39;bottom&#39;</span><span class="p">]:</span>
            <span class="n">orientation</span> <span class="o">=</span> <span class="s1">&#39;horizontal&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;location must be top,bottom,left or right&#39;</span><span class="p">)</span>
        <span class="n">cax</span> <span class="o">=</span> <span class="n">divider</span><span class="o">.</span><span class="n">append_axes</span><span class="p">(</span><span class="n">location</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">size</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="n">pad</span><span class="p">)</span>
        <span class="c1"># create colorbar.</span>
        <span class="n">cb</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">mappable</span><span class="p">,</span><span class="n">orientation</span><span class="o">=</span><span class="n">orientation</span><span class="p">,</span><span class="n">cax</span><span class="o">=</span><span class="n">cax</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">sca</span><span class="p">(</span><span class="n">ax</span><span class="p">)</span> <span class="c1"># reset parent axes as current axes.</span>
        <span class="k">return</span> <span class="n">cb</span></div>


<div class="viewcode-block" id="Basemap.nightshade">
<a class="viewcode-back" href="../../api/basemap_api.html#mpl_toolkits.basemap.Basemap.nightshade">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">nightshade</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">date</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s2">&quot;k&quot;</span><span class="p">,</span><span class="n">delta</span><span class="o">=</span><span class="mf">0.25</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">zorder</span><span class="o">=</span><span class="mi">2</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Shade the regions of the map that are in darkness at the time</span>
<span class="sd">        specifed by ``date``.  ``date`` is a datetime instance,</span>
<span class="sd">        assumed to be UTC.</span>

<span class="sd">        .. tabularcolumns:: |l|L|</span>

<span class="sd">        ==============   ====================================================</span>
<span class="sd">        Keywords         Description</span>
<span class="sd">        ==============   ====================================================</span>
<span class="sd">        color            color to shade night regions (default black).</span>
<span class="sd">        delta            day/night terminator is computed with a</span>
<span class="sd">                         a resolution of ``delta`` degrees (default 0.25).</span>
<span class="sd">        alpha            alpha transparency for shading (default 0.5, so</span>
<span class="sd">                         map background shows through).</span>
<span class="sd">        zorder           zorder for shading (default 2).</span>
<span class="sd">        ==============   ====================================================</span>

<span class="sd">        Extra keyword ``ax`` can be used to override the default axis instance.</span>

<span class="sd">        returns a matplotlib.contour.ContourSet instance.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">from</span><span class="w"> </span><span class="nn">.solar</span><span class="w"> </span><span class="kn">import</span> <span class="n">daynight_grid</span>
        <span class="c1"># make sure date is UTC, or naive with repect to time zones</span>
        <span class="k">if</span> <span class="n">date</span><span class="o">.</span><span class="n">utcoffset</span><span class="p">():</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;datetime instance must be UTC, not </span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">date</span><span class="o">.</span><span class="n">tzname</span><span class="p">()))</span>
        <span class="c1"># get current axes instance (if none specified).</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="n">ax</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check_ax</span><span class="p">()</span>
        <span class="c1"># create grid of day=0, night=1</span>
        <span class="n">lons</span><span class="p">,</span><span class="n">lats</span><span class="p">,</span><span class="n">daynight</span> <span class="o">=</span> <span class="n">daynight_grid</span><span class="p">(</span><span class="n">date</span><span class="p">,</span><span class="n">delta</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">lonmin</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">lonmax</span><span class="p">)</span>
        <span class="n">x</span><span class="p">,</span><span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="p">(</span><span class="n">lons</span><span class="p">,</span><span class="n">lats</span><span class="p">)</span>
        <span class="c1"># contour the day-night grid, coloring the night area</span>
        <span class="c1"># with the specified color and transparency.</span>
        <span class="n">CS</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">contourf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">daynight</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">colors</span><span class="o">=</span><span class="p">[</span><span class="n">color</span><span class="p">],</span><span class="n">alpha</span><span class="o">=</span><span class="n">alpha</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">CS</span><span class="p">,</span> <span class="n">Artist</span><span class="p">):</span>
            <span class="c1"># Since MPL 3.8, `QuadContourSet` objects are `Artist` objects too.</span>
            <span class="n">CS</span><span class="o">.</span><span class="n">set_zorder</span><span class="p">(</span><span class="n">zorder</span><span class="p">)</span>
            <span class="c1"># clip to map limbs</span>
            <span class="n">CS</span><span class="p">,</span> <span class="n">c</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cliplimb</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">CS</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># set zorder on ContourSet collections show night shading</span>
            <span class="c1"># is on top.</span>
            <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">CS</span><span class="o">.</span><span class="n">collections</span><span class="p">:</span>
                <span class="n">c</span><span class="o">.</span><span class="n">set_zorder</span><span class="p">(</span><span class="n">zorder</span><span class="p">)</span>
            <span class="c1"># clip to map limbs</span>
            <span class="n">CS</span><span class="o">.</span><span class="n">collections</span><span class="p">,</span> <span class="n">c</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cliplimb</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">CS</span><span class="o">.</span><span class="n">collections</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">CS</span></div>


    <span class="k">def</span><span class="w"> </span><span class="nf">_check_ax</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the axis on which to draw.</span>
<span class="sd">        Returns self.ax, or if self.ax=None returns plt.gca().</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ax</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
                <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>
            <span class="c1"># associate an axes instance with this Basemap instance</span>
            <span class="c1"># the first time this method is called.</span>
            <span class="c1">#self.ax = ax</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ax</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ax</span>
        <span class="k">return</span> <span class="n">ax</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_ax_plt_from_kw</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">kw</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return (ax, plt), where ax is the current axes, and plt is</span>
<span class="sd">        None or a reference to the pyplot module.</span>

<span class="sd">        plt will be None if ax was popped from kw or taken from self.ax;</span>
<span class="sd">        otherwise, pyplot was used and is returned.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">plt</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">_ax</span> <span class="o">=</span> <span class="n">kw</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;ax&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">_ax</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">_ax</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ax</span>
            <span class="k">if</span> <span class="n">_ax</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
                <span class="n">_ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">_ax</span><span class="p">,</span> <span class="n">plt</span>

<div class="viewcode-block" id="Basemap.shiftdata">
<a class="viewcode-back" href="../../api/basemap_api.html#mpl_toolkits.basemap.Basemap.shiftdata">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">shiftdata</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">lonsin</span><span class="p">,</span><span class="n">datain</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">lon_0</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">fix_wrap_around</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Shift longitudes (and optionally data) so that they match map projection region.</span>
<span class="sd">        Only valid for cylindrical/pseudo-cylindrical global projections and data</span>
<span class="sd">        on regular lat/lon grids. longitudes and data can be 1-d or 2-d, if 2-d</span>
<span class="sd">        it is assumed longitudes are 2nd (rightmost) dimension.</span>

<span class="sd">        .. tabularcolumns:: |l|L|</span>

<span class="sd">        ================ ======================================================</span>
<span class="sd">        Arguments        Description</span>
<span class="sd">        ================ ======================================================</span>
<span class="sd">        lonsin           original 1-d or 2-d longitudes.</span>
<span class="sd">        ================ ======================================================</span>

<span class="sd">        .. tabularcolumns:: |l|L|</span>

<span class="sd">        ================ ======================================================</span>
<span class="sd">        Keywords         Description</span>
<span class="sd">        ================ ======================================================</span>
<span class="sd">        datain           original 1-d or 2-d data. Default None.</span>
<span class="sd">        lon_0            center of map projection region. Defaut None,</span>
<span class="sd">                         given by current map projection.</span>
<span class="sd">        fix_wrap_around  if True reindex (if required) longitudes (and data) to</span>
<span class="sd">                         avoid jumps caused by remapping of longitudes of</span>
<span class="sd">                         points from outside of the [lon_0-180, lon_0+180]</span>
<span class="sd">                         interval back into the interval.</span>
<span class="sd">                         If False do not reindex longitudes and data, but do</span>
<span class="sd">                         make sure that longitudes are in the</span>
<span class="sd">                         [lon_0-180, lon_0+180] range.</span>
<span class="sd">        ================ ======================================================</span>

<span class="sd">        If datain is given, returns ``lonsout, dataout`` (longitudes and data</span>
<span class="sd">        shifted to fit in the interval [lon_0-180, lon_0+180]); otherwise,</span>
<span class="sd">        returns just the shifted longitudes. If transformed longitudes lie</span>
<span class="sd">        outside the map projection region, data is masked and longitudes are</span>
<span class="sd">        set to 1.e30.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">lon_0</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="s1">&#39;lon_0&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">projparams</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;lon_0 keyword must be provided&#39;</span><span class="p">)</span>
        <span class="n">lonsin</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">lonsin</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">lonsin</span><span class="o">.</span><span class="n">ndim</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">]:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;1-d or 2-d longitudes required&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">datain</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># if it&#39;s a masked array, leave it alone.</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">ma</span><span class="o">.</span><span class="n">isMA</span><span class="p">(</span><span class="n">datain</span><span class="p">):</span> <span class="n">datain</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">datain</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">datain</span><span class="o">.</span><span class="n">ndim</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">]:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;1-d or 2-d data required&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">lon_0</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">lon_0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">projparams</span><span class="p">[</span><span class="s1">&#39;lon_0&#39;</span><span class="p">]</span>
        <span class="c1"># 2-d data.</span>
        <span class="k">if</span> <span class="n">lonsin</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">nlats</span> <span class="o">=</span> <span class="n">lonsin</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">nlons</span> <span class="o">=</span> <span class="n">lonsin</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">lonsin1</span> <span class="o">=</span> <span class="n">lonsin</span><span class="p">[</span><span class="mi">0</span><span class="p">,:]</span>
            <span class="n">lonsin1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">lonsin1</span> <span class="o">&gt;</span> <span class="n">lon_0</span><span class="o">+</span><span class="mi">180</span><span class="p">,</span> <span class="n">lonsin1</span><span class="o">-</span><span class="mi">360</span> <span class="p">,</span><span class="n">lonsin1</span><span class="p">)</span>
            <span class="n">lonsin1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">lonsin1</span> <span class="o">&lt;</span> <span class="n">lon_0</span><span class="o">-</span><span class="mi">180</span><span class="p">,</span> <span class="n">lonsin1</span><span class="o">+</span><span class="mi">360</span> <span class="p">,</span><span class="n">lonsin1</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">nlons</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">londiff</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">lonsin1</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">lonsin1</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>
                <span class="n">londiff_sort</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">londiff</span><span class="p">)</span>
                <span class="n">thresh</span> <span class="o">=</span> <span class="mf">360.</span><span class="o">-</span><span class="n">londiff_sort</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span> <span class="k">if</span> <span class="n">nlons</span> <span class="o">&gt;</span> <span class="mi">2</span> <span class="k">else</span> <span class="mf">360.</span><span class="o">-</span><span class="n">londiff_sort</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">itemindex</span> <span class="o">=</span> <span class="n">nlons</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">londiff</span><span class="o">&gt;=</span><span class="n">thresh</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">lonsin</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">lonsin1</span>
                <span class="n">itemindex</span> <span class="o">=</span> <span class="mi">0</span>

            <span class="c1"># if no shift necessary, itemindex will be</span>
            <span class="c1"># empty, so don&#39;t do anything</span>
            <span class="k">if</span> <span class="n">fix_wrap_around</span> <span class="ow">and</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">itemindex</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="ow">and</span> <span class="n">itemindex</span><span class="o">.</span><span class="n">size</span><span class="p">:</span>
                <span class="c1"># check to see if cyclic (wraparound) point included</span>
                <span class="c1"># if so, remove it.</span>
                <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">lonsin1</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="n">lonsin1</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="o">&lt;</span> <span class="mf">1.e-4</span><span class="p">:</span>
                    <span class="n">hascyclic</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="n">lonsin_save</span> <span class="o">=</span> <span class="n">lonsin</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
                    <span class="n">lonsin</span> <span class="o">=</span> <span class="n">lonsin</span><span class="p">[:,</span><span class="mi">1</span><span class="p">:]</span>
                    <span class="k">if</span> <span class="n">datain</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                       <span class="n">datain_save</span> <span class="o">=</span> <span class="n">datain</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
                       <span class="n">datain</span> <span class="o">=</span> <span class="n">datain</span><span class="p">[:,</span><span class="mi">1</span><span class="p">:]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">hascyclic</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="n">lonsin</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">lonsin</span> <span class="o">&gt;</span> <span class="n">lon_0</span><span class="o">+</span><span class="mi">180</span><span class="p">,</span> <span class="n">lonsin</span><span class="o">-</span><span class="mi">360</span> <span class="p">,</span><span class="n">lonsin</span><span class="p">)</span>
                <span class="n">lonsin</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">lonsin</span> <span class="o">&lt;</span> <span class="n">lon_0</span><span class="o">-</span><span class="mi">180</span><span class="p">,</span> <span class="n">lonsin</span><span class="o">+</span><span class="mi">360</span> <span class="p">,</span><span class="n">lonsin</span><span class="p">)</span>
                <span class="n">lonsin</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">roll</span><span class="p">(</span><span class="n">lonsin</span><span class="p">,</span><span class="n">itemindex</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">datain</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="c1"># np.roll works on ndarrays and on masked arrays</span>
                    <span class="n">datain</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">roll</span><span class="p">(</span><span class="n">datain</span><span class="p">,</span><span class="n">itemindex</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
                <span class="c1"># add cyclic point back at beginning.</span>
                <span class="k">if</span> <span class="n">hascyclic</span><span class="p">:</span>
                    <span class="n">lonsin_save</span><span class="p">[:,</span><span class="mi">1</span><span class="p">:]</span> <span class="o">=</span> <span class="n">lonsin</span>
                    <span class="n">lonsin_save</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">lonsin</span><span class="p">[:,</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="mf">360.</span>
                    <span class="n">lonsin</span> <span class="o">=</span> <span class="n">lonsin_save</span>
                    <span class="k">if</span> <span class="n">datain</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="n">datain_save</span><span class="p">[:,</span><span class="mi">1</span><span class="p">:]</span> <span class="o">=</span> <span class="n">datain</span>
                        <span class="n">datain_save</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">datain</span><span class="p">[:,</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                        <span class="n">datain</span> <span class="o">=</span> <span class="n">datain_save</span>

        <span class="c1"># 1-d data.</span>
        <span class="k">elif</span> <span class="n">lonsin</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">nlons</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">lonsin</span><span class="p">)</span>
            <span class="n">lonsin</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">lonsin</span> <span class="o">&gt;</span> <span class="n">lon_0</span><span class="o">+</span><span class="mi">180</span><span class="p">,</span> <span class="n">lonsin</span><span class="o">-</span><span class="mi">360</span> <span class="p">,</span><span class="n">lonsin</span><span class="p">)</span>
            <span class="n">lonsin</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">lonsin</span> <span class="o">&lt;</span> <span class="n">lon_0</span><span class="o">-</span><span class="mi">180</span><span class="p">,</span> <span class="n">lonsin</span><span class="o">+</span><span class="mi">360</span> <span class="p">,</span><span class="n">lonsin</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">nlons</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">londiff</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">lonsin</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">lonsin</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>
                <span class="n">londiff_sort</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">londiff</span><span class="p">)</span>
                <span class="n">thresh</span> <span class="o">=</span> <span class="mf">360.</span><span class="o">-</span><span class="n">londiff_sort</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span> <span class="k">if</span> <span class="n">nlons</span> <span class="o">&gt;</span> <span class="mi">2</span> <span class="k">else</span> <span class="mf">360.0</span> <span class="o">-</span> <span class="n">londiff_sort</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">itemindex</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">lonsin</span><span class="p">)</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">londiff</span><span class="o">&gt;=</span><span class="n">thresh</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">itemindex</span> <span class="o">=</span> <span class="mi">0</span>

            <span class="k">if</span> <span class="n">fix_wrap_around</span> <span class="ow">and</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">itemindex</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="ow">and</span> <span class="n">itemindex</span><span class="o">.</span><span class="n">size</span><span class="p">:</span>
                <span class="c1"># check to see if cyclic (wraparound) point included</span>
                <span class="c1"># if so, remove it.</span>
                <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">lonsin</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="n">lonsin</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="o">&lt;</span> <span class="mf">1.e-4</span><span class="p">:</span>
                    <span class="n">hascyclic</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="n">lonsin_save</span> <span class="o">=</span> <span class="n">lonsin</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
                    <span class="n">lonsin</span> <span class="o">=</span> <span class="n">lonsin</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
                    <span class="k">if</span> <span class="n">datain</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="n">datain_save</span> <span class="o">=</span> <span class="n">datain</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
                        <span class="n">datain</span> <span class="o">=</span> <span class="n">datain</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">hascyclic</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="n">lonsin</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">roll</span><span class="p">(</span><span class="n">lonsin</span><span class="p">,</span><span class="n">itemindex</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">datain</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">datain</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">roll</span><span class="p">(</span><span class="n">datain</span><span class="p">,</span><span class="n">itemindex</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
                <span class="c1"># add cyclic point back at beginning.</span>
                <span class="k">if</span> <span class="n">hascyclic</span><span class="p">:</span>
                    <span class="n">lonsin_save</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="o">=</span> <span class="n">lonsin</span>
                    <span class="n">lonsin_save</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">lonsin</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="mf">360.</span>
                    <span class="n">lonsin</span> <span class="o">=</span> <span class="n">lonsin_save</span>
                    <span class="k">if</span> <span class="n">datain</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="n">datain_save</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="o">=</span> <span class="n">datain</span>
                        <span class="n">datain_save</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">datain</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                        <span class="n">datain</span> <span class="o">=</span> <span class="n">datain_save</span>

        <span class="c1"># mask points outside</span>
        <span class="c1"># map region so they don&#39;t wrap back in the domain.</span>
        <span class="n">mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logical_or</span><span class="p">(</span><span class="n">lonsin</span><span class="o">&lt;</span><span class="n">lon_0</span><span class="o">-</span><span class="mi">180</span><span class="p">,</span><span class="n">lonsin</span><span class="o">&gt;</span><span class="n">lon_0</span><span class="o">+</span><span class="mi">180</span><span class="p">)</span>
        <span class="n">lonsin</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">mask</span><span class="p">,</span><span class="mf">1.e30</span><span class="p">,</span><span class="n">lonsin</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">datain</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">mask</span><span class="o">.</span><span class="n">any</span><span class="p">():</span>
            <span class="n">datain</span> <span class="o">=</span> <span class="n">ma</span><span class="o">.</span><span class="n">masked_where</span><span class="p">(</span><span class="n">mask</span><span class="p">,</span> <span class="n">datain</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">datain</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">lonsin</span><span class="p">,</span> <span class="n">datain</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">lonsin</span></div>
</div>


<span class="c1">### End of Basemap class</span>

<span class="k">def</span><span class="w"> </span><span class="nf">_searchlist</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">x</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    like bisect, but works for lists that are not sorted,</span>
<span class="sd">    and are not in increasing order.</span>
<span class="sd">    returns -1 if x does not fall between any two elements&quot;&quot;&quot;</span>
    <span class="c1"># make sure x is a float (and not an array scalar)</span>
    <span class="n">x</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="n">itemprev</span> <span class="o">=</span> <span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">nslot</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
    <span class="n">eps</span> <span class="o">=</span> <span class="mf">180.</span>
    <span class="k">for</span> <span class="n">n</span><span class="p">,</span><span class="n">item</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="mi">1</span><span class="p">:]):</span>
        <span class="k">if</span> <span class="n">item</span> <span class="o">&lt;</span> <span class="n">itemprev</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">itemprev</span><span class="o">-</span><span class="n">item</span><span class="o">&gt;</span><span class="n">eps</span><span class="p">:</span>
                <span class="k">if</span> <span class="p">((</span><span class="n">x</span><span class="o">&gt;</span><span class="n">itemprev</span> <span class="ow">and</span> <span class="n">x</span><span class="o">&lt;=</span><span class="mf">360.</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">x</span><span class="o">&lt;</span><span class="n">item</span> <span class="ow">and</span> <span class="n">x</span><span class="o">&gt;=</span><span class="mf">0.</span><span class="p">)):</span>
                    <span class="n">nslot</span> <span class="o">=</span> <span class="n">n</span><span class="o">+</span><span class="mi">1</span>
                    <span class="k">break</span>
            <span class="k">elif</span> <span class="n">x</span> <span class="o">&lt;=</span> <span class="n">itemprev</span> <span class="ow">and</span> <span class="n">x</span> <span class="o">&gt;</span> <span class="n">item</span> <span class="ow">and</span> <span class="n">itemprev</span><span class="p">:</span>
                <span class="n">nslot</span> <span class="o">=</span> <span class="n">n</span><span class="o">+</span><span class="mi">1</span>
                <span class="k">break</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">item</span><span class="o">-</span><span class="n">itemprev</span><span class="o">&gt;</span><span class="n">eps</span><span class="p">:</span>
                <span class="k">if</span> <span class="p">((</span><span class="n">x</span><span class="o">&lt;</span><span class="n">itemprev</span> <span class="ow">and</span> <span class="n">x</span><span class="o">&gt;=</span><span class="mf">0.</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">x</span><span class="o">&gt;</span><span class="n">item</span> <span class="ow">and</span> <span class="n">x</span><span class="o">&lt;=</span><span class="mf">360.</span><span class="p">)):</span>
                    <span class="n">nslot</span> <span class="o">=</span> <span class="n">n</span><span class="o">+</span><span class="mi">1</span>
                    <span class="k">break</span>
            <span class="k">elif</span> <span class="n">x</span> <span class="o">&gt;=</span> <span class="n">itemprev</span> <span class="ow">and</span> <span class="n">x</span> <span class="o">&lt;</span> <span class="n">item</span><span class="p">:</span>
                <span class="n">nslot</span> <span class="o">=</span> <span class="n">n</span><span class="o">+</span><span class="mi">1</span>
                <span class="k">break</span>
        <span class="n">itemprev</span> <span class="o">=</span> <span class="n">item</span>
    <span class="k">return</span> <span class="n">nslot</span>

<div class="viewcode-block" id="interp">
<a class="viewcode-back" href="../../api/basemap_api.html#mpl_toolkits.basemap.interp">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">interp</span><span class="p">(</span><span class="n">datain</span><span class="p">,</span><span class="n">xin</span><span class="p">,</span><span class="n">yin</span><span class="p">,</span><span class="n">xout</span><span class="p">,</span><span class="n">yout</span><span class="p">,</span><span class="n">checkbounds</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">masked</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">order</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Interpolate data (``datain``) on a rectilinear grid (with x = ``xin``</span>
<span class="sd">    y = ``yin``) to a grid with x = ``xout``, y= ``yout``.</span>

<span class="sd">    .. tabularcolumns:: |l|L|</span>

<span class="sd">    ==============   ====================================================</span>
<span class="sd">    Arguments        Description</span>
<span class="sd">    ==============   ====================================================</span>
<span class="sd">    datain           a rank-2 array with 1st dimension corresponding to</span>
<span class="sd">                     y, 2nd dimension x.</span>
<span class="sd">    xin, yin         rank-1 arrays containing x and y of</span>
<span class="sd">                     datain grid in increasing order.</span>
<span class="sd">    xout, yout       rank-2 arrays containing x and y of desired output grid.</span>
<span class="sd">    ==============   ====================================================</span>

<span class="sd">    .. tabularcolumns:: |l|L|</span>

<span class="sd">    ==============   ====================================================</span>
<span class="sd">    Keywords         Description</span>
<span class="sd">    ==============   ====================================================</span>
<span class="sd">    checkbounds      If True, values of xout and yout are checked to see</span>
<span class="sd">                     that they lie within the range specified by xin</span>
<span class="sd">                     and xin.</span>
<span class="sd">                     If False, and xout,yout are outside xin,yin,</span>
<span class="sd">                     interpolated values will be clipped to values on</span>
<span class="sd">                     boundary of input grid (xin,yin)</span>
<span class="sd">                     Default is False.</span>
<span class="sd">    masked           If True, points outside the range of xin and yin</span>
<span class="sd">                     are masked (in a masked array).</span>
<span class="sd">                     If masked is set to a number, then</span>
<span class="sd">                     points outside the range of xin and yin will be</span>
<span class="sd">                     set to that number. Default False.</span>
<span class="sd">    order            0 for nearest-neighbor interpolation, 1 for</span>
<span class="sd">                     bilinear interpolation, 3 for cublic spline</span>
<span class="sd">                     (default 1). order=3 requires scipy.ndimage.</span>
<span class="sd">    ==============   ====================================================</span>

<span class="sd">    .. note::</span>
<span class="sd">     If datain is a masked array and order=1 (bilinear interpolation) is</span>
<span class="sd">     used, elements of dataout will be masked if any of the four surrounding</span>
<span class="sd">     points in datain are masked.  To avoid this, do the interpolation in two</span>
<span class="sd">     passes, first with order=1 (producing dataout1), then with order=0</span>
<span class="sd">     (producing dataout2).  Then replace all the masked values in dataout1</span>
<span class="sd">     with the corresponding elements in dataout2 (using numpy.where).</span>
<span class="sd">     This effectively uses nearest neighbor interpolation if any of the</span>
<span class="sd">     four surrounding points in datain are masked, and bilinear interpolation</span>
<span class="sd">     otherwise.</span>

<span class="sd">    Returns ``dataout``, the interpolated data on the grid ``xout, yout``.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># xin and yin must be monotonically increasing.</span>
    <span class="k">if</span> <span class="n">xin</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">xin</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">yin</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">yin</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;xin and yin must be increasing!&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">xout</span><span class="o">.</span><span class="n">shape</span> <span class="o">!=</span> <span class="n">yout</span><span class="o">.</span><span class="n">shape</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;xout and yout must have same shape!&#39;</span><span class="p">)</span>
    <span class="c1"># check that xout,yout are</span>
    <span class="c1"># within region defined by xin,yin.</span>
    <span class="k">if</span> <span class="n">checkbounds</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">xout</span><span class="o">.</span><span class="n">min</span><span class="p">()</span> <span class="o">&lt;</span> <span class="n">xin</span><span class="o">.</span><span class="n">min</span><span class="p">()</span> <span class="ow">or</span> \
           <span class="n">xout</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">&gt;</span> <span class="n">xin</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="ow">or</span> \
           <span class="n">yout</span><span class="o">.</span><span class="n">min</span><span class="p">()</span> <span class="o">&lt;</span> <span class="n">yin</span><span class="o">.</span><span class="n">min</span><span class="p">()</span> <span class="ow">or</span> \
           <span class="n">yout</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">&gt;</span> <span class="n">yin</span><span class="o">.</span><span class="n">max</span><span class="p">():</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;yout or xout outside range of yin or xin&#39;</span><span class="p">)</span>
    <span class="c1"># compute grid coordinates of output grid.</span>
    <span class="n">delx</span> <span class="o">=</span> <span class="n">xin</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span><span class="o">-</span><span class="n">xin</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">dely</span> <span class="o">=</span> <span class="n">yin</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span><span class="o">-</span><span class="n">yin</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="k">if</span> <span class="nb">max</span><span class="p">(</span><span class="n">delx</span><span class="p">)</span><span class="o">-</span><span class="nb">min</span><span class="p">(</span><span class="n">delx</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">1.e-4</span> <span class="ow">and</span> <span class="nb">max</span><span class="p">(</span><span class="n">dely</span><span class="p">)</span><span class="o">-</span><span class="nb">min</span><span class="p">(</span><span class="n">dely</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">1.e-4</span><span class="p">:</span>
        <span class="c1"># regular input grid.</span>
        <span class="n">xcoords</span> <span class="o">=</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">xin</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">xout</span><span class="o">-</span><span class="n">xin</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">/</span><span class="p">(</span><span class="n">xin</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">xin</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">ycoords</span> <span class="o">=</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">yin</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">yout</span><span class="o">-</span><span class="n">yin</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">/</span><span class="p">(</span><span class="n">yin</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">yin</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># irregular (but still rectilinear) input grid.</span>
        <span class="n">xoutflat</span> <span class="o">=</span> <span class="n">xout</span><span class="o">.</span><span class="n">flatten</span><span class="p">();</span> <span class="n">youtflat</span> <span class="o">=</span> <span class="n">yout</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
        <span class="n">ix</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">searchsorted</span><span class="p">(</span><span class="n">xin</span><span class="p">,</span><span class="n">xoutflat</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
        <span class="n">iy</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">searchsorted</span><span class="p">(</span><span class="n">yin</span><span class="p">,</span><span class="n">youtflat</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
        <span class="n">xoutflat</span> <span class="o">=</span> <span class="n">xoutflat</span><span class="o">.</span><span class="n">tolist</span><span class="p">();</span> <span class="n">xin</span> <span class="o">=</span> <span class="n">xin</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
        <span class="n">youtflat</span> <span class="o">=</span> <span class="n">youtflat</span><span class="o">.</span><span class="n">tolist</span><span class="p">();</span> <span class="n">yin</span> <span class="o">=</span> <span class="n">yin</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
        <span class="n">xcoords</span> <span class="o">=</span> <span class="p">[];</span> <span class="n">ycoords</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">n</span><span class="p">,</span><span class="n">i</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">ix</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">xcoords</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="c1"># outside of range on xin (lower end)</span>
            <span class="k">elif</span> <span class="n">i</span> <span class="o">&gt;=</span> <span class="nb">len</span><span class="p">(</span><span class="n">xin</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                <span class="n">xcoords</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">xin</span><span class="p">))</span> <span class="c1"># outside range on upper end.</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">xcoords</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">+</span><span class="p">(</span><span class="n">xoutflat</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">-</span><span class="n">xin</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="o">/</span><span class="p">(</span><span class="n">xin</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">xin</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>
        <span class="k">for</span> <span class="n">m</span><span class="p">,</span><span class="n">j</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">iy</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">ycoords</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="c1"># outside of range of yin (on lower end)</span>
            <span class="k">elif</span> <span class="n">j</span> <span class="o">&gt;=</span> <span class="nb">len</span><span class="p">(</span><span class="n">yin</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                <span class="n">ycoords</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">yin</span><span class="p">))</span> <span class="c1"># outside range on upper end</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">ycoords</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">j</span><span class="p">)</span><span class="o">+</span><span class="p">(</span><span class="n">youtflat</span><span class="p">[</span><span class="n">m</span><span class="p">]</span><span class="o">-</span><span class="n">yin</span><span class="p">[</span><span class="n">j</span><span class="p">])</span><span class="o">/</span><span class="p">(</span><span class="n">yin</span><span class="p">[</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">yin</span><span class="p">[</span><span class="n">j</span><span class="p">]))</span>
        <span class="n">xcoords</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">xcoords</span><span class="p">,</span><span class="n">xout</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
        <span class="n">ycoords</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">ycoords</span><span class="p">,</span><span class="n">yout</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
    <span class="c1"># data outside range xin,yin will be clipped to</span>
    <span class="c1"># values on boundary.</span>
    <span class="k">if</span> <span class="n">masked</span><span class="p">:</span>
        <span class="n">xmask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logical_or</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">less</span><span class="p">(</span><span class="n">xcoords</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span><span class="n">np</span><span class="o">.</span><span class="n">greater</span><span class="p">(</span><span class="n">xcoords</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">xin</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span>
        <span class="n">ymask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logical_or</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">less</span><span class="p">(</span><span class="n">ycoords</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span><span class="n">np</span><span class="o">.</span><span class="n">greater</span><span class="p">(</span><span class="n">ycoords</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">yin</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span>
        <span class="n">xymask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logical_or</span><span class="p">(</span><span class="n">xmask</span><span class="p">,</span><span class="n">ymask</span><span class="p">)</span>
    <span class="n">xcoords</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">xcoords</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">xin</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">ycoords</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">ycoords</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">yin</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
    <span class="c1"># interpolate to output grid using bilinear interpolation.</span>
    <span class="k">if</span> <span class="n">order</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">xi</span> <span class="o">=</span> <span class="n">xcoords</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span>
        <span class="n">yi</span> <span class="o">=</span> <span class="n">ycoords</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span>
        <span class="n">xip1</span> <span class="o">=</span> <span class="n">xi</span><span class="o">+</span><span class="mi">1</span>
        <span class="n">yip1</span> <span class="o">=</span> <span class="n">yi</span><span class="o">+</span><span class="mi">1</span>
        <span class="n">xip1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">xip1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">xin</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">yip1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">yip1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">yin</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">delx</span> <span class="o">=</span> <span class="n">xcoords</span><span class="o">-</span><span class="n">xi</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
        <span class="n">dely</span> <span class="o">=</span> <span class="n">ycoords</span><span class="o">-</span><span class="n">yi</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
        <span class="n">dataout</span> <span class="o">=</span> <span class="p">(</span><span class="mf">1.</span><span class="o">-</span><span class="n">delx</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="mf">1.</span><span class="o">-</span><span class="n">dely</span><span class="p">)</span><span class="o">*</span><span class="n">datain</span><span class="p">[</span><span class="n">yi</span><span class="p">,</span><span class="n">xi</span><span class="p">]</span> <span class="o">+</span> \
                  <span class="n">delx</span><span class="o">*</span><span class="n">dely</span><span class="o">*</span><span class="n">datain</span><span class="p">[</span><span class="n">yip1</span><span class="p">,</span><span class="n">xip1</span><span class="p">]</span> <span class="o">+</span> \
                  <span class="p">(</span><span class="mf">1.</span><span class="o">-</span><span class="n">delx</span><span class="p">)</span><span class="o">*</span><span class="n">dely</span><span class="o">*</span><span class="n">datain</span><span class="p">[</span><span class="n">yip1</span><span class="p">,</span><span class="n">xi</span><span class="p">]</span> <span class="o">+</span> \
                  <span class="n">delx</span><span class="o">*</span><span class="p">(</span><span class="mf">1.</span><span class="o">-</span><span class="n">dely</span><span class="p">)</span><span class="o">*</span><span class="n">datain</span><span class="p">[</span><span class="n">yi</span><span class="p">,</span><span class="n">xip1</span><span class="p">]</span>
    <span class="k">elif</span> <span class="n">order</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">xcoordsi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">xcoords</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span>
        <span class="n">ycoordsi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">ycoords</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span>
        <span class="n">dataout</span> <span class="o">=</span> <span class="n">datain</span><span class="p">[</span><span class="n">ycoordsi</span><span class="p">,</span><span class="n">xcoordsi</span><span class="p">]</span>
    <span class="k">elif</span> <span class="n">order</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="kn">from</span><span class="w"> </span><span class="nn">scipy.ndimage</span><span class="w"> </span><span class="kn">import</span> <span class="n">map_coordinates</span>
        <span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;scipy.ndimage must be installed if order=3&#39;</span><span class="p">)</span>
        <span class="n">coords</span> <span class="o">=</span> <span class="p">[</span><span class="n">ycoords</span><span class="p">,</span><span class="n">xcoords</span><span class="p">]</span>
        <span class="n">dataout</span> <span class="o">=</span> <span class="n">map_coordinates</span><span class="p">(</span><span class="n">datain</span><span class="p">,</span><span class="n">coords</span><span class="p">,</span><span class="n">order</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span><span class="n">mode</span><span class="o">=</span><span class="s1">&#39;nearest&#39;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;order keyword must be 0, 1 or 3&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">masked</span><span class="p">:</span>
        <span class="n">newmask</span> <span class="o">=</span> <span class="n">ma</span><span class="o">.</span><span class="n">mask_or</span><span class="p">(</span><span class="n">ma</span><span class="o">.</span><span class="n">getmask</span><span class="p">(</span><span class="n">dataout</span><span class="p">),</span> <span class="n">xymask</span><span class="p">)</span>
        <span class="n">dataout</span> <span class="o">=</span> <span class="n">ma</span><span class="o">.</span><span class="n">masked_array</span><span class="p">(</span><span class="n">dataout</span><span class="p">,</span> <span class="n">mask</span><span class="o">=</span><span class="n">newmask</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">masked</span><span class="p">,</span> <span class="nb">bool</span><span class="p">):</span>
            <span class="n">dataout</span> <span class="o">=</span> <span class="n">dataout</span><span class="o">.</span><span class="n">filled</span><span class="p">(</span><span class="n">masked</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">dataout</span></div>


<div class="viewcode-block" id="shiftgrid">
<a class="viewcode-back" href="../../api/basemap_api.html#mpl_toolkits.basemap.shiftgrid">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">shiftgrid</span><span class="p">(</span><span class="n">lon0</span><span class="p">,</span><span class="n">datain</span><span class="p">,</span><span class="n">lonsin</span><span class="p">,</span><span class="n">start</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">cyclic</span><span class="o">=</span><span class="mf">360.0</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Shift global lat/lon grid east or west.</span>

<span class="sd">    .. tabularcolumns:: |l|L|</span>

<span class="sd">    ==============   ====================================================</span>
<span class="sd">    Arguments        Description</span>
<span class="sd">    ==============   ====================================================</span>
<span class="sd">    lon0             starting longitude for shifted grid</span>
<span class="sd">                     (ending longitude if start=False). lon0 must be on</span>
<span class="sd">                     input grid (within the range of lonsin).</span>
<span class="sd">    datain           original data with longitude the right-most</span>
<span class="sd">                     dimension.</span>
<span class="sd">    lonsin           original longitudes.</span>
<span class="sd">    ==============   ====================================================</span>

<span class="sd">    .. tabularcolumns:: |l|L|</span>

<span class="sd">    ==============   ====================================================</span>
<span class="sd">    Keywords         Description</span>
<span class="sd">    ==============   ====================================================</span>
<span class="sd">    start            if True, lon0 represents the starting longitude</span>
<span class="sd">                     of the new grid. if False, lon0 is the ending</span>
<span class="sd">                     longitude. Default True.</span>
<span class="sd">    cyclic           width of periodic domain (default 360)</span>
<span class="sd">    ==============   ====================================================</span>

<span class="sd">    returns ``dataout,lonsout`` (data and longitudes on shifted grid).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">fabs</span><span class="p">(</span><span class="n">lonsin</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">lonsin</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="n">cyclic</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mf">1.e-4</span><span class="p">:</span>
        <span class="c1"># Use all data instead of raise ValueError, &#39;cyclic point not included&#39;</span>
        <span class="n">start_idx</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># If cyclic, remove the duplicate point</span>
        <span class="n">start_idx</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="k">if</span> <span class="n">lon0</span> <span class="o">&lt;</span> <span class="n">lonsin</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">or</span> <span class="n">lon0</span> <span class="o">&gt;</span> <span class="n">lonsin</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;lon0 outside of range of lonsin&#39;</span><span class="p">)</span>
    <span class="n">i0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">fabs</span><span class="p">(</span><span class="n">lonsin</span><span class="o">-</span><span class="n">lon0</span><span class="p">))</span>
    <span class="n">i0_shift</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">lonsin</span><span class="p">)</span><span class="o">-</span><span class="n">i0</span>
    <span class="k">if</span> <span class="n">ma</span><span class="o">.</span><span class="n">isMA</span><span class="p">(</span><span class="n">datain</span><span class="p">):</span>
        <span class="n">dataout</span>  <span class="o">=</span> <span class="n">ma</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">datain</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span><span class="n">datain</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">dataout</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">datain</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span><span class="n">datain</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">ma</span><span class="o">.</span><span class="n">isMA</span><span class="p">(</span><span class="n">lonsin</span><span class="p">):</span>
        <span class="n">lonsout</span> <span class="o">=</span> <span class="n">ma</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">lonsin</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span><span class="n">lonsin</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">lonsout</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">lonsin</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span><span class="n">lonsin</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">start</span><span class="p">:</span>
        <span class="n">lonsout</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">i0_shift</span><span class="p">]</span> <span class="o">=</span> <span class="n">lonsin</span><span class="p">[</span><span class="n">i0</span><span class="p">:]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">lonsout</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">i0_shift</span><span class="p">]</span> <span class="o">=</span> <span class="n">lonsin</span><span class="p">[</span><span class="n">i0</span><span class="p">:]</span><span class="o">-</span><span class="n">cyclic</span>
    <span class="n">dataout</span><span class="p">[</span><span class="o">...</span><span class="p">,</span><span class="mi">0</span><span class="p">:</span><span class="n">i0_shift</span><span class="p">]</span> <span class="o">=</span> <span class="n">datain</span><span class="p">[</span><span class="o">...</span><span class="p">,</span><span class="n">i0</span><span class="p">:]</span>
    <span class="k">if</span> <span class="n">start</span><span class="p">:</span>
        <span class="n">lonsout</span><span class="p">[</span><span class="n">i0_shift</span><span class="p">:]</span> <span class="o">=</span> <span class="n">lonsin</span><span class="p">[</span><span class="n">start_idx</span><span class="p">:</span><span class="n">i0</span><span class="o">+</span><span class="n">start_idx</span><span class="p">]</span><span class="o">+</span><span class="n">cyclic</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">lonsout</span><span class="p">[</span><span class="n">i0_shift</span><span class="p">:]</span> <span class="o">=</span> <span class="n">lonsin</span><span class="p">[</span><span class="n">start_idx</span><span class="p">:</span><span class="n">i0</span><span class="o">+</span><span class="n">start_idx</span><span class="p">]</span>
    <span class="n">dataout</span><span class="p">[</span><span class="o">...</span><span class="p">,</span><span class="n">i0_shift</span><span class="p">:]</span> <span class="o">=</span> <span class="n">datain</span><span class="p">[</span><span class="o">...</span><span class="p">,</span><span class="n">start_idx</span><span class="p">:</span><span class="n">i0</span><span class="o">+</span><span class="n">start_idx</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">dataout</span><span class="p">,</span><span class="n">lonsout</span></div>


<div class="viewcode-block" id="addcyclic">
<a class="viewcode-back" href="../../api/basemap_api.html#mpl_toolkits.basemap.addcyclic">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">addcyclic</span><span class="p">(</span><span class="o">*</span><span class="n">arr</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Adds cyclic (wraparound) points in longitude to one or several arrays,</span>
<span class="sd">    the last array being longitudes in degrees. e.g.</span>

<span class="sd">   ``data1out, data2out, lonsout = addcyclic(data1,data2,lons)``</span>

<span class="sd">    ==============   ====================================================</span>
<span class="sd">    Keywords         Description</span>
<span class="sd">    ==============   ====================================================</span>
<span class="sd">    axis             the dimension representing longitude (default -1,</span>
<span class="sd">                     or right-most)</span>
<span class="sd">    cyclic           width of periodic domain (default 360)</span>
<span class="sd">    ==============   ====================================================</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># get (default) keyword arguments</span>
    <span class="n">axis</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;axis&#39;</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">cyclic</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;cyclic&#39;</span><span class="p">,</span><span class="mi">360</span><span class="p">)</span>
    <span class="c1"># define functions</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_addcyclic</span><span class="p">(</span><span class="n">a</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;addcyclic function for a single data array&quot;&quot;&quot;</span>
        <span class="n">npsel</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span> <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">is_masked</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="k">else</span> <span class="n">np</span>
        <span class="n">slicer</span> <span class="o">=</span> <span class="p">[</span><span class="nb">slice</span><span class="p">(</span><span class="kc">None</span><span class="p">)]</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">ndim</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">slicer</span><span class="p">[</span><span class="n">axis</span><span class="p">]</span> <span class="o">=</span> <span class="nb">slice</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;The specified axis does not correspond to an &#39;</span>
                    <span class="s1">&#39;array dimension.&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">npsel</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">a</span><span class="p">,</span><span class="n">a</span><span class="p">[</span><span class="nb">tuple</span><span class="p">(</span><span class="n">slicer</span><span class="p">)]),</span><span class="n">axis</span><span class="o">=</span><span class="n">axis</span><span class="p">)</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_addcyclic_lon</span><span class="p">(</span><span class="n">a</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;addcyclic function for a single longitude array&quot;&quot;&quot;</span>
        <span class="c1"># select the right numpy functions</span>
        <span class="n">npsel</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span> <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">is_masked</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="k">else</span> <span class="n">np</span>
        <span class="c1"># get cyclic longitudes</span>
        <span class="n">clon</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">take</span><span class="p">(</span><span class="n">a</span><span class="p">,[</span><span class="mi">0</span><span class="p">],</span><span class="n">axis</span><span class="o">=</span><span class="n">axis</span><span class="p">)</span>
                <span class="o">+</span> <span class="n">cyclic</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sign</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">take</span><span class="p">(</span><span class="n">a</span><span class="p">,[</span><span class="mi">0</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span><span class="n">axis</span><span class="o">=</span><span class="n">axis</span><span class="p">),</span><span class="n">axis</span><span class="o">=</span><span class="n">axis</span><span class="p">)))</span>
        <span class="c1"># ensure the values do not exceed cyclic</span>
        <span class="n">clonmod</span> <span class="o">=</span> <span class="n">npsel</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">clon</span><span class="o">&lt;=</span><span class="n">cyclic</span><span class="p">,</span><span class="n">clon</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">mod</span><span class="p">(</span><span class="n">clon</span><span class="p">,</span><span class="n">cyclic</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">npsel</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">a</span><span class="p">,</span><span class="n">clonmod</span><span class="p">),</span><span class="n">axis</span><span class="o">=</span><span class="n">axis</span><span class="p">)</span>
    <span class="c1"># process array(s)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">arr</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">_addcyclic_lon</span><span class="p">(</span><span class="n">arr</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">_addcyclic</span><span class="p">,</span><span class="n">arr</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]))</span> <span class="o">+</span> <span class="p">[</span><span class="n">_addcyclic_lon</span><span class="p">(</span><span class="n">arr</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])]</span></div>


<span class="k">def</span><span class="w"> </span><span class="nf">_choosecorners</span><span class="p">(</span><span class="n">width</span><span class="p">,</span><span class="n">height</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    private function to determine lat/lon values of projection region corners,</span>
<span class="sd">    given width and height of projection region in meters.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">p</span> <span class="o">=</span> <span class="n">pyproj</span><span class="o">.</span><span class="n">Proj</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="n">urcrnrlon</span><span class="p">,</span> <span class="n">urcrnrlat</span> <span class="o">=</span> <span class="n">p</span><span class="p">(</span><span class="mf">0.5</span><span class="o">*</span><span class="n">width</span><span class="p">,</span><span class="mf">0.5</span><span class="o">*</span><span class="n">height</span><span class="p">,</span> <span class="n">inverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">llcrnrlon</span><span class="p">,</span> <span class="n">llcrnrlat</span> <span class="o">=</span> <span class="n">p</span><span class="p">(</span><span class="o">-</span><span class="mf">0.5</span><span class="o">*</span><span class="n">width</span><span class="p">,</span><span class="o">-</span><span class="mf">0.5</span><span class="o">*</span><span class="n">height</span><span class="p">,</span> <span class="n">inverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">corners</span> <span class="o">=</span> <span class="n">llcrnrlon</span><span class="p">,</span><span class="n">llcrnrlat</span><span class="p">,</span><span class="n">urcrnrlon</span><span class="p">,</span><span class="n">urcrnrlat</span>
    <span class="c1"># test for invalid projection points on output</span>
    <span class="k">if</span> <span class="n">llcrnrlon</span> <span class="o">&gt;</span> <span class="mf">1.e20</span> <span class="ow">or</span> <span class="n">urcrnrlon</span> <span class="o">&gt;</span> <span class="mf">1.e20</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;width and/or height too large for this projection, try smaller values&#39;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">corners</span>

<span class="k">def</span><span class="w"> </span><span class="nf">_choosecornersllur</span><span class="p">(</span><span class="n">llcrnrx</span><span class="p">,</span> <span class="n">llcrnry</span><span class="p">,</span> <span class="n">urcrnrx</span><span class="p">,</span> <span class="n">urcrnry</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    private function to determine lat/lon values of projection region corners,</span>
<span class="sd">    given width and height of projection region in meters.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">p</span> <span class="o">=</span> <span class="n">pyproj</span><span class="o">.</span><span class="n">Proj</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="n">urcrnrlon</span><span class="p">,</span> <span class="n">urcrnrlat</span> <span class="o">=</span> <span class="n">p</span><span class="p">(</span><span class="n">urcrnrx</span><span class="p">,</span> <span class="n">urcrnry</span><span class="p">,</span> <span class="n">inverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">llcrnrlon</span><span class="p">,</span> <span class="n">llcrnrlat</span> <span class="o">=</span> <span class="n">p</span><span class="p">(</span><span class="n">llcrnrx</span><span class="p">,</span> <span class="n">llcrnry</span><span class="p">,</span> <span class="n">inverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">corners</span> <span class="o">=</span> <span class="n">llcrnrlon</span><span class="p">,</span><span class="n">llcrnrlat</span><span class="p">,</span><span class="n">urcrnrlon</span><span class="p">,</span><span class="n">urcrnrlat</span>
    <span class="c1"># test for invalid projection points on output</span>
    <span class="k">if</span> <span class="n">llcrnrlon</span> <span class="o">&gt;</span> <span class="mf">1.e20</span> <span class="ow">or</span> <span class="n">urcrnrlon</span> <span class="o">&gt;</span> <span class="mf">1.e20</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;width and/or height too large for this projection, try smaller values&#39;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">corners</span>

<div class="viewcode-block" id="maskoceans">
<a class="viewcode-back" href="../../api/basemap_api.html#mpl_toolkits.basemap.maskoceans">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">maskoceans</span><span class="p">(</span><span class="n">lonsin</span><span class="p">,</span><span class="n">latsin</span><span class="p">,</span><span class="n">datain</span><span class="p">,</span><span class="n">inlands</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">resolution</span><span class="o">=</span><span class="s1">&#39;l&#39;</span><span class="p">,</span><span class="n">grid</span><span class="o">=</span><span class="mi">5</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    mask data (``datain``), defined on a grid with latitudes ``latsin``</span>
<span class="sd">    longitudes ``lonsin`` so that points over water will not be plotted.</span>

<span class="sd">    .. tabularcolumns:: |l|L|</span>

<span class="sd">    ==============   ====================================================</span>
<span class="sd">    Arguments        Description</span>
<span class="sd">    ==============   ====================================================</span>
<span class="sd">    lonsin, latsin   rank-2 arrays containing longitudes and latitudes of</span>
<span class="sd">                     grid.</span>
<span class="sd">    datain           rank-2 input array on grid defined by ``lonsin`` and</span>
<span class="sd">                     ``latsin``.</span>
<span class="sd">    inlands          if False, masked only ocean points and not inland</span>
<span class="sd">                     lakes (Default True).</span>
<span class="sd">    resolution       gshhs coastline resolution used to define land/sea</span>
<span class="sd">                     mask (default &#39;l&#39;, available &#39;c&#39;,&#39;l&#39;,&#39;i&#39;,&#39;h&#39; or &#39;f&#39;)</span>
<span class="sd">    grid             land/sea mask grid spacing in minutes (Default 5;</span>
<span class="sd">                     10, 2.5 and 1.25 are also available).</span>
<span class="sd">    ==============   ====================================================</span>

<span class="sd">    returns a masked array the same shape as datain with &quot;wet&quot; points masked.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># read in land/sea mask.</span>
    <span class="n">lsmask_lons</span><span class="p">,</span> <span class="n">lsmask_lats</span><span class="p">,</span> <span class="n">lsmask</span> <span class="o">=</span>\
    <span class="n">_readlsmask</span><span class="p">(</span><span class="n">lakes</span><span class="o">=</span><span class="n">inlands</span><span class="p">,</span><span class="n">resolution</span><span class="o">=</span><span class="n">resolution</span><span class="p">,</span><span class="n">grid</span><span class="o">=</span><span class="n">grid</span><span class="p">)</span>
    <span class="c1"># nearest-neighbor interpolation to output grid.</span>
    <span class="n">lsmasko</span> <span class="o">=</span> <span class="n">interp</span><span class="p">(</span><span class="n">lsmask</span><span class="p">,</span><span class="n">lsmask_lons</span><span class="p">,</span><span class="n">lsmask_lats</span><span class="p">,</span><span class="n">lonsin</span><span class="p">,</span><span class="n">latsin</span><span class="p">,</span><span class="n">masked</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">order</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="c1"># mask input data.</span>
    <span class="n">mask</span> <span class="o">=</span> <span class="n">lsmasko</span> <span class="o">==</span> <span class="mi">0</span>
    <span class="k">return</span> <span class="n">ma</span><span class="o">.</span><span class="n">masked_array</span><span class="p">(</span><span class="n">datain</span><span class="p">,</span><span class="n">mask</span><span class="o">=</span><span class="n">mask</span><span class="p">)</span></div>


<span class="k">def</span><span class="w"> </span><span class="nf">_readlsmask</span><span class="p">(</span><span class="n">lakes</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">resolution</span><span class="o">=</span><span class="s1">&#39;l&#39;</span><span class="p">,</span><span class="n">grid</span><span class="o">=</span><span class="mi">5</span><span class="p">):</span>
    <span class="c1"># read in land/sea mask.</span>
    <span class="k">if</span> <span class="n">grid</span> <span class="o">==</span> <span class="mi">10</span><span class="p">:</span>
        <span class="n">nlons</span> <span class="o">=</span> <span class="mi">2160</span>
    <span class="k">elif</span> <span class="n">grid</span> <span class="o">==</span> <span class="mi">5</span><span class="p">:</span>
        <span class="n">nlons</span> <span class="o">=</span> <span class="mi">4320</span>
    <span class="k">elif</span> <span class="n">grid</span> <span class="o">==</span> <span class="mf">2.5</span><span class="p">:</span>
        <span class="n">nlons</span> <span class="o">=</span> <span class="mi">8640</span>
    <span class="k">elif</span> <span class="n">grid</span> <span class="o">==</span> <span class="mf">1.25</span><span class="p">:</span>
        <span class="n">nlons</span> <span class="o">=</span> <span class="mi">17280</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;grid for land/sea mask must be 10,5,2.5 or 1.25&#39;</span><span class="p">)</span>
    <span class="n">nlats</span> <span class="o">=</span> <span class="n">nlons</span><span class="o">//</span><span class="mi">2</span>
    <span class="kn">import</span><span class="w"> </span><span class="nn">gzip</span>
    <span class="n">lsmaskf</span> <span class="o">=</span>\
    <span class="n">gzip</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">basemap_datadir</span><span class="p">,</span><span class="s1">&#39;lsmask_</span><span class="si">%s</span><span class="s1">min_</span><span class="si">%s</span><span class="s1">.bin&#39;</span> <span class="o">%</span>\
        <span class="p">(</span><span class="n">grid</span><span class="p">,</span><span class="n">resolution</span><span class="p">)),</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span>
    <span class="n">lsmask</span> <span class="o">=</span>\
    <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">frombuffer</span><span class="p">(</span><span class="n">lsmaskf</span><span class="o">.</span><span class="n">read</span><span class="p">(),</span><span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">),(</span><span class="n">nlats</span><span class="p">,</span><span class="n">nlons</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">lakes</span><span class="p">:</span>
        <span class="n">lsmask</span> <span class="o">=</span>\
        <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">lsmask</span><span class="o">==</span><span class="mi">2</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">),</span><span class="n">lsmask</span><span class="p">)</span>
    <span class="n">lsmaskf</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="n">delta</span> <span class="o">=</span> <span class="mf">360.</span><span class="o">/</span><span class="n">nlons</span>
    <span class="n">lsmask_lons</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">180</span><span class="o">+</span><span class="mf">0.5</span><span class="o">*</span><span class="n">delta</span><span class="p">,</span><span class="mi">180</span><span class="o">-</span><span class="mf">0.5</span><span class="o">*</span><span class="n">delta</span><span class="p">,</span><span class="n">nlons</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
    <span class="n">lsmask_lats</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">90</span><span class="o">+</span><span class="mf">0.5</span><span class="o">*</span><span class="n">delta</span><span class="p">,</span><span class="mi">90</span><span class="o">-</span><span class="mf">0.5</span><span class="o">*</span><span class="n">delta</span><span class="p">,</span><span class="n">nlats</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">lsmask_lons</span><span class="p">,</span> <span class="n">lsmask_lats</span><span class="p">,</span> <span class="n">lsmask</span>

<span class="k">class</span><span class="w"> </span><span class="nc">_tup</span><span class="p">(</span><span class="nb">tuple</span><span class="p">):</span>
    <span class="c1"># tuple with an added remove method.</span>
    <span class="c1"># used for objects returned by drawparallels and drawmeridians.</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">remove</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">item</span><span class="p">:</span>
                <span class="n">x</span><span class="o">.</span><span class="n">remove</span><span class="p">()</span>
<span class="k">class</span><span class="w"> </span><span class="nc">_dict</span><span class="p">(</span><span class="nb">dict</span><span class="p">):</span>
    <span class="c1"># override __delitem__ to first call remove method on values.</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__delitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">key</span><span class="p">):</span>
        <span class="bp">self</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">remove</span><span class="p">()</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">_dict</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__delitem__</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>


<span class="k">def</span><span class="w"> </span><span class="nf">_setlonlab</span><span class="p">(</span><span class="n">fmt</span><span class="p">,</span> <span class="n">lon</span><span class="p">,</span> <span class="n">labelstyle</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Set longitude label string (called by :meth:`Basemap.drawmeridians`).&quot;&quot;&quot;</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># `fmt` is a function that returns a formatted string.</span>
        <span class="n">lonlab</span> <span class="o">=</span> <span class="n">fmt</span><span class="p">(</span><span class="n">lon</span><span class="p">)</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="c1"># `fmt` is a format string.</span>
        <span class="n">degchar</span> <span class="o">=</span> <span class="sa">b</span><span class="s2">&quot;</span><span class="se">\xc2\xb0</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">lon</span> <span class="o">&gt;</span> <span class="mi">180</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">mpl</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s2">&quot;text.usetex&quot;</span><span class="p">]:</span>
                <span class="k">if</span> <span class="n">labelstyle</span> <span class="o">==</span> <span class="s2">&quot;+/-&quot;</span><span class="p">:</span>
                    <span class="n">lonlabstr</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;${\/-</span><span class="si">%s</span><span class="s2">\/^{\circ}}$&quot;</span> <span class="o">%</span> <span class="n">fmt</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">lonlabstr</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;${</span><span class="si">%s</span><span class="s2">\/^{\circ}\/W}$&quot;</span> <span class="o">%</span> <span class="n">fmt</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">labelstyle</span> <span class="o">==</span> <span class="s2">&quot;+/-&quot;</span><span class="p">:</span>
                    <span class="n">lonlabstr</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;-</span><span class="si">%s%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">fmt</span><span class="p">,</span> <span class="n">degchar</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">lonlabstr</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;</span><span class="si">%s%s</span><span class="s2">W&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">fmt</span><span class="p">,</span> <span class="n">degchar</span><span class="p">)</span>
            <span class="n">lonlab</span> <span class="o">=</span> <span class="n">lonlabstr</span> <span class="o">%</span> <span class="n">np</span><span class="o">.</span><span class="n">fabs</span><span class="p">(</span><span class="n">lon</span> <span class="o">-</span> <span class="mi">360</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">lon</span> <span class="o">&lt;</span> <span class="mi">180</span> <span class="ow">and</span> <span class="n">lon</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">mpl</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s2">&quot;text.usetex&quot;</span><span class="p">]:</span>
                <span class="k">if</span> <span class="n">labelstyle</span> <span class="o">==</span> <span class="s2">&quot;+/-&quot;</span><span class="p">:</span>
                    <span class="n">lonlabstr</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;${\/+</span><span class="si">%s</span><span class="s2">\/^{\circ}}$&quot;</span> <span class="o">%</span> <span class="n">fmt</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">lonlabstr</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;${</span><span class="si">%s</span><span class="s2">\/^{\circ}\/E}$&quot;</span> <span class="o">%</span> <span class="n">fmt</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">labelstyle</span> <span class="o">==</span> <span class="s2">&quot;+/-&quot;</span><span class="p">:</span>
                    <span class="n">lonlabstr</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;+</span><span class="si">%s%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">fmt</span><span class="p">,</span> <span class="n">degchar</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">lonlabstr</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;</span><span class="si">%s%s</span><span class="s2">E&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">fmt</span><span class="p">,</span> <span class="n">degchar</span><span class="p">)</span>
            <span class="n">lonlab</span> <span class="o">=</span> <span class="n">lonlabstr</span> <span class="o">%</span> <span class="n">lon</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">mpl</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s2">&quot;text.usetex&quot;</span><span class="p">]:</span>
                <span class="n">lonlabstr</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;${</span><span class="si">%s</span><span class="s2">\/^{\circ}}$&quot;</span> <span class="o">%</span> <span class="n">fmt</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">lonlabstr</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;</span><span class="si">%s%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">fmt</span><span class="p">,</span> <span class="n">degchar</span><span class="p">)</span>
            <span class="n">lonlab</span> <span class="o">=</span> <span class="n">lonlabstr</span> <span class="o">%</span> <span class="n">lon</span>
    <span class="k">return</span> <span class="n">lonlab</span>


<span class="k">def</span><span class="w"> </span><span class="nf">_setlatlab</span><span class="p">(</span><span class="n">fmt</span><span class="p">,</span> <span class="n">lat</span><span class="p">,</span> <span class="n">labelstyle</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Set latitude label string (called by :meth:`Basemap.drawparallels`).&quot;&quot;&quot;</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># `fmt` is a function that returns a formatted string.</span>
        <span class="n">latlab</span> <span class="o">=</span> <span class="n">fmt</span><span class="p">(</span><span class="n">lat</span><span class="p">)</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="c1"># `fmt` is a format string.</span>
        <span class="n">degchar</span> <span class="o">=</span> <span class="sa">b</span><span class="s2">&quot;</span><span class="se">\xc2\xb0</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">lat</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">mpl</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s2">&quot;text.usetex&quot;</span><span class="p">]:</span>
                <span class="k">if</span> <span class="n">labelstyle</span> <span class="o">==</span> <span class="s2">&quot;+/-&quot;</span><span class="p">:</span>
                    <span class="n">latlabstr</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;${\/-</span><span class="si">%s</span><span class="s2">\/^{\circ}}$&quot;</span> <span class="o">%</span> <span class="n">fmt</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">latlabstr</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;${</span><span class="si">%s</span><span class="s2">\/^{\circ}\/S}$&quot;</span> <span class="o">%</span> <span class="n">fmt</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">labelstyle</span> <span class="o">==</span> <span class="s2">&quot;+/-&quot;</span><span class="p">:</span>
                    <span class="n">latlabstr</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;-</span><span class="si">%s%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">fmt</span><span class="p">,</span> <span class="n">degchar</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">latlabstr</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;</span><span class="si">%s%s</span><span class="s2">S&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">fmt</span><span class="p">,</span> <span class="n">degchar</span><span class="p">)</span>
            <span class="n">latlab</span> <span class="o">=</span> <span class="n">latlabstr</span> <span class="o">%</span> <span class="n">np</span><span class="o">.</span><span class="n">fabs</span><span class="p">(</span><span class="n">lat</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">lat</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">mpl</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s2">&quot;text.usetex&quot;</span><span class="p">]:</span>
                <span class="k">if</span> <span class="n">labelstyle</span> <span class="o">==</span> <span class="s2">&quot;+/-&quot;</span><span class="p">:</span>
                    <span class="n">latlabstr</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;${\/+</span><span class="si">%s</span><span class="s2">\/^{\circ}}$&quot;</span> <span class="o">%</span> <span class="n">fmt</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">latlabstr</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;${</span><span class="si">%s</span><span class="s2">\/^{\circ}\/N}$&quot;</span> <span class="o">%</span> <span class="n">fmt</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">labelstyle</span> <span class="o">==</span> <span class="s2">&quot;+/-&quot;</span><span class="p">:</span>
                    <span class="n">latlabstr</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;+</span><span class="si">%s%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">fmt</span><span class="p">,</span> <span class="n">degchar</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">latlabstr</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;</span><span class="si">%s%s</span><span class="s2">N&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">fmt</span><span class="p">,</span> <span class="n">degchar</span><span class="p">)</span>
            <span class="n">latlab</span> <span class="o">=</span> <span class="n">latlabstr</span> <span class="o">%</span> <span class="n">lat</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">mpl</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s2">&quot;text.usetex&quot;</span><span class="p">]:</span>
                <span class="n">latlabstr</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;${</span><span class="si">%s</span><span class="s2">\/^{\circ}}$&quot;</span> <span class="o">%</span> <span class="n">fmt</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">latlabstr</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;</span><span class="si">%s%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">fmt</span><span class="p">,</span> <span class="n">degchar</span><span class="p">)</span>
            <span class="n">latlab</span> <span class="o">=</span> <span class="n">latlabstr</span> <span class="o">%</span> <span class="n">lat</span>
    <span class="k">return</span> <span class="n">latlab</span>
</pre></div>
        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          
          
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            <div class="copyright">
                Copyright &#169; 2011-2014 Jeffrey Whitaker; 2015-2025 The Matplotlib development team
            </div>
            Made with <a href="https://www.sphinx-doc.org/">Sphinx</a> and <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
            
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            
          </div>
          <div class="right-details">
            
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer no-toc">
      
      
      
    </aside>
  </div>
</div><script src="../../_static/documentation_options.js?v=51b770b3"></script>
    <script src="../../_static/doctools.js?v=9a2dae69"></script>
    <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/scripts/furo.js?v=5fa4622c"></script>
    </body>
</html>